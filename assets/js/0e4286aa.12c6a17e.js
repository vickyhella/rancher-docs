"use strict";(self.webpackChunkrancher_docs=self.webpackChunkrancher_docs||[]).push([[92522],{3905:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>m});var a=n(67294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var c=a.createContext({}),s=function(e){var t=a.useContext(c),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},p=function(e){var t=s(e.components);return a.createElement(c.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},u=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,i=e.originalType,c=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),u=s(n),m=r,k=u["".concat(c,".").concat(m)]||u[m]||d[m]||i;return n?a.createElement(k,o(o({ref:t},p),{},{components:n})):a.createElement(k,o({ref:t},p))}));function m(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=n.length,o=new Array(i);o[0]=u;var l={};for(var c in t)hasOwnProperty.call(t,c)&&(l[c]=t[c]);l.originalType=e,l.mdxType="string"==typeof e?e:r,o[1]=l;for(var s=2;s<i;s++)o[s]=n[s];return a.createElement.apply(null,o)}return a.createElement.apply(null,n)}u.displayName="MDXCreateElement"},4187:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>o,default:()=>d,frontMatter:()=>i,metadata:()=>l,toc:()=>s});var a=n(87462),r=(n(67294),n(3905));const i={title:"Backup Configuration"},o=void 0,l={unversionedId:"reference-guides/backup-restore-configuration/backup-configuration",id:"version-2.6/reference-guides/backup-restore-configuration/backup-configuration",title:"Backup Configuration",description:"The Backup Create page lets you configure a schedule, enable encryption and specify the storage location for your backups.",source:"@site/versioned_docs/version-2.6/reference-guides/backup-restore-configuration/backup-configuration.md",sourceDirName:"reference-guides/backup-restore-configuration",slug:"/reference-guides/backup-restore-configuration/backup-configuration",permalink:"/v2.6/reference-guides/backup-restore-configuration/backup-configuration",draft:!1,editUrl:"https://github.com/rancher/rancher-docs/edit/main/versioned_docs/version-2.6/reference-guides/backup-restore-configuration/backup-configuration.md",tags:[],version:"2.6",lastUpdatedAt:1676641701,formattedLastUpdatedAt:"Feb 17, 2023",frontMatter:{title:"Backup Configuration"},sidebar:"tutorialSidebar",previous:{title:"Rancher Backup Configuration Reference",permalink:"/v2.6/pages-for-subheaders/backup-restore-configuration"},next:{title:"Restore Configuration",permalink:"/v2.6/reference-guides/backup-restore-configuration/restore-configuration"}},c={},s=[{value:"Schedule",id:"schedule",level:2},{value:"Encryption",id:"encryption",level:2},{value:"Storage Location",id:"storage-location",level:2},{value:"S3",id:"s3",level:3},{value:"Example S3 Storage Configuration",id:"example-s3-storage-configuration",level:3},{value:"Example MinIO Configuration",id:"example-minio-configuration",level:3},{value:"Example credentialSecret",id:"example-credentialsecret",level:3},{value:"IAM Permissions for EC2 Nodes to Access S3",id:"iam-permissions-for-ec2-nodes-to-access-s3",level:3},{value:"Examples",id:"examples",level:2}],p={toc:s};function d(e){let{components:t,...i}=e;return(0,r.kt)("wrapper",(0,a.Z)({},p,i,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"The Backup Create page lets you configure a schedule, enable encryption and specify the storage location for your backups."),(0,r.kt)("h2",{id:"schedule"},"Schedule"),(0,r.kt)("p",null,"Select the first option to perform a one-time backup, or select the second option to schedule recurring backups. Selecting ",(0,r.kt)("strong",{parentName:"p"},"Recurring Backups")," lets you configure following two fields:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Schedule"),": This field accepts",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Standard ",(0,r.kt)("a",{parentName:"li",href:"https://en.wikipedia.org/wiki/Cron"},"cron expressions"),", such as ",(0,r.kt)("inlineCode",{parentName:"li"},'"0 * * * *"')),(0,r.kt)("li",{parentName:"ul"},"Descriptors, such as ",(0,r.kt)("inlineCode",{parentName:"li"},'"@midnight"')," or ",(0,r.kt)("inlineCode",{parentName:"li"},'"@every 1h30m"')))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Retention Count"),": This value specifies how many backup files must be retained. If files exceed the given retentionCount,  the oldest files will be deleted. The default value is 10.")),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"YAML Directive Name"),(0,r.kt)("th",{parentName:"tr",align:null},"Description"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"schedule")),(0,r.kt)("td",{parentName:"tr",align:null},"Provide the cron string for scheduling recurring backups.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"retentionCount")),(0,r.kt)("td",{parentName:"tr",align:null},"Provide the number of backup files to be retained.")))),(0,r.kt)("h2",{id:"encryption"},"Encryption"),(0,r.kt)("p",null,"The rancher-backup gathers resources by making calls to the kube-apiserver. Objects returned by apiserver are decrypted, so even if ",(0,r.kt)("a",{parentName:"p",href:"https://kubernetes.io/docs/tasks/administer-cluster/encrypt-data/"},"encryption at rest")," is enabled, even the encrypted objects gathered by the backup will be in plaintext."),(0,r.kt)("p",null,"To avoid storing them in plaintext, you can use the same ",(0,r.kt)("inlineCode",{parentName:"p"},"EncryptionConfiguration")," file that was used for at rest encryption, to encrypt certain resources in your backup."),(0,r.kt)("admonition",{title:"Important:",type:"note"},(0,r.kt)("p",{parentName:"admonition"},"When encrypting objects in the backup you must save the ",(0,r.kt)("inlineCode",{parentName:"p"},"EncryptionConfiguration")," file for future use, because it won\u2019t be saved by the rancher-backup operator."),(0,r.kt)("p",{parentName:"admonition"},"For example, when ",(0,r.kt)("a",{parentName:"p",href:"/v2.6/how-to-guides/new-user-guides/backup-restore-and-disaster-recovery/migrate-rancher-to-new-cluster"},"migrating Rancher to a new cluster")," the file is used to re-create the secret in the new cluster.")),(0,r.kt)("p",null,"The operator consumes the ",(0,r.kt)("inlineCode",{parentName:"p"},"EncryptionConfiguration")," as a Kubernetes Secret in the ",(0,r.kt)("inlineCode",{parentName:"p"},"cattle-resources-system")," namespace under the key named  ",(0,r.kt)("inlineCode",{parentName:"p"},"encryption-provider-config.yaml")," in the secret data."),(0,r.kt)("p",null,"For the ",(0,r.kt)("inlineCode",{parentName:"p"},"EncryptionConfiguration"),", you can use the ",(0,r.kt)("a",{parentName:"p",href:"https://kubernetes.io/docs/tasks/administer-cluster/encrypt-data/#understanding-the-encryption-at-rest-configuration"},"sample file provided in the Kubernetes documentation.")),(0,r.kt)("p",null,"To ensure the correct key is used in the secret, the encryption configuration file must be named ",(0,r.kt)("inlineCode",{parentName:"p"},"encryption-provider-config.yaml"),". The below command uses the ",(0,r.kt)("inlineCode",{parentName:"p"},"--from-file")," flag to create the secret with the correct key name."),(0,r.kt)("p",null,"Save the ",(0,r.kt)("inlineCode",{parentName:"p"},"EncryptionConfiguration")," in a file called ",(0,r.kt)("inlineCode",{parentName:"p"},"encryption-provider-config.yaml")," and run this command:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"kubectl create secret generic encryptionconfig \\\n  --from-file=./encryption-provider-config.yaml \\\n  -n cattle-resources-system\n")),(0,r.kt)("p",null,"This will ensure that the secret contains a key named ",(0,r.kt)("inlineCode",{parentName:"p"},"encryption-provider-config.yaml"),", and the operator will use this key to get the encryption configuration."),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"Encryption Config Secret")," dropdown will filter out and list only those Secrets that have this exact key."),(0,r.kt)("p",null,(0,r.kt)("img",{src:n(61687).Z,width:"1203",height:"376"})),(0,r.kt)("p",null,"In the example command above, the name ",(0,r.kt)("inlineCode",{parentName:"p"},"encryptionconfig")," can be changed to anything."),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"YAML Directive Name"),(0,r.kt)("th",{parentName:"tr",align:null},"Description"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"encryptionConfigSecretName")),(0,r.kt)("td",{parentName:"tr",align:null},"Provide the name of the Secret from ",(0,r.kt)("inlineCode",{parentName:"td"},"cattle-resources-system")," namespace, that contains the encryption config file.")))),(0,r.kt)("h2",{id:"storage-location"},"Storage Location"),(0,r.kt)("p",null,"If the StorageLocation is specified in the Backup, the operator will retrieve the backup location from that particular S3 bucket. If not specified, the operator will try to find this file in the default operator-level S3 store, and in the operator-level PVC store. The default storage location is configured during the deployment of the ",(0,r.kt)("inlineCode",{parentName:"p"},"rancher-backup")," operator."),(0,r.kt)("p",null,"Selecting the first option stores this backup in the storage location configured while installing the rancher-backup chart. The second option lets you configure a different S3 compatible storage provider for storing the backup."),(0,r.kt)("h3",{id:"s3"},"S3"),(0,r.kt)("p",null,"The S3 storage location contains the following configuration fields:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("strong",{parentName:"li"},"Credential Secret")," (optional): If you need to use the AWS Access keys Secret keys to access s3 bucket, create a secret with your credentials with keys and the directives ",(0,r.kt)("inlineCode",{parentName:"li"},"accessKey")," and ",(0,r.kt)("inlineCode",{parentName:"li"},"secretKey"),". It can be in any namespace. An example secret is ",(0,r.kt)("a",{parentName:"li",href:"#example-credentialsecret"},"here.")," This directive is unnecessary if the nodes running your operator are in EC2 and set up with IAM permissions that allow them to access S3, as described in ",(0,r.kt)("a",{parentName:"li",href:"#iam-permissions-for-ec2-nodes-to-access-s3"},"this section.")," The Credential Secret dropdown lists the secrets in all namespaces."),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("strong",{parentName:"li"},"Bucket Name"),": The name of the S3 bucket where backup files will be stored."),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("strong",{parentName:"li"},"Region")," (optional): The AWS ",(0,r.kt)("a",{parentName:"li",href:"https://aws.amazon.com/about-aws/global-infrastructure/regions_az/"},"region")," where the S3 bucket is located. This field isn't needed for configuring MinIO."),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("strong",{parentName:"li"},"Folder")," (optional): The name of the folder in the S3 bucket where backup files will be stored. Nested folders (e.g., ",(0,r.kt)("inlineCode",{parentName:"li"},"rancher/cluster1"),") are not supported. If this field is left empty, the default behavior is to store the backup files in the root folder of the S3 bucket."),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("strong",{parentName:"li"},"Endpoint"),": The ",(0,r.kt)("a",{parentName:"li",href:"https://docs.aws.amazon.com/general/latest/gr/s3.html"},"endpoint"),"  that is used to access S3 in the region of your bucket."),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("strong",{parentName:"li"},"Endpoint CA")," (optional): This should be the Base64 encoded CA cert. For an example, refer to the ",(0,r.kt)("a",{parentName:"li",href:"#example-s3-storage-configuration"},"example S3 compatible configuration.")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("strong",{parentName:"li"},"Skip TLS Verifications")," (optional): Set to true if you are not using TLS.")),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"YAML Directive Name"),(0,r.kt)("th",{parentName:"tr",align:null},"Description"),(0,r.kt)("th",{parentName:"tr",align:null},"Required"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"credentialSecretName")),(0,r.kt)("td",{parentName:"tr",align:null},"If you need to use the AWS Access keys Secret keys to access s3 bucket, create a secret with your credentials with keys and the directives ",(0,r.kt)("inlineCode",{parentName:"td"},"accessKey")," and ",(0,r.kt)("inlineCode",{parentName:"td"},"secretKey"),". It can be in any namespace as long as you provide that namespace in ",(0,r.kt)("inlineCode",{parentName:"td"},"credentialSecretNamespace"),". An example secret is ",(0,r.kt)("a",{parentName:"td",href:"#example-credentialsecret"},"here.")," This directive is unnecessary if the nodes running your operator are in EC2 and set up with IAM permissions that allow them to access S3, as described in ",(0,r.kt)("a",{parentName:"td",href:"#iam-permissions-for-ec2-nodes-to-access-s3"},"this section.")),(0,r.kt)("td",{parentName:"tr",align:null})),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"credentialSecretNamespace")),(0,r.kt)("td",{parentName:"tr",align:null},"The namespace of the secret containing the credentials to access S3. This directive is unnecessary if the nodes running your operator are in EC2 and set up with IAM permissions that allow them to access S3, as described in ",(0,r.kt)("a",{parentName:"td",href:"#iam-permissions-for-ec2-nodes-to-access-s3"},"this section.")),(0,r.kt)("td",{parentName:"tr",align:null})),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"bucketName")),(0,r.kt)("td",{parentName:"tr",align:null},"The name of the S3 bucket where backup files will be stored."),(0,r.kt)("td",{parentName:"tr",align:null},"\u2713")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"folder")),(0,r.kt)("td",{parentName:"tr",align:null},"The name of the folder in the S3 bucket where backup files will be stored. Nested folders (e.g., ",(0,r.kt)("inlineCode",{parentName:"td"},"rancher/cluster1"),") are not supported. If this field is left empty, the default behavior is to store the backup files in the root folder of the S3 bucket."),(0,r.kt)("td",{parentName:"tr",align:null})),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"region")),(0,r.kt)("td",{parentName:"tr",align:null},"The AWS ",(0,r.kt)("a",{parentName:"td",href:"https://aws.amazon.com/about-aws/global-infrastructure/regions_az/"},"region")," where the S3 bucket is located."),(0,r.kt)("td",{parentName:"tr",align:null},"\u2713")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"endpoint")),(0,r.kt)("td",{parentName:"tr",align:null},"The ",(0,r.kt)("a",{parentName:"td",href:"https://docs.aws.amazon.com/general/latest/gr/s3.html"},"endpoint"),"  that is used to access S3 in the region of your bucket."),(0,r.kt)("td",{parentName:"tr",align:null},"\u2713")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"endpointCA")),(0,r.kt)("td",{parentName:"tr",align:null},"This should be the Base64 encoded CA cert. For an example, refer to the ",(0,r.kt)("a",{parentName:"td",href:"#example-s3-storage-configuration"},"example S3 compatible configuration.")),(0,r.kt)("td",{parentName:"tr",align:null})),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"insecureTLSSkipVerify")),(0,r.kt)("td",{parentName:"tr",align:null},"Set to true if you are not using TLS."),(0,r.kt)("td",{parentName:"tr",align:null})))),(0,r.kt)("h3",{id:"example-s3-storage-configuration"},"Example S3 Storage Configuration"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"s3:\n  credentialSecretName: s3-creds\n  credentialSecretNamespace: default\n  bucketName: rancher-backups\n  folder: rancher\n  region: us-west-2\n  endpoint: s3.us-west-2.amazonaws.com\n")),(0,r.kt)("h3",{id:"example-minio-configuration"},"Example MinIO Configuration"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"s3:\n  credentialSecretName: minio-creds\n  bucketName: rancherbackups\n  endpoint: minio.35.202.130.254.xip.io\n  endpointCA: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURHakNDQWdLZ0F3SUJBZ0lKQUtpWFZpNEpBb0J5TUEwR0NTcUdTSWIzRFFFQkN3VUFNQkl4RURBT0JnTlYKQkFNTUIzUmxjM1F0WTJFd0hoY05NakF3T0RNd01UZ3lOVFE1V2hjTk1qQXhNREk1TVRneU5UUTVXakFTTVJBdwpEZ1lEVlFRRERBZDBaWE4wTFdOaE1JSUJJakFOQmdrcWhraUc5dzBCQVFFRkFBT0NBUThBTUlJQkNnS0NBUUVBCjA4dnV3Q2Y0SEhtR2Q2azVNTmozRW5NOG00T2RpS3czSGszd1NlOUlXQkwyVzY5WDZxenBhN2I2M3U2L05mMnkKSnZWNDVqeXplRFB6bFJycjlpbEpWaVZ1NFNqWlFjdG9jWmFCaVNsL0xDbEFDdkFaUlYvKzN0TFVTZSs1ZDY0QQpWcUhDQlZObU5xM3E3aVY0TE1aSVpRc3N6K0FxaU1Sd0pOMVVKQTZ6V0tUc2Yzc3ByQ0J2dWxJWmZsVXVETVAyCnRCTCt6cXZEc0pDdWlhNEEvU2JNT29tVmM2WnNtTGkwMjdub3dGRld3MnRpSkM5d0xMRE14NnJoVHQ4a3VvVHYKQXJpUjB4WktiRU45L1Uzb011eUVKbHZyck9YS2ZuUDUwbk8ycGNaQnZCb3pUTStYZnRvQ1d5UnhKUmI5cFNTRApKQjlmUEFtLzNZcFpMMGRKY2sxR1h3SURBUUFCbzNNd2NUQWRCZ05WSFE0RUZnUVU5NHU4WXlMdmE2MTJnT1pyCm44QnlFQ2NucVFjd1FnWURWUjBqQkRzd09ZQVU5NHU4WXlMdmE2MTJnT1pybjhCeUVDY25xUWVoRnFRVU1CSXgKRURBT0JnTlZCQU1NQjNSbGMzUXRZMkdDQ1FDb2wxWXVDUUtBY2pBTUJnTlZIUk1FQlRBREFRSC9NQTBHQ1NxRwpTSWIzRFFFQkN3VUFBNElCQVFER1JRZ1RtdzdVNXRQRHA5Q2psOXlLRW9Vd2pYWWM2UlAwdm1GSHpubXJ3dUVLCjFrTkVJNzhBTUw1MEpuS29CY0ljVDNEeGQ3TGdIbTNCRE5mVVh2anArNnZqaXhJYXR2UWhsSFNVaWIyZjJsSTkKVEMxNzVyNCtROFkzelc1RlFXSDdLK08vY3pJTGh5ei93aHRDUlFkQ29lS1dXZkFiby8wd0VSejZzNkhkVFJzNwpHcWlGNWZtWGp6S0lOcTBjMHRyZ0xtalNKd1hwSnU0ZnNGOEcyZUh4b2pOKzdJQ1FuSkg5cGRIRVpUQUtOL2ppCnIvem04RlZtd1kvdTBndEZneWVQY1ZWbXBqRm03Y0ZOSkc4Y2ZYd0QzcEFwVjhVOGNocTZGeFBHTkVvWFZnclMKY1VRMklaU0RJd1FFY3FvSzFKSGdCUWw2RXBaUVpWMW1DRklrdFBwSQotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0t\n")),(0,r.kt)("h3",{id:"example-credentialsecret"},"Example credentialSecret"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"apiVersion: v1\nkind: Secret\nmetadata:\n  name: creds\ntype: Opaque\ndata:\n  accessKey: <base64-encoded access key>\n  secretKey: <base64-encoded secret key>\n")),(0,r.kt)("admonition",{type:"note"},(0,r.kt)("p",{parentName:"admonition"},"To avoid encoding issues, the ",(0,r.kt)("inlineCode",{parentName:"p"},"credentialSecret")," can be created with the below command, updating the values for ",(0,r.kt)("inlineCode",{parentName:"p"},"accessKey")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"secretKey"),"."),(0,r.kt)("pre",{parentName:"admonition"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"kubectl create secret generic s3-creds \\\n  --from-literal=accessKey=<access key> \\\n  --from-literal=secretKey=<secret key>\n"))),(0,r.kt)("h3",{id:"iam-permissions-for-ec2-nodes-to-access-s3"},"IAM Permissions for EC2 Nodes to Access S3"),(0,r.kt)("p",null,"There are two ways to set up the ",(0,r.kt)("inlineCode",{parentName:"p"},"rancher-backup")," operator to use S3 as the backup storage location."),(0,r.kt)("p",null,"One way is to configure the ",(0,r.kt)("inlineCode",{parentName:"p"},"credentialSecretName")," in the Backup custom resource, which refers to AWS credentials that have access to S3."),(0,r.kt)("p",null,"If the cluster nodes are in Amazon EC2, the S3 access can also be set up by assigning IAM permissions to the EC2 nodes so that they can access S3."),(0,r.kt)("p",null,"To allow a node to access S3, follow the instructions in the ",(0,r.kt)("a",{parentName:"p",href:"https://aws.amazon.com/premiumsupport/knowledge-center/ec2-instance-access-s3-bucket/"},"AWS documentation")," to create an IAM role for EC2. When you add a custom policy to the role, add the following permissions, and replace the ",(0,r.kt)("inlineCode",{parentName:"p"},"Resource")," with your bucket name:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "Version": "2012-10-17",\n  "Statement": [\n    {\n      "Effect": "Allow",\n      "Action": [\n        "s3:ListBucket"\n      ],\n     "Resource": [\n        "arn:aws:s3:::rancher-backups"\n      ]\n    },\n    {\n      "Effect": "Allow",\n      "Action": [\n        "s3:PutObject",\n        "s3:GetObject",\n        "s3:DeleteObject",\n        "s3:PutObjectAcl"\n      ],\n      "Resource": [\n         "arn:aws:s3:::rancher-backups/*"\n      ]\n    }\n  ]\n}\n')),(0,r.kt)("p",null,"After the role is created, and you have attached the corresponding instance profile to your EC2 instance(s), the ",(0,r.kt)("inlineCode",{parentName:"p"},"credentialSecretName")," directive can be left empty in the Backup custom resource."),(0,r.kt)("h2",{id:"examples"},"Examples"),(0,r.kt)("p",null,"For example Backup custom resources, refer to ",(0,r.kt)("a",{parentName:"p",href:"/v2.6/reference-guides/backup-restore-configuration/examples#backup"},"this page.")))}d.isMDXComponent=!0},61687:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/encryption-764e07a9a1c79ccb857802bdba719cb8.png"}}]);