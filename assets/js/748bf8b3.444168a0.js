"use strict";(self.webpackChunkrancher_docs=self.webpackChunkrancher_docs||[]).push([[91859],{3905:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>m});var a=n(67294);function l(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){l(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,a,l=function(e,t){if(null==e)return{};var n,a,l={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(l[n]=e[n]);return l}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(l[n]=e[n])}return l}var s=a.createContext({}),u=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},p=function(e){var t=u(e.components);return a.createElement(s.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},d=a.forwardRef((function(e,t){var n=e.components,l=e.mdxType,o=e.originalType,s=e.parentName,p=i(e,["components","mdxType","originalType","parentName"]),d=u(n),m=l,f=d["".concat(s,".").concat(m)]||d[m]||c[m]||o;return n?a.createElement(f,r(r({ref:t},p),{},{components:n})):a.createElement(f,r({ref:t},p))}));function m(e,t){var n=arguments,l=t&&t.mdxType;if("string"==typeof e||l){var o=n.length,r=new Array(o);r[0]=d;var i={};for(var s in t)hasOwnProperty.call(t,s)&&(i[s]=t[s]);i.originalType=e,i.mdxType="string"==typeof e?e:l,r[1]=i;for(var u=2;u<o;u++)r[u]=n[u];return a.createElement.apply(null,r)}return a.createElement.apply(null,n)}d.displayName="MDXCreateElement"},56042:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>r,default:()=>f,frontMatter:()=>o,metadata:()=>i,toc:()=>u});var a=n(87462),l=(n(67294),n(3905));const o={title:"Flows and ClusterFlows"},r=void 0,i={unversionedId:"explanations/integrations-in-rancher/logging/custom-resource-configuration/flows-and-clusterflows",id:"version-2.5/explanations/integrations-in-rancher/logging/custom-resource-configuration/flows-and-clusterflows",title:"Flows and ClusterFlows",description:"See the Logging operator documentation for the full details on how to configure  Flows and ClusterFlows.",source:"@site/versioned_docs/version-2.5/explanations/integrations-in-rancher/logging/custom-resource-configuration/flows-and-clusterflows.md",sourceDirName:"explanations/integrations-in-rancher/logging/custom-resource-configuration",slug:"/explanations/integrations-in-rancher/logging/custom-resource-configuration/flows-and-clusterflows",permalink:"/v2.5/explanations/integrations-in-rancher/logging/custom-resource-configuration/flows-and-clusterflows",draft:!1,editUrl:"https://github.com/rancher/rancher-docs/edit/main/versioned_docs/version-2.5/explanations/integrations-in-rancher/logging/custom-resource-configuration/flows-and-clusterflows.md",tags:[],version:"2.5",lastUpdatedAt:1677610090,formattedLastUpdatedAt:"Feb 28, 2023",frontMatter:{title:"Flows and ClusterFlows"},sidebar:"tutorialSidebar",previous:{title:"Custom Resource Configuration",permalink:"/v2.5/pages-for-subheaders/custom-resource-configuration"},next:{title:"Outputs and ClusterOutputs",permalink:"/v2.5/explanations/integrations-in-rancher/logging/custom-resource-configuration/outputs-and-clusteroutputs"}},s={},u=[{value:"Configuration",id:"configuration",level:2},{value:"Changes in v2.5.8",id:"changes-in-v258",level:2},{value:"Flows",id:"flows",level:2},{value:"Matches",id:"matches",level:3},{value:"Filters",id:"filters",level:3},{value:"Outputs",id:"outputs",level:3},{value:"ClusterFlows",id:"clusterflows",level:2},{value:"Flows",id:"flows-1",level:2},{value:"Matches",id:"matches-1",level:3},{value:"Filters",id:"filters-1",level:3},{value:"Outputs",id:"outputs-1",level:3},{value:"ClusterFlows",id:"clusterflows-1",level:2},{value:"YAML Example",id:"yaml-example",level:2}],p=e=>function(t){return console.warn("Component "+e+" was not imported, exported, or provided by MDXProvider as global scope"),(0,l.kt)("div",t)},c=p("Tabs"),d=p("TabItem"),m={toc:u};function f(e){let{components:t,...n}=e;return(0,l.kt)("wrapper",(0,a.Z)({},m,n,{components:t,mdxType:"MDXLayout"}),(0,l.kt)("p",null,"See the ",(0,l.kt)("a",{parentName:"p",href:"https://kube-logging.github.io/docs/configuration/flow/"},"Logging operator documentation")," for the full details on how to configure  ",(0,l.kt)("inlineCode",{parentName:"p"},"Flows")," and ",(0,l.kt)("inlineCode",{parentName:"p"},"ClusterFlows"),"."),(0,l.kt)("p",null,"See ",(0,l.kt)("a",{parentName:"p",href:"/v2.5/pages-for-subheaders/logging#The-Logging-Buffer-Overloads-Pods"},"Rancher Integration with Logging Services: Troubleshooting")," for how to resolve memory problems with the logging buffer."),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#configuration"},"Configuration")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#yaml-example"},"YAML Example"))),(0,l.kt)("h2",{id:"configuration"},"Configuration"),(0,l.kt)(c,{mdxType:"Tabs"},(0,l.kt)(d,{value:"Rancher v2.5.8+",mdxType:"TabItem"},(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#flows-2-5-8"},"Flows"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#matches-2-5-8"},"Matches")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#filters-2-5-8"},"Filters")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#outputs-2-5-8"},"Outputs")))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#clusterflows-2-5-8"},"ClusterFlows"))),(0,l.kt)("h2",{id:"changes-in-v258"},"Changes in v2.5.8"),(0,l.kt)("p",null,"The ",(0,l.kt)("inlineCode",{parentName:"p"},"Flows")," and ",(0,l.kt)("inlineCode",{parentName:"p"},"ClusterFlows")," can now be configured by filling out forms in the Rancher UI."),(0,l.kt)("a",{id:"flows-2-5-8"}),(0,l.kt)("h2",{id:"flows"},"Flows"),(0,l.kt)("p",null,"A ",(0,l.kt)("inlineCode",{parentName:"p"},"Flow")," defines which logs to collect and filter and which output to send the logs to."),(0,l.kt)("p",null,"The ",(0,l.kt)("inlineCode",{parentName:"p"},"Flow")," is a namespaced resource, which means logs will only be collected from the namespace that the ",(0,l.kt)("inlineCode",{parentName:"p"},"Flow")," is deployed in."),(0,l.kt)("p",null,"For more details about the ",(0,l.kt)("inlineCode",{parentName:"p"},"Flow")," custom resource, see ",(0,l.kt)("a",{parentName:"p",href:"https://kube-logging.github.io/docs/configuration/crds/v1beta1/flow_types/"},"FlowSpec.")),(0,l.kt)("a",{id:"matches-2-5-8"}),(0,l.kt)("h3",{id:"matches"},"Matches"),(0,l.kt)("p",null,"Match statements are used to select which containers to pull logs from."),(0,l.kt)("p",null,"You can specify match statements to select or exclude logs according to Kubernetes labels, container and host names. Match statements are evaluated in the order they are defined and processed only until the first matching select or exclude rule applies."),(0,l.kt)("p",null,"Matches can be configured by filling out the ",(0,l.kt)("inlineCode",{parentName:"p"},"Flow")," or ",(0,l.kt)("inlineCode",{parentName:"p"},"ClusterFlow")," forms in the Rancher UI."),(0,l.kt)("p",null,"For detailed examples on using the match statement, see the ",(0,l.kt)("a",{parentName:"p",href:"https://kube-logging.github.io/docs/configuration/log-routing/"},"official documentation on log routing.")),(0,l.kt)("a",{id:"filters-2-5-8"}),(0,l.kt)("h3",{id:"filters"},"Filters"),(0,l.kt)("p",null,"You can define one or more filters within a ",(0,l.kt)("inlineCode",{parentName:"p"},"Flow"),". Filters can perform various actions on the logs, for example, add additional data, transform the logs, or parse values from the records. The filters in the ",(0,l.kt)("inlineCode",{parentName:"p"},"Flow")," are applied in the order in the definition."),(0,l.kt)("p",null,"For a list of filters supported by the Logging operator, see ",(0,l.kt)("a",{parentName:"p",href:"https://kube-logging.github.io/docs/configuration/plugins/filters/"},"the official documentation on Fluentd filters"),"."),(0,l.kt)("p",null,"Filters need to be configured in YAML."),(0,l.kt)("a",{id:"outputs-2-5-8"}),(0,l.kt)("h3",{id:"outputs"},"Outputs"),(0,l.kt)("p",null,"This ",(0,l.kt)("inlineCode",{parentName:"p"},"Output")," will receive logs from the ",(0,l.kt)("inlineCode",{parentName:"p"},"Flow"),". Because the ",(0,l.kt)("inlineCode",{parentName:"p"},"Flow")," is a namespaced resource, the ",(0,l.kt)("inlineCode",{parentName:"p"},"Output")," must reside in same namespace as the ",(0,l.kt)("inlineCode",{parentName:"p"},"Flow"),"."),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"Outputs")," can be referenced when filling out the ",(0,l.kt)("inlineCode",{parentName:"p"},"Flow")," or ",(0,l.kt)("inlineCode",{parentName:"p"},"ClusterFlow")," forms in the Rancher UI."),(0,l.kt)("a",{id:"clusterflows-2-5-8"}),(0,l.kt)("h2",{id:"clusterflows"},"ClusterFlows"),(0,l.kt)("p",null,"Matches, filters and ",(0,l.kt)("inlineCode",{parentName:"p"},"Outputs")," are configured for ",(0,l.kt)("inlineCode",{parentName:"p"},"ClusterFlows")," in the same way that they are configured for ",(0,l.kt)("inlineCode",{parentName:"p"},"Flows"),". The key difference is that the ",(0,l.kt)("inlineCode",{parentName:"p"},"ClusterFlow")," is scoped at the cluster level and can configure log collection across all namespaces."),(0,l.kt)("p",null,"After ",(0,l.kt)("inlineCode",{parentName:"p"},"ClusterFlow")," selects logs from all namespaces in the cluster, logs from the cluster will be collected and logged to the selected ",(0,l.kt)("inlineCode",{parentName:"p"},"ClusterOutput"),".")),(0,l.kt)(d,{value:"Rancher before v2.5.8",mdxType:"TabItem"},(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#flows-2-5-0"},"Flows"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#matches-2-5-0"},"Matches")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#filters-2-5-0"},"Filters")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#outputs-2-5-0"},"Outputs")))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#clusterflows-2-5-0"},"ClusterFlows"))),(0,l.kt)("a",{id:"flows-2-5-0"}),(0,l.kt)("h2",{id:"flows-1"},"Flows"),(0,l.kt)("p",null,"A ",(0,l.kt)("inlineCode",{parentName:"p"},"Flow")," defines which logs to collect and filter and which ",(0,l.kt)("inlineCode",{parentName:"p"},"Output")," to send the logs to. The ",(0,l.kt)("inlineCode",{parentName:"p"},"Flow")," is a namespaced resource, which means logs will only be collected from the namespace that the ",(0,l.kt)("inlineCode",{parentName:"p"},"Flow")," is deployed in."),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"Flows")," need to be defined in YAML."),(0,l.kt)("p",null,"For more details about the ",(0,l.kt)("inlineCode",{parentName:"p"},"Flow")," custom resource, see ",(0,l.kt)("a",{parentName:"p",href:"https://kube-logging.github.io/docs/configuration/crds/v1beta1/flow_types/"},"FlowSpec.")),(0,l.kt)("a",{id:"matches-2-5-0"}),(0,l.kt)("h3",{id:"matches-1"},"Matches"),(0,l.kt)("p",null,"Match statements are used to select which containers to pull logs from."),(0,l.kt)("p",null,"You can specify match statements to select or exclude logs according to Kubernetes labels, container and host names. Match statements are evaluated in the order they are defined and processed only until the first matching select or exclude rule applies."),(0,l.kt)("p",null,"For detailed examples on using the match statement, see the ",(0,l.kt)("a",{parentName:"p",href:"https://kube-logging.github.io/docs/configuration/log-routing/"},"official documentation on log routing.")),(0,l.kt)("a",{id:"filters-2-5-0"}),(0,l.kt)("h3",{id:"filters-1"},"Filters"),(0,l.kt)("p",null,"You can define one or more filters within a ",(0,l.kt)("inlineCode",{parentName:"p"},"Flow"),". Filters can perform various actions on the logs, for example, add additional data, transform the logs, or parse values from the records. The filters in the ",(0,l.kt)("inlineCode",{parentName:"p"},"Flow")," are applied in the order in the definition."),(0,l.kt)("p",null,"For a list of filters supported by the Logging operator, see ",(0,l.kt)("a",{parentName:"p",href:"https://kube-logging.github.io/docs/configuration/plugins/filters/"},"this page.")),(0,l.kt)("a",{id:"outputs-2-5-0"}),(0,l.kt)("h3",{id:"outputs-1"},"Outputs"),(0,l.kt)("p",null,"This ",(0,l.kt)("inlineCode",{parentName:"p"},"Output")," will receive logs from the ",(0,l.kt)("inlineCode",{parentName:"p"},"Flow"),"."),(0,l.kt)("p",null,"Because the ",(0,l.kt)("inlineCode",{parentName:"p"},"Flow")," is a namespaced resource, the ",(0,l.kt)("inlineCode",{parentName:"p"},"Output")," must reside in same namespace as the ",(0,l.kt)("inlineCode",{parentName:"p"},"Flow"),"."),(0,l.kt)("a",{id:"clusterflows-2-5-0"}),(0,l.kt)("h2",{id:"clusterflows-1"},"ClusterFlows"),(0,l.kt)("p",null,"Matches, filters and ",(0,l.kt)("inlineCode",{parentName:"p"},"Outputs")," are also configured for ",(0,l.kt)("inlineCode",{parentName:"p"},"ClusterFlows"),". The only difference is that the ",(0,l.kt)("inlineCode",{parentName:"p"},"ClusterFlow")," is scoped at the cluster level and can configure log collection across all namespaces."),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"ClusterFlow")," selects logs from all namespaces in the cluster. Logs from the cluster will be collected and logged to the selected ",(0,l.kt)("inlineCode",{parentName:"p"},"ClusterOutput"),"."),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"ClusterFlows")," need to be defined in YAML."))),(0,l.kt)("h2",{id:"yaml-example"},"YAML Example"),(0,l.kt)("p",null,"The following example ",(0,l.kt)("inlineCode",{parentName:"p"},"Flow")," transforms the log messages from the default namespace and sends them to an S3 ",(0,l.kt)("inlineCode",{parentName:"p"},"Output"),":"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-yaml"},"apiVersion: logging.banzaicloud.io/v1beta1\nkind: Flow\nmetadata:\n  name: flow-sample\n  namespace: default\nspec:\n  filters:\n    - parser:\n        remove_key_name_field: true\n        parse:\n          type: nginx\n    - tag_normaliser:\n        format: ${namespace_name}.${pod_name}.${container_name}\n  localOutputRefs:\n    - s3-output\n  match:\n    - select:\n        labels:\n          app: nginx\n")))}f.isMDXComponent=!0}}]);