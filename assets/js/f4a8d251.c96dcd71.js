"use strict";(self.webpackChunkrancher_docs=self.webpackChunkrancher_docs||[]).push([[55104],{3905:function(e,t,a){a.d(t,{Zo:function(){return s},kt:function(){return h}});var n=a(67294);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function i(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function o(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?i(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):i(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function l(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},i=Object.keys(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var d=n.createContext({}),c=function(e){var t=n.useContext(d),a=t;return e&&(a="function"==typeof e?e(t):o(o({},t),e)),a},s=function(e){var t=c(e.components);return n.createElement(d.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},u=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,i=e.originalType,d=e.parentName,s=l(e,["components","mdxType","originalType","parentName"]),u=c(a),h=r,m=u["".concat(d,".").concat(h)]||u[h]||p[h]||i;return a?n.createElement(m,o(o({ref:t},s),{},{components:a})):n.createElement(m,o({ref:t},s))}));function h(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=a.length,o=new Array(i);o[0]=u;var l={};for(var d in t)hasOwnProperty.call(t,d)&&(l[d]=t[d]);l.originalType=e,l.mdxType="string"==typeof e?e:r,o[1]=l;for(var c=2;c<i;c++)o[c]=a[c];return n.createElement.apply(null,o)}return n.createElement.apply(null,a)}u.displayName="MDXCreateElement"},85162:function(e,t,a){a.d(t,{Z:function(){return o}});var n=a(67294),r=a(86010),i="tabItem_Ymn6";function o(e){var t=e.children,a=e.hidden,o=e.className;return n.createElement("div",{role:"tabpanel",className:(0,r.Z)(i,o),hidden:a},t)}},65488:function(e,t,a){a.d(t,{Z:function(){return h}});var n=a(87462),r=a(67294),i=a(86010),o=a(72389),l=a(67392),d=a(7094),c=a(12466),s="tabList__CuJ",p="tabItem_LNqP";function u(e){var t,a,o=e.lazy,u=e.block,h=e.defaultValue,m=e.values,k=e.groupId,g=e.className,N=r.Children.map(e.children,(function(e){if((0,r.isValidElement)(e)&&"value"in e.props)return e;throw new Error("Docusaurus error: Bad <Tabs> child <"+("string"==typeof e.type?e.type:e.type.name)+'>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.')})),f=null!=m?m:N.map((function(e){var t=e.props;return{value:t.value,label:t.label,attributes:t.attributes}})),v=(0,l.l)(f,(function(e,t){return e.value===t.value}));if(v.length>0)throw new Error('Docusaurus error: Duplicate values "'+v.map((function(e){return e.value})).join(", ")+'" found in <Tabs>. Every value needs to be unique.');var y=null===h?h:null!=(t=null!=h?h:null==(a=N.find((function(e){return e.props.default})))?void 0:a.props.value)?t:N[0].props.value;if(null!==y&&!f.some((function(e){return e.value===y})))throw new Error('Docusaurus error: The <Tabs> has a defaultValue "'+y+'" but none of its children has the corresponding value. Available values are: '+f.map((function(e){return e.value})).join(", ")+". If you intend to show no default tab, use defaultValue={null} instead.");var R=(0,d.U)(),b=R.tabGroupChoices,C=R.setTabGroupChoices,w=(0,r.useState)(y),T=w[0],E=w[1],A=[],O=(0,c.o5)().blockElementScrollPositionUntilNextRender;if(null!=k){var I=b[k];null!=I&&I!==T&&f.some((function(e){return e.value===I}))&&E(I)}var _=function(e){var t=e.currentTarget,a=A.indexOf(t),n=f[a].value;n!==T&&(O(t),E(n),null!=k&&C(k,String(n)))},S=function(e){var t,a=null;switch(e.key){case"ArrowRight":var n,r=A.indexOf(e.currentTarget)+1;a=null!=(n=A[r])?n:A[0];break;case"ArrowLeft":var i,o=A.indexOf(e.currentTarget)-1;a=null!=(i=A[o])?i:A[A.length-1]}null==(t=a)||t.focus()};return r.createElement("div",{className:(0,i.Z)("tabs-container",s)},r.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,i.Z)("tabs",{"tabs--block":u},g)},f.map((function(e){var t=e.value,a=e.label,o=e.attributes;return r.createElement("li",(0,n.Z)({role:"tab",tabIndex:T===t?0:-1,"aria-selected":T===t,key:t,ref:function(e){return A.push(e)},onKeyDown:S,onFocus:_,onClick:_},o,{className:(0,i.Z)("tabs__item",p,null==o?void 0:o.className,{"tabs__item--active":T===t})}),null!=a?a:t)}))),o?(0,r.cloneElement)(N.filter((function(e){return e.props.value===T}))[0],{className:"margin-top--md"}):r.createElement("div",{className:"margin-top--md"},N.map((function(e,t){return(0,r.cloneElement)(e,{key:t,hidden:e.props.value!==T})}))))}function h(e){var t=(0,o.Z)();return r.createElement(u,(0,n.Z)({key:String(t)},e))}},12473:function(e,t,a){a.r(t),a.d(t,{assets:function(){return u},contentTitle:function(){return s},default:function(){return k},frontMatter:function(){return c},metadata:function(){return p},toc:function(){return h}});var n=a(87462),r=a(63366),i=(a(67294),a(3905)),o=a(65488),l=a(85162),d=["components"],c={title:"Upgrading Rancher Installed with Docker"},s=void 0,p={unversionedId:"getting-started/installation-and-upgrade/other-installation-methods/rancher-on-a-single-node-with-docker/upgrade-docker-installed-rancher",id:"getting-started/installation-and-upgrade/other-installation-methods/rancher-on-a-single-node-with-docker/upgrade-docker-installed-rancher",title:"Upgrading Rancher Installed with Docker",description:"The following instructions will guide you through upgrading a Rancher server that was installed with Docker.",source:"@site/docs/getting-started/installation-and-upgrade/other-installation-methods/rancher-on-a-single-node-with-docker/upgrade-docker-installed-rancher.md",sourceDirName:"getting-started/installation-and-upgrade/other-installation-methods/rancher-on-a-single-node-with-docker",slug:"/getting-started/installation-and-upgrade/other-installation-methods/rancher-on-a-single-node-with-docker/upgrade-docker-installed-rancher",permalink:"/getting-started/installation-and-upgrade/other-installation-methods/rancher-on-a-single-node-with-docker/upgrade-docker-installed-rancher",draft:!1,editUrl:"https://github.com/rancher/rancher-docs/edit/main/docs/getting-started/installation-and-upgrade/other-installation-methods/rancher-on-a-single-node-with-docker/upgrade-docker-installed-rancher.md",tags:[],version:"current",lastUpdatedAt:1666730461,formattedLastUpdatedAt:"10/25/2022",frontMatter:{title:"Upgrading Rancher Installed with Docker"},sidebar:"tutorialSidebar",previous:{title:"Installing Rancher on a Single Node Using Docker",permalink:"/pages-for-subheaders/rancher-on-a-single-node-with-docker"},next:{title:"Rolling Back Rancher Installed with Docker",permalink:"/getting-started/installation-and-upgrade/other-installation-methods/rancher-on-a-single-node-with-docker/roll-back-docker-installed-rancher"}},u={},h=[{value:"Prerequisites",id:"prerequisites",level:2},{value:"Placeholder Review",id:"placeholder-review",level:2},{value:"Get Data for Upgrade Commands",id:"get-data-for-upgrade-commands",level:2},{value:"Upgrade",id:"upgrade",level:2},{value:"1. Create a copy of the data from your Rancher server container",id:"1-create-a-copy-of-the-data-from-your-rancher-server-container",level:3},{value:"2. Create a backup tarball",id:"2-create-a-backup-tarball",level:3},{value:"3. Pull the New Docker Image",id:"3-pull-the-new-docker-image",level:3},{value:"4. Start the New Rancher Server Container",id:"4-start-the-new-rancher-server-container",level:3},{value:"Option A: Default Self-Signed Certificate",id:"option-a-default-self-signed-certificate",level:4},{value:"Option B: Bring Your Own Certificate: Self-Signed",id:"option-b-bring-your-own-certificate-self-signed",level:4},{value:"Option C: Bring Your Own Certificate: Signed by Recognized CA",id:"option-c-bring-your-own-certificate-signed-by-recognized-ca",level:4},{value:"Option D: Let&#39;s Encrypt Certificate",id:"option-d-lets-encrypt-certificate",level:4},{value:"Option A: Default Self-Signed Certificate",id:"option-a-default-self-signed-certificate-1",level:4},{value:"Option B: Bring Your Own Certificate: Self-Signed",id:"option-b-bring-your-own-certificate-self-signed-1",level:4},{value:"Option C: Bring Your Own Certificate: Signed by Recognized CA",id:"option-c-bring-your-own-certificate-signed-by-recognized-ca-1",level:4},{value:"5. Verify the Upgrade",id:"5-verify-the-upgrade",level:3},{value:"6. Clean up Your Old Rancher Server Container",id:"6-clean-up-your-old-rancher-server-container",level:3},{value:"Rolling Back",id:"rolling-back",level:2}],m={toc:h};function k(e){var t=e.components,c=(0,r.Z)(e,d);return(0,i.kt)("wrapper",(0,n.Z)({},m,c,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("p",null,"The following instructions will guide you through upgrading a Rancher server that was installed with Docker."),(0,i.kt)("div",{className:"admonition admonition-caution alert alert--warning"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"}))),"caution")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},(0,i.kt)("strong",{parentName:"p"},"Docker installs are not supported in production environments.")," These instructions are provided for testing and development purposes only. If you have already deployed a Docker install in production and need to upgrade to a new Rancher version, we recommend ",(0,i.kt)("a",{parentName:"p",href:"/how-to-guides/new-user-guides/backup-restore-and-disaster-recovery/migrate-rancher-to-new-cluster"},"migrating to the Helm chart install")," before upgrading."))),(0,i.kt)("h2",{id:"prerequisites"},"Prerequisites"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Review the ",(0,i.kt)("a",{parentName:"strong",href:"/getting-started/installation-and-upgrade/install-upgrade-on-a-kubernetes-cluster/upgrades#known-upgrade-issues"},"known upgrade issues"))," section in the Rancher documentation for the most noteworthy issues to consider when upgrading Rancher. A more complete list of known issues for each Rancher version can be found in the release notes on ",(0,i.kt)("a",{parentName:"li",href:"https://github.com/rancher/rancher/releases"},"GitHub")," and on the ",(0,i.kt)("a",{parentName:"li",href:"https://forums.rancher.com/c/announcements/12"},"Rancher forums"),". Note that upgrades to or from any chart in the ",(0,i.kt)("a",{parentName:"li",href:"/getting-started/installation-and-upgrade/installation-references/helm-chart-options#helm-chart-repositories/"},"rancher-alpha repository")," aren\u2019t supported."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"For ",(0,i.kt)("a",{parentName:"strong",href:"/pages-for-subheaders/air-gapped-helm-cli-install"},"air gap installs only,")," collect and populate images for the new Rancher server version"),". Follow the guide to ",(0,i.kt)("a",{parentName:"li",href:"/getting-started/installation-and-upgrade/other-installation-methods/air-gapped-helm-cli-install/publish-images"},"populate your private registry")," with the images for the Rancher version that you want to upgrade to.")),(0,i.kt)("h2",{id:"placeholder-review"},"Placeholder Review"),(0,i.kt)("p",null,"During upgrade, you'll enter a series of commands, filling placeholders with data from your environment. These placeholders are denoted with angled brackets and all capital letters (",(0,i.kt)("inlineCode",{parentName:"p"},"<EXAMPLE>"),")."),(0,i.kt)("p",null,"Here's an ",(0,i.kt)("strong",{parentName:"p"},"example")," of a command with a placeholder:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"docker stop <RANCHER_CONTAINER_NAME>\n")),(0,i.kt)("p",null,"In this command, ",(0,i.kt)("inlineCode",{parentName:"p"},"<RANCHER_CONTAINER_NAME>")," is the name of your Rancher container."),(0,i.kt)("h2",{id:"get-data-for-upgrade-commands"},"Get Data for Upgrade Commands"),(0,i.kt)("p",null,"To obtain the data to replace the placeholders, run:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"docker ps\n")),(0,i.kt)("p",null,"Write down or copy this information before starting the upgrade."),(0,i.kt)("sup",null,"Terminal ",(0,i.kt)("code",null,"docker ps")," Command, Displaying Where to Find ",(0,i.kt)("code",null,"<RANCHER_CONTAINER_TAG>")," and ",(0,i.kt)("code",null,"<RANCHER_CONTAINER_NAME>")),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"Placeholder Reference",src:a(50953).Z,width:"1275",height:"258"})),(0,i.kt)("table",null,(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:null},"Placeholder"),(0,i.kt)("th",{parentName:"tr",align:null},"Example"),(0,i.kt)("th",{parentName:"tr",align:null},"Description"))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"<RANCHER_CONTAINER_TAG>")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"v2.1.3")),(0,i.kt)("td",{parentName:"tr",align:null},"The rancher/rancher image you pulled for initial install.")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"<RANCHER_CONTAINER_NAME>")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"festive_mestorf")),(0,i.kt)("td",{parentName:"tr",align:null},"The name of your Rancher container.")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"<RANCHER_VERSION>")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"v2.1.3")),(0,i.kt)("td",{parentName:"tr",align:null},"The version of Rancher that you're creating a backup for.")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"<DATE>")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"2018-12-19")),(0,i.kt)("td",{parentName:"tr",align:null},"The date that the data container or backup was created.")))),(0,i.kt)("br",null),(0,i.kt)("p",null,"You can obtain ",(0,i.kt)("inlineCode",{parentName:"p"},"<RANCHER_CONTAINER_TAG>")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"<RANCHER_CONTAINER_NAME>")," by logging into your Rancher server by remote connection and entering the command to view the containers that are running: ",(0,i.kt)("inlineCode",{parentName:"p"},"docker ps"),". You can also view containers that are stopped using a different command: ",(0,i.kt)("inlineCode",{parentName:"p"},"docker ps -a"),". Use these commands for help anytime during while creating backups."),(0,i.kt)("h2",{id:"upgrade"},"Upgrade"),(0,i.kt)("p",null,"During upgrade, you create a copy of the data from your current Rancher container and a backup in case something goes wrong. Then you deploy the new version of Rancher in a new container using your existing data."),(0,i.kt)("h3",{id:"1-create-a-copy-of-the-data-from-your-rancher-server-container"},"1. Create a copy of the data from your Rancher server container"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Using a remote Terminal connection, log into the node running your Rancher server.")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Stop the container currently running Rancher server. Replace ",(0,i.kt)("inlineCode",{parentName:"p"},"<RANCHER_CONTAINER_NAME>")," with the name of your Rancher container."),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre"},"docker stop <RANCHER_CONTAINER_NAME>\n"))),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("a",{id:"backup"}),"Use the command below, replacing each placeholder, to create a data container from the Rancher container that you just stopped.",(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre"},"docker create --volumes-from <RANCHER_CONTAINER_NAME> --name rancher-data rancher/rancher:<RANCHER_CONTAINER_TAG>\n")))),(0,i.kt)("h3",{id:"2-create-a-backup-tarball"},"2. Create a backup tarball"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("a",{id:"tarball"}),"From the data container that you just created (",(0,i.kt)("code",null,"rancher-data"),"), create a backup tarball (",(0,i.kt)("code",null,"rancher-data-backup-<RANCHER_VERSION>-<DATE>.tar.gz"),").",(0,i.kt)("p",{parentName:"li"},"This tarball will serve as a rollback point if something goes wrong during upgrade. Use the following command, replacing each placeholder."),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre"},'docker run --volumes-from rancher-data -v "$PWD:/backup" --rm busybox tar zcvf /backup/rancher-data-backup-<RANCHER_VERSION>-<DATE>.tar.gz /var/lib/rancher\n')),(0,i.kt)("p",{parentName:"li"},(0,i.kt)("strong",{parentName:"p"},"Step Result:")," When you enter this command, a series of commands should run.")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Enter the ",(0,i.kt)("inlineCode",{parentName:"p"},"ls")," command to confirm that the backup tarball was created. It will have a name similar to ",(0,i.kt)("inlineCode",{parentName:"p"},"rancher-data-backup-<RANCHER_VERSION>-<DATE>.tar.gz"),"."),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre"},"[rancher@ip-10-0-0-50 ~]$ ls\nrancher-data-backup-v2.1.3-20181219.tar.gz\n"))),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Move your backup tarball to a safe location external from your Rancher server."))),(0,i.kt)("h3",{id:"3-pull-the-new-docker-image"},"3. Pull the New Docker Image"),(0,i.kt)("p",null,"Pull the image of the Rancher version that you want to upgrade to."),(0,i.kt)("table",null,(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:null},"Placeholder"),(0,i.kt)("th",{parentName:"tr",align:null},"Description"))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"<RANCHER_VERSION_TAG>")),(0,i.kt)("td",{parentName:"tr",align:null},"The release tag of the ",(0,i.kt)("a",{parentName:"td",href:"/getting-started/installation-and-upgrade/installation-references/helm-chart-options"},"Rancher version")," that you want to upgrade to.")))),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"docker pull rancher/rancher:<RANCHER_VERSION_TAG>\n")),(0,i.kt)("h3",{id:"4-start-the-new-rancher-server-container"},"4. Start the New Rancher Server Container"),(0,i.kt)("p",null,"Start a new Rancher server container using the data from the ",(0,i.kt)("inlineCode",{parentName:"p"},"rancher-data")," container. Remember to pass in all the environment variables that you had used when you started the original container."),(0,i.kt)("div",{className:"admonition admonition-danger alert alert--danger"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"}))),"danger")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},(0,i.kt)("strong",{parentName:"p"},(0,i.kt)("em",{parentName:"strong"},"Do not"))," stop the upgrade after initiating it, even if the upgrade process seems longer than expected. Stopping the upgrade may result in database migration errors during future upgrades."))),(0,i.kt)("p",null,"If you used a proxy, see ",(0,i.kt)("a",{parentName:"p",href:"/reference-guides/single-node-rancher-in-docker/http-proxy-configuration"},"HTTP Proxy Configuration.")),(0,i.kt)("p",null,"If you configured a custom CA root certificate to access your services, see ",(0,i.kt)("a",{parentName:"p",href:"/reference-guides/single-node-rancher-in-docker/advanced-options#custom-ca-certificate"},"Custom CA root certificate.")),(0,i.kt)("p",null,"If you are recording all transactions with the Rancher API, see ",(0,i.kt)("a",{parentName:"p",href:"/reference-guides/single-node-rancher-in-docker/advanced-options#api-audit-log"},"API Auditing")),(0,i.kt)("p",null,"To see the command to use when starting the new Rancher server container, choose from the following options:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Docker Upgrade"),(0,i.kt)("li",{parentName:"ul"},"Docker Upgrade for Air Gap Installs")),(0,i.kt)(o.Z,{mdxType:"Tabs"},(0,i.kt)(l.Z,{value:"Docker Upgrade",mdxType:"TabItem"},(0,i.kt)("p",null,"Select which option you had installed Rancher server"),(0,i.kt)("h4",{id:"option-a-default-self-signed-certificate"},"Option A: Default Self-Signed Certificate"),(0,i.kt)("details",{id:"option-a"},(0,i.kt)("summary",null,"Click to expand"),(0,i.kt)("p",null,"If you have selected to use the Rancher generated self-signed certificate, you add the ",(0,i.kt)("inlineCode",{parentName:"p"},"--volumes-from rancher-data")," to the command that you had started your original Rancher server container."),(0,i.kt)("table",null,(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:null},"Placeholder"),(0,i.kt)("th",{parentName:"tr",align:null},"Description"))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"<RANCHER_VERSION_TAG>")),(0,i.kt)("td",{parentName:"tr",align:null},"The release tag of the ",(0,i.kt)("a",{parentName:"td",href:"/getting-started/installation-and-upgrade/installation-references/helm-chart-options"},"Rancher version")," that you want to upgrade to.")))),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"docker run -d --volumes-from rancher-data \\\n  --restart=unless-stopped \\\n  -p 80:80 -p 443:443 \\\n  --privileged \\\n  rancher/rancher:<RANCHER_VERSION_TAG>\n")),(0,i.kt)("p",null,"Privileged access is ",(0,i.kt)("a",{parentName:"p",href:"/pages-for-subheaders/rancher-on-a-single-node-with-docker#privileged-access-for-rancher"},"required."))),(0,i.kt)("h4",{id:"option-b-bring-your-own-certificate-self-signed"},"Option B: Bring Your Own Certificate: Self-Signed"),(0,i.kt)("details",{id:"option-b"},(0,i.kt)("summary",null,"Click to expand"),(0,i.kt)("p",null,"If you have selected to bring your own self-signed certificate, you add the ",(0,i.kt)("inlineCode",{parentName:"p"},"--volumes-from rancher-data")," to the command that you had started your original Rancher server container and need to have access to the same certificate that you had originally installed with."),(0,i.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"Reminder of the Cert Prerequisite:")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"The certificate files must be in PEM format. In your certificate file, include all intermediate certificates in the chain. Order your certificates with your certificate first, followed by the intermediates."))),(0,i.kt)("table",null,(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:null},"Placeholder"),(0,i.kt)("th",{parentName:"tr",align:null},"Description"))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"<CERT_DIRECTORY>")),(0,i.kt)("td",{parentName:"tr",align:null},"The path to the directory containing your certificate files.")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"<FULL_CHAIN.pem>")),(0,i.kt)("td",{parentName:"tr",align:null},"The path to your full certificate chain.")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"<PRIVATE_KEY.pem>")),(0,i.kt)("td",{parentName:"tr",align:null},"The path to the private key for your certificate.")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"<CA_CERTS.pem>")),(0,i.kt)("td",{parentName:"tr",align:null},"The path to the certificate authority's certificate.")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"<RANCHER_VERSION_TAG>")),(0,i.kt)("td",{parentName:"tr",align:null},"The release tag of the ",(0,i.kt)("a",{parentName:"td",href:"/getting-started/installation-and-upgrade/installation-references/helm-chart-options"},"Rancher version")," that you want to upgrade to.")))),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"docker run -d --volumes-from rancher-data \\\n  --restart=unless-stopped \\\n  -p 80:80 -p 443:443 \\\n  -v /<CERT_DIRECTORY>/<FULL_CHAIN.pem>:/etc/rancher/ssl/cert.pem \\\n  -v /<CERT_DIRECTORY>/<PRIVATE_KEY.pem>:/etc/rancher/ssl/key.pem \\\n  -v /<CERT_DIRECTORY>/<CA_CERTS.pem>:/etc/rancher/ssl/cacerts.pem \\\n  --privileged \\\n  rancher/rancher:<RANCHER_VERSION_TAG>\n")),(0,i.kt)("p",null,"Privileged access is ",(0,i.kt)("a",{parentName:"p",href:"/pages-for-subheaders/rancher-on-a-single-node-with-docker#privileged-access-for-rancher"},"required."))),(0,i.kt)("h4",{id:"option-c-bring-your-own-certificate-signed-by-recognized-ca"},"Option C: Bring Your Own Certificate: Signed by Recognized CA"),(0,i.kt)("details",{id:"option-c"},(0,i.kt)("summary",null,"Click to expand"),(0,i.kt)("p",null,"If you have selected to use a certificate signed by a recognized CA, you add the ",(0,i.kt)("inlineCode",{parentName:"p"},"--volumes-from rancher-data")," to the command that you had started your original Rancher server container and need to have access to the same certificates that you had originally installed with. Remember to include ",(0,i.kt)("inlineCode",{parentName:"p"},"--no-cacerts")," as an argument to the container to disable the default CA certificate generated by Rancher."),(0,i.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"Reminder of the Cert Prerequisite:")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"The certificate files must be in PEM format. In your certificate file, include all intermediate certificates provided by the recognized CA. Order your certificates with your certificate first, followed by the intermediates. For an example, see ",(0,i.kt)("a",{parentName:"p",href:"/getting-started/installation-and-upgrade/other-installation-methods/rancher-on-a-single-node-with-docker/certificate-troubleshooting"},"Certificate Troubleshooting.")))),(0,i.kt)("table",null,(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:null},"Placeholder"),(0,i.kt)("th",{parentName:"tr",align:null},"Description"))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"<CERT_DIRECTORY>")),(0,i.kt)("td",{parentName:"tr",align:null},"The path to the directory containing your certificate files.")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"<FULL_CHAIN.pem>")),(0,i.kt)("td",{parentName:"tr",align:null},"The path to your full certificate chain.")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"<PRIVATE_KEY.pem>")),(0,i.kt)("td",{parentName:"tr",align:null},"The path to the private key for your certificate.")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"<RANCHER_VERSION_TAG>")),(0,i.kt)("td",{parentName:"tr",align:null},"The release tag of the ",(0,i.kt)("a",{parentName:"td",href:"/getting-started/installation-and-upgrade/installation-references/helm-chart-options"},"Rancher version")," that you want to upgrade to.")))),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"docker run -d --volumes-from rancher-data \\\n  --restart=unless-stopped \\\n  -p 80:80 -p 443:443 \\\n  -v /<CERT_DIRECTORY>/<FULL_CHAIN.pem>:/etc/rancher/ssl/cert.pem \\\n  -v /<CERT_DIRECTORY>/<PRIVATE_KEY.pem>:/etc/rancher/ssl/key.pem \\\n  --privileged \\\n  rancher/rancher:<RANCHER_VERSION_TAG> \\\n  --no-cacerts\n")),(0,i.kt)("p",null,"Privileged access is ",(0,i.kt)("a",{parentName:"p",href:"/pages-for-subheaders/rancher-on-a-single-node-with-docker#privileged-access-for-rancher"},"required."))),(0,i.kt)("h4",{id:"option-d-lets-encrypt-certificate"},"Option D: Let's Encrypt Certificate"),(0,i.kt)("details",{id:"option-d"},(0,i.kt)("summary",null,"Click to expand"),(0,i.kt)("div",{className:"admonition admonition-caution alert alert--warning"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"}))),"caution")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"Let's Encrypt provides rate limits for requesting new certificates. Therefore, limit how often you create or destroy the container. For more information, see ",(0,i.kt)("a",{parentName:"p",href:"https://letsencrypt.org/docs/rate-limits/"},"Let's Encrypt documentation on rate limits"),"."))),(0,i.kt)("p",null,"If you have selected to use ",(0,i.kt)("a",{parentName:"p",href:"https://letsencrypt.org/"},"Let's Encrypt")," certificates, you add the ",(0,i.kt)("inlineCode",{parentName:"p"},"--volumes-from rancher-data")," to the command that you had started your original Rancher server container and need to provide the domain that you had used when you originally installed Rancher."),(0,i.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"Reminder of the Cert Prerequisites:")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("ul",{parentName:"div"},(0,i.kt)("li",{parentName:"ul"},"Create a record in your DNS that binds your Linux host IP address to the hostname that you want to use for Rancher access (",(0,i.kt)("inlineCode",{parentName:"li"},"rancher.mydomain.com")," for example)."),(0,i.kt)("li",{parentName:"ul"},"Open port ",(0,i.kt)("inlineCode",{parentName:"li"},"TCP/80")," on your Linux host. The Let's Encrypt http-01 challenge can come from any source IP address, so port ",(0,i.kt)("inlineCode",{parentName:"li"},"TCP/80")," must be open to all IP addresses.")))),(0,i.kt)("table",null,(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:null},"Placeholder"),(0,i.kt)("th",{parentName:"tr",align:null},"Description"))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"<RANCHER_VERSION_TAG>")),(0,i.kt)("td",{parentName:"tr",align:null},"The release tag of the ",(0,i.kt)("a",{parentName:"td",href:"/getting-started/installation-and-upgrade/installation-references/helm-chart-options"},"Rancher version")," that you want to upgrade to.")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"<YOUR.DNS.NAME>")),(0,i.kt)("td",{parentName:"tr",align:null},"The domain address that you had originally started with")))),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"docker run -d --volumes-from rancher-data \\\n  --restart=unless-stopped \\\n  -p 80:80 -p 443:443 \\\n  --privileged \\\n  rancher/rancher:<RANCHER_VERSION_TAG> \\\n  --acme-domain <YOUR.DNS.NAME>\n")),(0,i.kt)("p",null,"Privileged access is ",(0,i.kt)("a",{parentName:"p",href:"/pages-for-subheaders/rancher-on-a-single-node-with-docker#privileged-access-for-rancher"},"required.")))),(0,i.kt)(l.Z,{value:"Docker Air Gap Upgrade",mdxType:"TabItem"},(0,i.kt)("p",null,"For security purposes, SSL (Secure Sockets Layer) is required when using Rancher. SSL secures all Rancher network communication, like when you login or interact with a cluster."),(0,i.kt)("p",null,"When starting the new Rancher server container, choose from the following options:"),(0,i.kt)("h4",{id:"option-a-default-self-signed-certificate-1"},"Option A: Default Self-Signed Certificate"),(0,i.kt)("details",{id:"option-a"},(0,i.kt)("summary",null,"Click to expand"),(0,i.kt)("p",null,"If you have selected to use the Rancher generated self-signed certificate, you add the ",(0,i.kt)("inlineCode",{parentName:"p"},"--volumes-from rancher-data")," to the command that you had started your original Rancher server container."),(0,i.kt)("table",null,(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:null},"Placeholder"),(0,i.kt)("th",{parentName:"tr",align:null},"Description"))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"<REGISTRY.YOURDOMAIN.COM:PORT>")),(0,i.kt)("td",{parentName:"tr",align:null},"Your private registry URL and port.")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"<RANCHER_VERSION_TAG>")),(0,i.kt)("td",{parentName:"tr",align:null},"The release tag of the ",(0,i.kt)("a",{parentName:"td",href:"/getting-started/installation-and-upgrade/installation-references/helm-chart-options"},"Rancher version")," that you want to to upgrade to.")))),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"  docker run -d --volumes-from rancher-data \\\n      --restart=unless-stopped \\\n      -p 80:80 -p 443:443 \\\n      -e CATTLE_SYSTEM_DEFAULT_REGISTRY=<REGISTRY.YOURDOMAIN.COM:PORT> \\ # Set a default private registry to be used in Rancher\n      -e CATTLE_SYSTEM_CATALOG=bundled \\ # Use the packaged Rancher system charts\n      --privileged \\\n      <REGISTRY.YOURDOMAIN.COM:PORT>/rancher/rancher:<RANCHER_VERSION_TAG>\n")),(0,i.kt)("p",null,"Privileged access is ",(0,i.kt)("a",{parentName:"p",href:"/pages-for-subheaders/rancher-on-a-single-node-with-docker#privileged-access-for-rancher"},"required."))),(0,i.kt)("h4",{id:"option-b-bring-your-own-certificate-self-signed-1"},"Option B: Bring Your Own Certificate: Self-Signed"),(0,i.kt)("details",{id:"option-b"},(0,i.kt)("summary",null,"Click to expand"),(0,i.kt)("p",null,"If you have selected to bring your own self-signed certificate, you add the ",(0,i.kt)("inlineCode",{parentName:"p"},"--volumes-from rancher-data")," to the command that you had started your original Rancher server container and need to have access to the same certificate that you had originally installed with."),(0,i.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"Reminder of the Cert Prerequisite:")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"The certificate files must be in PEM format. In your certificate file, include all intermediate certificates in the chain. Order your certificates with your certificate first, followed by the intermediates. For an example, see ",(0,i.kt)("a",{parentName:"p",href:"/getting-started/installation-and-upgrade/other-installation-methods/rancher-on-a-single-node-with-docker/certificate-troubleshooting"},"Certificate Troubleshooting.")))),(0,i.kt)("table",null,(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:null},"Placeholder"),(0,i.kt)("th",{parentName:"tr",align:null},"Description"))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"<CERT_DIRECTORY>")),(0,i.kt)("td",{parentName:"tr",align:null},"The path to the directory containing your certificate files.")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"<FULL_CHAIN.pem>")),(0,i.kt)("td",{parentName:"tr",align:null},"The path to your full certificate chain.")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"<PRIVATE_KEY.pem>")),(0,i.kt)("td",{parentName:"tr",align:null},"The path to the private key for your certificate.")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"<CA_CERTS.pem>")),(0,i.kt)("td",{parentName:"tr",align:null},"The path to the certificate authority's certificate.")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"<REGISTRY.YOURDOMAIN.COM:PORT>")),(0,i.kt)("td",{parentName:"tr",align:null},"Your private registry URL and port.")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"<RANCHER_VERSION_TAG>")),(0,i.kt)("td",{parentName:"tr",align:null},"The release tag of the ",(0,i.kt)("a",{parentName:"td",href:"/getting-started/installation-and-upgrade/installation-references/helm-chart-options"},"Rancher version")," that you want to upgrade to.")))),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"docker run -d --restart=unless-stopped \\\n    -p 80:80 -p 443:443 \\\n    -v /<CERT_DIRECTORY>/<FULL_CHAIN.pem>:/etc/rancher/ssl/cert.pem \\\n    -v /<CERT_DIRECTORY>/<PRIVATE_KEY.pem>:/etc/rancher/ssl/key.pem \\\n    -v /<CERT_DIRECTORY>/<CA_CERTS.pem>:/etc/rancher/ssl/cacerts.pem \\\n    -e CATTLE_SYSTEM_DEFAULT_REGISTRY=<REGISTRY.YOURDOMAIN.COM:PORT> \\ # Set a default private registry to be used in Rancher\n    -e CATTLE_SYSTEM_CATALOG=bundled \\ # Use the packaged Rancher system charts\n    --privileged \\\n    <REGISTRY.YOURDOMAIN.COM:PORT>/rancher/rancher:<RANCHER_VERSION_TAG>\n")),(0,i.kt)("p",null,"Privileged access is ",(0,i.kt)("a",{parentName:"p",href:"/pages-for-subheaders/rancher-on-a-single-node-with-docker#privileged-access-for-rancher"},"required."))),(0,i.kt)("h4",{id:"option-c-bring-your-own-certificate-signed-by-recognized-ca-1"},"Option C: Bring Your Own Certificate: Signed by Recognized CA"),(0,i.kt)("details",{id:"option-c"},(0,i.kt)("summary",null,"Click to expand"),(0,i.kt)("p",null,"If you have selected to use a certificate signed by a recognized CA, you add the ",(0,i.kt)("inlineCode",{parentName:"p"},"--volumes-from rancher-data")," to the command that you had started your original Rancher server container and need to have access to the same certificates that you had originally installed with."),(0,i.kt)("p",null,"  :::note Reminder of the Cert Prerequisite:"),(0,i.kt)("p",null,"  The certificate files must be in PEM format. In your certificate file, include all intermediate certificates provided by the recognized CA. Order your certificates with your certificate first, followed by the intermediates. For an example, see ",(0,i.kt)("a",{parentName:"p",href:"/getting-started/installation-and-upgrade/other-installation-methods/rancher-on-a-single-node-with-docker/certificate-troubleshooting"},"Certificate Troubleshooting.")),(0,i.kt)("p",null,"  :::"),(0,i.kt)("table",null,(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:null},"Placeholder"),(0,i.kt)("th",{parentName:"tr",align:null},"Description"))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"<CERT_DIRECTORY>")),(0,i.kt)("td",{parentName:"tr",align:null},"The path to the directory containing your certificate files.")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"<FULL_CHAIN.pem>")),(0,i.kt)("td",{parentName:"tr",align:null},"The path to your full certificate chain.")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"<PRIVATE_KEY.pem>")),(0,i.kt)("td",{parentName:"tr",align:null},"The path to the private key for your certificate.")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"<REGISTRY.YOURDOMAIN.COM:PORT>")),(0,i.kt)("td",{parentName:"tr",align:null},"Your private registry URL and port.")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"<RANCHER_VERSION_TAG>")),(0,i.kt)("td",{parentName:"tr",align:null},"The release tag of the ",(0,i.kt)("a",{parentName:"td",href:"/getting-started/installation-and-upgrade/installation-references/helm-chart-options"},"Rancher version")," that you want to upgrade to.")))),(0,i.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"Use the ",(0,i.kt)("inlineCode",{parentName:"p"},"--no-cacerts")," as argument to the container to disable the default CA certificate generated by Rancher."))),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"docker run -d --volumes-from rancher-data \\\n    --restart=unless-stopped \\\n     -p 80:80 -p 443:443 \\\n     --no-cacerts \\\n     -v /<CERT_DIRECTORY>/<FULL_CHAIN.pem>:/etc/rancher/ssl/cert.pem \\\n     -v /<CERT_DIRECTORY>/<PRIVATE_KEY.pem>:/etc/rancher/ssl/key.pem \\\n     -e CATTLE_SYSTEM_DEFAULT_REGISTRY=<REGISTRY.YOURDOMAIN.COM:PORT> \\ # Set a default private registry to be used in Rancher\n     -e CATTLE_SYSTEM_CATALOG=bundled \\ # Use the packaged Rancher system charts\n     --privileged\n     <REGISTRY.YOURDOMAIN.COM:PORT>/rancher/rancher:<RANCHER_VERSION_TAG>\n")),(0,i.kt)("p",null,"privileged access is ",(0,i.kt)("a",{parentName:"p",href:"/pages-for-subheaders/rancher-on-a-single-node-with-docker#privileged-access-for-rancher"},"required."))))),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Result:")," You have upgraded Rancher. Data from your upgraded server is now saved to the ",(0,i.kt)("inlineCode",{parentName:"p"},"rancher-data")," container for use in future upgrades."),(0,i.kt)("h3",{id:"5-verify-the-upgrade"},"5. Verify the Upgrade"),(0,i.kt)("p",null,"Log into Rancher. Confirm that the upgrade succeeded by checking the version displayed in the bottom-left corner of the browser window."),(0,i.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"Having network issues in your user clusters following upgrade?")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"See ",(0,i.kt)("a",{parentName:"p",href:"/v2.0-v2.4/getting-started/installation-and-upgrade/install-upgrade-on-a-kubernetes-cluster/upgrades/namespace-migration"},"Restoring Cluster Networking"),"."))),(0,i.kt)("h3",{id:"6-clean-up-your-old-rancher-server-container"},"6. Clean up Your Old Rancher Server Container"),(0,i.kt)("p",null,"Remove the previous Rancher server container. If you only stop the previous Rancher server container (and don't remove it), the container may restart after the next server reboot."),(0,i.kt)("h2",{id:"rolling-back"},"Rolling Back"),(0,i.kt)("p",null,"If your upgrade does not complete successfully, you can roll back Rancher server and its data back to its last healthy state. For more information, see ",(0,i.kt)("a",{parentName:"p",href:"/getting-started/installation-and-upgrade/other-installation-methods/rancher-on-a-single-node-with-docker/roll-back-docker-installed-rancher"},"Docker Rollback"),"."))}k.isMDXComponent=!0},50953:function(e,t,a){t.Z=a.p+"assets/images/placeholder-ref-70c9571e1a85164291c80a55c7c614b5.png"}}]);