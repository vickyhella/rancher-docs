"use strict";(self.webpackChunkrancher_docs=self.webpackChunkrancher_docs||[]).push([[36611],{3905:(e,n,t)=>{t.d(n,{Zo:()=>p,kt:()=>m});var a=t(67294);function r(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function l(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function i(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?l(Object(t),!0).forEach((function(n){r(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):l(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function o(e,n){if(null==e)return{};var t,a,r=function(e,n){if(null==e)return{};var t,a,r={},l=Object.keys(e);for(a=0;a<l.length;a++)t=l[a],n.indexOf(t)>=0||(r[t]=e[t]);return r}(e,n);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(a=0;a<l.length;a++)t=l[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var s=a.createContext({}),u=function(e){var n=a.useContext(s),t=n;return e&&(t="function"==typeof e?e(n):i(i({},n),e)),t},p=function(e){var n=u(e.components);return a.createElement(s.Provider,{value:n},e.children)},c={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},d=a.forwardRef((function(e,n){var t=e.components,r=e.mdxType,l=e.originalType,s=e.parentName,p=o(e,["components","mdxType","originalType","parentName"]),d=u(t),m=r,k=d["".concat(s,".").concat(m)]||d[m]||c[m]||l;return t?a.createElement(k,i(i({ref:n},p),{},{components:t})):a.createElement(k,i({ref:n},p))}));function m(e,n){var t=arguments,r=n&&n.mdxType;if("string"==typeof e||r){var l=t.length,i=new Array(l);i[0]=d;var o={};for(var s in n)hasOwnProperty.call(n,s)&&(o[s]=n[s]);o.originalType=e,o.mdxType="string"==typeof e?e:r,i[1]=o;for(var u=2;u<l;u++)i[u]=t[u];return a.createElement.apply(null,i)}return a.createElement.apply(null,t)}d.displayName="MDXCreateElement"},54267:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>s,contentTitle:()=>i,default:()=>c,frontMatter:()=>l,metadata:()=>o,toc:()=>u});var a=t(87462),r=(t(67294),t(3905));const l={title:"Hardening Guide v2.3.3"},i=void 0,o={unversionedId:"reference-guides/rancher-security/rancher-v2.3-hardening-guides/rancher-v2.3.3-hardening-guide-with-cis-v1.4.1-benchmark",id:"version-2.0-2.4/reference-guides/rancher-security/rancher-v2.3-hardening-guides/rancher-v2.3.3-hardening-guide-with-cis-v1.4.1-benchmark",title:"Hardening Guide v2.3.3",description:"This document provides prescriptive guidance for hardening a production installation of Rancher v2.3.3. It outlines the configurations and controls required to address Kubernetes benchmark controls from the Center for Information Security (CIS).",source:"@site/versioned_docs/version-2.0-2.4/reference-guides/rancher-security/rancher-v2.3-hardening-guides/rancher-v2.3.3-hardening-guide-with-cis-v1.4.1-benchmark.md",sourceDirName:"reference-guides/rancher-security/rancher-v2.3-hardening-guides",slug:"/reference-guides/rancher-security/rancher-v2.3-hardening-guides/rancher-v2.3.3-hardening-guide-with-cis-v1.4.1-benchmark",permalink:"/v2.0-v2.4/reference-guides/rancher-security/rancher-v2.3-hardening-guides/rancher-v2.3.3-hardening-guide-with-cis-v1.4.1-benchmark",draft:!1,editUrl:"https://github.com/rancher/rancher-docs/edit/main/versioned_docs/version-2.0-2.4/reference-guides/rancher-security/rancher-v2.3-hardening-guides/rancher-v2.3.3-hardening-guide-with-cis-v1.4.1-benchmark.md",tags:[],version:"2.0-2.4",lastUpdatedAt:1663953084,formattedLastUpdatedAt:"Sep 23, 2022",frontMatter:{title:"Hardening Guide v2.3.3"},sidebar:"tutorialSidebar",previous:{title:"CIS Benchmark Rancher Self-Assessment Guide - Rancher v2.3.3",permalink:"/v2.0-v2.4/reference-guides/rancher-security/rancher-v2.3-hardening-guides/rancher-v2.3.3-self-assessment-guide-with-cis-v1.4.1-benchmark"},next:{title:"CIS Benchmark Rancher Self-Assessment Guide - v2.3.5",permalink:"/v2.0-v2.4/reference-guides/rancher-security/rancher-v2.3-hardening-guides/rancher-v2.3.5-self-assessment-guide-with-cis-v1.5-benchmark"}},s={},u=[{value:"Profile Definitions",id:"profile-definitions",level:3},{value:"Level 1",id:"level-1",level:4},{value:"Level 2",id:"level-2",level:4},{value:"1.1 - Rancher RKE Kubernetes cluster host configuration",id:"11---rancher-rke-kubernetes-cluster-host-configuration",level:2},{value:"1.1.1 - Configure default sysctl settings on all hosts",id:"111---configure-default-sysctl-settings-on-all-hosts",level:3},{value:"1.4.11 Ensure that the etcd data directory permissions are set to <code>700</code> or more restrictive",id:"1411-ensure-that-the-etcd-data-directory-permissions-are-set-to-700-or-more-restrictive",level:3},{value:"1.4.12 - Ensure that the etcd data directory ownership is set to <code>etcd:etcd</code>",id:"1412---ensure-that-the-etcd-data-directory-ownership-is-set-to-etcdetcd",level:3},{value:"2.1 - Rancher HA Kubernetes Cluster Configuration via RKE",id:"21---rancher-ha-kubernetes-cluster-configuration-via-rke",level:2},{value:"2.1.1 - Configure kubelet options",id:"211---configure-kubelet-options",level:3},{value:"2.1.2 - Configure kube-api options",id:"212---configure-kube-api-options",level:3},{value:"2.1.3 - Configure scheduler options",id:"213---configure-scheduler-options",level:3},{value:"2.1.4 - Configure controller options",id:"214---configure-controller-options",level:3},{value:"2.1.5 - Configure addons and PSPs",id:"215---configure-addons-and-psps",level:3},{value:"3.1 - Rancher Management Control Plane Installation",id:"31---rancher-management-control-plane-installation",level:2},{value:"3.1.1 - Disable the local cluster option",id:"311---disable-the-local-cluster-option",level:3},{value:"3.1.2 - Enable Rancher Audit logging",id:"312---enable-rancher-audit-logging",level:3},{value:"Reference",id:"reference",level:4},{value:"3.2 - Rancher Management Control Plane Authentication",id:"32---rancher-management-control-plane-authentication",level:2},{value:"3.2.1 - Change the local admin password from the default value",id:"321---change-the-local-admin-password-from-the-default-value",level:3},{value:"3.2.2 - Configure an Identity Provider for Authentication",id:"322---configure-an-identity-provider-for-authentication",level:3},{value:"Reference",id:"reference-1",level:4},{value:"3.3 - Rancher Management Control Plane RBAC",id:"33---rancher-management-control-plane-rbac",level:2},{value:"3.3.1 - Ensure that administrator privileges are only granted to those who require them",id:"331---ensure-that-administrator-privileges-are-only-granted-to-those-who-require-them",level:3},{value:"3.4 - Rancher Management Control Plane Configuration",id:"34---rancher-management-control-plane-configuration",level:2},{value:"3.4.1 - Ensure only approved node drivers are active",id:"341---ensure-only-approved-node-drivers-are-active",level:3},{value:"4.1 - Rancher Kubernetes Custom Cluster Configuration via RKE",id:"41---rancher-kubernetes-custom-cluster-configuration-via-rke",level:2},{value:"4.1.1 - Configure kubelet options",id:"411---configure-kubelet-options",level:3},{value:"4.1.2 - Configure kube-api options",id:"412---configure-kube-api-options",level:3},{value:"4.1.3 - Configure scheduler options",id:"413---configure-scheduler-options",level:3},{value:"4.1.4 - Configure controller options",id:"414---configure-controller-options",level:3},{value:"4.1.5 - Check PSPs",id:"415---check-psps",level:3},{value:"Appendix A - Complete ubuntu <code>cloud-config</code> Example",id:"appendix-a---complete-ubuntu-cloud-config-example",level:2},{value:"Appendix B - Complete RKE <code>cluster.yml</code> Example",id:"appendix-b---complete-rke-clusteryml-example",level:2},{value:"Appendix C - Complete RKE Template Example",id:"appendix-c---complete-rke-template-example",level:2}],p={toc:u};function c(e){let{components:n,...t}=e;return(0,r.kt)("wrapper",(0,a.Z)({},p,t,{components:n,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"This document provides prescriptive guidance for hardening a production installation of Rancher v2.3.3. It outlines the configurations and controls required to address Kubernetes benchmark controls from the Center for Information Security (CIS)."),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"This hardening guide describes how to secure the nodes in your cluster, and it is recommended to follow this guide before installing Kubernetes.")),(0,r.kt)("p",null,"This hardening guide is intended to be used with specific versions of the CIS Kubernetes Benchmark, Kubernetes, and Rancher:"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Hardening Guide Version"),(0,r.kt)("th",{parentName:"tr",align:null},"Rancher Version"),(0,r.kt)("th",{parentName:"tr",align:null},"CIS Benchmark Version"),(0,r.kt)("th",{parentName:"tr",align:null},"Kubernetes Version"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Hardening Guide v2.3.3"),(0,r.kt)("td",{parentName:"tr",align:null},"Rancher v2.3.3"),(0,r.kt)("td",{parentName:"tr",align:null},"Benchmark v1.4.1"),(0,r.kt)("td",{parentName:"tr",align:null},"Kubernetes 1.14, 1.15, and 1.16")))),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://releases.rancher.com/documents/security/2.3.3/Rancher_Hardening_Guide.pdf"},"Click here to download a PDF version of this document")),(0,r.kt)("p",null,"For more detail about evaluating a hardened cluster against the official CIS benchmark, refer to the ",(0,r.kt)("a",{parentName:"p",href:"/v2.0-v2.4/reference-guides/rancher-security/rancher-v2.3-hardening-guides/rancher-v2.3.3-self-assessment-guide-with-cis-v1.4.1-benchmark"},"CIS Benchmark Rancher Self-Assessment Guide v2.3.3"),"."),(0,r.kt)("h3",{id:"profile-definitions"},"Profile Definitions"),(0,r.kt)("p",null,"The following profile definitions agree with the CIS benchmarks for Kubernetes."),(0,r.kt)("p",null,"A profile is a set of configurations that provide a certain amount of hardening. Generally, the more hardened an environment is, the more it affects performance."),(0,r.kt)("h4",{id:"level-1"},"Level 1"),(0,r.kt)("p",null,"Items in this profile intend to:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"offer practical advice appropriate for the environment;"),(0,r.kt)("li",{parentName:"ul"},"deliver an obvious security benefit; and"),(0,r.kt)("li",{parentName:"ul"},"not alter the functionality or utility of the environment beyond an acceptable margin")),(0,r.kt)("h4",{id:"level-2"},"Level 2"),(0,r.kt)("p",null,"Items in this profile extend the \u201cLevel 1\u201d profile and exhibit one or more of the following characteristics:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"are intended for use in environments or use cases where security is paramount"),(0,r.kt)("li",{parentName:"ul"},"act as a defense in depth measure"),(0,r.kt)("li",{parentName:"ul"},"may negatively impact the utility or performance of the technology")),(0,r.kt)("hr",null),(0,r.kt)("h2",{id:"11---rancher-rke-kubernetes-cluster-host-configuration"},"1.1 - Rancher RKE Kubernetes cluster host configuration"),(0,r.kt)("p",null,"(See Appendix A. for full ubuntu ",(0,r.kt)("inlineCode",{parentName:"p"},"cloud-config")," example)"),(0,r.kt)("h3",{id:"111---configure-default-sysctl-settings-on-all-hosts"},"1.1.1 - Configure default sysctl settings on all hosts"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Profile Applicability")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Level 1")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Description")),(0,r.kt)("p",null,"Configure sysctl settings to match what the kubelet would set if allowed."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Rationale")),(0,r.kt)("p",null,"We recommend that users launch the kubelet with the ",(0,r.kt)("inlineCode",{parentName:"p"},"--protect-kernel-defaults")," option. The settings that the kubelet initially attempts to change can be set manually."),(0,r.kt)("p",null,"This supports the following control:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"2.1.7 - Ensure that the ",(0,r.kt)("inlineCode",{parentName:"li"},"--protect-kernel-defaults")," argument is set to true (Scored)")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Audit")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Verify ",(0,r.kt)("inlineCode",{parentName:"li"},"vm.overcommit_memory = 1"))),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"sysctl vm.overcommit_memory\n")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Verify ",(0,r.kt)("inlineCode",{parentName:"li"},"vm.panic_on_oom = 0"))),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"sysctl vm.panic_on_oom\n")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Verify ",(0,r.kt)("inlineCode",{parentName:"li"},"kernel.panic = 10"))),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"sysctl kernel.panic\n")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Verify ",(0,r.kt)("inlineCode",{parentName:"li"},"kernel.panic_on_oops = 1"))),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"sysctl kernel.panic_on_oops\n")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Verify ",(0,r.kt)("inlineCode",{parentName:"li"},"kernel.keys.root_maxkeys = 1000000"))),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"sysctl kernel.keys.root_maxkeys\n")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Verify ",(0,r.kt)("inlineCode",{parentName:"li"},"kernel.keys.root_maxbytes = 25000000"))),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"sysctl kernel.keys.root_maxbytes\n")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Remediation")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Set the following parameters in ",(0,r.kt)("inlineCode",{parentName:"li"},"/etc/sysctl.d/90-kubelet.conf")," on all nodes:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-plain"},"vm.overcommit_memory=1\nvm.panic_on_oom=0\nkernel.panic=10\nkernel.panic_on_oops=1\nkernel.keys.root_maxkeys=1000000\nkernel.keys.root_maxbytes=25000000\n")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Run ",(0,r.kt)("inlineCode",{parentName:"li"},"sysctl -p /etc/sysctl.d/90-kubelet.conf")," to enable the settings.")),(0,r.kt)("h3",{id:"1411-ensure-that-the-etcd-data-directory-permissions-are-set-to-700-or-more-restrictive"},"1.4.11 Ensure that the etcd data directory permissions are set to ",(0,r.kt)("inlineCode",{parentName:"h3"},"700")," or more restrictive"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Profile Applicability")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Level 1")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Description")),(0,r.kt)("p",null,"Ensure that the etcd data directory has permissions of 700 or more restrictive."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Rationale")),(0,r.kt)("p",null,"etcd is a highly-available key-value store used by Kubernetes deployments for persistent storage of all of its REST API objects. This data directory should be protected from any unauthorized reads or writes. It should not be readable or writable by any group members or the world."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Audit")),(0,r.kt)("p",null,"On the etcd server node, get the etcd data directory, passed as an argument ",(0,r.kt)("inlineCode",{parentName:"p"},"--data-dir")," ,\nfrom the below command:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"ps -ef | grep etcd\n")),(0,r.kt)("p",null,"Run the below command (based on the etcd data directory found above). For example,"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"stat -c %a /var/lib/etcd\n")),(0,r.kt)("p",null,"Verify that the permissions are ",(0,r.kt)("inlineCode",{parentName:"p"},"700")," or more restrictive."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Remediation")),(0,r.kt)("p",null,"Follow the steps as documented in ",(0,r.kt)("a",{parentName:"p",href:"#1-4-12-ensure-that-the-etcd-data-directory-ownership-is-set-to-etcd-etcd"},"1.4.12")," remediation."),(0,r.kt)("h3",{id:"1412---ensure-that-the-etcd-data-directory-ownership-is-set-to-etcdetcd"},"1.4.12 - Ensure that the etcd data directory ownership is set to ",(0,r.kt)("inlineCode",{parentName:"h3"},"etcd:etcd")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Profile Applicability")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Level 1")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Description")),(0,r.kt)("p",null,"Ensure that the etcd data directory ownership is set to ",(0,r.kt)("inlineCode",{parentName:"p"},"etcd:etcd"),"."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Rationale")),(0,r.kt)("p",null,"etcd is a highly-available key-value store used by Kubernetes deployments for persistent storage of all of its REST API objects. This data directory should be protected from any unauthorized reads or writes. It should be owned by ",(0,r.kt)("inlineCode",{parentName:"p"},"etcd:etcd"),"."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Audit")),(0,r.kt)("p",null,"On a etcd server node, get the etcd data directory, passed as an argument ",(0,r.kt)("inlineCode",{parentName:"p"},"--data-dir"),", from the below command:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"ps -ef | grep etcd\n")),(0,r.kt)("p",null,"Run the below command (based on the etcd data directory found above). For example,"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"stat -c %U:%G /var/lib/etcd\n")),(0,r.kt)("p",null,"Verify that the ownership is set to ",(0,r.kt)("inlineCode",{parentName:"p"},"etcd:etcd"),"."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Remediation")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"On the etcd server node(s) add the ",(0,r.kt)("inlineCode",{parentName:"li"},"etcd")," user:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},'useradd -c "Etcd user" -d /var/lib/etcd etcd\n')),(0,r.kt)("p",null,"Record the uid/gid:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"id etcd\n")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Add the following to the RKE ",(0,r.kt)("inlineCode",{parentName:"li"},"cluster.yml")," etcd section under ",(0,r.kt)("inlineCode",{parentName:"li"},"services"),":")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"services:\n  etcd:\n    uid: <etcd user uid recorded previously>\n    gid: <etcd user gid recorded previously>\n")),(0,r.kt)("h2",{id:"21---rancher-ha-kubernetes-cluster-configuration-via-rke"},"2.1 - Rancher HA Kubernetes Cluster Configuration via RKE"),(0,r.kt)("p",null,"(See Appendix B. for full RKE ",(0,r.kt)("inlineCode",{parentName:"p"},"cluster.yml")," example)"),(0,r.kt)("h3",{id:"211---configure-kubelet-options"},"2.1.1 - Configure kubelet options"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Profile Applicability")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Level 1")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Description")),(0,r.kt)("p",null,"Ensure Kubelet options are configured to match CIS controls."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Rationale")),(0,r.kt)("p",null,"To pass the following controls in the CIS benchmark, ensure the appropriate flags are passed to the Kubelet."),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"2.1.1 - Ensure that the ",(0,r.kt)("inlineCode",{parentName:"li"},"--anonymous-auth")," argument is set to false (Scored)"),(0,r.kt)("li",{parentName:"ul"},"2.1.2 - Ensure that the ",(0,r.kt)("inlineCode",{parentName:"li"},"--authorization-mode")," argument is not set to ",(0,r.kt)("inlineCode",{parentName:"li"},"AlwaysAllow")," (Scored)"),(0,r.kt)("li",{parentName:"ul"},"2.1.6 - Ensure that the ",(0,r.kt)("inlineCode",{parentName:"li"},"--streaming-connection-idle-timeout")," argument is not set to 0 (Scored)"),(0,r.kt)("li",{parentName:"ul"},"2.1.7 - Ensure that the ",(0,r.kt)("inlineCode",{parentName:"li"},"--protect-kernel-defaults")," argument is set to true (Scored)"),(0,r.kt)("li",{parentName:"ul"},"2.1.8 - Ensure that the ",(0,r.kt)("inlineCode",{parentName:"li"},"--make-iptables-util-chains")," argument is set to true (Scored)"),(0,r.kt)("li",{parentName:"ul"},"2.1.10 - Ensure that the ",(0,r.kt)("inlineCode",{parentName:"li"},"--event-qps")," argument is set to 0 (Scored)"),(0,r.kt)("li",{parentName:"ul"},"2.1.13 - Ensure that the ",(0,r.kt)("inlineCode",{parentName:"li"},"RotateKubeletServerCertificate")," argument is set to true (Scored)"),(0,r.kt)("li",{parentName:"ul"},"2.1.14 - Ensure that the Kubelet only makes use of Strong Cryptographic Ciphers (Not Scored)")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Audit")),(0,r.kt)("p",null,"Inspect the Kubelet containers on all hosts and verify that they are running with the following options:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"--streaming-connection-idle-timeout=<duration greater than 0>")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"--authorization-mode=Webhook")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"--protect-kernel-defaults=true")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"--make-iptables-util-chains=true")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"--event-qps=0")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"--anonymous-auth=false")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},'--feature-gates="RotateKubeletServerCertificate=true"')),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},'--tls-cipher-suites="TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_AES_128_GCM_SHA256"'))),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Remediation")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Add the following to the RKE ",(0,r.kt)("inlineCode",{parentName:"li"},"cluster.yml")," kubelet section under ",(0,r.kt)("inlineCode",{parentName:"li"},"services"),":")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},'services:\n  kubelet:\n    generate_serving_certificate: true\n    extra_args:\n      feature-gates: "RotateKubeletServerCertificate=true"\n      protect-kernel-defaults: "true"\n      tls-cipher-suites: "TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_AES_128_GCM_SHA256"\n')),(0,r.kt)("p",null,"  Where ",(0,r.kt)("inlineCode",{parentName:"p"},"<duration>")," is in a form like ",(0,r.kt)("inlineCode",{parentName:"p"},"1800s"),"."),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Reconfigure the cluster:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"rke up --config cluster.yml\n")),(0,r.kt)("h3",{id:"212---configure-kube-api-options"},"2.1.2 - Configure kube-api options"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Profile Applicability")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Level 1")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Description")),(0,r.kt)("p",null,"Ensure the RKE configuration is set to deploy the ",(0,r.kt)("inlineCode",{parentName:"p"},"kube-api")," service with the options required for controls."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"NOTE:")),(0,r.kt)("p",null,"Enabling the ",(0,r.kt)("inlineCode",{parentName:"p"},"AlwaysPullImages")," admission control plugin can cause degraded performance due to overhead of always pulling images.\nEnabling the ",(0,r.kt)("inlineCode",{parentName:"p"},"DenyEscalatingExec")," admission control plugin will prevent the 'Launch kubectl' functionality in the UI from working."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Rationale")),(0,r.kt)("p",null,"To pass the following controls for the kube-api server ensure RKE configuration passes the appropriate options."),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"1.1.1 - Ensure that the ",(0,r.kt)("inlineCode",{parentName:"li"},"--anonymous-auth")," argument is set to false (Scored)"),(0,r.kt)("li",{parentName:"ul"},"1.1.8 - Ensure that the ",(0,r.kt)("inlineCode",{parentName:"li"},"--profiling")," argument is set to false (Scored)"),(0,r.kt)("li",{parentName:"ul"},"1.1.11 - Ensure that the admission control plugin ",(0,r.kt)("inlineCode",{parentName:"li"},"AlwaysPullImages")," is set (Scored)"),(0,r.kt)("li",{parentName:"ul"},"1.1.12 - Ensure that the admission control plugin ",(0,r.kt)("inlineCode",{parentName:"li"},"DenyEscalatingExec")," is set (Scored)"),(0,r.kt)("li",{parentName:"ul"},"1.1.14 - Ensure that the admission control plugin ",(0,r.kt)("inlineCode",{parentName:"li"},"NamespaceLifecycle")," is set (Scored)"),(0,r.kt)("li",{parentName:"ul"},"1.1.15 - Ensure that the ",(0,r.kt)("inlineCode",{parentName:"li"},"--audit-log-path")," argument is set as appropriate (Scored)"),(0,r.kt)("li",{parentName:"ul"},"1.1.16 - Ensure that the ",(0,r.kt)("inlineCode",{parentName:"li"},"--audit-log-maxage")," argument is set as appropriate (Scored)"),(0,r.kt)("li",{parentName:"ul"},"1.1.17 - Ensure that the ",(0,r.kt)("inlineCode",{parentName:"li"},"--audit-log-maxbackup")," argument is set as appropriate (Scored)"),(0,r.kt)("li",{parentName:"ul"},"1.1.18 - Ensure that the ",(0,r.kt)("inlineCode",{parentName:"li"},"--audit-log-maxsize")," argument is set as appropriate (Scored)"),(0,r.kt)("li",{parentName:"ul"},"1.1.23 - Ensure that the ",(0,r.kt)("inlineCode",{parentName:"li"},"--service-account-lookup")," argument is set to true (Scored)"),(0,r.kt)("li",{parentName:"ul"},"1.1.24 - Ensure that the admission control plugin ",(0,r.kt)("inlineCode",{parentName:"li"},"PodSecurityPolicy")," is set (Scored)"),(0,r.kt)("li",{parentName:"ul"},"1.1.30 Ensure that the API Server only makes use of Strong Cryptographic Ciphers (Not Scored)"),(0,r.kt)("li",{parentName:"ul"},"1.1.34 - Ensure that the ",(0,r.kt)("inlineCode",{parentName:"li"},"--encryption-provider-config")," argument is set as appropriate (Scored)"),(0,r.kt)("li",{parentName:"ul"},"1.1.35 - Ensure that the encryption provider is set to ",(0,r.kt)("inlineCode",{parentName:"li"},"aescbc")," (Scored)"),(0,r.kt)("li",{parentName:"ul"},"1.1.36 - Ensure that the admission control plugin ",(0,r.kt)("inlineCode",{parentName:"li"},"EventRateLimit")," is set (Scored)"),(0,r.kt)("li",{parentName:"ul"},"1.1.37 - Ensure that the ",(0,r.kt)("inlineCode",{parentName:"li"},"AdvancedAuditing")," argument is not set to ",(0,r.kt)("inlineCode",{parentName:"li"},"false")," (Scored)")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Audit")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"On nodes with the ",(0,r.kt)("inlineCode",{parentName:"p"},"controlplane")," role inspect the ",(0,r.kt)("inlineCode",{parentName:"p"},"kube-apiserver")," containers:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"docker inspect kube-apiserver\n"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Look for the following options in the command section of the output:"))),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},"--anonymous-auth=false\n--profiling=false\n--service-account-lookup=true\n--enable-admission-plugins=ServiceAccount,NamespaceLifecycle,LimitRanger,PersistentVolumeLabel,DefaultStorageClass,ResourceQuota,DefaultTolerationSeconds,AlwaysPullImages,DenyEscalatingExec,NodeRestriction,EventRateLimit,PodSecurityPolicy\n--encryption-provider-config=/etc/kubernetes/ssl/encryption.yaml\n--admission-control-config-file=/etc/kubernetes/admission.yaml\n--audit-log-path=/var/log/kube-audit/audit-log.json\n--audit-log-maxage=30\n--audit-log-maxbackup=10\n--audit-log-maxsize=100\n--audit-log-format=json\n--audit-policy-file=/etc/kubernetes/audit-policy.yaml\n--tls-cipher-suites=TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_AES_128_GCM_SHA256\n")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"In the ",(0,r.kt)("inlineCode",{parentName:"li"},"volume")," section of the output ensure the bind mount is present:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},"/var/log/kube-audit:/var/log/kube-audit\n")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Remediation")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"In the RKE ",(0,r.kt)("inlineCode",{parentName:"li"},"cluster.yml")," add the following directives to the ",(0,r.kt)("inlineCode",{parentName:"li"},"kube-api")," section under ",(0,r.kt)("inlineCode",{parentName:"li"},"services"),":")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},'services:\n  kube_api:\n    always_pull_images: true\n    pod_security_policy: true\n    service_node_port_range: 30000-32767\n    event_rate_limit:\n      enabled: true\n    audit_log:\n      enabled: true\n    secrets_encryption_config:\n      enabled: true\n    extra_args:\n      anonymous-auth: "false"\n      enable-admission-plugins: "ServiceAccount,NamespaceLifecycle,LimitRanger,PersistentVolumeLabel,DefaultStorageClass,ResourceQuota,DefaultTolerationSeconds,AlwaysPullImages,DenyEscalatingExec,NodeRestriction,EventRateLimit,PodSecurityPolicy"\n      profiling: "false"\n      service-account-lookup: "true"\n      tls-cipher-suites: "TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_AES_128_GCM_SHA256"\n    extra_binds:\n      - "/opt/kubernetes:/opt/kubernetes"\n')),(0,r.kt)("p",null,"For k8s 1.14 ",(0,r.kt)("inlineCode",{parentName:"p"},"enable-admission-plugins")," should be"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},'        enable-admission-plugins: "ServiceAccount,NamespaceLifecycle,LimitRanger,PersistentVolumeLabel,DefaultStorageClass,ResourceQuota,DefaultTolerationSeconds,AlwaysPullImages,DenyEscalatingExec,NodeRestriction,PodSecurityPolicy,MutatingAdmissionWebhook,ValidatingAdmissionWebhook,Priority,EventRateLimit"\n')),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Reconfigure the cluster:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"rke up --config cluster.yml\n")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"NOTE:")),(0,r.kt)("p",null,"Files that are placed in ",(0,r.kt)("inlineCode",{parentName:"p"},"/opt/kubernetes")," need to be mounted in using the ",(0,r.kt)("inlineCode",{parentName:"p"},"extra_binds")," functionality in RKE."),(0,r.kt)("h3",{id:"213---configure-scheduler-options"},"2.1.3 - Configure scheduler options"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Profile Applicability")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Level 1")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Description")),(0,r.kt)("p",null,"Set the appropriate options for the Kubernetes scheduling service."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"NOTE:")," Setting ",(0,r.kt)("inlineCode",{parentName:"p"},"--address")," to ",(0,r.kt)("inlineCode",{parentName:"p"},"127.0.0.1")," will prevent Rancher cluster monitoring from scraping this endpoint."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Rationale")),(0,r.kt)("p",null,"To address the following controls on the CIS benchmark, the command line options should be set on the Kubernetes scheduler."),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"1.2.1 - Ensure that the ",(0,r.kt)("inlineCode",{parentName:"li"},"--profiling")," argument is set to ",(0,r.kt)("inlineCode",{parentName:"li"},"false")," (Scored)"),(0,r.kt)("li",{parentName:"ul"},"1.2.2 - Ensure that the ",(0,r.kt)("inlineCode",{parentName:"li"},"--address")," argument is set to ",(0,r.kt)("inlineCode",{parentName:"li"},"127.0.0.1")," (Scored)")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Audit")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"On nodes with the ",(0,r.kt)("inlineCode",{parentName:"li"},"controlplane")," role: inspect the ",(0,r.kt)("inlineCode",{parentName:"li"},"kube-scheduler")," containers:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"docker inspect kube-scheduler\n")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Verify the following options are set in the ",(0,r.kt)("inlineCode",{parentName:"li"},"command")," section.")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},"--profiling=false\n--address=127.0.0.1\n")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Remediation")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"In the RKE ",(0,r.kt)("inlineCode",{parentName:"li"},"cluster.yml")," file ensure the following options are set:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},'services:\n  scheduler:\n    extra_args:\n      profiling: "false"\n      address: "127.0.0.1"\n')),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Reconfigure the cluster:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"rke up --config cluster.yml\n")),(0,r.kt)("h3",{id:"214---configure-controller-options"},"2.1.4 - Configure controller options"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Profile Applicability")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Level 1")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Description")),(0,r.kt)("p",null,"Set the appropriate arguments on the Kubernetes controller manager."),(0,r.kt)("p",null,"5*NOTE:** Setting ",(0,r.kt)("inlineCode",{parentName:"p"},"--address")," to ",(0,r.kt)("inlineCode",{parentName:"p"},"127.0.0.1")," will prevent Rancher cluster monitoring from scraping this endpoint."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Rationale")),(0,r.kt)("p",null,"To address the following controls the options need to be passed to the Kubernetes controller manager."),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"1.3.1 - Ensure that the ",(0,r.kt)("inlineCode",{parentName:"li"},"--terminated-pod-gc-threshold")," argument is set as appropriate (Scored)"),(0,r.kt)("li",{parentName:"ul"},"1.3.2 - Ensure that the ",(0,r.kt)("inlineCode",{parentName:"li"},"--profiling")," argument is set to false (Scored)"),(0,r.kt)("li",{parentName:"ul"},"1.3.6 Ensure that the RotateKubeletServerCertificate argument is set to true (Scored)"),(0,r.kt)("li",{parentName:"ul"},"1.3.7 - Ensure that the ",(0,r.kt)("inlineCode",{parentName:"li"},"--address")," argument is set to 127.0.0.1 (Scored)")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Audit")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"On nodes with the ",(0,r.kt)("inlineCode",{parentName:"li"},"controlplane")," role inspect the ",(0,r.kt)("inlineCode",{parentName:"li"},"kube-controller-manager")," container:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"docker inspect kube-controller-manager\n")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Verify the following options are set in the ",(0,r.kt)("inlineCode",{parentName:"li"},"command")," section:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},'--terminated-pod-gc-threshold=1000\n--profiling=false\n--address=127.0.0.1\n--feature-gates="RotateKubeletServerCertificate=true"\n')),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Remediation")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"In the RKE ",(0,r.kt)("inlineCode",{parentName:"li"},"cluster.yml")," file ensure the following options are set:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},'services:\n  kube-controller:\n    extra_args:\n      profiling: "false"\n      address: "127.0.0.1"\n      terminated-pod-gc-threshold: "1000"\n      feature-gates: "RotateKubeletServerCertificate=true"\n')),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Reconfigure the cluster:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"rke up --config cluster.yml\n")),(0,r.kt)("h3",{id:"215---configure-addons-and-psps"},"2.1.5 - Configure addons and PSPs"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Profile Applicability")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Level 1")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Description")),(0,r.kt)("p",null,"Configure a restrictive pod security policy (PSP) as the default and create role bindings for system level services to use the less restrictive default PSP."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Rationale")),(0,r.kt)("p",null,"To address the following controls, a restrictive default PSP needs to be applied as the default. Role bindings need to be in place to allow system services to still function."),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"1.7.1 - Do not admit privileged containers (Not Scored)"),(0,r.kt)("li",{parentName:"ul"},"1.7.2 - Do not admit containers wishing to share the host process ID namespace (Not Scored)"),(0,r.kt)("li",{parentName:"ul"},"1.7.3 - Do not admit containers wishing to share the host IPC namespace (Not Scored)"),(0,r.kt)("li",{parentName:"ul"},"1.7.4 - Do not admit containers wishing to share the host network namespace (Not Scored)"),(0,r.kt)("li",{parentName:"ul"},"1.7.5 - Do not admit containers with ",(0,r.kt)("inlineCode",{parentName:"li"},"allowPrivilegeEscalation")," (Not Scored)"),(0,r.kt)("li",{parentName:"ul"},"1.7.6 - Do not admit root containers (Not Scored)"),(0,r.kt)("li",{parentName:"ul"},"1.7.7 - Do not admit containers with dangerous capabilities (Not Scored)")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Audit")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Verify that the ",(0,r.kt)("inlineCode",{parentName:"li"},"cattle-system")," namespace exists:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"kubectl get ns |grep cattle\n")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Verify that the roles exist:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"kubectl get role default-psp-role -n ingress-nginx\nkubectl get role default-psp-role -n cattle-system\nkubectl get clusterrole restricted-clusterrole\n")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Verify the bindings are set correctly:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"kubectl get rolebinding -n ingress-nginx default-psp-rolebinding\nkubectl get rolebinding -n cattle-system default-psp-rolebinding\nkubectl get clusterrolebinding restricted-clusterrolebinding\n")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Verify the restricted PSP is present.")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"kubectl get psp restricted-psp\n")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Remediation")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"In the RKE ",(0,r.kt)("inlineCode",{parentName:"li"},"cluster.yml")," file ensure the following options are set:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"addons: |\n  apiVersion: rbac.authorization.k8s.io/v1\n  kind: Role\n  metadata:\n    name: default-psp-role\n    namespace: ingress-nginx\n  rules:\n  - apiGroups:\n    - extensions\n    resourceNames:\n    - default-psp\n    resources:\n    - podsecuritypolicies\n    verbs:\n    - use\n  ---\n  apiVersion: rbac.authorization.k8s.io/v1\n  kind: RoleBinding\n  metadata:\n    name: default-psp-rolebinding\n    namespace: ingress-nginx\n  roleRef:\n    apiGroup: rbac.authorization.k8s.io\n    kind: Role\n    name: default-psp-role\n  subjects:\n  - apiGroup: rbac.authorization.k8s.io\n    kind: Group\n    name: system:serviceaccounts\n  - apiGroup: rbac.authorization.k8s.io\n    kind: Group\n    name: system:authenticated\n  ---\n  apiVersion: v1\n  kind: Namespace\n  metadata:\n    name: cattle-system\n  ---\n  apiVersion: rbac.authorization.k8s.io/v1\n  kind: Role\n  metadata:\n    name: default-psp-role\n    namespace: cattle-system\n  rules:\n  - apiGroups:\n    - extensions\n    resourceNames:\n    - default-psp\n    resources:\n    - podsecuritypolicies\n    verbs:\n    - use\n  ---\n  apiVersion: rbac.authorization.k8s.io/v1\n  kind: RoleBinding\n  metadata:\n    name: default-psp-rolebinding\n    namespace: cattle-system\n  roleRef:\n    apiGroup: rbac.authorization.k8s.io\n    kind: Role\n    name: default-psp-role\n  subjects:\n  - apiGroup: rbac.authorization.k8s.io\n    kind: Group\n    name: system:serviceaccounts\n  - apiGroup: rbac.authorization.k8s.io\n    kind: Group\n    name: system:authenticated\n  ---\n  apiVersion: policy/v1beta1\n  kind: PodSecurityPolicy\n  metadata:\n    name: restricted-psp\n  spec:\n    requiredDropCapabilities:\n    - NET_RAW\n    privileged: false\n    allowPrivilegeEscalation: false\n    defaultAllowPrivilegeEscalation: false\n    fsGroup:\n      rule: RunAsAny\n    runAsUser:\n      rule: MustRunAsNonRoot\n    seLinux:\n      rule: RunAsAny\n    supplementalGroups:\n      rule: RunAsAny\n    volumes:\n    - emptyDir\n    - secret\n    - persistentVolumeClaim\n    - downwardAPI\n    - configMap\n    - projected\n  ---\n  apiVersion: rbac.authorization.k8s.io/v1\n  kind: ClusterRole\n  metadata:\n    name: restricted-clusterrole\n  rules:\n  - apiGroups:\n    - extensions\n    resourceNames:\n    - restricted-psp\n    resources:\n    - podsecuritypolicies\n    verbs:\n    - use\n  ---\n  apiVersion: rbac.authorization.k8s.io/v1\n  kind: ClusterRoleBinding\n  metadata:\n    name: restricted-clusterrolebinding\n  roleRef:\n    apiGroup: rbac.authorization.k8s.io\n    kind: ClusterRole\n    name: restricted-clusterrole\n  subjects:\n  - apiGroup: rbac.authorization.k8s.io\n    kind: Group\n    name: system:serviceaccounts\n  - apiGroup: rbac.authorization.k8s.io\n    kind: Group\n    name: system:authenticated\n")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Reconfigure the cluster:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"rke up --config cluster.yml\n")),(0,r.kt)("h2",{id:"31---rancher-management-control-plane-installation"},"3.1 - Rancher Management Control Plane Installation"),(0,r.kt)("h3",{id:"311---disable-the-local-cluster-option"},"3.1.1 - Disable the local cluster option"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Profile Applicability")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Level 2")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Description")),(0,r.kt)("p",null,"When deploying Rancher, disable the local cluster option on the Rancher Server."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"NOTE:")," This requires Rancher v2.1.2 or above."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Rationale")),(0,r.kt)("p",null,"Having access to the local cluster from the Rancher UI is convenient for troubleshooting and debugging; however, if the local cluster is enabled in the Rancher UI, a user has access to all elements of the system, including the Rancher management server itself. Disabling the local cluster is a defense in depth measure and removes the possible attack vector from the Rancher UI and API."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Audit")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Verify the Rancher deployment has the ",(0,r.kt)("inlineCode",{parentName:"li"},"--add-local=false")," option set.")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"kubectl get deployment rancher -n cattle-system -o yaml |grep 'add-local'\n")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"In the Rancher UI go to ",(0,r.kt)("em",{parentName:"li"},"Clusters")," in the ",(0,r.kt)("em",{parentName:"li"},"Global")," view and verify that no ",(0,r.kt)("inlineCode",{parentName:"li"},"local")," cluster is present.")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Remediation")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"While upgrading or installing Rancher 2.3.3 or above, provide the following flag:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},'--set addLocal="false"\n')),(0,r.kt)("h3",{id:"312---enable-rancher-audit-logging"},"3.1.2 - Enable Rancher Audit logging"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Profile Applicability")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Level 1")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Description")),(0,r.kt)("p",null,"Enable Rancher\u2019s built-in audit logging capability."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Rationale")),(0,r.kt)("p",null,"Tracking down what actions were performed by users in Rancher can provide insight during post mortems, and if monitored proactively can be used to quickly detect malicious actions."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Audit")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Verify that the audit log parameters were passed into the Rancher deployment.")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"kubectl get deployment rancher -n cattle-system -o yaml | grep auditLog\n")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Verify that the log is going to the appropriate destination, as set by\n",(0,r.kt)("inlineCode",{parentName:"p"},"auditLog.destination")),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"p"},"sidecar"),":"),(0,r.kt)("ol",{parentName:"li"},(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"List pods:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"kubectl get pods -n cattle-system\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Tail logs:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"kubectl logs <pod> -n cattle-system -c rancher-audit-log\n"))))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"p"},"hostPath")),(0,r.kt)("ol",{parentName:"li"},(0,r.kt)("li",{parentName:"ol"},"On the worker nodes running the Rancher pods, verify that the log files are being written to the destination indicated in ",(0,r.kt)("inlineCode",{parentName:"li"},"auditlog.hostPath"),".")))))),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Remediation")),(0,r.kt)("p",null,"Upgrade the Rancher server installation using Helm, and configure the audit log settings. The instructions for doing so can be found in the reference section below."),(0,r.kt)("h4",{id:"reference"},"Reference"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://rancher.com/docs/rancher/v2.0-v2.4/en/installation/resources/chart-options/"},"https://rancher.com/docs/rancher/v2.0-v2.4/en/installation/resources/chart-options/"))),(0,r.kt)("h2",{id:"32---rancher-management-control-plane-authentication"},"3.2 - Rancher Management Control Plane Authentication"),(0,r.kt)("h3",{id:"321---change-the-local-admin-password-from-the-default-value"},"3.2.1 - Change the local admin password from the default value"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Profile Applicability")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Level 1")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Description")),(0,r.kt)("p",null,"The local admin password should be changed from the default."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Rationale")),(0,r.kt)("p",null,"The default admin password is common across all Rancher installations and should be changed immediately upon startup."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Audit")),(0,r.kt)("p",null,"Attempt to login into the UI with the following credentials:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Username: admin"),(0,r.kt)("li",{parentName:"ul"},"Password: admin")),(0,r.kt)("p",null,"The login attempt must not succeed."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Remediation")),(0,r.kt)("p",null,"Change the password from ",(0,r.kt)("inlineCode",{parentName:"p"},"admin")," to a password that meets the recommended password standards for your organization."),(0,r.kt)("h3",{id:"322---configure-an-identity-provider-for-authentication"},"3.2.2 - Configure an Identity Provider for Authentication"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Profile Applicability")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Level 1")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Description")),(0,r.kt)("p",null,"When running Rancher in a production environment, configure an identity provider for authentication."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Rationale")),(0,r.kt)("p",null,"Rancher supports several authentication backends that are common in enterprises. It is recommended to tie Rancher into an external authentication system to simplify user and group access in the Rancher cluster. Doing so assures that access control follows the organization's change management process for user accounts."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Audit")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"In the Rancher UI, select ",(0,r.kt)("em",{parentName:"li"},"Global")),(0,r.kt)("li",{parentName:"ul"},"Select ",(0,r.kt)("em",{parentName:"li"},"Security")),(0,r.kt)("li",{parentName:"ul"},"Select ",(0,r.kt)("em",{parentName:"li"},"Authentication")),(0,r.kt)("li",{parentName:"ul"},"Ensure the authentication provider for your environment is active and configured correctly")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Remediation")),(0,r.kt)("p",null,"Configure the appropriate authentication provider for your Rancher installation according to the documentation found at the link in the reference section below."),(0,r.kt)("h4",{id:"reference-1"},"Reference"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://rancher.com/docs/rancher/v2.0-v2.4/en/admin-settings/authentication/"},"https://rancher.com/docs/rancher/v2.0-v2.4/en/admin-settings/authentication/"))),(0,r.kt)("h2",{id:"33---rancher-management-control-plane-rbac"},"3.3 - Rancher Management Control Plane RBAC"),(0,r.kt)("h3",{id:"331---ensure-that-administrator-privileges-are-only-granted-to-those-who-require-them"},"3.3.1 - Ensure that administrator privileges are only granted to those who require them"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Profile Applicability")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Level 1")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Description")),(0,r.kt)("p",null,"Restrict administrator access to only those responsible for managing and operating the Rancher server."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Rationale")),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"admin"),"  privilege level gives the user the highest level of access to the Rancher server and all attached clusters. This privilege should only be granted to a few people who are responsible for the availability and support of Rancher and the clusters that it manages."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Audit")),(0,r.kt)("p",null,"The following script uses the Rancher API to show users with administrator privileges:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"#!/bin/bash\nfor i in $(curl -sk -u 'token-<id>:<secret>' https://<RANCHER_URL>/v3/users|jq -r .data[].links.globalRoleBindings); do\n\ncurl -sk -u 'token-<id>:<secret>' $i| jq '.data[] | \"\\(.userId) \\(.globalRoleId)\"'\n\ndone\n\n")),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"admin")," role should only be assigned to users that require administrative privileges. Any role that is not ",(0,r.kt)("inlineCode",{parentName:"p"},"admin")," or ",(0,r.kt)("inlineCode",{parentName:"p"},"user")," should be audited in the RBAC section of the UI to ensure that the privileges adhere to policies for global access."),(0,r.kt)("p",null,"The Rancher server permits customization of the default global permissions. We recommend that auditors also review the policies of any custom global roles."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Remediation")),(0,r.kt)("p",null,"Remove the ",(0,r.kt)("inlineCode",{parentName:"p"},"admin")," role from any user that does not require administrative privileges."),(0,r.kt)("h2",{id:"34---rancher-management-control-plane-configuration"},"3.4 - Rancher Management Control Plane Configuration"),(0,r.kt)("h3",{id:"341---ensure-only-approved-node-drivers-are-active"},"3.4.1 - Ensure only approved node drivers are active"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Profile Applicability")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Level 1")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Description")),(0,r.kt)("p",null,"Ensure that node drivers that are not needed or approved are not active in the Rancher console."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Rationale")),(0,r.kt)("p",null,"Node drivers are used to provision compute nodes in various cloud providers and local IaaS infrastructure. For convenience, popular cloud providers are enabled by default. If the organization does not intend to use these or does not allow users to provision resources in certain providers, the drivers should be disabled. This will prevent users from using Rancher resources to provision the nodes."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Audit")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"In the Rancher UI select ",(0,r.kt)("em",{parentName:"li"},"Global")),(0,r.kt)("li",{parentName:"ul"},"Select ",(0,r.kt)("em",{parentName:"li"},"Node Drivers")),(0,r.kt)("li",{parentName:"ul"},"Review the list of node drivers that are in an ",(0,r.kt)("em",{parentName:"li"},"Active")," state.")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Remediation")),(0,r.kt)("p",null,"If a disallowed node driver is active, visit the ",(0,r.kt)("em",{parentName:"p"},"Node Drivers")," page under ",(0,r.kt)("em",{parentName:"p"},"Global")," and disable it."),(0,r.kt)("h2",{id:"41---rancher-kubernetes-custom-cluster-configuration-via-rke"},"4.1 - Rancher Kubernetes Custom Cluster Configuration via RKE"),(0,r.kt)("p",null,"(See Appendix C. for full RKE template example)"),(0,r.kt)("h3",{id:"411---configure-kubelet-options"},"4.1.1 - Configure kubelet options"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Profile Applicability")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Level 1")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Description")),(0,r.kt)("p",null,"Ensure Kubelet options are configured to match CIS controls."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Rationale")),(0,r.kt)("p",null,"To pass the following controls in the CIS benchmark, ensure the appropriate flags are passed to the Kubelet."),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"2.1.1 - Ensure that the ",(0,r.kt)("inlineCode",{parentName:"li"},"--anonymous-auth")," argument is set to false (Scored)"),(0,r.kt)("li",{parentName:"ul"},"2.1.2 - Ensure that the ",(0,r.kt)("inlineCode",{parentName:"li"},"--authorization-mode")," argument is not set to ",(0,r.kt)("inlineCode",{parentName:"li"},"AlwaysAllow")," (Scored)"),(0,r.kt)("li",{parentName:"ul"},"2.1.6 - Ensure that the ",(0,r.kt)("inlineCode",{parentName:"li"},"--streaming-connection-idle-timeout")," argument is not set to 0 (Scored)"),(0,r.kt)("li",{parentName:"ul"},"2.1.7 - Ensure that the ",(0,r.kt)("inlineCode",{parentName:"li"},"--protect-kernel-defaults")," argument is set to true (Scored)"),(0,r.kt)("li",{parentName:"ul"},"2.1.8 - Ensure that the ",(0,r.kt)("inlineCode",{parentName:"li"},"--make-iptables-util-chains")," argument is set to true (Scored)"),(0,r.kt)("li",{parentName:"ul"},"2.1.10 - Ensure that the ",(0,r.kt)("inlineCode",{parentName:"li"},"--event-qps")," argument is set to 0 (Scored)"),(0,r.kt)("li",{parentName:"ul"},"2.1.13 - Ensure that the ",(0,r.kt)("inlineCode",{parentName:"li"},"RotateKubeletServerCertificate")," argument is set to true (Scored)"),(0,r.kt)("li",{parentName:"ul"},"2.1.14 - Ensure that the Kubelet only makes use of Strong Cryptographic Ciphers (Not Scored)")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Audit")),(0,r.kt)("p",null,"Inspect the Kubelet containers on all hosts and verify that they are running with the following options:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"--streaming-connection-idle-timeout=<duration greater than 0>")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"--authorization-mode=Webhook")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"--protect-kernel-defaults=true")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"--make-iptables-util-chains=true")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"--event-qps=0")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"--anonymous-auth=false")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},'--feature-gates="RotateKubeletServerCertificate=true"')),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},'--tls-cipher-suites="TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_AES_128_GCM_SHA256"'))),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Remediation")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Add the following to the RKE ",(0,r.kt)("inlineCode",{parentName:"li"},"cluster.yml")," kubelet section under ",(0,r.kt)("inlineCode",{parentName:"li"},"services"),":")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},'services:\n  kubelet:\n    generate_serving_certificate: true\n    extra_args:\n      feature-gates: "RotateKubeletServerCertificate=true"\n      protect-kernel-defaults: "true"\n      tls-cipher-suites: "TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_AES_128_GCM_SHA256"\n')),(0,r.kt)("p",null,"  Where ",(0,r.kt)("inlineCode",{parentName:"p"},"<duration>")," is in a form like ",(0,r.kt)("inlineCode",{parentName:"p"},"1800s"),"."),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Reconfigure the cluster:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"rke up --config cluster.yml\n")),(0,r.kt)("h3",{id:"412---configure-kube-api-options"},"4.1.2 - Configure kube-api options"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Profile Applicability")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Level 1")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Description")),(0,r.kt)("p",null,"Ensure the RKE configuration is set to deploy the ",(0,r.kt)("inlineCode",{parentName:"p"},"kube-api")," service with the options required for controls."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"NOTE:")),(0,r.kt)("p",null,"Enabling the ",(0,r.kt)("inlineCode",{parentName:"p"},"AlwaysPullImages")," admission control plugin can cause degraded performance due to overhead of always pulling images.\nEnabling the ",(0,r.kt)("inlineCode",{parentName:"p"},"DenyEscalatingExec")," admission control plugin will prevent the 'Launch kubectl' functionality in the UI from working."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Rationale")),(0,r.kt)("p",null,"To pass the following controls for the kube-api server ensure RKE configuration passes the appropriate options."),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"1.1.1 - Ensure that the ",(0,r.kt)("inlineCode",{parentName:"li"},"--anonymous-auth")," argument is set to false (Scored)"),(0,r.kt)("li",{parentName:"ul"},"1.1.8 - Ensure that the ",(0,r.kt)("inlineCode",{parentName:"li"},"--profiling")," argument is set to false (Scored)"),(0,r.kt)("li",{parentName:"ul"},"1.1.11 - Ensure that the admission control plugin ",(0,r.kt)("inlineCode",{parentName:"li"},"AlwaysPullImages")," is set (Scored)"),(0,r.kt)("li",{parentName:"ul"},"1.1.12 - Ensure that the admission control plugin ",(0,r.kt)("inlineCode",{parentName:"li"},"DenyEscalatingExec")," is set (Scored)"),(0,r.kt)("li",{parentName:"ul"},"1.1.14 - Ensure that the admission control plugin ",(0,r.kt)("inlineCode",{parentName:"li"},"NamespaceLifecycle")," is set (Scored)"),(0,r.kt)("li",{parentName:"ul"},"1.1.15 - Ensure that the ",(0,r.kt)("inlineCode",{parentName:"li"},"--audit-log-path")," argument is set as appropriate (Scored)"),(0,r.kt)("li",{parentName:"ul"},"1.1.16 - Ensure that the ",(0,r.kt)("inlineCode",{parentName:"li"},"--audit-log-maxage")," argument is set as appropriate (Scored)"),(0,r.kt)("li",{parentName:"ul"},"1.1.17 - Ensure that the ",(0,r.kt)("inlineCode",{parentName:"li"},"--audit-log-maxbackup")," argument is set as appropriate (Scored)"),(0,r.kt)("li",{parentName:"ul"},"1.1.18 - Ensure that the ",(0,r.kt)("inlineCode",{parentName:"li"},"--audit-log-maxsize")," argument is set as appropriate (Scored)"),(0,r.kt)("li",{parentName:"ul"},"1.1.23 - Ensure that the ",(0,r.kt)("inlineCode",{parentName:"li"},"--service-account-lookup")," argument is set to true (Scored)"),(0,r.kt)("li",{parentName:"ul"},"1.1.24 - Ensure that the admission control plugin ",(0,r.kt)("inlineCode",{parentName:"li"},"PodSecurityPolicy")," is set (Scored)"),(0,r.kt)("li",{parentName:"ul"},"1.1.30 Ensure that the API Server only makes use of Strong Cryptographic Ciphers (Not Scored)"),(0,r.kt)("li",{parentName:"ul"},"1.1.34 - Ensure that the ",(0,r.kt)("inlineCode",{parentName:"li"},"--encryption-provider-config")," argument is set as appropriate (Scored)"),(0,r.kt)("li",{parentName:"ul"},"1.1.35 - Ensure that the encryption provider is set to ",(0,r.kt)("inlineCode",{parentName:"li"},"aescbc")," (Scored)"),(0,r.kt)("li",{parentName:"ul"},"1.1.36 - Ensure that the admission control plugin ",(0,r.kt)("inlineCode",{parentName:"li"},"EventRateLimit")," is set (Scored)"),(0,r.kt)("li",{parentName:"ul"},"1.1.37 - Ensure that the ",(0,r.kt)("inlineCode",{parentName:"li"},"AdvancedAuditing")," argument is not set to ",(0,r.kt)("inlineCode",{parentName:"li"},"false")," (Scored)")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Audit")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"On nodes with the ",(0,r.kt)("inlineCode",{parentName:"p"},"controlplane")," role inspect the ",(0,r.kt)("inlineCode",{parentName:"p"},"kube-apiserver")," containers:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"docker inspect kube-apiserver\n"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Look for the following options in the command section of the output:"))),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},"--anonymous-auth=false\n--profiling=false\n--service-account-lookup=true\n--enable-admission-plugins=ServiceAccount,NamespaceLifecycle,LimitRanger,PersistentVolumeLabel,DefaultStorageClass,ResourceQuota,DefaultTolerationSeconds,AlwaysPullImages,DenyEscalatingExec,NodeRestriction,EventRateLimit,PodSecurityPolicy\n--encryption-provider-config=/etc/kubernetes/ssl/encryption.yaml\n--admission-control-config-file=/etc/kubernetes/admission.yaml\n--audit-log-path=/var/log/kube-audit/audit-log.json\n--audit-log-maxage=30\n--audit-log-maxbackup=10\n--audit-log-maxsize=100\n--audit-log-format=json\n--audit-policy-file=/etc/kubernetes/audit-policy.yaml\n--tls-cipher-suites=TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_AES_128_GCM_SHA256\n")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"In the ",(0,r.kt)("inlineCode",{parentName:"li"},"volume")," section of the output ensure the bind mount is present:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},"/var/log/kube-audit:/var/log/kube-audit\n")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Remediation")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"In the RKE ",(0,r.kt)("inlineCode",{parentName:"li"},"cluster.yml")," add the following directives to the ",(0,r.kt)("inlineCode",{parentName:"li"},"kube-api")," section under ",(0,r.kt)("inlineCode",{parentName:"li"},"services"),":")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},'services:\n  kube_api:\n    always_pull_images: true\n    pod_security_policy: true\n    service_node_port_range: 30000-32767\n    event_rate_limit:\n      enabled: true\n    audit_log:\n      enabled: true\n    secrets_encryption_config:\n      enabled: true\n    extra_args:\n      anonymous-auth: "false"\n      enable-admission-plugins: "ServiceAccount,NamespaceLifecycle,LimitRanger,PersistentVolumeLabel,DefaultStorageClass,ResourceQuota,DefaultTolerationSeconds,AlwaysPullImages,DenyEscalatingExec,NodeRestriction,EventRateLimit,PodSecurityPolicy"\n      profiling: "false"\n      service-account-lookup: "true"\n      tls-cipher-suites: "TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_AES_128_GCM_SHA256"\n    extra_binds:\n      - "/opt/kubernetes:/opt/kubernetes"\n')),(0,r.kt)("p",null,"For k8s 1.14 ",(0,r.kt)("inlineCode",{parentName:"p"},"enable-admission-plugins")," should be"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},'        enable-admission-plugins: "ServiceAccount,NamespaceLifecycle,LimitRanger,PersistentVolumeLabel,DefaultStorageClass,ResourceQuota,DefaultTolerationSeconds,AlwaysPullImages,DenyEscalatingExec,NodeRestriction,PodSecurityPolicy,MutatingAdmissionWebhook,ValidatingAdmissionWebhook,Priority,EventRateLimit"\n')),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Reconfigure the cluster:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"rke up --config cluster.yml\n")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"NOTE:")),(0,r.kt)("p",null,"Files that are placed in ",(0,r.kt)("inlineCode",{parentName:"p"},"/opt/kubernetes")," need to be mounted in using the ",(0,r.kt)("inlineCode",{parentName:"p"},"extra_binds")," functionality in RKE."),(0,r.kt)("h3",{id:"413---configure-scheduler-options"},"4.1.3 - Configure scheduler options"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Profile Applicability")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Level 1")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Description")),(0,r.kt)("p",null,"Set the appropriate options for the Kubernetes scheduling service."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"NOTE:")," Setting ",(0,r.kt)("inlineCode",{parentName:"p"},"--address")," to ",(0,r.kt)("inlineCode",{parentName:"p"},"127.0.0.1")," will prevent Rancher cluster monitoring from scraping this endpoint."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Rationale")),(0,r.kt)("p",null,"To address the following controls on the CIS benchmark, the command line options should be set on the Kubernetes scheduler."),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"1.2.1 - Ensure that the ",(0,r.kt)("inlineCode",{parentName:"li"},"--profiling")," argument is set to ",(0,r.kt)("inlineCode",{parentName:"li"},"false")," (Scored)"),(0,r.kt)("li",{parentName:"ul"},"1.2.2 - Ensure that the ",(0,r.kt)("inlineCode",{parentName:"li"},"--address")," argument is set to ",(0,r.kt)("inlineCode",{parentName:"li"},"127.0.0.1")," (Scored)")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Audit")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"On nodes with the ",(0,r.kt)("inlineCode",{parentName:"li"},"controlplane")," role: inspect the ",(0,r.kt)("inlineCode",{parentName:"li"},"kube-scheduler")," containers:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"docker inspect kube-scheduler\n")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Verify the following options are set in the ",(0,r.kt)("inlineCode",{parentName:"li"},"command")," section.")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},"--profiling=false\n--address=127.0.0.1\n")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Remediation")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"In the RKE ",(0,r.kt)("inlineCode",{parentName:"li"},"cluster.yml")," file ensure the following options are set:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},'services:\n  scheduler:\n    extra_args:\n      profiling: "false"\n      address: "127.0.0.1"\n')),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Reconfigure the cluster:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"rke up --config cluster.yml\n")),(0,r.kt)("h3",{id:"414---configure-controller-options"},"4.1.4 - Configure controller options"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Profile Applicability")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Level 1")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Description")),(0,r.kt)("p",null,"Set the appropriate arguments on the Kubernetes controller manager."),(0,r.kt)("p",null,"5*NOTE:** Setting ",(0,r.kt)("inlineCode",{parentName:"p"},"--address")," to ",(0,r.kt)("inlineCode",{parentName:"p"},"127.0.0.1")," will prevent Rancher cluster monitoring from scraping this endpoint."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Rationale")),(0,r.kt)("p",null,"To address the following controls the options need to be passed to the Kubernetes controller manager."),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"1.3.1 - Ensure that the ",(0,r.kt)("inlineCode",{parentName:"li"},"--terminated-pod-gc-threshold")," argument is set as appropriate (Scored)"),(0,r.kt)("li",{parentName:"ul"},"1.3.2 - Ensure that the ",(0,r.kt)("inlineCode",{parentName:"li"},"--profiling")," argument is set to false (Scored)"),(0,r.kt)("li",{parentName:"ul"},"1.3.6 Ensure that the RotateKubeletServerCertificate argument is set to true (Scored)"),(0,r.kt)("li",{parentName:"ul"},"1.3.7 - Ensure that the ",(0,r.kt)("inlineCode",{parentName:"li"},"--address")," argument is set to 127.0.0.1 (Scored)")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Audit")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"On nodes with the ",(0,r.kt)("inlineCode",{parentName:"li"},"controlplane")," role inspect the ",(0,r.kt)("inlineCode",{parentName:"li"},"kube-controller-manager")," container:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"docker inspect kube-controller-manager\n")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Verify the following options are set in the ",(0,r.kt)("inlineCode",{parentName:"li"},"command")," section:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},'--terminated-pod-gc-threshold=1000\n--profiling=false\n--address=127.0.0.1\n--feature-gates="RotateKubeletServerCertificate=true"\n')),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Remediation")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"In the RKE ",(0,r.kt)("inlineCode",{parentName:"li"},"cluster.yml")," file ensure the following options are set:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},'services:\n  kube-controller:\n    extra_args:\n      profiling: "false"\n      address: "127.0.0.1"\n      terminated-pod-gc-threshold: "1000"\n      feature-gates: "RotateKubeletServerCertificate=true"\n')),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Reconfigure the cluster:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"rke up --config cluster.yml\n")),(0,r.kt)("h3",{id:"415---check-psps"},"4.1.5 - Check PSPs"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Profile Applicability")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Level 1")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Description")),(0,r.kt)("p",null,"Configure a restrictive pod security policy (PSP) as the default and create role bindings for system level services to use the less restrictive default PSP."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Rationale")),(0,r.kt)("p",null,"To address the following controls, a restrictive default PSP needs to be applied as the default. Role bindings need to be in place to allow system services to still function."),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"1.7.1 - Do not admit privileged containers (Not Scored)"),(0,r.kt)("li",{parentName:"ul"},"1.7.2 - Do not admit containers wishing to share the host process ID namespace (Not Scored)"),(0,r.kt)("li",{parentName:"ul"},"1.7.3 - Do not admit containers wishing to share the host IPC namespace (Not Scored)"),(0,r.kt)("li",{parentName:"ul"},"1.7.4 - Do not admit containers wishing to share the host network namespace (Not Scored)"),(0,r.kt)("li",{parentName:"ul"},"1.7.5 - Do not admit containers with ",(0,r.kt)("inlineCode",{parentName:"li"},"allowPrivilegeEscalation")," (Not Scored)"),(0,r.kt)("li",{parentName:"ul"},"1.7.6 - Do not admit root containers (Not Scored)"),(0,r.kt)("li",{parentName:"ul"},"1.7.7 - Do not admit containers with dangerous capabilities (Not Scored)")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Audit")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Verify that the ",(0,r.kt)("inlineCode",{parentName:"li"},"cattle-system")," namespace exists:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"kubectl get ns |grep cattle\n")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Verify that the roles exist:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"kubectl get role default-psp-role -n ingress-nginx\nkubectl get role default-psp-role -n cattle-system\nkubectl get clusterrole restricted-clusterrole\n")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Verify the bindings are set correctly:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"kubectl get rolebinding -n ingress-nginx default-psp-rolebinding\nkubectl get rolebinding -n cattle-system default-psp-rolebinding\n")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Verify the restricted PSP is present.")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"kubectl get psp restricted-psp\n")),(0,r.kt)("hr",null),(0,r.kt)("h2",{id:"appendix-a---complete-ubuntu-cloud-config-example"},"Appendix A - Complete ubuntu ",(0,r.kt)("inlineCode",{parentName:"h2"},"cloud-config")," Example"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"cloud-config")," file to automate hardening manual steps on nodes deployment."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"#cloud-config\nbootcmd:\n- apt-get update\n- apt-get install -y apt-transport-https\napt:\n  sources:\n    docker:\n      source: \"deb [arch=amd64] https://download.docker.com/linux/ubuntu $RELEASE stable\"\n      keyid: 0EBFCD88\npackages:\n- [docker-ce, '5:19.03.5~3-0~ubuntu-bionic']\n- jq\nwrite_files:\n# 1.1.1 - Configure default sysctl settings on all hosts\n- path: /etc/sysctl.d/90-kubelet.conf\n  owner: root:root\n  permissions: '0644'\n  content: |\n    vm.overcommit_memory=1\n    vm.panic_on_oom=0\n    kernel.panic=10\n    kernel.panic_on_oops=1\n    kernel.keys.root_maxkeys=1000000\n    kernel.keys.root_maxbytes=25000000\n# 1.4.12 etcd user\ngroups:\n  - etcd\nusers:\n  - default\n  - name: etcd\n    gecos: Etcd user\n    primary_group: etcd\n    homedir: /var/lib/etcd\n# 1.4.11 etcd data dir\nruncmd:\n  - chmod 0700 /var/lib/etcd\n  - usermod -G docker -a ubuntu\n  - sysctl -p /etc/sysctl.d/90-kubelet.conf\n")),(0,r.kt)("h2",{id:"appendix-b---complete-rke-clusteryml-example"},"Appendix B - Complete RKE ",(0,r.kt)("inlineCode",{parentName:"h2"},"cluster.yml")," Example"),(0,r.kt)("p",null,"Before apply, replace ",(0,r.kt)("inlineCode",{parentName:"p"},"rancher_kubernetes_engine_config.services.etcd.gid")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"rancher_kubernetes_engine_config.services.etcd.uid")," with the proper etcd group and user ids that were created on etcd nodes."),(0,r.kt)("details",{id:"cluster-1.14"},(0,r.kt)("summary",null,"RKE yaml for k8s 1.14"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"nodes:\n- address: 18.191.190.205\n  internal_address: 172.31.24.213\n  user: ubuntu\n  role: [ \"controlplane\", \"etcd\", \"worker\" ]\n- address: 18.191.190.203\n  internal_address: 172.31.24.203\n  user: ubuntu\n  role: [ \"controlplane\", \"etcd\", \"worker\" ]\n- address: 18.191.190.10\n  internal_address: 172.31.24.244\n  user: ubuntu\n  role: [ \"controlplane\", \"etcd\", \"worker\" ]\naddon_job_timeout: 30\nauthentication:\n  strategy: x509\nauthorization: {}\nbastion_host:\n  ssh_agent_auth: false\ncloud_provider: {}\nignore_docker_version: true\n#\n# # Currently only nginx ingress provider is supported.\n# # To disable ingress controller, set `provider: none`\n# # To enable ingress on specific nodes, use the node_selector, eg:\n#    provider: nginx\n#    node_selector:\n#      app: ingress\n#\ningress:\n  provider: nginx\nkubernetes_version: v1.14.9-rancher1-1\nmonitoring:\n  provider: metrics-server\n#\n#   If you are using calico on AWS\n#\n#    network:\n#      plugin: calico\n#      calico_network_provider:\n#        cloud_provider: aws\n#\n# # To specify flannel interface\n#\n#    network:\n#      plugin: flannel\n#      flannel_network_provider:\n#      iface: eth1\n#\n# # To specify flannel interface for canal plugin\n#\n#    network:\n#      plugin: canal\n#      canal_network_provider:\n#        iface: eth1\n#\nnetwork:\n  options:\n    flannel_backend_type: vxlan\n  plugin: canal\nrestore:\n  restore: false\n#\n#    services:\n#      kube-api:\n#        service_cluster_ip_range: 10.43.0.0/16\n#      kube-controller:\n#        cluster_cidr: 10.42.0.0/16\n#        service_cluster_ip_range: 10.43.0.0/16\n#      kubelet:\n#        cluster_domain: cluster.local\n#        cluster_dns_server: 10.43.0.10\n#\nservices:\n  etcd:\n    backup_config:\n      enabled: true\n      interval_hours: 12\n      retention: 6\n      safe_timestamp: false\n    creation: 12h\n    extra_args:\n      election-timeout: '5000'\n      heartbeat-interval: '500'\n    gid: 1000\n    retention: 72h\n    snapshot: false\n    uid: 1000\n  kube-api:\n    always_pull_images: true\n    audit_log:\n      enabled: true\n    event_rate_limit:\n      enabled: true\n    extra_args:\n      anonymous-auth: 'false'\n      enable-admission-plugins: >-\n        ServiceAccount,NamespaceLifecycle,LimitRanger,PersistentVolumeLabel,DefaultStorageClass,ResourceQuota,DefaultTolerationSeconds,AlwaysPullImages,DenyEscalatingExec,NodeRestriction,PodSecurityPolicy,MutatingAdmissionWebhook,ValidatingAdmissionWebhook,Priority,EventRateLimit\n      profiling: 'false'\n      service-account-lookup: 'true'\n      tls-cipher-suites: >-\n        TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_AES_128_GCM_SHA256\n    extra_binds:\n      - '/opt/kubernetes:/opt/kubernetes'\n    pod_security_policy: true\n    secrets_encryption_config:\n      enabled: true\n    service_node_port_range: 30000-32767\n  kube-controller:\n    extra_args:\n      address: 127.0.0.1\n      feature-gates: RotateKubeletServerCertificate=true\n      profiling: 'false'\n      terminated-pod-gc-threshold: '1000'\n  kubelet:\n    extra_args:\n      protect-kernel-defaults: 'true'\n    fail_swap_on: false\n    generate_serving_certificate: true\n  kubeproxy: {}\n  scheduler:\n    extra_args:\n      address: 127.0.0.1\n      profiling: 'false'\nssh_agent_auth: false\n"))),(0,r.kt)("details",{id:"cluster-1.15"},(0,r.kt)("summary",null,"RKE yaml for k8s 1.15"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},'nodes:\n- address: 18.191.190.205\n  internal_address: 172.31.24.213\n  user: ubuntu\n  role: [ "controlplane", "etcd", "worker" ]\n- address: 18.191.190.203\n  internal_address: 172.31.24.203\n  user: ubuntu\n  role: [ "controlplane", "etcd", "worker" ]\n- address: 18.191.190.10\n  internal_address: 172.31.24.244\n  user: ubuntu\n  role: [ "controlplane", "etcd", "worker" ]\naddon_job_timeout: 30\nauthentication:\n  strategy: x509\nignore_docker_version: true\n#\n# # Currently only nginx ingress provider is supported.\n# # To disable ingress controller, set `provider: none`\n# # To enable ingress on specific nodes, use the node_selector, eg:\n#    provider: nginx\n#    node_selector:\n#      app: ingress\n#\ningress:\n  provider: nginx\nkubernetes_version: v1.15.6-rancher1-2\nmonitoring:\n  provider: metrics-server\n#\n#   If you are using calico on AWS\n#\n#    network:\n#      plugin: calico\n#      calico_network_provider:\n#        cloud_provider: aws\n#\n# # To specify flannel interface\n#\n#    network:\n#      plugin: flannel\n#      flannel_network_provider:\n#      iface: eth1\n#\n# # To specify flannel interface for canal plugin\n#\n#    network:\n#      plugin: canal\n#      canal_network_provider:\n#        iface: eth1\n#\nnetwork:\n  options:\n    flannel_backend_type: vxlan\n  plugin: canal\n#\n#    services:\n#      kube-api:\n#        service_cluster_ip_range: 10.43.0.0/16\n#      kube-controller:\n#        cluster_cidr: 10.42.0.0/16\n#        service_cluster_ip_range: 10.43.0.0/16\n#      kubelet:\n#        cluster_domain: cluster.local\n#        cluster_dns_server: 10.43.0.10\n#\nservices:\n  etcd:\n    backup_config:\n      enabled: true\n      interval_hours: 12\n      retention: 6\n      safe_timestamp: false\n    creation: 12h\n    extra_args:\n      election-timeout: 5000\n      heartbeat-interval: 500\n    gid: 1000\n    retention: 72h\n    snapshot: false\n    uid: 1000\n  kube_api:\n    always_pull_images: true\n    pod_security_policy: true\n    service_node_port_range: 30000-32767\n    event_rate_limit:\n      enabled: true\n    audit_log:\n      enabled: true\n    secrets_encryption_config:\n      enabled: true\n    extra_args:\n      anonymous-auth: "false"\n      enable-admission-plugins: "ServiceAccount,NamespaceLifecycle,LimitRanger,PersistentVolumeLabel,DefaultStorageClass,ResourceQuota,DefaultTolerationSeconds,AlwaysPullImages,DenyEscalatingExec,NodeRestriction,EventRateLimit,PodSecurityPolicy"\n      profiling: "false"\n      service-account-lookup: "true"\n      tls-cipher-suites: "TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_AES_128_GCM_SHA256"\n    extra_binds:\n      - "/opt/kubernetes:/opt/kubernetes"\n  kubelet:\n    generate_serving_certificate: true\n    extra_args:\n      feature-gates: "RotateKubeletServerCertificate=true"\n      protect-kernel-defaults: "true"\n      tls-cipher-suites: "TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_AES_128_GCM_SHA256"\n  kube-controller:\n    extra_args:\n      profiling: "false"\n      address: "127.0.0.1"\n      terminated-pod-gc-threshold: "1000"\n      feature-gates: "RotateKubeletServerCertificate=true"\n  scheduler:\n    extra_args:\n      profiling: "false"\n      address: "127.0.0.1"\nssh_agent_auth: false\n'))),(0,r.kt)("details",{id:"cluster-1.16"},(0,r.kt)("summary",null,"RKE yaml for k8s 1.16"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},'nodes:\n- address: 18.191.190.205\n  internal_address: 172.31.24.213\n  user: ubuntu\n  role: [ "controlplane", "etcd", "worker" ]\n- address: 18.191.190.203\n  internal_address: 172.31.24.203\n  user: ubuntu\n  role: [ "controlplane", "etcd", "worker" ]\n- address: 18.191.190.10\n  internal_address: 172.31.24.244\n  user: ubuntu\n  role: [ "controlplane", "etcd", "worker" ]\naddon_job_timeout: 30\nauthentication:\n  strategy: x509\nignore_docker_version: true\n#\n# # Currently only nginx ingress provider is supported.\n# # To disable ingress controller, set `provider: none`\n# # To enable ingress on specific nodes, use the node_selector, eg:\n#    provider: nginx\n#    node_selector:\n#      app: ingress\n#\ningress:\n  provider: nginx\nkubernetes_version: v1.16.3-rancher1-1\nmonitoring:\n  provider: metrics-server\n#\n#   If you are using calico on AWS\n#\n#    network:\n#      plugin: calico\n#      calico_network_provider:\n#        cloud_provider: aws\n#\n# # To specify flannel interface\n#\n#    network:\n#      plugin: flannel\n#      flannel_network_provider:\n#      iface: eth1\n#\n# # To specify flannel interface for canal plugin\n#\n#    network:\n#      plugin: canal\n#      canal_network_provider:\n#        iface: eth1\n#\nnetwork:\n  options:\n    flannel_backend_type: vxlan\n  plugin: canal\n#\n#    services:\n#      kube-api:\n#        service_cluster_ip_range: 10.43.0.0/16\n#      kube-controller:\n#        cluster_cidr: 10.42.0.0/16\n#        service_cluster_ip_range: 10.43.0.0/16\n#      kubelet:\n#        cluster_domain: cluster.local\n#        cluster_dns_server: 10.43.0.10\n#\nservices:\n  etcd:\n    backup_config:\n      enabled: true\n      interval_hours: 12\n      retention: 6\n      safe_timestamp: false\n    creation: 12h\n    extra_args:\n      election-timeout: 5000\n      heartbeat-interval: 500\n    gid: 1000\n    retention: 72h\n    snapshot: false\n    uid: 1000\n  kube_api:\n    always_pull_images: true\n    pod_security_policy: true\n    service_node_port_range: 30000-32767\n    event_rate_limit:\n      enabled: true\n    audit_log:\n      enabled: true\n    secrets_encryption_config:\n      enabled: true\n    extra_args:\n      anonymous-auth: "false"\n      enable-admission-plugins: "ServiceAccount,NamespaceLifecycle,LimitRanger,PersistentVolumeLabel,DefaultStorageClass,ResourceQuota,DefaultTolerationSeconds,AlwaysPullImages,DenyEscalatingExec,NodeRestriction,EventRateLimit,PodSecurityPolicy"\n      profiling: "false"\n      service-account-lookup: "true"\n      tls-cipher-suites: "TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_AES_128_GCM_SHA256"\n    extra_binds:\n      - "/opt/kubernetes:/opt/kubernetes"\n  kubelet:\n    generate_serving_certificate: true\n    extra_args:\n      feature-gates: "RotateKubeletServerCertificate=true"\n      protect-kernel-defaults: "true"\n      tls-cipher-suites: "TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_AES_128_GCM_SHA256"\n  kube-controller:\n    extra_args:\n      profiling: "false"\n      address: "127.0.0.1"\n      terminated-pod-gc-threshold: "1000"\n      feature-gates: "RotateKubeletServerCertificate=true"\n  scheduler:\n    extra_args:\n      profiling: "false"\n      address: "127.0.0.1"\nssh_agent_auth: false\n'))),(0,r.kt)("h2",{id:"appendix-c---complete-rke-template-example"},"Appendix C - Complete RKE Template Example"),(0,r.kt)("p",null,"Before apply, replace ",(0,r.kt)("inlineCode",{parentName:"p"},"rancher_kubernetes_engine_config.services.etcd.gid")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"rancher_kubernetes_engine_config.services.etcd.uid")," with the proper etcd group and user ids that were created on etcd nodes."),(0,r.kt)("details",{id:"k8s-1.14"},(0,r.kt)("summary",null,"RKE template for k8s 1.14"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"#\n# Cluster Config\n#\nanswers: {}\ndefault_pod_security_policy_template_id: restricted\ndocker_root_dir: /var/lib/docker\nenable_cluster_alerting: false\nenable_cluster_monitoring: false\nenable_network_policy: false\nlocal_cluster_auth_endpoint:\n  enabled: false\nname: test-35378\n#\n# Rancher Config\n#\nrancher_kubernetes_engine_config:\n  addon_job_timeout: 30\n  authentication:\n    strategy: x509\n  authorization: {}\n  bastion_host:\n    ssh_agent_auth: false\n  cloud_provider: {}\n  ignore_docker_version: true\n#\n# # Currently only nginx ingress provider is supported.\n# # To disable ingress controller, set `provider: none`\n# # To enable ingress on specific nodes, use the node_selector, eg:\n#    provider: nginx\n#    node_selector:\n#      app: ingress\n#\n  ingress:\n    provider: nginx\n  kubernetes_version: v1.14.9-rancher1-1\n  monitoring:\n    provider: metrics-server\n#\n#   If you are using calico on AWS\n#\n#    network:\n#      plugin: calico\n#      calico_network_provider:\n#        cloud_provider: aws\n#\n# # To specify flannel interface\n#\n#    network:\n#      plugin: flannel\n#      flannel_network_provider:\n#      iface: eth1\n#\n# # To specify flannel interface for canal plugin\n#\n#    network:\n#      plugin: canal\n#      canal_network_provider:\n#        iface: eth1\n#\n  network:\n    options:\n      flannel_backend_type: vxlan\n    plugin: canal\n  restore:\n    restore: false\n#\n#    services:\n#      kube-api:\n#        service_cluster_ip_range: 10.43.0.0/16\n#      kube-controller:\n#        cluster_cidr: 10.42.0.0/16\n#        service_cluster_ip_range: 10.43.0.0/16\n#      kubelet:\n#        cluster_domain: cluster.local\n#        cluster_dns_server: 10.43.0.10\n#\n  services:\n    etcd:\n      backup_config:\n        enabled: true\n        interval_hours: 12\n        retention: 6\n        safe_timestamp: false\n      creation: 12h\n      extra_args:\n        election-timeout: '5000'\n        heartbeat-interval: '500'\n      gid: 1000\n      retention: 72h\n      snapshot: false\n      uid: 1000\n    kube-api:\n      always_pull_images: true\n      audit_log:\n        enabled: true\n      event_rate_limit:\n        enabled: true\n      extra_args:\n        anonymous-auth: 'false'\n        enable-admission-plugins: >-\n          ServiceAccount,NamespaceLifecycle,LimitRanger,PersistentVolumeLabel,DefaultStorageClass,ResourceQuota,DefaultTolerationSeconds,AlwaysPullImages,DenyEscalatingExec,NodeRestriction,PodSecurityPolicy,MutatingAdmissionWebhook,ValidatingAdmissionWebhook,Priority,EventRateLimit\n        profiling: 'false'\n        service-account-lookup: 'true'\n        tls-cipher-suites: >-\n          TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_AES_128_GCM_SHA256\n      extra_binds:\n        - '/opt/kubernetes:/opt/kubernetes'\n      pod_security_policy: true\n      secrets_encryption_config:\n        enabled: true\n      service_node_port_range: 30000-32767\n    kube-controller:\n      extra_args:\n        address: 127.0.0.1\n        feature-gates: RotateKubeletServerCertificate=true\n        profiling: 'false'\n        terminated-pod-gc-threshold: '1000'\n    kubelet:\n      extra_args:\n        protect-kernel-defaults: 'true'\n      fail_swap_on: false\n      generate_serving_certificate: true\n    kubeproxy: {}\n    scheduler:\n      extra_args:\n        address: 127.0.0.1\n        profiling: 'false'\n  ssh_agent_auth: false\nwindows_prefered_cluster: false\n"))),(0,r.kt)("details",{id:"k8s-1.15"},(0,r.kt)("summary",null,"RKE template for k8s 1.15"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},'#\n# Cluster Config\n#\ndefault_pod_security_policy_template_id: restricted\ndocker_root_dir: /var/lib/docker\nenable_cluster_alerting: false\nenable_cluster_monitoring: false\nenable_network_policy: false\nlocal_cluster_auth_endpoint:\n  enabled: true\n#\n# Rancher Config\n#\nrancher_kubernetes_engine_config:\n  addon_job_timeout: 30\n  authentication:\n    strategy: x509\n  ignore_docker_version: true\n#\n# # Currently only nginx ingress provider is supported.\n# # To disable ingress controller, set `provider: none`\n# # To enable ingress on specific nodes, use the node_selector, eg:\n#    provider: nginx\n#    node_selector:\n#      app: ingress\n#\n  ingress:\n    provider: nginx\n  kubernetes_version: v1.15.6-rancher1-2\n  monitoring:\n    provider: metrics-server\n#\n#   If you are using calico on AWS\n#\n#    network:\n#      plugin: calico\n#      calico_network_provider:\n#        cloud_provider: aws\n#\n# # To specify flannel interface\n#\n#    network:\n#      plugin: flannel\n#      flannel_network_provider:\n#      iface: eth1\n#\n# # To specify flannel interface for canal plugin\n#\n#    network:\n#      plugin: canal\n#      canal_network_provider:\n#        iface: eth1\n#\n  network:\n    options:\n      flannel_backend_type: vxlan\n    plugin: canal\n#\n#    services:\n#      kube-api:\n#        service_cluster_ip_range: 10.43.0.0/16\n#      kube-controller:\n#        cluster_cidr: 10.42.0.0/16\n#        service_cluster_ip_range: 10.43.0.0/16\n#      kubelet:\n#        cluster_domain: cluster.local\n#        cluster_dns_server: 10.43.0.10\n#\n  services:\n    etcd:\n      backup_config:\n        enabled: true\n        interval_hours: 12\n        retention: 6\n        safe_timestamp: false\n      creation: 12h\n      extra_args:\n        election-timeout: 5000\n        heartbeat-interval: 500\n      gid: 1000\n      retention: 72h\n      snapshot: false\n      uid: 1000\n    kube_api:\n      always_pull_images: true\n      pod_security_policy: true\n      service_node_port_range: 30000-32767\n      event_rate_limit:\n        enabled: true\n      audit_log:\n        enabled: true\n      secrets_encryption_config:\n        enabled: true\n      extra_args:\n        anonymous-auth: "false"\n        enable-admission-plugins: "ServiceAccount,NamespaceLifecycle,LimitRanger,PersistentVolumeLabel,DefaultStorageClass,ResourceQuota,DefaultTolerationSeconds,AlwaysPullImages,DenyEscalatingExec,NodeRestriction,EventRateLimit,PodSecurityPolicy"\n        profiling: "false"\n        service-account-lookup: "true"\n        tls-cipher-suites: "TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_AES_128_GCM_SHA256"\n      extra_binds:\n        - "/opt/kubernetes:/opt/kubernetes"\n    kubelet:\n      generate_serving_certificate: true\n      extra_args:\n        feature-gates: "RotateKubeletServerCertificate=true"\n        protect-kernel-defaults: "true"\n        tls-cipher-suites: "TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_AES_128_GCM_SHA256"\n    kube-controller:\n      extra_args:\n        profiling: "false"\n        address: "127.0.0.1"\n        terminated-pod-gc-threshold: "1000"\n        feature-gates: "RotateKubeletServerCertificate=true"\n    scheduler:\n      extra_args:\n        profiling: "false"\n        address: "127.0.0.1"\n  ssh_agent_auth: false\nwindows_prefered_cluster: false\n'))),(0,r.kt)("details",{id:"k8s-1.16"},(0,r.kt)("summary",null,"RKE template for k8s 1.16"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},'#\n# Cluster Config\n#\ndefault_pod_security_policy_template_id: restricted\ndocker_root_dir: /var/lib/docker\nenable_cluster_alerting: false\nenable_cluster_monitoring: false\nenable_network_policy: false\nlocal_cluster_auth_endpoint:\n  enabled: true\n#\n# Rancher Config\n#\nrancher_kubernetes_engine_config:\n  addon_job_timeout: 30\n  authentication:\n    strategy: x509\n  ignore_docker_version: true\n#\n# # Currently only nginx ingress provider is supported.\n# # To disable ingress controller, set `provider: none`\n# # To enable ingress on specific nodes, use the node_selector, eg:\n#    provider: nginx\n#    node_selector:\n#      app: ingress\n#\n  ingress:\n    provider: nginx\n  kubernetes_version: v1.16.3-rancher1-1\n  monitoring:\n    provider: metrics-server\n#\n#   If you are using calico on AWS\n#\n#    network:\n#      plugin: calico\n#      calico_network_provider:\n#        cloud_provider: aws\n#\n# # To specify flannel interface\n#\n#    network:\n#      plugin: flannel\n#      flannel_network_provider:\n#      iface: eth1\n#\n# # To specify flannel interface for canal plugin\n#\n#    network:\n#      plugin: canal\n#      canal_network_provider:\n#        iface: eth1\n#\n  network:\n    options:\n      flannel_backend_type: vxlan\n    plugin: canal\n#\n#    services:\n#      kube-api:\n#        service_cluster_ip_range: 10.43.0.0/16\n#      kube-controller:\n#        cluster_cidr: 10.42.0.0/16\n#        service_cluster_ip_range: 10.43.0.0/16\n#      kubelet:\n#        cluster_domain: cluster.local\n#        cluster_dns_server: 10.43.0.10\n#\n  services:\n    etcd:\n      backup_config:\n        enabled: true\n        interval_hours: 12\n        retention: 6\n        safe_timestamp: false\n      creation: 12h\n      extra_args:\n        election-timeout: 5000\n        heartbeat-interval: 500\n      gid: 1000\n      retention: 72h\n      snapshot: false\n      uid: 1000\n    kube_api:\n      always_pull_images: true\n      pod_security_policy: true\n      service_node_port_range: 30000-32767\n      event_rate_limit:\n        enabled: true\n      audit_log:\n        enabled: true\n      secrets_encryption_config:\n        enabled: true\n      extra_args:\n        anonymous-auth: "false"\n        enable-admission-plugins: "ServiceAccount,NamespaceLifecycle,LimitRanger,PersistentVolumeLabel,DefaultStorageClass,ResourceQuota,DefaultTolerationSeconds,AlwaysPullImages,DenyEscalatingExec,NodeRestriction,EventRateLimit,PodSecurityPolicy"\n        profiling: "false"\n        service-account-lookup: "true"\n        tls-cipher-suites: "TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_AES_128_GCM_SHA256"\n      extra_binds:\n        - "/opt/kubernetes:/opt/kubernetes"\n    kubelet:\n      generate_serving_certificate: true\n      extra_args:\n        feature-gates: "RotateKubeletServerCertificate=true"\n        protect-kernel-defaults: "true"\n        tls-cipher-suites: "TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_AES_128_GCM_SHA256"\n    kube-controller:\n      extra_args:\n        profiling: "false"\n        address: "127.0.0.1"\n        terminated-pod-gc-threshold: "1000"\n        feature-gates: "RotateKubeletServerCertificate=true"\n    scheduler:\n      extra_args:\n        profiling: "false"\n        address: "127.0.0.1"\n  ssh_agent_auth: false\nwindows_prefered_cluster: false\n'))))}c.isMDXComponent=!0}}]);