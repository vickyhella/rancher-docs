<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-getting-started/installation-and-upgrade/other-installation-methods/air-gapped-helm-cli-install/infrastructure-private-registry">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.21">
<link rel="search" type="application/opensearchdescription+xml" title="Rancher Manager" href="/opensearch.xml"><title data-rh="true">1. Set up Infrastructure and Private Registry | Rancher Manager</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="http://docs.ranchermanager.rancher.io//getting-started/installation-and-upgrade/other-installation-methods/air-gapped-helm-cli-install/infrastructure-private-registry"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="1. Set up Infrastructure and Private Registry | Rancher Manager"><meta data-rh="true" name="description" content="In this section, you will provision the underlying infrastructure for your Rancher management server in an air gapped environment. You will also set up the private Docker registry that must be available to your Rancher node(s)."><meta data-rh="true" property="og:description" content="In this section, you will provision the underlying infrastructure for your Rancher management server in an air gapped environment. You will also set up the private Docker registry that must be available to your Rancher node(s)."><link data-rh="true" rel="icon" href="/img/favicon.png"><link data-rh="true" rel="canonical" href="http://docs.ranchermanager.rancher.io//getting-started/installation-and-upgrade/other-installation-methods/air-gapped-helm-cli-install/infrastructure-private-registry"><link data-rh="true" rel="alternate" href="http://docs.ranchermanager.rancher.io//getting-started/installation-and-upgrade/other-installation-methods/air-gapped-helm-cli-install/infrastructure-private-registry" hreflang="en"><link data-rh="true" rel="alternate" href="http://docs.ranchermanager.rancher.io//getting-started/installation-and-upgrade/other-installation-methods/air-gapped-helm-cli-install/infrastructure-private-registry" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://30NEY6C9UY-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.9543bcfd.css">
<link rel="preload" href="/assets/js/runtime~main.217a7f9f.js" as="script">
<link rel="preload" href="/assets/js/main.00d8b9dc.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_fXgn">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/rancher-logo-horiz-color.svg" alt="logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/rancher-logo-horiz-color.svg" alt="logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate"></b></a><div class="navbar__item dropdown dropdown--hoverable"><a aria-current="page" class="navbar__link active" aria-haspopup="true" aria-expanded="false" role="button" href="/">v2.6</a><ul class="dropdown__menu"><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/getting-started/installation-and-upgrade/other-installation-methods/air-gapped-helm-cli-install/infrastructure-private-registry">v2.6</a></li><li><a class="dropdown__link" href="/v2.5/getting-started/installation-and-upgrade/other-installation-methods/air-gapped-helm-cli-install/infrastructure-private-registry">v2.5</a></li><li><a class="dropdown__link" href="/v2.0-v2.4/getting-started/installation-and-upgrade/other-installation-methods/air-gapped-helm-cli-install/infrastructure-private-registry">v2.0-v2.4</a></li><li><a class="dropdown__link" href="/versions">All versions</a></li></ul></div></div><div class="navbar__items navbar__items--right"><a aria-current="page" class="navbar__item navbar__link navbar__docs navbar__link--active" href="/">Docs</a><a href="https://github.com/rancher/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link navbar__github btn btn-secondary icon-github">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_lCJq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd"><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/">Rancher 2.6</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/getting-started">Getting Started</a><button aria-label="Toggle the collapsible sidebar category &#x27;Getting Started&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/pages-for-subheaders/introduction">Introduction</a><button aria-label="Toggle the collapsible sidebar category &#x27;Introduction&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/pages-for-subheaders/quick-start-guides">Quick Start Guides</a><button aria-label="Toggle the collapsible sidebar category &#x27;Quick Start Guides&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" tabindex="0" href="/pages-for-subheaders/installation-and-upgrade">Installation and Upgrade</a><button aria-label="Toggle the collapsible sidebar category &#x27;Installation and Upgrade&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/pages-for-subheaders/installation-requirements">Installation Requirements</a><button aria-label="Toggle the collapsible sidebar category &#x27;Installation Requirements&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/pages-for-subheaders/install-upgrade-on-a-kubernetes-cluster">Install/Upgrade on a Kubernetes Cluster</a><button aria-label="Toggle the collapsible sidebar category &#x27;Install/Upgrade on a Kubernetes Cluster&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" tabindex="0" href="/pages-for-subheaders/other-installation-methods">Other Installation Methods</a><button aria-label="Toggle the collapsible sidebar category &#x27;Other Installation Methods&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-4 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" tabindex="0" href="/pages-for-subheaders/air-gapped-helm-cli-install">Air-Gapped Helm CLI Install</a><button aria-label="Toggle the collapsible sidebar category &#x27;Air-Gapped Helm CLI Install&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/getting-started/installation-and-upgrade/other-installation-methods/air-gapped-helm-cli-install/infrastructure-private-registry">1. Set up Infrastructure and Private Registry</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class="menu__link" tabindex="0" href="/getting-started/installation-and-upgrade/other-installation-methods/air-gapped-helm-cli-install/publish-images">2. Collect and Publish Images to your Private Registry</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class="menu__link" tabindex="0" href="/getting-started/installation-and-upgrade/other-installation-methods/air-gapped-helm-cli-install/install-kubernetes">3. Install Kubernetes (Skip for Docker Installs)</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class="menu__link" tabindex="0" href="/getting-started/installation-and-upgrade/other-installation-methods/air-gapped-helm-cli-install/install-rancher-ha">4. Install Rancher</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class="menu__link" tabindex="0" href="/getting-started/installation-and-upgrade/other-installation-methods/air-gapped-helm-cli-install/docker-install-commands">Docker Install Commands</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-4 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/pages-for-subheaders/rancher-on-a-single-node-with-docker">Rancher on a Single Node with Docker</a><button aria-label="Toggle the collapsible sidebar category &#x27;Rancher on a Single Node with Docker&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-4 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/pages-for-subheaders/rancher-behind-an-http-proxy">Rancher Behind an HTTP Proxy</a><button aria-label="Toggle the collapsible sidebar category &#x27;Rancher Behind an HTTP Proxy&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/pages-for-subheaders/resources">Resources</a><button aria-label="Toggle the collapsible sidebar category &#x27;Resources&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/getting-started/installation-and-upgrade/upgrade-and-roll-back-kubernetes">Upgrading and Rolling Back Kubernetes</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/getting-started/installation-and-upgrade/upgrade-kubernetes-without-upgrading-rancher">Upgrading Kubernetes without Upgrading Rancher</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/pages-for-subheaders/advanced-options">Advanced Options</a><button aria-label="Toggle the collapsible sidebar category &#x27;Advanced Options&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/how-to-guides">How-to Guides</a><button aria-label="Toggle the collapsible sidebar category &#x27;How-to Guides&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/reference-guides">Reference Guides</a><button aria-label="Toggle the collapsible sidebar category &#x27;Reference Guides&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/explanations">Explanations</a><button aria-label="Toggle the collapsible sidebar category &#x27;Explanations&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/faq">FAQ</a><button aria-label="Toggle the collapsible sidebar category &#x27;FAQ&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/troubleshooting">Troubleshooting</a><button aria-label="Toggle the collapsible sidebar category &#x27;Troubleshooting&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/contribute-to-rancher">Contributing to Rancher</a></li></ul></nav></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_GujU"><div class="docItemContainer_Adtb"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_OVgt"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/getting-started"><span itemprop="name">Getting Started</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/pages-for-subheaders/installation-and-upgrade"><span itemprop="name">Installation and Upgrade</span></a><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/pages-for-subheaders/other-installation-methods"><span itemprop="name">Other Installation Methods</span></a><meta itemprop="position" content="3"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/pages-for-subheaders/air-gapped-helm-cli-install"><span itemprop="name">Air-Gapped Helm CLI Install</span></a><meta itemprop="position" content="4"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">1. Set up Infrastructure and Private Registry</span><meta itemprop="position" content="5"></li></ul></nav><span class="theme-doc-version-badge badge badge--secondary">Version: v2.6</span><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_aoJ5"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>1. Set up Infrastructure and Private Registry</h1></header><p>In this section, you will provision the underlying infrastructure for your Rancher management server in an air gapped environment. You will also set up the private Docker registry that must be available to your Rancher node(s).</p><p>An air gapped environment is an environment where the Rancher server is installed offline or behind a firewall.</p><p>The infrastructure depends on whether you are installing Rancher on a K3s Kubernetes cluster, an RKE Kubernetes cluster, or a single Docker container. For more information on each installation option, refer to <a href="/pages-for-subheaders/installation-and-upgrade">this page.</a></p><p>Rancher can be installed on any Kubernetes cluster. The RKE and K3s Kubernetes infrastructure tutorials below are still included for convenience.</p><div class="tabs-container tabList__CuJ"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LNqP tabs__item--active">K3s</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">RKE</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">Docker</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_Ymn6"><p>We recommend setting up the following infrastructure for a high-availability installation:</p><ul><li><strong>Two Linux nodes,</strong> typically virtual machines, in the infrastructure provider of your choice.</li><li><strong>An external database</strong> to store the cluster data. PostgreSQL, MySQL, and etcd are supported.</li><li><strong>A load balancer</strong> to direct traffic to the two nodes.</li><li><strong>A DNS record</strong> to map a URL to the load balancer. This will become the Rancher server URL, and downstream Kubernetes clusters will need to reach it.</li><li><strong>A private Docker registry</strong> to distribute Docker images to your machines.</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="1-set-up-linux-nodes">1. Set up Linux Nodes<a class="hash-link" href="#1-set-up-linux-nodes" title="Direct link to heading">​</a></h3><p>These hosts will be disconnected from the internet, but require being able to connect with your private registry.</p><p>Make sure that your nodes fulfill the general installation requirements for <a href="/pages-for-subheaders/installation-requirements">OS, container runtime, hardware, and networking.</a></p><p>For an example of one way to set up Linux nodes, refer to this <a href="/how-to-guides/new-user-guides/infrastructure-setup/nodes-in-amazon-ec2">tutorial</a> for setting up nodes as instances in Amazon EC2.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="2-set-up-external-datastore">2. Set up External Datastore<a class="hash-link" href="#2-set-up-external-datastore" title="Direct link to heading">​</a></h3><p>The ability to run Kubernetes using a datastore other than etcd sets K3s apart from other Kubernetes distributions. This feature provides flexibility to Kubernetes operators. The available options allow you to select a datastore that best fits your use case.</p><p>For a high-availability K3s installation, you will need to set up one of the following external databases:</p><ul><li><a href="https://www.postgresql.org/" target="_blank" rel="noopener noreferrer">PostgreSQL</a> (certified against versions 10.7 and 11.5)</li><li><a href="https://www.mysql.com/" target="_blank" rel="noopener noreferrer">MySQL</a> (certified against version 5.7)</li><li><a href="https://etcd.io/" target="_blank" rel="noopener noreferrer">etcd</a> (certified against version 3.3.15)</li></ul><p>When you install Kubernetes, you will pass in details for K3s to connect to the database.</p><p>For an example of one way to set up the database, refer to this <a href="/how-to-guides/new-user-guides/infrastructure-setup/mysql-database-in-amazon-rds">tutorial</a> for setting up a MySQL database on Amazon&#x27;s RDS service.</p><p>For the complete list of options that are available for configuring a K3s cluster datastore, refer to the <a href="https://rancher.com/docs/k3s/latest/en/installation/datastore/" target="_blank" rel="noopener noreferrer">K3s documentation.</a></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="3-set-up-the-load-balancer">3. Set up the Load Balancer<a class="hash-link" href="#3-set-up-the-load-balancer" title="Direct link to heading">​</a></h3><p>You will also need to set up a load balancer to direct traffic to the Rancher replica on both nodes. That will prevent an outage of any single node from taking down communications to the Rancher management server.</p><p>When Kubernetes gets set up in a later step, the K3s tool will deploy a Traefik Ingress controller. This controller will listen on ports 80 and 443 of the worker nodes, answering traffic destined for specific hostnames.</p><p>When Rancher is installed (also in a later step), the Rancher system creates an Ingress resource. That Ingress tells the Traefik Ingress controller to listen for traffic destined for the Rancher hostname. The Traefik Ingress controller, when receiving traffic destined for the Rancher hostname, will forward that traffic to the running Rancher pods in the cluster.</p><p>For your implementation, consider if you want or need to use a Layer-4 or Layer-7 load balancer:</p><ul><li><strong>A layer-4 load balancer</strong> is the simpler of the two choices, in which you are forwarding TCP traffic to your nodes. We recommend configuring your load balancer as a Layer 4 balancer, forwarding traffic to ports TCP/80 and TCP/443 to the Rancher management cluster nodes. The Ingress controller on the cluster will redirect HTTP traffic to HTTPS and terminate SSL/TLS on port TCP/443. The Ingress controller will forward traffic to port TCP/80 to the Ingress pod in the Rancher deployment.</li><li><strong>A layer-7 load balancer</strong> is a bit more complicated but can offer features that you may want. For instance, a layer-7 load balancer is capable of handling TLS termination at the load balancer, as opposed to Rancher doing TLS termination itself. This can be beneficial if you want to centralize your TLS termination in your infrastructure. Layer-7 load balancing also offers the capability for your load balancer to make decisions based on HTTP attributes such as cookies, etc. that a layer-4 load balancer is not able to concern itself with. If you decide to terminate the SSL/TLS traffic on a layer-7 load balancer, you will need to use the <code>--set tls=external</code> option when installing Rancher in a later step. For more information, refer to the <a href="/reference-guides/installation-references/helm-chart-options#external-tls-termination">Rancher Helm chart options.</a></li></ul><p>For an example showing how to set up an NGINX load balancer, refer to <a href="/how-to-guides/new-user-guides/infrastructure-setup/nginx-load-balancer">this page.</a></p><p>For a how-to guide for setting up an Amazon ELB Network Load Balancer, refer to <a href="/how-to-guides/new-user-guides/infrastructure-setup/amazon-elb-load-balancer">this page.</a></p><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>Important:</h5></div><div class="admonition-content"><p>Do not use this load balancer (i.e, the <code>local</code> cluster Ingress) to load balance applications other than Rancher following installation. Sharing this Ingress with other applications may result in websocket errors to Rancher following Ingress configuration reloads for other apps. We recommend dedicating the <code>local</code> cluster to Rancher and no other applications.</p></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="4-set-up-the-dns-record">4. Set up the DNS Record<a class="hash-link" href="#4-set-up-the-dns-record" title="Direct link to heading">​</a></h3><p>Once you have set up your load balancer, you will need to create a DNS record to send traffic to this load balancer.</p><p>Depending on your environment, this may be an A record pointing to the load balancer IP, or it may be a CNAME pointing to the load balancer hostname. In either case, make sure this record is the hostname that you intend Rancher to respond on.</p><p>You will need to specify this hostname in a later step when you install Rancher, and it is not possible to change it later. Make sure that your decision is a final one.</p><p>For a how-to guide for setting up a DNS record to route domain traffic to an Amazon ELB load balancer, refer to the <a href="https://docs.aws.amazon.com/Route53/latest/DeveloperGuide/routing-to-elb-load-balancer" target="_blank" rel="noopener noreferrer">official AWS documentation.</a></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="5-set-up-a-private-docker-registry">5. Set up a Private Docker Registry<a class="hash-link" href="#5-set-up-a-private-docker-registry" title="Direct link to heading">​</a></h3><p>Rancher supports air gap installs using a private registry. You must have your own private registry or other means of distributing Docker images to your machines.</p><p>In a later step, when you set up your K3s Kubernetes cluster, you will create a <a href="https://rancher.com/docs/k3s/latest/en/installation/private-registry/" target="_blank" rel="noopener noreferrer">private registries configuration file</a> with details from this registry.</p><p>If you need help with creating a private registry, please refer to the <a href="https://docs.docker.com/registry/deploying/#run-an-externally-accessible-registry" target="_blank" rel="noopener noreferrer">official Docker documentation.</a></p></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><p>To install the Rancher management server on a high-availability RKE cluster, we recommend setting up the following infrastructure:</p><ul><li><strong>Three Linux nodes,</strong> typically virtual machines, in an infrastructure provider such as Amazon&#x27;s EC2, Google Compute Engine, or vSphere.</li><li><strong>A load balancer</strong> to direct front-end traffic to the three nodes.</li><li><strong>A DNS record</strong> to map a URL to the load balancer. This will become the Rancher server URL, and downstream Kubernetes clusters will need to reach it.</li><li><strong>A private Docker registry</strong> to distribute Docker images to your machines.</li></ul><p>These nodes must be in the same region/data center. You may place these servers in separate availability zones.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="why-three-nodes">Why three nodes?<a class="hash-link" href="#why-three-nodes" title="Direct link to heading">​</a></h3><p>In an RKE cluster, Rancher server data is stored on etcd. This etcd database runs on all three nodes.</p><p>The etcd database requires an odd number of nodes so that it can always elect a leader with a majority of the etcd cluster. If the etcd database cannot elect a leader, etcd can suffer from <a href="https://www.quora.com/What-is-split-brain-in-distributed-systems" target="_blank" rel="noopener noreferrer">split brain</a>, requiring the cluster to be restored from backup. If one of the three etcd nodes fails, the two remaining nodes can elect a leader because they have the majority of the total number of etcd nodes.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="1-set-up-linux-nodes-1">1. Set up Linux Nodes<a class="hash-link" href="#1-set-up-linux-nodes-1" title="Direct link to heading">​</a></h3><p>These hosts will be disconnected from the internet, but require being able to connect with your private registry.</p><p>Make sure that your nodes fulfill the general installation requirements for <a href="/pages-for-subheaders/installation-requirements">OS, container runtime, hardware, and networking.</a></p><p>For an example of one way to set up Linux nodes, refer to this <a href="/how-to-guides/new-user-guides/infrastructure-setup/nodes-in-amazon-ec2">tutorial</a> for setting up nodes as instances in Amazon EC2.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="2-set-up-the-load-balancer">2. Set up the Load Balancer<a class="hash-link" href="#2-set-up-the-load-balancer" title="Direct link to heading">​</a></h3><p>You will also need to set up a load balancer to direct traffic to the Rancher replica on both nodes. That will prevent an outage of any single node from taking down communications to the Rancher management server.</p><p>When Kubernetes gets set up in a later step, the RKE tool will deploy an NGINX Ingress controller. This controller will listen on ports 80 and 443 of the worker nodes, answering traffic destined for specific hostnames.</p><p>When Rancher is installed (also in a later step), the Rancher system creates an Ingress resource. That Ingress tells the NGINX Ingress controller to listen for traffic destined for the Rancher hostname. The NGINX Ingress controller, when receiving traffic destined for the Rancher hostname, will forward that traffic to the running Rancher pods in the cluster.</p><p>For your implementation, consider if you want or need to use a Layer-4 or Layer-7 load balancer:</p><ul><li><strong>A layer-4 load balancer</strong> is the simpler of the two choices, in which you are forwarding TCP traffic to your nodes. We recommend configuring your load balancer as a Layer 4 balancer, forwarding traffic to ports TCP/80 and TCP/443 to the Rancher management cluster nodes. The Ingress controller on the cluster will redirect HTTP traffic to HTTPS and terminate SSL/TLS on port TCP/443. The Ingress controller will forward traffic to port TCP/80 to the Ingress pod in the Rancher deployment.</li><li><strong>A layer-7 load balancer</strong> is a bit more complicated but can offer features that you may want. For instance, a layer-7 load balancer is capable of handling TLS termination at the load balancer, as opposed to Rancher doing TLS termination itself. This can be beneficial if you want to centralize your TLS termination in your infrastructure. Layer-7 load balancing also offers the capability for your load balancer to make decisions based on HTTP attributes such as cookies, etc. that a layer-4 load balancer is not able to concern itself with. If you decide to terminate the SSL/TLS traffic on a layer-7 load balancer, you will need to use the <code>--set tls=external</code> option when installing Rancher in a later step. For more information, refer to the <a href="/reference-guides/installation-references/helm-chart-options#external-tls-termination">Rancher Helm chart options.</a></li></ul><p>For an example showing how to set up an NGINX load balancer, refer to <a href="/how-to-guides/new-user-guides/infrastructure-setup/nginx-load-balancer">this page.</a></p><p>For a how-to guide for setting up an Amazon ELB Network Load Balancer, refer to <a href="/how-to-guides/new-user-guides/infrastructure-setup/amazon-elb-load-balancer">this page.</a></p><div class="admonition admonition-caution alert alert--warning"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>caution</h5></div><div class="admonition-content"><p>Do not use this load balancer (i.e, the <code>local</code> cluster Ingress) to load balance applications other than Rancher following installation. Sharing this Ingress with other applications may result in websocket errors to Rancher following Ingress configuration reloads for other apps. We recommend dedicating the <code>local</code> cluster to Rancher and no other applications.</p></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="3-set-up-the-dns-record">3. Set up the DNS Record<a class="hash-link" href="#3-set-up-the-dns-record" title="Direct link to heading">​</a></h3><p>Once you have set up your load balancer, you will need to create a DNS record to send traffic to this load balancer.</p><p>Depending on your environment, this may be an A record pointing to the LB IP, or it may be a CNAME pointing to the load balancer hostname. In either case, make sure this record is the hostname that you intend Rancher to respond on.</p><p>You will need to specify this hostname in a later step when you install Rancher, and it is not possible to change it later. Make sure that your decision is a final one.</p><p>For a how-to guide for setting up a DNS record to route domain traffic to an Amazon ELB load balancer, refer to the <a href="https://docs.aws.amazon.com/Route53/latest/DeveloperGuide/routing-to-elb-load-balancer" target="_blank" rel="noopener noreferrer">official AWS documentation.</a></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="4-set-up-a-private-docker-registry">4. Set up a Private Docker Registry<a class="hash-link" href="#4-set-up-a-private-docker-registry" title="Direct link to heading">​</a></h3><p>Rancher supports air gap installs using a secure Docker private registry. You must have your own private registry or other means of distributing Docker images to your machines.</p><p>In a later step, when you set up your RKE Kubernetes cluster, you will create a <a href="https://rancher.com/docs/rke/latest/en/config-options/private-registries/" target="_blank" rel="noopener noreferrer">private registries configuration file</a> with details from this registry.</p><p>If you need help with creating a private registry, please refer to the <a href="https://docs.docker.com/registry/deploying/#run-an-externally-accessible-registry" target="_blank" rel="noopener noreferrer">official Docker documentation.</a></p></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>Notes:</h5></div><div class="admonition-content"><ul><li><p>The Docker installation is for Rancher users that are wanting to test out Rancher. Since there is only one node and a single Docker container, if the node goes down, you will lose all the data of your Rancher server.</p></li><li><p>The Rancher backup operator can be used to migrate Rancher from the single Docker container install to an installation on a high-availability Kubernetes cluster. For details, refer to the documentation on <a href="/how-to-guides/new-user-guides/backup-restore-and-disaster-recovery/migrate-rancher-to-new-cluster">migrating Rancher to a new cluster.</a></p></li></ul></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="1-set-up-a-linux-node">1. Set up a Linux Node<a class="hash-link" href="#1-set-up-a-linux-node" title="Direct link to heading">​</a></h3><p>This host will be disconnected from the Internet, but needs to be able to connect to your private registry.</p><p>Make sure that your node fulfills the general installation requirements for <a href="/pages-for-subheaders/installation-requirements">OS, Docker, hardware, and networking.</a></p><p>For an example of one way to set up Linux nodes, refer to this <a href="/how-to-guides/new-user-guides/infrastructure-setup/nodes-in-amazon-ec2">tutorial</a> for setting up nodes as instances in Amazon EC2.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="2-set-up-a-private-docker-registry">2. Set up a Private Docker Registry<a class="hash-link" href="#2-set-up-a-private-docker-registry" title="Direct link to heading">​</a></h3><p>Rancher supports air gap installs using a Docker private registry on your bastion server. You must have your own private registry or other means of distributing Docker images to your machines.</p><p>If you need help with creating a private registry, please refer to the <a href="https://docs.docker.com/registry/" target="_blank" rel="noopener noreferrer">official Docker documentation.</a></p></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="next-collect-and-publish-images-to-your-private-registry"><a href="/getting-started/installation-and-upgrade/other-installation-methods/air-gapped-helm-cli-install/publish-images">Next: Collect and Publish Images to your Private Registry</a><a class="hash-link" href="#next-collect-and-publish-images-to-your-private-registry" title="Direct link to heading">​</a></h3></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/rancher/rancher-docs/edit/main/docs/getting-started/installation-and-upgrade/other-installation-methods/air-gapped-helm-cli-install/infrastructure-private-registry.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_eYIM" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vbeJ"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2022-09-08T22:35:34.000Z">9/8/2022</time></b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/pages-for-subheaders/air-gapped-helm-cli-install"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Air-Gapped Helm CLI Install</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/getting-started/installation-and-upgrade/other-installation-methods/air-gapped-helm-cli-install/publish-images"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">2. Collect and Publish Images to your Private Registry</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#1-set-up-linux-nodes" class="table-of-contents__link toc-highlight">1. Set up Linux Nodes</a></li><li><a href="#2-set-up-external-datastore" class="table-of-contents__link toc-highlight">2. Set up External Datastore</a></li><li><a href="#3-set-up-the-load-balancer" class="table-of-contents__link toc-highlight">3. Set up the Load Balancer</a></li><li><a href="#4-set-up-the-dns-record" class="table-of-contents__link toc-highlight">4. Set up the DNS Record</a></li><li><a href="#5-set-up-a-private-docker-registry" class="table-of-contents__link toc-highlight">5. Set up a Private Docker Registry</a></li><li><a href="#why-three-nodes" class="table-of-contents__link toc-highlight">Why three nodes?</a></li><li><a href="#1-set-up-linux-nodes-1" class="table-of-contents__link toc-highlight">1. Set up Linux Nodes</a></li><li><a href="#2-set-up-the-load-balancer" class="table-of-contents__link toc-highlight">2. Set up the Load Balancer</a></li><li><a href="#3-set-up-the-dns-record" class="table-of-contents__link toc-highlight">3. Set up the DNS Record</a></li><li><a href="#4-set-up-a-private-docker-registry" class="table-of-contents__link toc-highlight">4. Set up a Private Docker Registry</a></li><li><a href="#1-set-up-a-linux-node" class="table-of-contents__link toc-highlight">1. Set up a Linux Node</a></li><li><a href="#2-set-up-a-private-docker-registry" class="table-of-contents__link toc-highlight">2. Set up a Private Docker Registry</a></li><li><a href="#next-collect-and-publish-images-to-your-private-registry" class="table-of-contents__link toc-highlight">Next: Collect and Publish Images to your Private Registry</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2022 SUSE Rancher. All Rights Reserved.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.217a7f9f.js"></script>
<script src="/assets/js/main.00d8b9dc.js"></script>
</body>
</html>