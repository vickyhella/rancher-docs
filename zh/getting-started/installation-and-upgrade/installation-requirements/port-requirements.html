<!doctype html>
<html lang="zh" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-getting-started/installation-and-upgrade/installation-requirements/port-requirements">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.21">
<link rel="search" type="application/opensearchdescription+xml" title="Rancher Manager" href="/zh/opensearch.xml"><title data-rh="true">端口要求 | Rancher Manager</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="http://docs.ranchermanager.rancher.io//zh/getting-started/installation-and-upgrade/installation-requirements/port-requirements"><meta data-rh="true" name="docusaurus_locale" content="zh"><meta data-rh="true" name="docsearch:language" content="zh"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="端口要求 | Rancher Manager"><meta data-rh="true" name="description" content="了解 Rancher 正常运行所需的端口要求，包括 Rancher 节点和下游 Kubernetes 集群节点"><meta data-rh="true" property="og:description" content="了解 Rancher 正常运行所需的端口要求，包括 Rancher 节点和下游 Kubernetes 集群节点"><link data-rh="true" rel="icon" href="/zh/img/favicon.png"><link data-rh="true" rel="canonical" href="http://docs.ranchermanager.rancher.io//zh/getting-started/installation-and-upgrade/installation-requirements/port-requirements"><link data-rh="true" rel="alternate" href="http://docs.ranchermanager.rancher.io//getting-started/installation-and-upgrade/installation-requirements/port-requirements" hreflang="en"><link data-rh="true" rel="alternate" href="http://docs.ranchermanager.rancher.io//zh/getting-started/installation-and-upgrade/installation-requirements/port-requirements" hreflang="zh"><link data-rh="true" rel="alternate" href="http://docs.ranchermanager.rancher.io//getting-started/installation-and-upgrade/installation-requirements/port-requirements" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://30NEY6C9UY-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/zh/assets/css/styles.27db6f3b.css">
<link rel="preload" href="/zh/assets/js/runtime~main.1041c6af.js" as="script">
<link rel="preload" href="/zh/assets/js/main.bba6dd3d.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_fXgn">跳到主要内容</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/zh/"><div class="navbar__logo"><img src="/zh/img/rancher-logo-horiz-color.svg" alt="logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/zh/img/rancher-logo-horiz-color.svg" alt="logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate"></b></a><div class="navbar__item dropdown dropdown--hoverable"><a aria-current="page" class="navbar__link active" aria-haspopup="true" aria-expanded="false" role="button" href="/zh/">v2.6</a><ul class="dropdown__menu"><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/zh/getting-started/installation-and-upgrade/installation-requirements/port-requirements">v2.6</a></li><li><a class="dropdown__link" href="/zh/v2.5/getting-started/installation-and-upgrade/installation-requirements/port-requirements">v2.5</a></li><li><a class="dropdown__link" href="/zh/v2.0-v2.4/getting-started/installation-and-upgrade/installation-requirements/port-requirements">v2.0-v2.4</a></li><li><a class="dropdown__link" href="/zh/versions">All versions</a></li></ul></div></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_nlXk"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>简体中文</a><ul class="dropdown__menu"><li><a href="/getting-started/installation-and-upgrade/installation-requirements/port-requirements" target="_self" rel="noopener noreferrer" class="dropdown__link">English</a></li><li><a href="/zh/getting-started/installation-and-upgrade/installation-requirements/port-requirements" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active">简体中文</a></li></ul></div><a href="https://github.com/rancher/rancher-docs" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link navbar__github">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_lCJq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="搜索"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">搜索</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docsWrapper_BCFX"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd"><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/zh/">什么是 Rancher？</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/zh/getting-started/overview">开始使用</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh/getting-started/overview">概述</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/zh/pages-for-subheaders/quick-start-guides">快速入门指南</a><button aria-label="打开/收起侧边栏菜单「快速入门指南」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" tabindex="0" href="/zh/pages-for-subheaders/installation-and-upgrade">安装和升级</a><button aria-label="打开/收起侧边栏菜单「安装和升级」" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" tabindex="0" href="/zh/pages-for-subheaders/installation-requirements">安装要求</a><button aria-label="打开/收起侧边栏菜单「安装要求」" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/zh/getting-started/installation-and-upgrade/installation-requirements/install-docker">安装 Docker</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/zh/getting-started/installation-and-upgrade/installation-requirements/dockershim">Dockershim</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/zh/getting-started/installation-and-upgrade/installation-requirements/port-requirements">端口要求</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/zh/pages-for-subheaders/installation-references">安装参考</a><button aria-label="打开/收起侧边栏菜单「安装参考」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/zh/pages-for-subheaders/install-upgrade-on-a-kubernetes-cluster">在 Kubernetes 集群上安装/升级 Rancher</a><button aria-label="打开/收起侧边栏菜单「在 Kubernetes 集群上安装/升级 Rancher」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/zh/pages-for-subheaders/other-installation-methods">其他安装方式</a><button aria-label="打开/收起侧边栏菜单「其他安装方式」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/zh/pages-for-subheaders/resources">资源</a><button aria-label="打开/收起侧边栏菜单「资源」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/zh/getting-started/installation-and-upgrade/upgrade-and-roll-back-kubernetes">升级和回滚 Kubernetes</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/zh/getting-started/installation-and-upgrade/upgrade-kubernetes-without-upgrading-rancher">在不升级 Rancher 的情况下升级 Kubernetes</a></li></ul></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/zh/pages-for-subheaders/new-user-guides">操作指南</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/zh/pages-for-subheaders/best-practices">参考指南</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/zh/pages-for-subheaders/cloud-marketplace">Rancher 中的集成</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/zh/faq/general-faq">常见问题</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/zh/troubleshooting/general-troubleshooting">故障排除</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/zh/contribute-to-rancher">参与 Rancher 社区贡献</a></li></ul></nav></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_GujU"><div class="docItemContainer_Adtb"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="页面路径"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="主页面" class="breadcrumbs__link" href="/zh/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_OVgt"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">开始使用</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/zh/pages-for-subheaders/installation-and-upgrade"><span itemprop="name">安装和升级</span></a><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/zh/pages-for-subheaders/installation-requirements"><span itemprop="name">安装要求</span></a><meta itemprop="position" content="3"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">端口要求</span><meta itemprop="position" content="4"></li></ul></nav><span class="theme-doc-version-badge badge badge--secondary">版本：v2.6</span><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_aoJ5"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">本页总览</button></div><div class="theme-doc-markdown markdown"><header><h1>端口要求</h1></header><p>为了确保能正常运行，Rancher 需要在 Rancher 节点和下游 Kubernetes 集群节点上开放一些端口。</p><h1>Rancher 节点</h1><p>下表列出了运行 Rancher Server 的节点之间需要开放的端口。</p><p>不同的 Rancher Server 架构有不同的端口要求。</p><p>Rancher 可以安装在任何 Kubernetes 集群上。如果你的 Rancher 安装在 K3s、RKE 或 RKE2 Kubernetes 集群上，请参考下面的标签页。对于其他 Kubernetes 发行版，请参见该发行版的文档，了解集群节点的端口要求。</p><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>注意事项：</h5></div><div class="admonition-content"><ul><li>Rancher 节点可能要求额外出站访问已配置的外部验证提供程序（如 LDAP）。</li><li>Kubernetes 建议节点端口服务使用 TCP 30000-32767。</li><li>对于防火墙，可能需要在集群和 Pod CIDR 内启用流量。</li><li>Rancher 节点可能还需要出站访问用于存储集群备份（如 Minio）的外部 S3 上的位置。</li></ul></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="k3s-上-rancher-server-节点的端口">K3s 上 Rancher Server 节点的端口<a class="hash-link" href="#k3s-上-rancher-server-节点的端口" title="标题的直接链接">​</a></h3><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>单击展开</summary><div><div class="collapsibleContent_i85q"><p>K3s server 需要开放端口 6443 才能供节点访问。</p><p>使用 Flannel VXLAN 时，节点需要能够通过 UDP 端口 8472 访问其他节点。节点不应监听任何其他端口。K3s 使用反向隧道，建立节点与 Server 的出站连接，所有 kubelet 流量都通过该隧道进行。但是，如果你不使用 Flannel，而是使用自定义的 CNI，K3s 则不需要打开 8472 端口。</p><p>如果要使用 Metrics Server，则需要在每个节点上打开端口 10250。</p><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>重要提示：</h5></div><div class="admonition-content"><p>节点上的 VXLAN 端口会开放集群网络，让任何人均能访问集群。因此，不要将 VXLAN 端口暴露给外界。请使用禁用 8472 端口的防火墙/安全组来运行节点。</p></div></div><p>下表描述了入站和出站流量的端口要求：</p><figcaption>Rancher Server 节点的入站规则</figcaption><table><thead><tr><th>协议</th><th>端口</th><th>源</th><th>描述</th></tr></thead><tbody><tr><td>TCP</td><td>80</td><td>执行外部 SSL 终止的负载均衡器/代理</td><td>使用外部 SSL 终止时的 Rancher UI/API</td></tr><tr><td>TCP</td><td>443</td><td><ul><li>Server 节点</li><li>Agent 节点</li><li>托管/注册的 Kubernetes</li><li>任何需要使用 Rancher UI 或 API 的源</li></ul></td><td>Rancher Agent，Rancher UI/API，kubectl</td></tr><tr><td>TCP</td><td>6443</td><td>K3s Server 节点</td><td>Kubernetes API</td></tr><tr><td>UDP</td><td>8472</td><td>K3s Server 和 Agent 节点</td><td>仅 Flannel VXLAN 需要</td></tr><tr><td>TCP</td><td>10250</td><td>K3s Server 和 Agent 节点</td><td>kubelet</td></tr></tbody></table><figcaption>Rancher 节点的出站规则</figcaption><table><thead><tr><th>协议</th><th>端口</th><th>目标</th><th>描述</th></tr></thead><tbody><tr><td>TCP</td><td>22</td><td>使用 Node Driver 创建的节点的任何节点 IP</td><td>使用 Node Driver SSH 配置节点</td></tr><tr><td>TCP</td><td>443</td><td>git.rancher.io</td><td>Rancher catalog</td></tr><tr><td>TCP</td><td>2376</td><td>使用 Node Driver 创建的节点的任何节点 IP</td><td>Docker Machine 使用的 Docker daemon TLS 端口</td></tr><tr><td>TCP</td><td>6443</td><td>托管/导入的 Kubernetes API</td><td>Kubernetes API Server</td></tr></tbody></table></div></div></details><h3 class="anchor anchorWithStickyNavbar_LWe7" id="rke-上-rancher-server-节点的端口">RKE 上 Rancher Server 节点的端口<a class="hash-link" href="#rke-上-rancher-server-节点的端口" title="标题的直接链接">​</a></h3><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>单击展开</summary><div><div class="collapsibleContent_i85q"><p>通常情况下，Rancher 安装在三个 RKE 节点上，这些节点都有 etcd、controlplane 和 worker 角色。</p><p>下表描述了 Rancher 节点之间流量的端口要求：</p><figcaption>Rancher 节点的流量规则</figcaption><table><thead><tr><th>协议</th><th>端口</th><th>描述</th></tr></thead><tbody><tr><td>TCP</td><td>443</td><td>Rancher Agents</td></tr><tr><td>TCP</td><td>2379</td><td>etcd 客户端请求</td></tr><tr><td>TCP</td><td>2380</td><td>etcd 对等通信</td></tr><tr><td>TCP</td><td>6443</td><td>Kubernetes apiserver</td></tr><tr><td>TCP</td><td>8443</td><td>NGINX Ingress 的验证 Webhook</td></tr><tr><td>UDP</td><td>8472</td><td>Canal/Flannel VXLAN 覆盖网络</td></tr><tr><td>TCP</td><td>9099</td><td>Canal/Flannel livenessProbe/readinessProbe</td></tr><tr><td>TCP</td><td>10250</td><td>Metrics Server 与所有节点的通信</td></tr><tr><td>TCP</td><td>10254</td><td>Ingress controller livenessProbe/readinessProbe</td></tr></tbody></table><p>下表描述了入站和出站流量的端口要求：</p><figcaption>Rancher 节点的入站规则</figcaption><table><thead><tr><th>协议</th><th>端口</th><th>源</th><th>描述</th></tr></thead><tbody><tr><td>TCP</td><td>22</td><td>RKE CLI</td><td>RKE 通过 SSH 配置节点</td></tr><tr><td>TCP</td><td>80</td><td>负载均衡器/反向代理</td><td>到 Rancher UI/API 的 HTTP 流量</td></tr><tr><td>TCP</td><td>443</td><td><ul><li>负载均衡器/反向代理</li><li>所有集群节点和其他 API/UI 客户端的 IP</li></ul></td><td>到 Rancher UI/API 的 HTTPS 流量</td></tr><tr><td>TCP</td><td>6443</td><td>Kubernetes API 客户端</td><td>到 Kubernetes API 的 HTTPS 流量</td></tr></tbody></table><figcaption>Rancher 节点的出站规则</figcaption><table><thead><tr><th>协议</th><th>端口</th><th>目标</th><th>描述</th></tr></thead><tbody><tr><td>TCP</td><td>443</td><td><code>35.160.43.145</code>，<code>35.167.242.46</code>，<code>52.33.59.17</code></td><td>Rancher catalog（git.rancher.io）</td></tr><tr><td>TCP</td><td>22</td><td>使用 Node Driver 创建的任何节点</td><td>Node Driver 通过 SSH 配置节点</td></tr><tr><td>TCP</td><td>2376</td><td>使用 Node Driver 创建的任何节点</td><td>Node Driver 使用的 Docker daemon TLS 端口</td></tr><tr><td>TCP</td><td>6443</td><td>托管/导入的 Kubernetes API</td><td>Kubernetes API Server</td></tr><tr><td>TCP</td><td>提供商依赖</td><td>托管集群中 Kubernetes API 端点的端口</td><td>Kubernetes API</td></tr></tbody></table></div></div></details><h3 class="anchor anchorWithStickyNavbar_LWe7" id="rke2-上-rancher-server-节点的端口">RKE2 上 Rancher Server 节点的端口<a class="hash-link" href="#rke2-上-rancher-server-节点的端口" title="标题的直接链接">​</a></h3><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>单击展开</summary><div><div class="collapsibleContent_i85q"><p>RKE2 server 需要开放端口 6443 和 9345 才能供集群中的其他节点访问。</p><p>使用 Flannel VXLAN 时，所有节点都需要能够通过 UDP 端口 8472 访问其他节点。</p><p>如果要使用 Metrics Server，则需要在每个节点上打开端口 10250。</p><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>重要提示：</h5></div><div class="admonition-content"><p>节点上的 VXLAN 端口会开放集群网络，让任何人均能访问集群。因此，不要将 VXLAN 端口暴露给外界。请使用禁用 8472 端口的防火墙/安全组来运行节点。</p></div></div><figcaption>RKE2 Server 节点的入站规则</figcaption><table><thead><tr><th>协议</th><th>端口</th><th>源</th><th>描述</th></tr></thead><tbody><tr><td>TCP</td><td>9345</td><td>RKE2 Agent 节点</td><td>Kubernetes API</td></tr><tr><td>TCP</td><td>6443</td><td>RKE2 Agent 节点</td><td>Kubernetes API</td></tr><tr><td>UDP</td><td>8472</td><td>RKE2 Server 和 Agent 节点</td><td>仅 Flannel VXLAN 需要</td></tr><tr><td>TCP</td><td>10250</td><td>RKE2 Server 和 Agent 节点</td><td>kubelet</td></tr><tr><td>TCP</td><td>2379</td><td>RKE2 Server 节点</td><td>etcd 客户端端口</td></tr><tr><td>TCP</td><td>2380</td><td>RKE2 Server 节点</td><td>etcd 对等端口</td></tr><tr><td>TCP</td><td>30000-32767</td><td>RKE2 Server 和 Agent 节点</td><td>NodePort 端口范围</td></tr><tr><td>TCP</td><td>5473</td><td>Calico-node pod 连接到 typha pod</td><td>使用 Calico 部署时需要</td></tr><tr><td>HTTP</td><td>8080</td><td>执行外部 SSL 终止的负载均衡器/代理</td><td>使用外部 SSL 终止时的 Rancher UI/API</td></tr><tr><td>HTTPS</td><td>8443</td><td><ul><li>托管/注册的 Kubernetes</li><li>任何需要使用 Rancher UI 或 API 的源</li></ul></td><td>Rancher Agent，Rancher UI/API，kubectl。如果负载均衡执行 TLS 终止，则不需要。</td></tr></tbody></table><p>所有出站流量通常都是允许的。</p></div></div></details><h3 class="anchor anchorWithStickyNavbar_LWe7" id="docker-安装的-rancher-server-的端口">Docker 安装的 Rancher Server 的端口<a class="hash-link" href="#docker-安装的-rancher-server-的端口" title="标题的直接链接">​</a></h3><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>单击展开</summary><div><div class="collapsibleContent_i85q"><p>下表描述了 Rancher 节点入站和出站流量的端口要求：</p><figcaption>Rancher 节点的入站规则</figcaption><table><thead><tr><th>协议</th><th>端口</th><th>源</th><th>描述</th></tr></thead><tbody><tr><td>TCP</td><td>80</td><td>执行外部 SSL 终止的负载均衡器/代理</td><td>使用外部 SSL 终止时的 Rancher UI/API</td></tr><tr><td>TCP</td><td>443</td><td><ul><li>托管/注册的 Kubernetes</li><li>任何需要使用 Rancher UI 或 API 的源</li></ul></td><td>Rancher Agent，Rancher UI/API，kubectl</td></tr></tbody></table><figcaption>Rancher 节点的出站规则</figcaption><table><thead><tr><th>协议</th><th>端口</th><th>源</th><th>描述</th></tr></thead><tbody><tr><td>TCP</td><td>22</td><td>使用 Node Driver 创建的节点的任何节点 IP</td><td>使用 Node Driver SSH 配置节点</td></tr><tr><td>TCP</td><td>443</td><td>git.rancher.io</td><td>Rancher catalog</td></tr><tr><td>TCP</td><td>2376</td><td>使用 Node Driver 创建的节点的任何节点 IP</td><td>Docker Machine 使用的 Docker daemon TLS 端口</td></tr><tr><td>TCP</td><td>6443</td><td>托管/导入的 Kubernetes API</td><td>Kubernetes API Server</td></tr></tbody></table></div></div></details><h1>下游 Kubernetes 集群节点</h1><p>下游 Kubernetes 集群用于运行你的应用和服务。本节介绍了哪些端口需要在下游集群的节点上打开，以便 Rancher 能够与它们进行通信。</p><p>不同的下游集群的启动方式有不同的端口要求。下面的每个标签都列出了不同<a href="/zh/pages-for-subheaders/kubernetes-clusters-in-rancher-setup">集群类型</a>所需打开的端口。</p><p>下图描述了为每个<a href="/zh/pages-for-subheaders/kubernetes-clusters-in-rancher-setup">集群类型</a>打开的端口。</p><figcaption>Rancher 管理面板的端口要求</figcaption><p><img loading="lazy" alt="基本端口要求" src="/zh/assets/images/port-communications-1eb2fc08fabf37fda3fd63878bfa7902.svg" width="856" height="488" class="img_ev3q"></p><div class="admonition admonition-tip alert alert--success"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</h5></div><div class="admonition-content"><p>如果你对安全性的关注不是太高，而且也愿意多打开几个端口，你可以参考<a href="#%E5%B8%B8%E7%94%A8%E7%AB%AF%E5%8F%A3">常用端口</a>中列出的端口，而不是参考下方的表格。</p></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="rancher-使用节点池启动-kubernetes-集群的端口">Rancher 使用节点池启动 Kubernetes 集群的端口<a class="hash-link" href="#rancher-使用节点池启动-kubernetes-集群的端口" title="标题的直接链接">​</a></h3><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>单击展开</summary><div><div class="collapsibleContent_i85q"><p>下表描述了节点在<a href="/zh/pages-for-subheaders/use-new-nodes-in-an-infra-provider">云提供商</a>中创建的情况下，<a href="/zh/pages-for-subheaders/launch-kubernetes-with-rancher">Rancher 启动 Kubernetes</a> 的端口要求。</p><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>在 AWS EC2 或 DigitalOcean 等云提供商中创建集群期间，Rancher 会自动打开所需的端口。</p></div></div><table style="border-style:solid"><thead><tr><th>From / To</th><th>Rancher Nodes</th><th>etcd Plane Nodes</th><th>Control Plane Nodes</th><th>Worker Plane Nodes</th><th>External Rancher Load Balancer</th><th>Internet</th></tr></thead><tbody><tr><td rowspan="2">Rancher Nodes <sup>(1)</sup></td><td></td><td colspan="3" style="background-color:#3497DA;color:#ffffff">22 TCP</td><td></td><td rowspan="2" style="background-color:#3497DA;color:#ffffff">git.rancher.io</td></tr><tr><td></td><td colspan="3" style="background-color:#3497DA;color:#ffffff">2376 TCP</td><td></td></tr><tr><td rowspan="5">etcd Plane Nodes</td><td rowspan="5" style="background-color:#3497DA;color:#ffffff">443 TCP <sup>(3)</sup></td><td style="background-color:#3497DA;color:#ffffff">2379 TCP</td><td></td><td></td><td rowspan="5" style="background-color:#3497DA;color:#ffffff">443 TCP</td><td></td></tr><tr><td style="background-color:#3497DA;color:#ffffff">2380 TCP</td><td></td><td></td><td></td></tr><tr><td></td><td style="background-color:#3497DA;color:#ffffff">6443 TCP</td><td></td><td></td></tr><tr><td colspan="3" style="background-color:#3497DA;color:#ffffff">8472 UDP</td><td></td></tr><tr><td style="background-color:#3497DA;color:#ffffff">9099 TCP <sup>(4)</sup></td><td></td><td></td><td></td></tr><tr><td rowspan="7">Control Plane Nodes</td><td rowspan="7" style="background-color:#3497DA;color:#ffffff">443 TCP <sup>(3)</sup></td><td style="background-color:#3497DA;color:#ffffff">2379 TCP</td><td></td><td></td><td rowspan="7" style="background-color:#3497DA;color:#ffffff">443 TCP</td><td></td></tr><tr><td style="background-color:#3497DA;color:#ffffff">2380 TCP</td><td></td><td></td><td></td></tr><tr><td></td><td style="background-color:#3497DA;color:#ffffff">6443 TCP</td><td></td><td></td></tr><tr><td colspan="3" style="background-color:#3497DA;color:#ffffff">8472 UDP</td><td></td></tr><tr><td colspan="3" style="background-color:#3497DA;color:#ffffff">10250 TCP</td><td></td></tr><tr><td></td><td style="background-color:#3497DA;color:#ffffff">9099 TCP <sup>(4)</sup></td><td></td><td></td></tr><tr><td></td><td style="background-color:#3497DA;color:#ffffff">10254 TCP <sup>(4)</sup></td><td></td><td></td></tr><tr><td rowspan="4">Worker Plane Nodes</td><td rowspan="4" style="background-color:#3497DA;color:#ffffff">443 TCP <sup>(3)</sup></td><td></td><td style="background-color:#3497DA;color:#ffffff">6443 TCP</td><td></td><td rowspan="4" style="background-color:#3497DA;color:#ffffff">443 TCP</td><td></td></tr><tr><td colspan="3" style="background-color:#3497DA;color:#ffffff">8472 UDP</td><td></td></tr><tr><td></td><td></td><td style="background-color:#3497DA;color:#ffffff">9099 TCP <sup>(4)</sup></td><td></td></tr><tr><td></td><td></td><td style="background-color:#3497DA;color:#ffffff">10254 TCP <sup>(4)</sup></td><td></td></tr><tr><td>Kubernetes API Clients</td><td></td><td></td><td style="background-color:#3497DA;color:#ffffff">6443 TCP <sup>(5)</sup></td><td></td><td></td><td></td></tr><tr><td rowspan="3">Workload Clients or Load Balancer</td><td></td><td></td><td></td><td style="background-color:#3497DA;color:#ffffff">30000-32767 TCP / UDP<br>(nodeport)</td><td></td><td></td></tr><tr><td></td><td></td><td></td><td style="background-color:#3497DA;color:#ffffff">80 TCP (Ingress)</td><td></td></tr><tr><td></td><td></td><td></td><td style="background-color:#3497DA;color:#ffffff">443 TCP (Ingress)</td><td></td></tr><tr><td colspan="7">Notes:<br><br>1. Nodes running standalone server or Rancher HA deployment.<br>2. Required to fetch Rancher chart library.<br>3. Only without external load balancer in front of Rancher.<br>4. Local traffic to the node itself (not across nodes).<br>5. Only if Authorized Cluster Endpoints are activated.</td></tr></tbody></table></div></div></details><h3 class="anchor anchorWithStickyNavbar_LWe7" id="rancher-使用自定义节点启动-kubernetes-集群的端口">Rancher 使用自定义节点启动 Kubernetes 集群的端口<a class="hash-link" href="#rancher-使用自定义节点启动-kubernetes-集群的端口" title="标题的直接链接">​</a></h3><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>单击展开</summary><div><div class="collapsibleContent_i85q"><p>下表描述了使用<a href="/zh/pages-for-subheaders/use-existing-nodes">自定义节点</a>的情况下，<a href="/zh/pages-for-subheaders/launch-kubernetes-with-rancher">Rancher 启动 Kubernetes</a> 的端口要求。</p><table><thead><tr><th>From / To</th><th>Rancher Nodes</th><th>etcd Plane Nodes</th><th>Control Plane Nodes</th><th>Worker Plane Nodes</th><th>External Rancher Load Balancer</th><th>Internet</th></tr></thead><tbody><tr><td>Rancher Nodes <sup>(1)</sup></td><td></td><td></td><td></td><td></td><td></td><td style="background-color:#3497DA;color:#ffffff">git.rancher.io</td></tr><tr><td rowspan="6">etcd Plane Nodes</td><td rowspan="6" style="background-color:#3497DA;color:#ffffff">443 TCP <sup>(3)</sup></td><td style="background-color:#3497DA;color:#ffffff">2379 TCP</td><td></td><td></td><td rowspan="5" style="background-color:#3497DA;color:#ffffff">443 TCP</td><td></td></tr><tr><td style="background-color:#3497DA;color:#ffffff">2380 TCP</td><td></td><td></td><td></td></tr><tr><td></td><td style="background-color:#3497DA;color:#ffffff">6443 TCP</td><td></td><td></td></tr><tr><td colspan="3" style="background-color:#3497DA;color:#ffffff">8472 UDP</td><td></td></tr><tr><td colspan="3" style="background-color:#3497DA;color:#ffffff">4789 UDP <sup>(6)</sup></td><td></td></tr><tr><td style="background-color:#3497DA;color:#ffffff">9099 TCP <sup>(4)</sup></td><td></td><td></td><td></td></tr><tr><td rowspan="8">Control Plane Nodes</td><td rowspan="8" style="background-color:#3497DA;color:#ffffff">443 TCP <sup>(3)</sup></td><td style="background-color:#3497DA;color:#ffffff">2379 TCP</td><td></td><td></td><td rowspan="7" style="background-color:#3497DA;color:#ffffff">443 TCP</td><td></td></tr><tr><td style="background-color:#3497DA;color:#ffffff">2380 TCP</td><td></td><td></td><td></td></tr><tr><td></td><td style="background-color:#3497DA;color:#ffffff">6443 TCP</td><td></td><td></td></tr><tr><td colspan="3" style="background-color:#3497DA;color:#ffffff">8472 UDP</td><td></td></tr><tr><td colspan="3" style="background-color:#3497DA;color:#ffffff">4789 UDP <sup>(6)</sup></td><td></td></tr><tr><td colspan="3" style="background-color:#3497DA;color:#ffffff">10250 TCP</td><td></td></tr><tr><td></td><td style="background-color:#3497DA;color:#ffffff">9099 TCP <sup>(4)</sup></td><td></td><td></td></tr><tr><td></td><td style="background-color:#3497DA;color:#ffffff">10254 TCP <sup>(4)</sup></td><td></td><td></td></tr><tr><td rowspan="5">Worker Plane Nodes</td><td rowspan="5" style="background-color:#3497DA;color:#ffffff">443 TCP <sup>(3)</sup></td><td></td><td style="background-color:#3497DA;color:#ffffff">6443 TCP</td><td></td><td rowspan="4" style="background-color:#3497DA;color:#ffffff">443 TCP</td><td></td></tr><tr><td colspan="3" style="background-color:#3497DA;color:#ffffff">8472 UDP</td><td></td></tr><tr><td colspan="3" style="background-color:#3497DA;color:#ffffff">4789 UDP <sup>(6)</sup></td><td></td></tr><tr><td></td><td></td><td style="background-color:#3497DA;color:#ffffff">9099 TCP <sup>(4)</sup></td><td></td></tr><tr><td></td><td></td><td style="background-color:#3497DA;color:#ffffff">10254 TCP <sup>(4)</sup></td><td></td></tr><tr><td>Kubernetes API Clients</td><td></td><td></td><td style="background-color:#3497DA;color:#ffffff">6443 TCP <sup>(5)</sup></td><td></td><td></td><td></td></tr><tr><td rowspan="3">Workload Clients or Load Balancer</td><td></td><td></td><td></td><td style="background-color:#3497DA;color:#ffffff">30000-32767 TCP / UDP<br>(nodeport)</td><td></td><td></td></tr><tr><td></td><td></td><td></td><td style="background-color:#3497DA;color:#ffffff">80 TCP (Ingress)</td><td></td></tr><tr><td></td><td></td><td></td><td style="background-color:#3497DA;color:#ffffff">443 TCP (Ingress)</td><td></td></tr><tr><td colspan="7">Notes:<br><br>1. Nodes running standalone server or Rancher HA deployment.<br>2. Required to fetch Rancher chart library.<br>3. Only without external load balancer in front of Rancher.<br>4. Local traffic to the node itself (not across nodes).<br>5. Only if Authorized Cluster Endpoints are activated.<br>6. Only if using Overlay mode on Windows cluster.</td></tr></tbody></table></div></div></details><h3 class="anchor anchorWithStickyNavbar_LWe7" id="托管-kubernetes-集群的端口">托管 Kubernetes 集群的端口<a class="hash-link" href="#托管-kubernetes-集群的端口" title="标题的直接链接">​</a></h3><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>单击展开</summary><div><div class="collapsibleContent_i85q"><p>下表描述了<a href="/zh/pages-for-subheaders/set-up-clusters-from-hosted-kubernetes-providers">托管集群</a>的端口要求。</p><table><thead><tr><th>From / To</th><th>Rancher Nodes</th><th>Hosted / Imported Cluster</th><th>External Rancher Load Balancer</th><th>Internet</th></tr></thead><tbody><tr><td rowspan="3">Rancher Nodes <sup>(1)</sup></td><td></td><td style="background-color:#3497DA;color:#ffffff">Kubernetes API <br>Endpoint Port <sup>(2)</sup></td><td></td><td rowspan="3" style="background-color:#3497DA;color:#ffffff">git.rancher.io</td></tr><tr><td></td><td style="background-color:#3497DA;color:#ffffff">8443 TCP</td><td></td></tr><tr><td></td><td style="background-color:#3497DA;color:#ffffff">9443 TCP</td><td></td></tr><tr><td>Hosted / Imported Cluster</td><td style="background-color:#3497DA;color:#ffffff">443 TCP <sup>(4)(5)</sup></td><td></td><td style="background-color:#3497DA;color:#ffffff">443 TCP <sup>(5)</sup></td><td></td></tr><tr><td>Kubernetes API Clients</td><td></td><td style="background-color:#3497DA;color:#ffffff">Cluster / Provider Specific <sup>(6)</sup></td><td></td><td></td></tr><tr><td>Workload Client</td><td></td><td style="background-color:#3497DA;color:#ffffff">Cluster / Provider Specific <sup>(7)</sup></td><td></td><td></td></tr><tr><td colspan="5">Notes:<br><br>1. Nodes running standalone server or Rancher HA deployment.<br>2. Only for hosted clusters.<br>3. Required to fetch Rancher chart library.<br>4. Only without external load balancer.<br>5. From worker nodes.<br>6. For direct access to the Kubernetes API without Rancher.<br>7. Usually Ingress backed by infrastructure load balancer and/or nodeport.</td></tr></tbody></table></div></div></details><h3 class="anchor anchorWithStickyNavbar_LWe7" id="已注册集群的端口">已注册集群的端口<a class="hash-link" href="#已注册集群的端口" title="标题的直接链接">​</a></h3><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>在 Rancher 2.5 之前，注册集群被称为导入集群。</p></div></div><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>单击展开</summary><div><div class="collapsibleContent_i85q"><p>下表描述了<a href="/zh/how-to-guides/new-user-guides/kubernetes-clusters-in-rancher-setup/register-existing-clusters">注册集群</a>的端口要求。</p><table><thead><tr><th>From / To</th><th>Rancher Nodes</th><th>Hosted / Imported Cluster</th><th>External Rancher Load Balancer</th><th>Internet</th></tr></thead><tbody><tr><td rowspan="3">Rancher Nodes <sup>(1)</sup></td><td></td><td style="background-color:#3497DA;color:#ffffff">Kubernetes API <br>Endpoint Port <sup>(2)</sup></td><td></td><td rowspan="3" style="background-color:#3497DA;color:#ffffff">git.rancher.io</td></tr><tr><td></td><td style="background-color:#3497DA;color:#ffffff">8443 TCP</td><td></td></tr><tr><td></td><td style="background-color:#3497DA;color:#ffffff">9443 TCP</td><td></td></tr><tr><td>Hosted / Imported Cluster</td><td style="background-color:#3497DA;color:#ffffff">443 TCP <sup>(4)(5)</sup></td><td></td><td style="background-color:#3497DA;color:#ffffff">443 TCP <sup>(5)</sup></td><td></td></tr><tr><td>Kubernetes API Clients</td><td></td><td style="background-color:#3497DA;color:#ffffff">Cluster / Provider Specific <sup>(6)</sup></td><td></td><td></td></tr><tr><td>Workload Client</td><td></td><td style="background-color:#3497DA;color:#ffffff">Cluster / Provider Specific <sup>(7)</sup></td><td></td><td></td></tr><tr><td colspan="5">Notes:<br><br>1. Nodes running standalone server or Rancher HA deployment.<br>2. Only for hosted clusters.<br>3. Required to fetch Rancher chart library.<br>4. Only without external load balancer.<br>5. From worker nodes.<br>6. For direct access to the Kubernetes API without Rancher.<br>7. Usually Ingress backed by infrastructure load balancer and/or nodeport.</td></tr></tbody></table></div></div></details><h1>其他端口注意事项</h1><h3 class="anchor anchorWithStickyNavbar_LWe7" id="常用端口">常用端口<a class="hash-link" href="#常用端口" title="标题的直接链接">​</a></h3><p>无论集群是什么类型，常用端口通常在你的 Kubernetes 节点上打开。</p><table><thead><tr><th align="center">协议</th><th align="center">端口</th><th>描述</th></tr></thead><tbody><tr><td align="center">TCP</td><td align="center">22</td><td>Node Driver SSH 配置</td></tr><tr><td align="center">TCP</td><td align="center">179</td><td>Calico BGP 端口</td></tr><tr><td align="center">TCP</td><td align="center">2376</td><td>Node Driver Docker daemon TLS 端口</td></tr><tr><td align="center">TCP</td><td align="center">2379</td><td>etcd 客户端请求</td></tr><tr><td align="center">TCP</td><td align="center">2380</td><td>etcd 对等通信</td></tr><tr><td align="center">UDP</td><td align="center">8472</td><td>Canal/Flannel VXLAN 覆盖网络</td></tr><tr><td align="center">UDP</td><td align="center">4789</td><td>Windows 集群中的 Flannel VXLAN 覆盖网络</td></tr><tr><td align="center">TCP</td><td align="center">8443</td><td>Rancher webhook</td></tr><tr><td align="center">TCP</td><td align="center">9099</td><td>Canal/Flannel livenessProbe/readinessProbe</td></tr><tr><td align="center">TCP</td><td align="center">9100</td><td>Monitoring 从 Linux node-exporter 中抓取指标所需的默认端口</td></tr><tr><td align="center">TCP</td><td align="center">9443</td><td>Rancher webhook</td></tr><tr><td align="center">TCP</td><td align="center">9796</td><td>Monitoring 从 Windows node-exporter 中抓取指标所需的默认端口</td></tr><tr><td align="center">TCP</td><td align="center">6783</td><td>Weave 端口</td></tr><tr><td align="center">UDP</td><td align="center">6783-6784</td><td>Weave UDP 端口</td></tr><tr><td align="center">TCP</td><td align="center">10250</td><td>Metrics Server 与所有节点 API 的通信</td></tr><tr><td align="center">TCP</td><td align="center">10254</td><td>Ingress controller livenessProbe/readinessProbe</td></tr><tr><td align="center">TCP/UDP</td><td align="center">30000-32767</td><td>NodePort 端口范围</td></tr></tbody></table><hr><h3 class="anchor anchorWithStickyNavbar_LWe7" id="本地节点流量">本地节点流量<a class="hash-link" href="#本地节点流量" title="标题的直接链接">​</a></h3><p>上述要求中标记为<code>本地流量</code>（例如 <code>9099 TCP</code>）的端口会用于 Kubernetes 健康检查 （<code>livenessProbe</code> 和 <code>readinessProbe</code>）。
这些健康检查是在节点本身执行的。在大多数云环境中，这种本地流量是默认允许的。</p><p>但是，在以下情况下可能会阻止此流量：</p><ul><li>你已在节点上应用了严格的主机防火墙策略。</li><li>你正在使用有多个接口（多宿主）的节点。</li></ul><p>在这些情况下，你必须在你的主机防火墙中主动允许这种流量，如果是公共/私有云托管的主机（例如 AWS 或 OpenStack），你需要在你的安全组配置中主动允许此流量。请记住，如果你在安全组中使用安全组作为源或目标，主动开放端口只适用于节点/实例的私有接口。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="rancher-aws-ec2-安全组">Rancher AWS EC2 安全组<a class="hash-link" href="#rancher-aws-ec2-安全组" title="标题的直接链接">​</a></h3><p>当你使用 <a href="/zh/how-to-guides/new-user-guides/launch-kubernetes-with-rancher/use-new-nodes-in-an-infra-provider/create-an-amazon-ec2-cluster">AWS EC2 Node Driver</a> 在 Rancher 中配置集群节点时，你可以让 Rancher 创建一个名为 <code>rancher-nodes</code> 的安全组。以下规则会自动添加到该安全组中。</p><table><thead><tr><th>类型</th><th align="center">协议</th><th align="center">端口范围</th><th>源/目标</th><th align="center">规则类型</th></tr></thead><tbody><tr><td>SSH</td><td align="center">TCP</td><td align="center">22</td><td>0.0.0.0/0</td><td align="center">入站</td></tr><tr><td>HTTP</td><td align="center">TCP</td><td align="center">80</td><td>0.0.0.0/0</td><td align="center">入站</td></tr><tr><td>自定义 TCP 规则</td><td align="center">TCP</td><td align="center">443</td><td>0.0.0.0/0</td><td align="center">入站</td></tr><tr><td>自定义 TCP 规则</td><td align="center">TCP</td><td align="center">2376</td><td>0.0.0.0/0</td><td align="center">入站</td></tr><tr><td>自定义 TCP 规则</td><td align="center">TCP</td><td align="center">2379-2380</td><td>sg-xxx (rancher-nodes)</td><td align="center">入站</td></tr><tr><td>自定义 UDP 规则</td><td align="center">UDP</td><td align="center">4789</td><td>sg-xxx (rancher-nodes)</td><td align="center">入站</td></tr><tr><td>自定义 TCP 规则</td><td align="center">TCP</td><td align="center">6443</td><td>0.0.0.0/0</td><td align="center">入站</td></tr><tr><td>自定义 UDP 规则</td><td align="center">UDP</td><td align="center">8472</td><td>sg-xxx (rancher-nodes)</td><td align="center">入站</td></tr><tr><td>自定义 TCP 规则</td><td align="center">TCP</td><td align="center">10250-10252</td><td>sg-xxx (rancher-nodes)</td><td align="center">入站</td></tr><tr><td>自定义 TCP 规则</td><td align="center">TCP</td><td align="center">10256</td><td>sg-xxx (rancher-nodes)</td><td align="center">入站</td></tr><tr><td>自定义 TCP 规则</td><td align="center">TCP</td><td align="center">30000-32767</td><td>0.0.0.0/0</td><td align="center">入站</td></tr><tr><td>自定义 UDP 规则</td><td align="center">UDP</td><td align="center">30000-32767</td><td>0.0.0.0/0</td><td align="center">入站</td></tr><tr><td>所有流量</td><td align="center">全部</td><td align="center">全部</td><td>0.0.0.0/0</td><td align="center">出站</td></tr></tbody></table><h3 class="anchor anchorWithStickyNavbar_LWe7" id="打开-suse-linux-端口">打开 SUSE Linux 端口<a class="hash-link" href="#打开-suse-linux-端口" title="标题的直接链接">​</a></h3><p>SUSE Linux 可能有一个防火墙，默认情况下会阻止所有端口。要打开将主机添加到自定义集群所需的端口：</p><div class="tabs-container tabList__CuJ"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LNqP tabs__item--active">SLES 15 / openSUSE Leap 15</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">SLES 12 / openSUSE Leap 42</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_Ymn6">1. SSH 进入实例。 1. 以文本模式启动 YaST： ``` sudo yast2 ```<ol><li>导航到<strong>安全和用户</strong> &gt; <strong>防火墙</strong> &gt; <strong>区域：公共</strong> &gt; <strong>端口</strong>。要在界面内导航，请参照<a href="https://doc.opensuse.org/documentation/leap/reference/html/book.opensuse.reference/cha-yast-text.html#sec-yast-cli-navigate" target="_blank" rel="noopener noreferrer">指示</a>。</li><li>要打开所需的端口，把它们输入到 <strong>TCP 端口</strong> 和 <strong>UDP 端口</strong> 字段。在这个例子中，端口 9796 和 10250 也被打开，用于监控。由此产生的字段应类似于以下内容：</li></ol><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">TCP Ports</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">22</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">80</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">443</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">2376</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">2379</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">2380</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">6443</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">9099</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">9796</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">10250</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">10254</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> 30000</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token number" style="color:rgb(247, 140, 108)">32767</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">UDP Ports</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">8472</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> 30000</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token number" style="color:rgb(247, 140, 108)">32767</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol><li>所有必须端口都输入后，选择<strong>接受</strong>。</li></ol></div><div role="tabpanel" class="tabItem_Ymn6" hidden="">1. SSH 进入实例。 1. 编辑 `/etc/sysconfig/SuSEfirewall2` 并打开所需的端口。在这个例子中，端口 9796 和 10250 也被打开，用于监控。 ``` FW_SERVICES_EXT_TCP=&quot;22 80 443 2376 2379 2380 6443 9099 9796 10250 10254 30000:32767&quot; FW_SERVICES_EXT_UDP=&quot;8472 30000:32767&quot; FW_ROUTE=yes ``` 1. 用新的端口重启防火墙： ``` SuSEfirewall2 ```</div></div></div><p><strong>结果</strong> ：该节点已打开添加到自定义集群所需的端口。</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/rancher/rancher-docs/edit/main/docs/getting-started/installation-and-upgrade/installation-requirements/port-requirements.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_eYIM" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>编辑此页</a></div><div class="col lastUpdated_vbeJ"><span class="theme-last-updated">最后<!-- -->于 <b><time datetime="2022-10-25T20:41:06.000Z">2022/10/25</time></b> <!-- -->更新</span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="文档分页导航"><a class="pagination-nav__link pagination-nav__link--prev" href="/zh/getting-started/installation-and-upgrade/installation-requirements/dockershim"><div class="pagination-nav__sublabel">上一页</div><div class="pagination-nav__label">Dockershim</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/zh/pages-for-subheaders/installation-references"><div class="pagination-nav__sublabel">下一页</div><div class="pagination-nav__label">安装参考</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#k3s-上-rancher-server-节点的端口" class="table-of-contents__link toc-highlight">K3s 上 Rancher Server 节点的端口</a></li><li><a href="#rke-上-rancher-server-节点的端口" class="table-of-contents__link toc-highlight">RKE 上 Rancher Server 节点的端口</a></li><li><a href="#rke2-上-rancher-server-节点的端口" class="table-of-contents__link toc-highlight">RKE2 上 Rancher Server 节点的端口</a></li><li><a href="#docker-安装的-rancher-server-的端口" class="table-of-contents__link toc-highlight">Docker 安装的 Rancher Server 的端口</a></li><li><a href="#rancher-使用节点池启动-kubernetes-集群的端口" class="table-of-contents__link toc-highlight">Rancher 使用节点池启动 Kubernetes 集群的端口</a></li><li><a href="#rancher-使用自定义节点启动-kubernetes-集群的端口" class="table-of-contents__link toc-highlight">Rancher 使用自定义节点启动 Kubernetes 集群的端口</a></li><li><a href="#托管-kubernetes-集群的端口" class="table-of-contents__link toc-highlight">托管 Kubernetes 集群的端口</a></li><li><a href="#已注册集群的端口" class="table-of-contents__link toc-highlight">已注册集群的端口</a></li><li><a href="#常用端口" class="table-of-contents__link toc-highlight">常用端口</a></li><li><a href="#本地节点流量" class="table-of-contents__link toc-highlight">本地节点流量</a></li><li><a href="#rancher-aws-ec2-安全组" class="table-of-contents__link toc-highlight">Rancher AWS EC2 安全组</a></li><li><a href="#打开-suse-linux-端口" class="table-of-contents__link toc-highlight">打开 SUSE Linux 端口</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2022 SUSE Rancher. All Rights Reserved.</div></div></div></footer></div>
<script src="/zh/assets/js/runtime~main.1041c6af.js"></script>
<script src="/zh/assets/js/main.bba6dd3d.js"></script>
</body>
</html>