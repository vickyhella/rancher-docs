<!doctype html>
<html lang="zh" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-integrations-in-rancher/monitoring-and-alerting/rbac-for-monitoring">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.3.1">
<title data-rh="true">RBAC | Rancher Manager</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="http://ranchermanager.docs.rancher.com/zh/integrations-in-rancher/monitoring-and-alerting/rbac-for-monitoring"><meta data-rh="true" name="docusaurus_locale" content="zh"><meta data-rh="true" name="docsearch:language" content="zh"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="RBAC | Rancher Manager"><meta data-rh="true" name="description" content="本节描述了 RBAC 在 Rancher Monitoring 中的作用。"><meta data-rh="true" property="og:description" content="本节描述了 RBAC 在 Rancher Monitoring 中的作用。"><link data-rh="true" rel="icon" href="/zh/img/favicon.png"><link data-rh="true" rel="canonical" href="http://ranchermanager.docs.rancher.com/zh/integrations-in-rancher/monitoring-and-alerting/rbac-for-monitoring"><link data-rh="true" rel="alternate" href="http://ranchermanager.docs.rancher.com/integrations-in-rancher/monitoring-and-alerting/rbac-for-monitoring" hreflang="en"><link data-rh="true" rel="alternate" href="http://ranchermanager.docs.rancher.com/zh/integrations-in-rancher/monitoring-and-alerting/rbac-for-monitoring" hreflang="zh"><link data-rh="true" rel="alternate" href="http://ranchermanager.docs.rancher.com/integrations-in-rancher/monitoring-and-alerting/rbac-for-monitoring" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://30NEY6C9UY-dsn.algolia.net" crossorigin="anonymous"><link rel="preconnect" href="https://www.googletagmanager.com">
<script>window.dataLayer=window.dataLayer||[]</script>
<script>!function(e,t,a,n,g){e[n]=e[n]||[],e[n].push({"gtm.start":(new Date).getTime(),event:"gtm.js"});var m=t.getElementsByTagName(a)[0],r=t.createElement(a);r.async=!0,r.src="https://www.googletagmanager.com/gtm.js?id=GTM-57KS2MW",m.parentNode.insertBefore(r,m)}(window,document,"script","dataLayer")</script>


<link rel="search" type="application/opensearchdescription+xml" title="Rancher Manager" href="/zh/opensearch.xml">

<script src="https://cdn.cookielaw.org/scripttemplates/otSDKStub.js" charset="UTF-8" data-domain-script="0f98beb0-fc4c-417d-a42e-564e2cae42d2" async></script>
<script src="/scripts/optanonwrapper.js" async></script><link rel="stylesheet" href="/zh/assets/css/styles.9e0f75bb.css">
<link rel="preload" href="/zh/assets/js/runtime~main.2f000545.js" as="script">
<link rel="preload" href="/zh/assets/js/main.02ca8a94.js" as="script">
</head>
<body class="navigation-with-keyboard">
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-57KS2MW" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>

<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="跳到主要内容"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">跳到主要内容</a></div><nav aria-label="主导航" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="切换导航栏" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/zh/"><div class="navbar__logo"><img src="/zh/img/rancher-logo-horiz-color.svg" alt="logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/zh/img/rancher-logo-horiz-color.svg" alt="logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate"></b></a><div class="navbar__item dropdown dropdown--hoverable"><a aria-current="page" class="navbar__link active" aria-haspopup="true" aria-expanded="false" role="button" href="/zh/">v2.7</a><ul class="dropdown__menu"><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/zh/integrations-in-rancher/monitoring-and-alerting/rbac-for-monitoring">v2.7</a></li><li><a class="dropdown__link" href="/zh/v2.6/integrations-in-rancher/monitoring-and-alerting/rbac-for-monitoring">v2.6</a></li><li><a class="dropdown__link" href="/zh/v2.5">v2.5</a></li><li><a class="dropdown__link" href="/zh/v2.0-v2.4">v2.0-v2.4</a></li><li><a class="dropdown__link" href="/zh/versions">All versions</a></li></ul></div></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_nlXk"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>简体中文</a><ul class="dropdown__menu"><li><a href="/integrations-in-rancher/monitoring-and-alerting/rbac-for-monitoring" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="en">English</a></li><li><a href="/zh/integrations-in-rancher/monitoring-and-alerting/rbac-for-monitoring" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="zh">简体中文</a></li></ul></div><a href="https://github.com/rancher/rancher-docs" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link navbar__github">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="https://rancher.com" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Rancher 主页<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="搜索"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">搜索</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="文档侧边栏" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/zh/">什么是 Rancher？</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/zh/getting-started/overview">开始使用</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/zh/pages-for-subheaders/new-user-guides">操作指南</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/zh/pages-for-subheaders/best-practices">参考指南</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/zh/pages-for-subheaders/cloud-marketplace">Rancher 中的集成</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/zh/pages-for-subheaders/cloud-marketplace">云市场集成</a><button aria-label="打开/收起侧边栏菜单「云市场集成」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/zh/pages-for-subheaders/cis-scans">CIS 扫描</a><button aria-label="打开/收起侧边栏菜单「CIS 扫描」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/zh/pages-for-subheaders/fleet-gitops-at-scale">Fleet - 大规模的 GitOps</a><button aria-label="打开/收起侧边栏菜单「Fleet - 大规模的 GitOps」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh/integrations-in-rancher/harvester">Harvester 集成</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/zh/pages-for-subheaders/istio">Istio</a><button aria-label="打开/收起侧边栏菜单「Istio」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh/integrations-in-rancher/longhorn">Longhorn - Kubernetes 的云原生分布式块存储</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/zh/pages-for-subheaders/logging">Logging</a><button aria-label="打开/收起侧边栏菜单「Logging」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" tabindex="0" href="/zh/pages-for-subheaders/monitoring-and-alerting">监控和告警</a><button aria-label="打开/收起侧边栏菜单「监控和告警」" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/zh/integrations-in-rancher/monitoring-and-alerting/how-monitoring-works">Monitoring 的工作原理</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/zh/integrations-in-rancher/monitoring-and-alerting/rbac-for-monitoring">RBAC</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/zh/integrations-in-rancher/monitoring-and-alerting/built-in-dashboards">内置仪表板</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/zh/integrations-in-rancher/monitoring-and-alerting/windows-support">Monitoring V2 的 Windows 集群支持</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/zh/integrations-in-rancher/monitoring-and-alerting/promql-expressions">PromQL 表达式参考</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh/integrations-in-rancher/neuvector">NeuVector 集成</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh/integrations-in-rancher/opa-gatekeeper">OPA Gatekeeper</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh/integrations-in-rancher/rancher-extensions">Rancher 扩展</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/zh/faq/general-faq">常见问题</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/zh/troubleshooting/general-troubleshooting">故障排除</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/zh/contribute-to-rancher">参与 Rancher 社区贡献</a></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="页面路径"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="主页面" class="breadcrumbs__link" href="/zh/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Rancher 中的集成</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/zh/pages-for-subheaders/monitoring-and-alerting"><span itemprop="name">监控和告警</span></a><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">RBAC</span><meta itemprop="position" content="3"></li></ul></nav><span class="theme-doc-version-badge badge badge--secondary">版本：v2.7</span><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">本页总览</button></div><div class="theme-doc-markdown markdown"><header><h1>RBAC</h1></header><p>本节描述了 RBAC 在 Rancher Monitoring 中的作用。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="集群管理员">集群管理员<a href="#集群管理员" class="hash-link" aria-label="标题的直接链接" title="标题的直接链接">​</a></h2><p>默认情况下，只有具有 cluster-admin <code>ClusterRole</code> 的用户才能：</p><ul><li>将 <code>rancher-monitoring</code> 应用安装到集群上，并在 Chart 部署上执行所有其他相关配置。<ul><li>例如，是否创建了默认仪表板，要将哪些 Exporter 部署到集群上以收集指标等。</li></ul></li><li>通过 Prometheus CR 在集群中创建/修改/删除 Prometheus deployment。</li><li>通过 Alertmanager CR 在集群中创建/修改/删除 Alertmanager deployment。</li><li>通过在命名空间中创建 ConfigMap 来保留新的 Grafana 仪表板或数据源。</li><li>通过 <code>cattle-monitoring-system</code> 命名空间中的 Secret 将某些 Prometheus 指标暴露给 HPA 的 K8s Custom Metrics API。</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="具有基于-kubernetes-clusterrole-权限的用户">具有基于 Kubernetes ClusterRole 权限的用户<a href="#具有基于-kubernetes-clusterrole-权限的用户" class="hash-link" aria-label="标题的直接链接" title="标题的直接链接">​</a></h2><p><code>rancher-monitoring</code> Chart 安装了以下三个 <code>ClusterRole</code>。默认情况下，它们会聚合到相应的 K8s <code>ClusterRole</code> 中：</p><table><thead><tr><th>ClusterRole</th><th>聚合到默认的 K8s ClusterRole</th></tr></thead><tbody><tr><td><code>monitoring-admin</code></td><td><code>admin</code></td></tr><tr><td><code>monitoring-edit</code></td><td><code>edit</code></td></tr><tr><td><code>monitoring-view</code></td><td><code>view </code></td></tr></tbody></table><p>这些 <code>ClusterRole</code> 根据可执行的操作提供对 Monitoring CRD 的不同访问级别：</p><table><thead><tr><th>CRD (monitoring.coreos.com)</th><th>Admin</th><th>Edit</th><th>View</th></tr></thead><tbody><tr><td><ul><li><code>prometheuses</code></li><li><code>alertmanagers</code></li></ul></td><td>Get, List, Watch</td><td>Get, List, Watch</td><td>Get, List, Watch</td></tr><tr><td><ul><li><code>servicemonitors</code></li><li><code>podmonitors</code></li><li><code>prometheusrules</code></li></ul></td><td>*</td><td>*</td><td>Get, List, Watch</td></tr></tbody></table><p>在较高级别上，默认情况下会分配以下权限。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="具有-kubernetes-管理员编辑权限的用户">具有 Kubernetes 管理员/编辑权限的用户<a href="#具有-kubernetes-管理员编辑权限的用户" class="hash-link" aria-label="标题的直接链接" title="标题的直接链接">​</a></h3><p>只有具有 cluster-admin、admin 或 edit 的 <code>ClusterRole</code> 可以：</p><ul><li>通过 ServiceMonitor 和 PodMonitor CR 修改 Prometheus deployment 的抓取配置。</li><li>通过 PrometheusRules CR 修改 Prometheus deployment 的告警/记录规则。</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="具有-kubernetes-查看权限的用户">具有 Kubernetes 查看权限的用户<a href="#具有-kubernetes-查看权限的用户" class="hash-link" aria-label="标题的直接链接" title="标题的直接链接">​</a></h3><p>只有具有 Kubernetes <code>ClusterRole</code> 的用户可以：</p><ul><li>查看集群内部署的 Prometheuses 的配置。</li><li>查看集群内部署的 Alertmanagers 的配置。</li><li>通过 ServiceMonitor 和 PodMonitor CR 查看 Prometheus deployment 的抓取配置。</li><li>通过 PrometheusRules CR 查看 Prometheus deployment 的告警/记录规则。</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="其他监控角色">其他监控角色<a href="#其他监控角色" class="hash-link" aria-label="标题的直接链接" title="标题的直接链接">​</a></h3><p>Monitoring 还会创建其他 <code>Role</code>，这些角色默认情况下不会分配给用户，而是在集群中创建。你可以部署引用角色的 <code>RoleBinding</code> 来将角色绑定到命名空间。要使用 <code>kubectl</code> 而不是通过 Rancher 来定义 <code>RoleBinding</code>，请单击<a href="#%E4%BD%BF%E7%94%A8-kubectl-%E5%88%86%E9%85%8D-role-%E5%92%8C-clusterrole">此处</a>。</p><p>管理员应使用这些角色为用户提供更细粒度的访问权限：</p><table><thead><tr><th>角色</th><th>用途</th></tr></thead><tbody><tr><td>monitoring-config-admin</td><td>允许管理员为用户分配角色，以便查看/编辑 cattle-monitoring-system 命名空间中的 Secret 和 ConfigMap。修改此命名空间中的 Secret/ConfigMap 可以允许用户更改集群的 Alertmanager 配置、Prometheus Adapter 配置、其他 Grafana 数据源、TLS 密钥等。</td></tr><tr><td>monitoring-config-edit</td><td>允许管理员为用户分配角色，以便查看/编辑 cattle-monitoring-system 命名空间中的 Secret 和 ConfigMap。修改此命名空间中的 Secret/ConfigMap 可以允许用户更改集群的 Alertmanager 配置、Prometheus Adapter 配置、其他 Grafana 数据源、TLS 密钥等。</td></tr><tr><td>monitoring-config-view</td><td>允许管理员为用户分配角色，以便查看 cattle-monitoring-system 命名空间中的 Secret 和 ConfigMap。查看此命名空间中的 Secret/ConfigMap 可以允许用户观察集群的 Alertmanager 配置、Prometheus Adapter 配置、其他 Grafana 数据源、TLS 密钥等。</td></tr><tr><td>monitoring-dashboard-admin</td><td>允许管理员为用户分配角色，以便查看/编辑 cattle-dashboards 命名空间中的 ConfigMap。此命名空间中的 ConfigMap 将对应于持久化到集群上的 Grafana 仪表板。</td></tr><tr><td>monitoring-dashboard-edit</td><td>允许管理员为用户分配角色，以便查看/编辑 cattle-dashboards 命名空间中的 ConfigMap。此命名空间中的 ConfigMap 将对应于持久化到集群上的 Grafana 仪表板。</td></tr><tr><td>monitoring-dashboard-view</td><td>允许管理员为用户分配角色，以便查看 cattle-dashboards 命名空间中的 ConfigMap。此命名空间中的 ConfigMap 将对应于持久化到集群上的 Grafana 仪表板。</td></tr></tbody></table><h3 class="anchor anchorWithStickyNavbar_LWe7" id="通过自定义角色分配监控角色">通过自定义角色分配监控角色<a href="#通过自定义角色分配监控角色" class="hash-link" aria-label="标题的直接链接" title="标题的直接链接">​</a></h3><p>管理员可以在 Rancher UI 中分配自定义角色以管理、编辑和查看监控。这些“角色”是在安装 Monitoring 应用程序时默认创建的。此外，这些角色也会被部署到相应的 Kubernetes 角色：admin、edit 和 view <code>ClusterRoles</code>。</p><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>重要提示：</div><div class="admonitionContent_S0QG"><p>将用户添加到集群时，UI 不会提供 <code>monitoring-admin</code>、<code>monitoring-edit</code> 和 <code>monitoring-view</code> 选项。这些监控角色只能通过手动创建自定义角色来分配，该自定义角色继承 Project Owner 和 Project Monitoring View 角色。</p></div></div><ol><li><p>创建自定义角色：</p><p>1.1 单击 <strong>☰ &gt; Users &amp; Authentication &gt; Roles</strong>。</p><p>1.2 选择适当的选项卡，例如 <strong>Cluster</strong> 角色。然后单击 <strong>Create Cluster Role</strong>。</p><p>1.3 在 <strong>Name</strong> 字段中，创建自定义角色，例如 <code>View Monitoring</code>、<code>Edit Monitoring</code> 或 <code>Admin Monitoring</code>。</p><p>1.4 单击 <strong>Inherit From &gt; Add Resource</strong>，然后从下拉列表中选择所需的 Kubernetes 角色。</p><p>1.5 单击 <strong>Create</strong>。</p></li></ol><ol start="2"><li><p>将自定义角色分配给新用户：</p><p>2.1 单击 <strong>☰ &gt; Cluster Management &gt; Cluster Explore &gt; Cluster &gt; Cluster Members &gt; Add</strong>。</p><p>2.2 从显示的 <strong>Select Member</strong> 中搜索你的新用户名。</p><p>2.3 将 <strong>Cluster Permissions</strong> 中的新自定义角色分配给新用户。</p><p>2.4 单击 <strong>Create</strong>。</p></li></ol><p><strong>结果</strong>：新用户现在应该能够看到 monitoring 工具。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="其他监控集群角色">其他监控集群角色<a href="#其他监控集群角色" class="hash-link" aria-label="标题的直接链接" title="标题的直接链接">​</a></h3><p>Monitoring 还会创建其他 <code>ClusterRole</code>，这些角色默认情况下不会分配给用户，而是在集群中创建。默认情况下，这些角色不会聚合，但你可以部署引用角色的 <code>RoleBinding</code> 或 <code>ClusterRoleBinding</code> 来将角色绑定到命名空间。要使用 <code>kubectl</code> 而不是通过 Rancher 来定义 <code>RoleBinding</code>，请单击<a href="#%E4%BD%BF%E7%94%A8-kubectl-%E5%88%86%E9%85%8D-role-%E5%92%8C-clusterrole">此处</a>。</p><table><thead><tr><th>角色</th><th>用途</th></tr></thead><tbody><tr><td>monitoring-ui-view</td><td><a id="monitoring-ui-view"></a><em>从 Monitoring v2 14.5.100+ 开始可用</em>。通过授权用户列出 Prometheus、Alertmanager 和 Grafana 端点，并通过 Rancher 代理向 Prometheus、Grafana 和 Alertmanager UI 进行 GET 请求，来允许用户对外部 Monitoring UI 进行只读访问。</td></tr></tbody></table><h3 class="anchor anchorWithStickyNavbar_LWe7" id="使用-kubectl-分配-role-和-clusterrole">使用 kubectl 分配 Role 和 ClusterRole<a href="#使用-kubectl-分配-role-和-clusterrole" class="hash-link" aria-label="标题的直接链接" title="标题的直接链接">​</a></h3><p>使用 Rancher 将 <code>Role</code> 或 <code>ClusterRole</code> 附加到用户或组的另一种方法，是在你创建的 YAML 文件中定义绑定。你必须首先使用 YAML 文件配置 <code>RoleBinding</code>，然后运行 <code>kubectl apply</code> 命令来应用配置更改。</p><ul><li><strong>Role</strong>：以下 YAML 文件示例可帮助你在 Kubernetes 中配置 <code>RoleBinding</code>。你需要填写下方的 <code>name</code>（区分大小写）：</li></ul><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># monitoring-config-view-role-binding.yaml</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">apiVersion</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> rbac.authorization.k8s.io/v1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> RoleBinding</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> monitoring</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">config</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">view</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">namespace</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> cattle</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">monitoring</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">system</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">roleRef</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">kind</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> Role</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> monitoring</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">config</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">view</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">apiGroup</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> rbac.authorization.k8s.io</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">subjects</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">kind</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> User</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> u</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">b4qkhsnliz </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># this can be found via `kubectl get users -A`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">apiGroup</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> rbac.authorization.k8s.io</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li><p><strong>kubectl</strong>：以下 <code>kubectl</code> 示例命令用于应用 YAML 文件中创建的绑定。如前所述，你需要相应地填写你的 YAML 文件名。</p><ul><li><code>kubectl apply -f monitoring-config-view-role-binding.yaml</code></li></ul></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="具有-rancher-权限的用户">具有 Rancher 权限的用户<a href="#具有-rancher-权限的用户" class="hash-link" aria-label="标题的直接链接" title="标题的直接链接">​</a></h2><p>Rancher 部署的默认角色（即 cluster-owner、cluster-member、project-owner、project-member）、Kubernetes 默认角色，以及 rancher-monitoring Chart 部署的角色之间的关系如下：</p><figcaption>默认 Rancher 权限和对应的 Kubernetes ClusterRole</figcaption><table><thead><tr><th>Rancher 角色</th><th>Kubernetes 角色</th><th>Monitoring ClusterRole/Role</th><th>ClusterRoleBinding/RoleBinding</th></tr></thead><tbody><tr><td>cluster-owner</td><td>cluster-admin</td><td>N/A</td><td>ClusterRoleBinding</td></tr><tr><td>cluster-member</td><td>admin</td><td>monitoring-admin</td><td>ClusterRoleBinding</td></tr><tr><td>project-owner</td><td>admin</td><td>monitoring-admin</td><td>项目命名空间中的 RoleBinding</td></tr><tr><td>project-member</td><td>edit</td><td>monitoring-edit</td><td>项目命名空间中的 RoleBinding</td></tr></tbody></table><p>除这些默认角色之外，你还可以将以下的其他 Rancher 项目角色应用于集群成员，以提供对 Monitoring 的其他访问。这些 Rancher 角色将与 Monitoring Chart 部署的 ClusterRole 相关联：</p><figcaption>非默认的 Rancher 权限和对应的 Kubernetes ClusterRole</figcaption><table><thead><tr><th>Rancher 角色</th><th>Kubernetes ClusterRole</th><th>可用 Rancher 版本</th><th>可用 Monitoring V2 版本</th></tr></thead><tbody><tr><td>查看 Monitoring<!-- -->*</td><td><a href="#monitoring-ui-view">monitoring-ui-view</a></td><td>2.4.8+</td><td>9.4.204+</td></tr></tbody></table><p>*<!-- --> 如果某个用户绑定了 Rancher 的 <strong>View Monitoring</strong> 角色，该用户只有在有 UI 链接时才有权访问外部 Monitoring UI。要访问 Monitoring Pane 以获取这些链接，用户必须是至少一个项目的项目成员。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="25x-中的差异">2.5.x 中的差异<a href="#25x-中的差异" class="hash-link" aria-label="标题的直接链接" title="标题的直接链接">​</a></h3><p>在 Rancher 2.5.x 中，分配了 project-member 或 project-owner 角色的用户将无法访问 Prometheus 或 Grafana，因为我们仅在集群级别创建 Grafana 或 Prometheus。</p><p>此外，虽然 project-owner 仍然只能添加默认在项目命名空间内抓取资源的 ServiceMonitor/PodMonitor，但 PrometheusRule 并不局限于单个命名空间/项目。因此，即使 project-owner 无法查看/编辑/删除在项目命名空间之外创建的任何规则，project-owner 在其项目命名空间内创建的任何告警规则或记录规则都将应用于整个集群。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="分配其他访问权限">分配其他访问权限<a href="#分配其他访问权限" class="hash-link" aria-label="标题的直接链接" title="标题的直接链接">​</a></h3><p>如果 cluster-admin 想要为不具有 rancher-monitoring chart 角色的用户提供 admin/edit 访问权限，则存在下表的潜在影响：</p><table><thead><tr><th>CRD (monitoring.coreos.com)</th><th>是否会在命名空间/项目之外造成影响</th><th>影响</th></tr></thead><tbody><tr><td><code>prometheuses</code></td><td>是。该资源可以从整个集群中的任何目标中抓取指标（除非 Operator 本身进行了额外的配置）。</td><td>用户将能够定义应在集群中创建的新集群级 Prometheus deployment 的配置。</td></tr><tr><td><code>alertmanagers</code></td><td>否</td><td>用户将能够定义应在集群中创建的新集群级 Alertmanager deployment 的配置。注意：如果你只想允许用户配置路由和接收器等设置，你应该只提供对 Alertmanager Config Secret 的访问权限。</td></tr><tr><td><ul><li><code>servicemonitors</code></li><li><code>podmonitors</code></li></ul></td><td>否（默认）。可以通过 Prometheus CR 上的 <code>ignoreNamespaceSelectors</code> 进行配置。</td><td>用户将能够通过 Prometheus，在他们被授予此权限的命名空间内的 Service/Pod 暴露的端点上设置抓取。</td></tr><tr><td><code>prometheusrules</code></td><td>是。PrometheusRules 是集群范围的。</td><td>用户将能够根据在整个集群中收集的任何系列，在 Prometheus 上定义告警或记录规则。</td></tr></tbody></table><table><thead><tr><th>K8s 资源</th><th>命名空间</th><th>是否会在命名空间/项目之外造成影响</th><th>影响</th></tr></thead><tbody><tr><td><ul><li><code>secrets</code></li><li><code>configmaps</code></li></ul></td><td><code>cattle-monitoring-system</code></td><td>是。此命名空间中的 Config 和 Secret 会影响整个监控/告警流水线。</td><td>用户将能够创建或编辑 Secret/ ConfigMap，例如 Alertmanager Config、Prometheus Adapter 配置、TLS 密文、其他 Grafana 数据源等。这会对所有集群监控/告警产生广泛影响。</td></tr><tr><td><ul><li><code>secrets</code></li><li><code>configmaps</code></li></ul></td><td><code>cattle-dashboards</code></td><td>是。此命名空间中的 Config 和 Secret 可以创建仪表板，对在集群级别收集的所有指标进行查询。</td><td>用户将能够创建仅保留新 Grafana 仪表板的 Secret/ConfigMap。</td></tr></tbody></table><h2 class="anchor anchorWithStickyNavbar_LWe7" id="grafana-的-rbac">Grafana 的 RBAC<a href="#grafana-的-rbac" class="hash-link" aria-label="标题的直接链接" title="标题的直接链接">​</a></h2><p>对于经过 Kubernetes 认证并可以访问 Rancher Monitoring Chart 部署的 Grafana 服务的任何用户，Rancher 允许他们通过 Rancher Dashboard UI 访问 Grafana。默认情况下，所有能够访问 Grafana 的用户都被赋予 <a href="https://grafana.com/docs/grafana/latest/permissions/organization_roles/#viewer-role" target="_blank" rel="noopener noreferrer">Viewer</a> 角色，能查看 Rancher 部署的任何默认仪表板。</p><p>但是，如果有需要的话，用户可以选择以 <a href="https://grafana.com/docs/grafana/latest/permissions/organization_roles/#admin-role" target="_blank" rel="noopener noreferrer">Admin</a> 身份登录 Grafana。Grafana 实例的默认 Admin 用户名和密码是 <code>admin</code>/<code>prom-operator</code>，但你也可以在部署或升级 Chart 时替换凭证。</p><p>要查看 Grafana UI，请安装 <code>rancher-monitoring</code>。然后：</p><ol><li>在左上角，单击 <strong>☰ &gt; 集群管理</strong>。</li><li>在<strong>集群</strong>页面上，转到要可视化的集群，然后单击 <strong>Explore</strong>。</li><li>在左侧导航栏中，单击<strong>监控</strong>。</li><li>点击 <strong>Grafana</strong>。</li></ol><figcaption>Grafana 中的集群计算资源仪表板</figcaption><p><img loading="lazy" alt="Grafana 中的集群计算资源仪表板" src="/zh/assets/images/cluster-compute-resources-dashboard-025b46a16d139fbae87db2a94461b808.png" width="2234" height="1718" class="img_ev3q"></p><figcaption>Grafana 中的默认仪表板</figcaption><p><img loading="lazy" alt="Grafana 中的默认仪表板" src="/zh/assets/images/grafana-default-dashboard-957af33a50c22962b8accddd50b2a85e.png" width="1305" height="1106" class="img_ev3q"></p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/rancher/rancher-docs/edit/main/docs/integrations-in-rancher/monitoring-and-alerting/rbac-for-monitoring.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>编辑此页</a></div><div class="col lastUpdated_vwxv"><span class="theme-last-updated">最后<!-- -->于 <b><time datetime="2022-11-23T06:39:30.000Z">2022年11月23日</time></b> <!-- -->更新</span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="文档分页导航"><a class="pagination-nav__link pagination-nav__link--prev" href="/zh/integrations-in-rancher/monitoring-and-alerting/how-monitoring-works"><div class="pagination-nav__sublabel">上一页</div><div class="pagination-nav__label">Monitoring 的工作原理</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/zh/integrations-in-rancher/monitoring-and-alerting/built-in-dashboards"><div class="pagination-nav__sublabel">下一页</div><div class="pagination-nav__label">内置仪表板</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#集群管理员" class="table-of-contents__link toc-highlight">集群管理员</a></li><li><a href="#具有基于-kubernetes-clusterrole-权限的用户" class="table-of-contents__link toc-highlight">具有基于 Kubernetes ClusterRole 权限的用户</a><ul><li><a href="#具有-kubernetes-管理员编辑权限的用户" class="table-of-contents__link toc-highlight">具有 Kubernetes 管理员/编辑权限的用户</a></li><li><a href="#具有-kubernetes-查看权限的用户" class="table-of-contents__link toc-highlight">具有 Kubernetes 查看权限的用户</a></li><li><a href="#其他监控角色" class="table-of-contents__link toc-highlight">其他监控角色</a></li><li><a href="#通过自定义角色分配监控角色" class="table-of-contents__link toc-highlight">通过自定义角色分配监控角色</a></li><li><a href="#其他监控集群角色" class="table-of-contents__link toc-highlight">其他监控集群角色</a></li><li><a href="#使用-kubectl-分配-role-和-clusterrole" class="table-of-contents__link toc-highlight">使用 kubectl 分配 Role 和 ClusterRole</a></li></ul></li><li><a href="#具有-rancher-权限的用户" class="table-of-contents__link toc-highlight">具有 Rancher 权限的用户</a><ul><li><a href="#25x-中的差异" class="table-of-contents__link toc-highlight">2.5.x 中的差异</a></li><li><a href="#分配其他访问权限" class="table-of-contents__link toc-highlight">分配其他访问权限</a></li></ul></li><li><a href="#grafana-的-rbac" class="table-of-contents__link toc-highlight">Grafana 的 RBAC</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2022 SUSE Rancher. All Rights Reserved.</div></div></div></footer></div>
<script src="/zh/assets/js/runtime~main.2f000545.js"></script>
<script src="/zh/assets/js/main.02ca8a94.js"></script>
</body>
</html>