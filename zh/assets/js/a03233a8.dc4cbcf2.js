"use strict";(self.webpackChunkrancher_docs=self.webpackChunkrancher_docs||[]).push([[10601],{3905:(e,t,r)=>{r.d(t,{Zo:()=>u,kt:()=>d});var n=r(67294);function a(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function s(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function l(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?s(Object(r),!0).forEach((function(t){a(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):s(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function i(e,t){if(null==e)return{};var r,n,a=function(e,t){if(null==e)return{};var r,n,a={},s=Object.keys(e);for(n=0;n<s.length;n++)r=s[n],t.indexOf(r)>=0||(a[r]=e[r]);return a}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(n=0;n<s.length;n++)r=s[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(a[r]=e[r])}return a}var o=n.createContext({}),c=function(e){var t=n.useContext(o),r=t;return e&&(r="function"==typeof e?e(t):l(l({},t),e)),r},u=function(e){var t=c(e.components);return n.createElement(o.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},k=n.forwardRef((function(e,t){var r=e.components,a=e.mdxType,s=e.originalType,o=e.parentName,u=i(e,["components","mdxType","originalType","parentName"]),k=c(r),d=a,m=k["".concat(o,".").concat(d)]||k[d]||p[d]||s;return r?n.createElement(m,l(l({ref:t},u),{},{components:r})):n.createElement(m,l({ref:t},u))}));function d(e,t){var r=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var s=r.length,l=new Array(s);l[0]=k;var i={};for(var o in t)hasOwnProperty.call(t,o)&&(i[o]=t[o]);i.originalType=e,i.mdxType="string"==typeof e?e:a,l[1]=i;for(var c=2;c<s;c++)l[c]=r[c];return n.createElement.apply(null,l)}return n.createElement.apply(null,r)}k.displayName="MDXCreateElement"},65704:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>o,contentTitle:()=>l,default:()=>p,frontMatter:()=>s,metadata:()=>i,toc:()=>c});var n=r(87462),a=(r(67294),r(3905));const s={title:"RKE CIS 1.6 Benchmark - \u81ea\u6211\u8bc4\u4f30\u6307\u5357 - Rancher 2.6"},l=void 0,i={unversionedId:"reference-guides/rancher-security/rancher-v2.6-hardening-guides/rke1-self-assessment-guide-with-cis-v1.6-benchmark",id:"version-2.6/reference-guides/rancher-security/rancher-v2.6-hardening-guides/rke1-self-assessment-guide-with-cis-v1.6-benchmark",title:"RKE CIS 1.6 Benchmark - \u81ea\u6211\u8bc4\u4f30\u6307\u5357 - Rancher 2.6",description:"RKE CIS 1.6 Kubernetes Benchmark - Rancher 2.6 \u4e0e Kubernetes 1.18 \u5230 1.23",source:"@site/i18n/zh/docusaurus-plugin-content-docs/version-2.6/reference-guides/rancher-security/rancher-v2.6-hardening-guides/rke1-self-assessment-guide-with-cis-v1.6-benchmark.md",sourceDirName:"reference-guides/rancher-security/rancher-v2.6-hardening-guides",slug:"/reference-guides/rancher-security/rancher-v2.6-hardening-guides/rke1-self-assessment-guide-with-cis-v1.6-benchmark",permalink:"/zh/v2.6/reference-guides/rancher-security/rancher-v2.6-hardening-guides/rke1-self-assessment-guide-with-cis-v1.6-benchmark",draft:!1,editUrl:"https://github.com/rancher/rancher-docs/edit/main/versioned_docs/version-2.6/reference-guides/rancher-security/rancher-v2.6-hardening-guides/rke1-self-assessment-guide-with-cis-v1.6-benchmark.md",tags:[],version:"2.6",lastUpdatedAt:1668452187,formattedLastUpdatedAt:"2022\u5e7411\u670814\u65e5",frontMatter:{title:"RKE CIS 1.6 Benchmark - \u81ea\u6211\u8bc4\u4f30\u6307\u5357 - Rancher 2.6"},sidebar:"tutorialSidebar",previous:{title:"\u4f7f\u7528 CIS 1.6 Benchmark \u7684 RKE \u5f3a\u5316\u6307\u5357",permalink:"/zh/v2.6/reference-guides/rancher-security/rancher-v2.6-hardening-guides/rke1-hardening-guide-with-cis-v1.6-benchmark"},next:{title:"\u4f7f\u7528 CIS 1.6 Benchmark \u7684 RKE2 \u5f3a\u5316\u6307\u5357",permalink:"/zh/v2.6/reference-guides/rancher-security/rancher-v2.6-hardening-guides/rke2-hardening-guide-with-cis-v1.6-benchmark"}},o={},c=[{value:"RKE CIS 1.6 Kubernetes Benchmark - Rancher 2.6 \u4e0e Kubernetes 1.18 \u5230 1.23",id:"rke-cis-16-kubernetes-benchmark---rancher-26-\u4e0e-kubernetes-118-\u5230-123",level:3},{value:"\u6982\u8ff0",id:"\u6982\u8ff0",level:4},{value:"\u6d4b\u8bd5\u7ba1\u63a7\u65b9\u6cd5",id:"\u6d4b\u8bd5\u7ba1\u63a7\u65b9\u6cd5",level:4},{value:"\u7ba1\u63a7",id:"\u7ba1\u63a7",level:3},{value:"1.1Master \u8282\u70b9\u914d\u7f6e\u6587\u4ef6",id:"11master-\u8282\u70b9\u914d\u7f6e\u6587\u4ef6",level:2},{value:"1.1.1\u786e\u4fdd API Server pod \u89c4\u8303\u6587\u4ef6\u6743\u9650\u5177\u6709 644 \u6216\u66f4\u4e25\u683c\u7684\u8bbe\u7f6e\uff08\u81ea\u52a8\uff09",id:"111\u786e\u4fdd-api-server-pod-\u89c4\u8303\u6587\u4ef6\u6743\u9650\u5177\u6709-644-\u6216\u66f4\u4e25\u683c\u7684\u8bbe\u7f6e\u81ea\u52a8",level:3},{value:"1.1.2\u786e\u4fdd API Server pod \u89c4\u8303\u6587\u4ef6\u6240\u6709\u6743\u8bbe\u7f6e\u4e3a root:root\uff08\u81ea\u52a8\uff09",id:"112\u786e\u4fdd-api-server-pod-\u89c4\u8303\u6587\u4ef6\u6240\u6709\u6743\u8bbe\u7f6e\u4e3a-rootroot\u81ea\u52a8",level:3},{value:"1.1.3\u786e\u4fdd Controller Manager pod \u89c4\u8303\u6587\u4ef6\u6743\u9650\u5177\u6709 644 \u6216\u66f4\u4e25\u683c\u7684\u8bbe\u7f6e\uff08\u81ea\u52a8\uff09",id:"113\u786e\u4fdd-controller-manager-pod-\u89c4\u8303\u6587\u4ef6\u6743\u9650\u5177\u6709-644-\u6216\u66f4\u4e25\u683c\u7684\u8bbe\u7f6e\u81ea\u52a8",level:3},{value:"1.1.4\u786e\u4fdd Controller Manager pod \u89c4\u8303\u6587\u4ef6\u6240\u6709\u6743\u8bbe\u7f6e\u4e3a root:root\uff08\u81ea\u52a8\uff09",id:"114\u786e\u4fdd-controller-manager-pod-\u89c4\u8303\u6587\u4ef6\u6240\u6709\u6743\u8bbe\u7f6e\u4e3a-rootroot\u81ea\u52a8",level:3},{value:"1.1.5\u786e\u4fdd Scheduler pod \u89c4\u8303\u6587\u4ef6\u6743\u9650\u5177\u6709 644 \u6216\u66f4\u4e25\u683c\u7684\u8bbe\u7f6e\uff08\u81ea\u52a8\uff09",id:"115\u786e\u4fdd-scheduler-pod-\u89c4\u8303\u6587\u4ef6\u6743\u9650\u5177\u6709-644-\u6216\u66f4\u4e25\u683c\u7684\u8bbe\u7f6e\u81ea\u52a8",level:3},{value:"1.1.6\u786e\u4fdd Scheduler pod \u89c4\u8303\u6587\u4ef6\u6240\u6709\u6743\u8bbe\u7f6e\u4e3a root:root\uff08\u81ea\u52a8\uff09",id:"116\u786e\u4fdd-scheduler-pod-\u89c4\u8303\u6587\u4ef6\u6240\u6709\u6743\u8bbe\u7f6e\u4e3a-rootroot\u81ea\u52a8",level:3},{value:"1.1.7\u786e\u4fdd etcd pod \u89c4\u8303\u6587\u4ef6\u6743\u9650\u5177\u6709 644 \u6216\u66f4\u4e25\u683c\u7684\u8bbe\u7f6e\uff08\u81ea\u52a8\uff09",id:"117\u786e\u4fdd-etcd-pod-\u89c4\u8303\u6587\u4ef6\u6743\u9650\u5177\u6709-644-\u6216\u66f4\u4e25\u683c\u7684\u8bbe\u7f6e\u81ea\u52a8",level:3},{value:"1.1.8\u786e\u4fdd etcd pod \u89c4\u8303\u6587\u4ef6\u6240\u6709\u6743\u8bbe\u7f6e\u4e3a root:root\uff08\u81ea\u52a8\uff09",id:"118\u786e\u4fdd-etcd-pod-\u89c4\u8303\u6587\u4ef6\u6240\u6709\u6743\u8bbe\u7f6e\u4e3a-rootroot\u81ea\u52a8",level:3},{value:"1.1.9\u786e\u4fdd\u5bb9\u5668\u7f51\u7edc\u63a5\u53e3\u6587\u4ef6\u6743\u9650\u8bbe\u7f6e\u4e3a 644 \u6216\u66f4\u4e25\u683c\u7684\u8bbe\u7f6e\uff08\u624b\u52a8\uff09",id:"119\u786e\u4fdd\u5bb9\u5668\u7f51\u7edc\u63a5\u53e3\u6587\u4ef6\u6743\u9650\u8bbe\u7f6e\u4e3a-644-\u6216\u66f4\u4e25\u683c\u7684\u8bbe\u7f6e\u624b\u52a8",level:3},{value:"1.1.10\u786e\u4fdd\u5bb9\u5668\u7f51\u7edc\u63a5\u53e3\u6587\u4ef6\u6240\u6709\u6743\u8bbe\u7f6e\u4e3a root:root\uff08\u624b\u52a8\uff09",id:"1110\u786e\u4fdd\u5bb9\u5668\u7f51\u7edc\u63a5\u53e3\u6587\u4ef6\u6240\u6709\u6743\u8bbe\u7f6e\u4e3a-rootroot\u624b\u52a8",level:3},{value:"1.1.11\u786e\u4fdd etcd \u6570\u636e\u76ee\u5f55\u6743\u9650\u8bbe\u7f6e\u4e3a 700 \u6216\u66f4\u4e25\u683c\u7684\u8bbe\u7f6e\uff08\u81ea\u52a8\uff09",id:"1111\u786e\u4fdd-etcd-\u6570\u636e\u76ee\u5f55\u6743\u9650\u8bbe\u7f6e\u4e3a-700-\u6216\u66f4\u4e25\u683c\u7684\u8bbe\u7f6e\u81ea\u52a8",level:3},{value:"1.1.12\u786e\u4fdd etcd \u6570\u636e\u76ee\u5f55\u6240\u6709\u6743\u8bbe\u7f6e\u4e3a etcd:etcd\uff08\u81ea\u52a8\uff09",id:"1112\u786e\u4fdd-etcd-\u6570\u636e\u76ee\u5f55\u6240\u6709\u6743\u8bbe\u7f6e\u4e3a-etcdetcd\u81ea\u52a8",level:3},{value:"1.1.13\u786e\u4fdd admin.conf \u6587\u4ef6\u6743\u9650\u5177\u6709 644 \u6216\u66f4\u4e25\u683c\u7684\u8bbe\u7f6e\uff08\u81ea\u52a8\uff09",id:"1113\u786e\u4fdd-adminconf-\u6587\u4ef6\u6743\u9650\u5177\u6709-644-\u6216\u66f4\u4e25\u683c\u7684\u8bbe\u7f6e\u81ea\u52a8",level:3},{value:"1.1.14\u786e\u4fdd admin.conf \u6587\u4ef6\u6240\u6709\u6743\u8bbe\u7f6e\u4e3a root:root\uff08\u81ea\u52a8\uff09",id:"1114\u786e\u4fdd-adminconf-\u6587\u4ef6\u6240\u6709\u6743\u8bbe\u7f6e\u4e3a-rootroot\u81ea\u52a8",level:3},{value:"1.1.15\u786e\u4fdd scheduler.conf \u6587\u4ef6\u6743\u9650\u5177\u6709 644 \u6216\u66f4\u4e25\u683c\u7684\u8bbe\u7f6e\uff08\u81ea\u52a8\uff09",id:"1115\u786e\u4fdd-schedulerconf-\u6587\u4ef6\u6743\u9650\u5177\u6709-644-\u6216\u66f4\u4e25\u683c\u7684\u8bbe\u7f6e\u81ea\u52a8",level:3},{value:"1.1.16\u786e\u4fdd scheduler.conf \u6587\u4ef6\u6240\u6709\u6743\u8bbe\u7f6e\u4e3a root:root\uff08\u81ea\u52a8\uff09",id:"1116\u786e\u4fdd-schedulerconf-\u6587\u4ef6\u6240\u6709\u6743\u8bbe\u7f6e\u4e3a-rootroot\u81ea\u52a8",level:3},{value:"1.1.17\u786e\u4fdd controller-manager.conf \u6587\u4ef6\u6743\u9650\u5177\u6709 644 \u6216\u66f4\u4e25\u683c\u7684\u8bbe\u7f6e\uff08\u81ea\u52a8\uff09",id:"1117\u786e\u4fdd-controller-managerconf-\u6587\u4ef6\u6743\u9650\u5177\u6709-644-\u6216\u66f4\u4e25\u683c\u7684\u8bbe\u7f6e\u81ea\u52a8",level:3},{value:"1.1.18\u786e\u4fdd\u5c06 controller-manager.conf \u6587\u4ef6\u6240\u6709\u6743\u8bbe\u7f6e\u4e3a root:root\uff08\u81ea\u52a8\uff09",id:"1118\u786e\u4fdd\u5c06-controller-managerconf-\u6587\u4ef6\u6240\u6709\u6743\u8bbe\u7f6e\u4e3a-rootroot\u81ea\u52a8",level:3},{value:"1.1.19\u786e\u4fdd Kubernetes PKI \u76ee\u5f55\u548c\u6587\u4ef6\u6240\u6709\u6743\u8bbe\u7f6e\u4e3a root:root\uff08\u81ea\u52a8\uff09",id:"1119\u786e\u4fdd-kubernetes-pki-\u76ee\u5f55\u548c\u6587\u4ef6\u6240\u6709\u6743\u8bbe\u7f6e\u4e3a-rootroot\u81ea\u52a8",level:3},{value:"1.1.20\u786e\u4fdd\u5c06 Kubernetes PKI \u8bc1\u4e66\u6587\u4ef6\u6743\u9650\u8bbe\u7f6e\u4e3a 644 \u6216\u66f4\u4e25\u683c\u7684\u8bbe\u7f6e\uff08\u81ea\u52a8\uff09",id:"1120\u786e\u4fdd\u5c06-kubernetes-pki-\u8bc1\u4e66\u6587\u4ef6\u6743\u9650\u8bbe\u7f6e\u4e3a-644-\u6216\u66f4\u4e25\u683c\u7684\u8bbe\u7f6e\u81ea\u52a8",level:3},{value:"1.1.21\u786e\u4fdd Kubernetes PKI \u5bc6\u94a5\u6587\u4ef6\u6743\u9650\u8bbe\u7f6e\u4e3a 600\uff08\u81ea\u52a8\uff09",id:"1121\u786e\u4fdd-kubernetes-pki-\u5bc6\u94a5\u6587\u4ef6\u6743\u9650\u8bbe\u7f6e\u4e3a-600\u81ea\u52a8",level:3},{value:"1.2API Server",id:"12api-server",level:2},{value:"1.2.1\u786e\u4fdd --anonymous-auth \u53c2\u6570\u8bbe\u7f6e\u4e3a false\uff08\u81ea\u52a8\uff09",id:"121\u786e\u4fdd---anonymous-auth-\u53c2\u6570\u8bbe\u7f6e\u4e3a-false\u81ea\u52a8",level:3},{value:"1.2.2\u786e\u4fdd\u672a\u8bbe\u7f6e --basic-auth-file \u53c2\u6570\uff08\u81ea\u52a8\uff09",id:"122\u786e\u4fdd\u672a\u8bbe\u7f6e---basic-auth-file-\u53c2\u6570\u81ea\u52a8",level:3},{value:"1.2.3\u786e\u4fdd\u672a\u8bbe\u7f6e --token-auth-file \u53c2\u6570\uff08\u81ea\u52a8\uff09",id:"123\u786e\u4fdd\u672a\u8bbe\u7f6e---token-auth-file-\u53c2\u6570\u81ea\u52a8",level:3},{value:"1.2.4\u786e\u4fdd --kubelet-https \u53c2\u6570\u8bbe\u7f6e\u4e3a true\uff08\u81ea\u52a8\uff09",id:"124\u786e\u4fdd---kubelet-https-\u53c2\u6570\u8bbe\u7f6e\u4e3a-true\u81ea\u52a8",level:3},{value:"1.2.5\u786e\u4fdd\u6b63\u786e\u8bbe\u7f6e\u4e86 --kubelet-client-certificate \u548c --kubelet-client-key \u53c2\u6570\uff08\u81ea\u52a8\uff09",id:"125\u786e\u4fdd\u6b63\u786e\u8bbe\u7f6e\u4e86---kubelet-client-certificate-\u548c---kubelet-client-key-\u53c2\u6570\u81ea\u52a8",level:3},{value:"1.2.6\u786e\u4fdd\u6839\u636e\u9700\u8981\u8bbe\u7f6e --kubelet-certificate-authority \u53c2\u6570\uff08\u81ea\u52a8\uff09",id:"126\u786e\u4fdd\u6839\u636e\u9700\u8981\u8bbe\u7f6e---kubelet-certificate-authority-\u53c2\u6570\u81ea\u52a8",level:3},{value:"1.2.7\u786e\u4fdd --authorization-mode \u53c2\u6570\u672a\u8bbe\u7f6e\u4e3a AlwaysAllow\uff08\u81ea\u52a8\uff09",id:"127\u786e\u4fdd---authorization-mode-\u53c2\u6570\u672a\u8bbe\u7f6e\u4e3a-alwaysallow\u81ea\u52a8",level:3},{value:"1.2.8\u786e\u4fdd --authorization-mode \u53c2\u6570\u5305\u62ec Node\uff08\u81ea\u52a8\uff09",id:"128\u786e\u4fdd---authorization-mode-\u53c2\u6570\u5305\u62ec-node\u81ea\u52a8",level:3},{value:"1.2.9\u786e\u4fdd --authorization-mode \u53c2\u6570\u5305\u62ec RBAC\uff08\u81ea\u52a8\uff09",id:"129\u786e\u4fdd---authorization-mode-\u53c2\u6570\u5305\u62ec-rbac\u81ea\u52a8",level:3},{value:"1.2.10\u786e\u4fdd\u8bbe\u7f6e\u4e86\u51c6\u5165\u63a7\u5236\u63d2\u4ef6 EventRateLimit\uff08\u81ea\u52a8\uff09",id:"1210\u786e\u4fdd\u8bbe\u7f6e\u4e86\u51c6\u5165\u63a7\u5236\u63d2\u4ef6-eventratelimit\u81ea\u52a8",level:3},{value:"1.2.11\u786e\u4fdd\u672a\u8bbe\u7f6e\u51c6\u5165\u63a7\u5236\u63d2\u4ef6 AlwaysAdmit\uff08\u81ea\u52a8\uff09",id:"1211\u786e\u4fdd\u672a\u8bbe\u7f6e\u51c6\u5165\u63a7\u5236\u63d2\u4ef6-alwaysadmit\u81ea\u52a8",level:3},{value:"1.2.12\u786e\u4fdd\u8bbe\u7f6e\u4e86\u51c6\u5165\u63a7\u5236\u63d2\u4ef6 AlwaysPullImages\uff08\u624b\u52a8\uff09",id:"1212\u786e\u4fdd\u8bbe\u7f6e\u4e86\u51c6\u5165\u63a7\u5236\u63d2\u4ef6-alwayspullimages\u624b\u52a8",level:3},{value:"1.2.13\u5982\u679c\u6ca1\u6709\u4f7f\u7528 PodSecurityPolicy\uff0c\u8bf7\u786e\u4fdd\u8bbe\u7f6e\u4e86\u51c6\u5165\u63a7\u5236\u63d2\u4ef6 SecurityContextDeny\uff08\u624b\u52a8\uff09",id:"1213\u5982\u679c\u6ca1\u6709\u4f7f\u7528-podsecuritypolicy\u8bf7\u786e\u4fdd\u8bbe\u7f6e\u4e86\u51c6\u5165\u63a7\u5236\u63d2\u4ef6-securitycontextdeny\u624b\u52a8",level:3},{value:"1.2.14\u786e\u4fdd\u8bbe\u7f6e\u4e86\u51c6\u5165\u63a7\u5236\u63d2\u4ef6 ServiceAccount\uff08\u81ea\u52a8\uff09",id:"1214\u786e\u4fdd\u8bbe\u7f6e\u4e86\u51c6\u5165\u63a7\u5236\u63d2\u4ef6-serviceaccount\u81ea\u52a8",level:3},{value:"1.2.15\u786e\u4fdd\u8bbe\u7f6e\u4e86\u51c6\u5165\u63a7\u5236\u63d2\u4ef6 NamespaceLifecycle\uff08\u81ea\u52a8\uff09",id:"1215\u786e\u4fdd\u8bbe\u7f6e\u4e86\u51c6\u5165\u63a7\u5236\u63d2\u4ef6-namespacelifecycle\u81ea\u52a8",level:3},{value:"1.2.16\u786e\u4fdd\u8bbe\u7f6e\u4e86\u51c6\u5165\u63a7\u5236\u63d2\u4ef6 PodSecurityPolicy\uff08\u81ea\u52a8\uff09",id:"1216\u786e\u4fdd\u8bbe\u7f6e\u4e86\u51c6\u5165\u63a7\u5236\u63d2\u4ef6-podsecuritypolicy\u81ea\u52a8",level:3},{value:"1.2.17\u786e\u4fdd\u8bbe\u7f6e\u4e86\u51c6\u5165\u63a7\u5236\u63d2\u4ef6 NodeRestriction\uff08\u81ea\u52a8\uff09",id:"1217\u786e\u4fdd\u8bbe\u7f6e\u4e86\u51c6\u5165\u63a7\u5236\u63d2\u4ef6-noderestriction\u81ea\u52a8",level:3},{value:"1.2.18\u786e\u4fdd\u672a\u8bbe\u7f6e --insecure-bind-address \u53c2\u6570\uff08\u81ea\u52a8\uff09",id:"1218\u786e\u4fdd\u672a\u8bbe\u7f6e---insecure-bind-address-\u53c2\u6570\u81ea\u52a8",level:3},{value:"1.2.19\u786e\u4fdd --insecure-port \u53c2\u6570\u8bbe\u7f6e\u4e3a 0\uff08\u81ea\u52a8\uff09",id:"1219\u786e\u4fdd---insecure-port-\u53c2\u6570\u8bbe\u7f6e\u4e3a-0\u81ea\u52a8",level:3},{value:"1.2.20\u786e\u4fdd --secure-port \u53c2\u6570\u672a\u8bbe\u7f6e\u4e3a 0\uff08\u81ea\u52a8\uff09",id:"1220\u786e\u4fdd---secure-port-\u53c2\u6570\u672a\u8bbe\u7f6e\u4e3a-0\u81ea\u52a8",level:3},{value:"1.2.21\u786e\u4fdd --profiling \u53c2\u6570\u8bbe\u7f6e\u4e3a false\uff08\u81ea\u52a8\uff09",id:"1221\u786e\u4fdd---profiling-\u53c2\u6570\u8bbe\u7f6e\u4e3a-false\u81ea\u52a8",level:3},{value:"1.2.22\u786e\u4fdd\u8bbe\u7f6e\u4e86 --audit-log-path \u53c2\u6570\uff08\u81ea\u52a8\uff09",id:"1222\u786e\u4fdd\u8bbe\u7f6e\u4e86---audit-log-path-\u53c2\u6570\u81ea\u52a8",level:3},{value:"1.2.23\u786e\u4fdd\u5c06 --audit-log-maxage \u53c2\u6570\u8bbe\u7f6e\u4e3a 30 \u6216\u9002\u5f53\u7684\u6570\u503c\uff08\u81ea\u52a8\uff09",id:"1223\u786e\u4fdd\u5c06---audit-log-maxage-\u53c2\u6570\u8bbe\u7f6e\u4e3a-30-\u6216\u9002\u5f53\u7684\u6570\u503c\u81ea\u52a8",level:3},{value:"1.2.24\u786e\u4fdd --audit-log-maxbackup \u53c2\u6570\u8bbe\u7f6e\u4e3a 10 \u6216\u9002\u5f53\u7684\u6570\u503c\uff08\u81ea\u52a8\uff09",id:"1224\u786e\u4fdd---audit-log-maxbackup-\u53c2\u6570\u8bbe\u7f6e\u4e3a-10-\u6216\u9002\u5f53\u7684\u6570\u503c\u81ea\u52a8",level:3},{value:"1.2.25\u786e\u4fdd --audit-log-maxsize \u53c2\u6570\u8bbe\u7f6e\u4e3a 100 \u6216\u9002\u5f53\u7684\u6570\u503c\uff08\u81ea\u52a8\uff09",id:"1225\u786e\u4fdd---audit-log-maxsize-\u53c2\u6570\u8bbe\u7f6e\u4e3a-100-\u6216\u9002\u5f53\u7684\u6570\u503c\u81ea\u52a8",level:3},{value:"1.2.26\u786e\u4fdd\u80fd\u6839\u636e\u9700\u8981\u8bbe\u7f6e --request-timeout \u53c2\u6570\uff08\u81ea\u52a8\uff09",id:"1226\u786e\u4fdd\u80fd\u6839\u636e\u9700\u8981\u8bbe\u7f6e---request-timeout-\u53c2\u6570\u81ea\u52a8",level:3},{value:"1.2.27\u786e\u4fdd --service-account-lookup \u53c2\u6570\u8bbe\u7f6e\u4e3a true\uff08\u81ea\u52a8\uff09",id:"1227\u786e\u4fdd---service-account-lookup-\u53c2\u6570\u8bbe\u7f6e\u4e3a-true\u81ea\u52a8",level:3},{value:"1.2.28\u786e\u4fdd\u6839\u636e\u9700\u8981\u8bbe\u7f6e --service-account-key-file \u53c2\u6570\uff08\u81ea\u52a8\uff09",id:"1228\u786e\u4fdd\u6839\u636e\u9700\u8981\u8bbe\u7f6e---service-account-key-file-\u53c2\u6570\u81ea\u52a8",level:3},{value:"1.2.29\u786e\u4fdd\u6839\u636e\u9700\u8981\u8bbe\u7f6e --etcd-certfile \u548c --etcd-keyfile \u53c2\u6570\uff08\u81ea\u52a8\uff09",id:"1229\u786e\u4fdd\u6839\u636e\u9700\u8981\u8bbe\u7f6e---etcd-certfile-\u548c---etcd-keyfile-\u53c2\u6570\u81ea\u52a8",level:3},{value:"1.2.30\u786e\u4fdd\u6839\u636e\u9700\u8981\u8bbe\u7f6e --tls-cert-file \u548c --tls-private-key-file \u53c2\u6570\uff08\u81ea\u52a8\uff09",id:"1230\u786e\u4fdd\u6839\u636e\u9700\u8981\u8bbe\u7f6e---tls-cert-file-\u548c---tls-private-key-file-\u53c2\u6570\u81ea\u52a8",level:3},{value:"1.2.31\u786e\u4fdd\u6839\u636e\u9700\u8981\u8bbe\u7f6e --client-ca-file \u53c2\u6570\uff08\u81ea\u52a8\uff09",id:"1231\u786e\u4fdd\u6839\u636e\u9700\u8981\u8bbe\u7f6e---client-ca-file-\u53c2\u6570\u81ea\u52a8",level:3},{value:"1.2.32\u786e\u4fdd --etcd-cafile \u53c2\u6570\u8bbe\u7f6e\u6b63\u786e\uff08\u81ea\u52a8\uff09",id:"1232\u786e\u4fdd---etcd-cafile-\u53c2\u6570\u8bbe\u7f6e\u6b63\u786e\u81ea\u52a8",level:3},{value:"1.2.33\u786e\u4fdd\u6839\u636e\u9700\u8981\u8bbe\u7f6e --encryption-provider-config \u53c2\u6570\uff08\u81ea\u52a8\uff09",id:"1233\u786e\u4fdd\u6839\u636e\u9700\u8981\u8bbe\u7f6e---encryption-provider-config-\u53c2\u6570\u81ea\u52a8",level:3},{value:"1.2.34\u786e\u4fdd\u6b63\u786e\u914d\u7f6e\u52a0\u5bc6\u63d0\u4f9b\u7a0b\u5e8f\uff08\u81ea\u52a8\uff09",id:"1234\u786e\u4fdd\u6b63\u786e\u914d\u7f6e\u52a0\u5bc6\u63d0\u4f9b\u7a0b\u5e8f\u81ea\u52a8",level:3},{value:"1.2.35\u786e\u4fdd API Server \u4ec5\u4f7f\u7528\u5f3a\u5bc6\u7801\uff08\u81ea\u52a8\uff09",id:"1235\u786e\u4fdd-api-server-\u4ec5\u4f7f\u7528\u5f3a\u5bc6\u7801\u81ea\u52a8",level:3},{value:"1.3Controller Manager",id:"13controller-manager",level:2},{value:"1.3.1\u786e\u4fdd\u6b63\u786e\u8bbe\u7f6e --terminated-pod-gc-threshold \u53c2\u6570\uff08\u81ea\u52a8\uff09",id:"131\u786e\u4fdd\u6b63\u786e\u8bbe\u7f6e---terminated-pod-gc-threshold-\u53c2\u6570\u81ea\u52a8",level:3},{value:"1.3.2\u786e\u4fdd --profiling \u53c2\u6570\u8bbe\u7f6e\u4e3a false\uff08\u81ea\u52a8\uff09",id:"132\u786e\u4fdd---profiling-\u53c2\u6570\u8bbe\u7f6e\u4e3a-false\u81ea\u52a8",level:3},{value:"1.3.3\u786e\u4fdd --use-service-account-credentials \u53c2\u6570\u8bbe\u7f6e\u4e3a true\uff08\u81ea\u52a8\uff09",id:"133\u786e\u4fdd---use-service-account-credentials-\u53c2\u6570\u8bbe\u7f6e\u4e3a-true\u81ea\u52a8",level:3},{value:"1.3.4\u786e\u4fdd\u6839\u636e\u9700\u8981\u8bbe\u7f6e --service-account-private-key-file \u53c2\u6570\uff08\u81ea\u52a8\uff09",id:"134\u786e\u4fdd\u6839\u636e\u9700\u8981\u8bbe\u7f6e---service-account-private-key-file-\u53c2\u6570\u81ea\u52a8",level:3},{value:"1.3.5\u786e\u4fdd\u6839\u636e\u9700\u8981\u8bbe\u7f6e --root-ca-file \u53c2\u6570\uff08\u81ea\u52a8\uff09",id:"135\u786e\u4fdd\u6839\u636e\u9700\u8981\u8bbe\u7f6e---root-ca-file-\u53c2\u6570\u81ea\u52a8",level:3},{value:"1.3.6\u786e\u4fdd RotateKubeletServerCertificate \u53c2\u6570\u8bbe\u7f6e\u4e3a true\uff08\u81ea\u52a8\uff09",id:"136\u786e\u4fdd-rotatekubeletservercertificate-\u53c2\u6570\u8bbe\u7f6e\u4e3a-true\u81ea\u52a8",level:3},{value:"1.3.7\u786e\u4fdd --bind-address \u53c2\u6570\u8bbe\u7f6e\u4e3a 127.0.0.1\uff08\u81ea\u52a8\uff09",id:"137\u786e\u4fdd---bind-address-\u53c2\u6570\u8bbe\u7f6e\u4e3a-127001\u81ea\u52a8",level:3},{value:"1.4Scheduler",id:"14scheduler",level:2},{value:"1.4.1\u786e\u4fdd --profiling \u53c2\u6570\u8bbe\u7f6e\u4e3a false\uff08\u81ea\u52a8\uff09",id:"141\u786e\u4fdd---profiling-\u53c2\u6570\u8bbe\u7f6e\u4e3a-false\u81ea\u52a8",level:3},{value:"1.4.2\u786e\u4fdd --bind-address \u53c2\u6570\u8bbe\u7f6e\u4e3a 127.0.0.1\uff08\u81ea\u52a8\uff09",id:"142\u786e\u4fdd---bind-address-\u53c2\u6570\u8bbe\u7f6e\u4e3a-127001\u81ea\u52a8",level:3},{value:"2 Etcd Node Configuration Files",id:"2-etcd-node-configuration-files",level:2},{value:"2.1\u786e\u4fdd\u6839\u636e\u9700\u8981\u8bbe\u7f6e --cert-file \u548c --key-file \u53c2\u6570\uff08\u81ea\u52a8\uff09",id:"21\u786e\u4fdd\u6839\u636e\u9700\u8981\u8bbe\u7f6e---cert-file-\u548c---key-file-\u53c2\u6570\u81ea\u52a8",level:3},{value:"2.2\u786e\u4fdd --client-cert-auth \u53c2\u6570\u8bbe\u7f6e\u4e3a true\uff08\u81ea\u52a8\uff09",id:"22\u786e\u4fdd---client-cert-auth-\u53c2\u6570\u8bbe\u7f6e\u4e3a-true\u81ea\u52a8",level:3},{value:"2.3\u786e\u4fdd --auto-tls \u53c2\u6570\u672a\u8bbe\u7f6e\u4e3a true\uff08\u81ea\u52a8\uff09",id:"23\u786e\u4fdd---auto-tls-\u53c2\u6570\u672a\u8bbe\u7f6e\u4e3a-true\u81ea\u52a8",level:3},{value:"2.4\u786e\u4fdd\u6839\u636e\u9700\u8981\u8bbe\u7f6e --peer-cert-file \u548c --peer-key-file \u53c2\u6570\uff08\u81ea\u52a8\uff09",id:"24\u786e\u4fdd\u6839\u636e\u9700\u8981\u8bbe\u7f6e---peer-cert-file-\u548c---peer-key-file-\u53c2\u6570\u81ea\u52a8",level:3},{value:"2.5\u786e\u4fdd --peer-client-cert-auth \u53c2\u6570\u8bbe\u7f6e\u4e3a true\uff08\u81ea\u52a8\uff09",id:"25\u786e\u4fdd---peer-client-cert-auth-\u53c2\u6570\u8bbe\u7f6e\u4e3a-true\u81ea\u52a8",level:3},{value:"2.6\u786e\u4fdd --peer-auto-tls \u53c2\u6570\u672a\u8bbe\u7f6e\u4e3a true\uff08\u81ea\u52a8\uff09",id:"26\u786e\u4fdd---peer-auto-tls-\u53c2\u6570\u672a\u8bbe\u7f6e\u4e3a-true\u81ea\u52a8",level:3},{value:"2.7\u786e\u4fdd etcd \u4f7f\u7528\u552f\u4e00\u7684 CA\uff08\u81ea\u52a8\uff09",id:"27\u786e\u4fdd-etcd-\u4f7f\u7528\u552f\u4e00\u7684-ca\u81ea\u52a8",level:3},{value:"3.1\u8ba4\u8bc1\u548c\u6388\u6743",id:"31\u8ba4\u8bc1\u548c\u6388\u6743",level:2},{value:"3.1.1\u4e0d\u80fd\u5c06\u5ba2\u6237\u7aef\u8bc1\u4e66\u8eab\u4efd\u9a8c\u8bc1\u5e94\u7528\u4e8e\u7528\u6237\uff08\u624b\u52a8\uff09",id:"311\u4e0d\u80fd\u5c06\u5ba2\u6237\u7aef\u8bc1\u4e66\u8eab\u4efd\u9a8c\u8bc1\u5e94\u7528\u4e8e\u7528\u6237\u624b\u52a8",level:3},{value:"3.2Logging",id:"32logging",level:2},{value:"3.2.1\u786e\u4fdd\u521b\u5efa\u6700\u5c0f\u5ba1\u8ba1\u7b56\u7565\uff08\u81ea\u52a8\uff09",id:"321\u786e\u4fdd\u521b\u5efa\u6700\u5c0f\u5ba1\u8ba1\u7b56\u7565\u81ea\u52a8",level:3},{value:"3.2.2\u786e\u4fdd\u5ba1\u8ba1\u7b56\u7565\u6db5\u76d6\u5173\u952e\u5b89\u5168\u95ee\u9898\uff08\u624b\u52a8\uff09",id:"322\u786e\u4fdd\u5ba1\u8ba1\u7b56\u7565\u6db5\u76d6\u5173\u952e\u5b89\u5168\u95ee\u9898\u624b\u52a8",level:3},{value:"4.1Worker \u8282\u70b9\u914d\u7f6e\u6587\u4ef6",id:"41worker-\u8282\u70b9\u914d\u7f6e\u6587\u4ef6",level:2},{value:"4.1.1\u786e\u4fdd kubelet \u670d\u52a1\u6587\u4ef6\u6743\u9650\u5177\u6709 644 \u6216\u66f4\u4e25\u683c\u7684\u8bbe\u7f6e\uff08\u81ea\u52a8\uff09",id:"411\u786e\u4fdd-kubelet-\u670d\u52a1\u6587\u4ef6\u6743\u9650\u5177\u6709-644-\u6216\u66f4\u4e25\u683c\u7684\u8bbe\u7f6e\u81ea\u52a8",level:3},{value:"4.1.2\u786e\u4fdd kubelet \u670d\u52a1\u6587\u4ef6\u6240\u6709\u6743\u8bbe\u7f6e\u4e3a root:root\uff08\u81ea\u52a8\uff09",id:"412\u786e\u4fdd-kubelet-\u670d\u52a1\u6587\u4ef6\u6240\u6709\u6743\u8bbe\u7f6e\u4e3a-rootroot\u81ea\u52a8",level:3},{value:"4.1.3\u5982\u679c\u4ee3\u7406 kubeconfig \u6587\u4ef6\u5b58\u5728\uff0c\u8bf7\u786e\u4fdd\u6743\u9650\u5177\u6709 644 \u6216\u66f4\u4e25\u683c\u7684\u8bbe\u7f6e\uff08\u81ea\u52a8\uff09",id:"413\u5982\u679c\u4ee3\u7406-kubeconfig-\u6587\u4ef6\u5b58\u5728\u8bf7\u786e\u4fdd\u6743\u9650\u5177\u6709-644-\u6216\u66f4\u4e25\u683c\u7684\u8bbe\u7f6e\u81ea\u52a8",level:3},{value:"4.1.4\u786e\u4fdd\u4ee3\u7406 kubeconfig \u6587\u4ef6\u6240\u6709\u6743\u8bbe\u7f6e\u4e3a root:root\uff08\u81ea\u52a8\uff09",id:"414\u786e\u4fdd\u4ee3\u7406-kubeconfig-\u6587\u4ef6\u6240\u6709\u6743\u8bbe\u7f6e\u4e3a-rootroot\u81ea\u52a8",level:3},{value:"4.1.5\u786e\u4fdd --kubeconfig kubelet.conf \u6587\u4ef6\u6743\u9650\u5177\u6709 644 \u6216\u66f4\u4e25\u683c\u7684\u8bbe\u7f6e\uff08\u81ea\u52a8\uff09",id:"415\u786e\u4fdd---kubeconfig-kubeletconf-\u6587\u4ef6\u6743\u9650\u5177\u6709-644-\u6216\u66f4\u4e25\u683c\u7684\u8bbe\u7f6e\u81ea\u52a8",level:3},{value:"4.1.6\u786e\u4fdd --kubeconfig kubelet.conf \u6587\u4ef6\u6240\u6709\u6743\u8bbe\u7f6e\u4e3a root:root\uff08\u81ea\u52a8\uff09",id:"416\u786e\u4fdd---kubeconfig-kubeletconf-\u6587\u4ef6\u6240\u6709\u6743\u8bbe\u7f6e\u4e3a-rootroot\u81ea\u52a8",level:3},{value:"4.1.7\u786e\u4fdd CA \u6587\u4ef6\u6743\u9650\u5177\u6709 644 \u6216\u66f4\u4e25\u683c\u7684\u8bbe\u7f6e\uff08\u81ea\u52a8\uff09",id:"417\u786e\u4fdd-ca-\u6587\u4ef6\u6743\u9650\u5177\u6709-644-\u6216\u66f4\u4e25\u683c\u7684\u8bbe\u7f6e\u81ea\u52a8",level:3},{value:"4.1.8\u786e\u4fdd\u5ba2\u6237\u7aef CA \u6587\u4ef6\u6240\u6709\u6743\u8bbe\u7f6e\u4e3a root:root\uff08\u81ea\u52a8\uff09",id:"418\u786e\u4fdd\u5ba2\u6237\u7aef-ca-\u6587\u4ef6\u6240\u6709\u6743\u8bbe\u7f6e\u4e3a-rootroot\u81ea\u52a8",level:3},{value:"4.1.9\u786e\u4fdd kubelet --config \u914d\u7f6e\u6587\u4ef6\u6743\u9650\u5177\u6709 644 \u6216\u66f4\u4e25\u683c\u7684\u8bbe\u7f6e\uff08\u81ea\u52a8\uff09",id:"419\u786e\u4fdd-kubelet---config-\u914d\u7f6e\u6587\u4ef6\u6743\u9650\u5177\u6709-644-\u6216\u66f4\u4e25\u683c\u7684\u8bbe\u7f6e\u81ea\u52a8",level:3},{value:"4.1.10\u786e\u4fdd kubelet --config \u914d\u7f6e\u6587\u4ef6\u6240\u6709\u6743\u8bbe\u7f6e\u4e3a root:root\uff08\u81ea\u52a8\uff09",id:"4110\u786e\u4fdd-kubelet---config-\u914d\u7f6e\u6587\u4ef6\u6240\u6709\u6743\u8bbe\u7f6e\u4e3a-rootroot\u81ea\u52a8",level:3},{value:"4.2Kubelet",id:"42kubelet",level:2},{value:"4.2.1\u786e\u4fdd\u5c06 anonymous-auth \u53c2\u6570\u8bbe\u7f6e\u4e3a false\uff08\u81ea\u52a8\uff09",id:"421\u786e\u4fdd\u5c06-anonymous-auth-\u53c2\u6570\u8bbe\u7f6e\u4e3a-false\u81ea\u52a8",level:3},{value:"4.2.2\u786e\u4fdd --authorization-mode \u53c2\u6570\u672a\u8bbe\u7f6e\u4e3a AlwaysAllow\uff08\u81ea\u52a8\uff09",id:"422\u786e\u4fdd---authorization-mode-\u53c2\u6570\u672a\u8bbe\u7f6e\u4e3a-alwaysallow\u81ea\u52a8",level:3},{value:"4.2.3\u786e\u4fdd\u6839\u636e\u9700\u8981\u8bbe\u7f6e --client-ca-file \u53c2\u6570\uff08\u81ea\u52a8\uff09",id:"423\u786e\u4fdd\u6839\u636e\u9700\u8981\u8bbe\u7f6e---client-ca-file-\u53c2\u6570\u81ea\u52a8",level:3},{value:"4.2.4\u786e\u4fdd --read-only-port \u53c2\u6570\u8bbe\u7f6e\u4e3a 0\uff08\u81ea\u52a8\uff09",id:"424\u786e\u4fdd---read-only-port-\u53c2\u6570\u8bbe\u7f6e\u4e3a-0\u81ea\u52a8",level:3},{value:"4.2.5\u786e\u4fdd --streaming-connection-idle-timeout \u53c2\u6570\u672a\u8bbe\u7f6e\u4e3a 0\uff08\u81ea\u52a8\uff09",id:"425\u786e\u4fdd---streaming-connection-idle-timeout-\u53c2\u6570\u672a\u8bbe\u7f6e\u4e3a-0\u81ea\u52a8",level:3},{value:"4.2.6\u786e\u4fdd --protect-kernel-defaults \u53c2\u6570\u8bbe\u7f6e\u4e3a true\uff08\u81ea\u52a8\uff09",id:"426\u786e\u4fdd---protect-kernel-defaults-\u53c2\u6570\u8bbe\u7f6e\u4e3a-true\u81ea\u52a8",level:3},{value:"4.2.7\u786e\u4fdd --make-iptables-util-chains \u53c2\u6570\u8bbe\u7f6e\u4e3a true\uff08\u81ea\u52a8\uff09",id:"427\u786e\u4fdd---make-iptables-util-chains-\u53c2\u6570\u8bbe\u7f6e\u4e3a-true\u81ea\u52a8",level:3},{value:"4.2.8\u786e\u4fdd\u672a\u8bbe\u7f6e --hostname-override \u53c2\u6570\uff08\u624b\u52a8\uff09",id:"428\u786e\u4fdd\u672a\u8bbe\u7f6e---hostname-override-\u53c2\u6570\u624b\u52a8",level:3},{value:"4.2.9\u786e\u4fdd --event-qps \u53c2\u6570\u8bbe\u7f6e\u4e3a 0 \u6216\u80fd\u9002\u5f53\u6293\u53d6\u4e8b\u4ef6\u7684\u7ea7\u522b\uff08\u81ea\u52a8\uff09",id:"429\u786e\u4fdd---event-qps-\u53c2\u6570\u8bbe\u7f6e\u4e3a-0-\u6216\u80fd\u9002\u5f53\u6293\u53d6\u4e8b\u4ef6\u7684\u7ea7\u522b\u81ea\u52a8",level:3},{value:"4.2.10\u786e\u4fdd\u6839\u636e\u9700\u8981\u8bbe\u7f6e --tls-cert-file \u548c --tls-private-key-file \u53c2\u6570\uff08\u81ea\u52a8\uff09",id:"4210\u786e\u4fdd\u6839\u636e\u9700\u8981\u8bbe\u7f6e---tls-cert-file-\u548c---tls-private-key-file-\u53c2\u6570\u81ea\u52a8",level:3},{value:"4.2.11\u786e\u4fdd --rotate-certificates \u53c2\u6570\u672a\u8bbe\u7f6e\u4e3a false\uff08\u81ea\u52a8\uff09",id:"4211\u786e\u4fdd---rotate-certificates-\u53c2\u6570\u672a\u8bbe\u7f6e\u4e3a-false\u81ea\u52a8",level:3},{value:"4.2.12\u9a8c\u8bc1 RotateKubeletServerCertificate \u53c2\u6570\u662f\u5426\u8bbe\u7f6e\u4e3a true\uff08\u81ea\u52a8\uff09",id:"4212\u9a8c\u8bc1-rotatekubeletservercertificate-\u53c2\u6570\u662f\u5426\u8bbe\u7f6e\u4e3a-true\u81ea\u52a8",level:3},{value:"4.2.13\u786e\u4fdd Kubelet \u4ec5\u4f7f\u7528\u5f3a\u5bc6\u7801\uff08\u81ea\u52a8\uff09",id:"4213\u786e\u4fdd-kubelet-\u4ec5\u4f7f\u7528\u5f3a\u5bc6\u7801\u81ea\u52a8",level:3},{value:"5.1RBAC \u548c ServiceAccount",id:"51rbac-\u548c-serviceaccount",level:2},{value:"5.1.1\u786e\u4fdd\u4ec5\u5728\u9700\u8981\u65f6\u4f7f\u7528 cluster-admin \u89d2\u8272\uff08\u624b\u52a8\uff09",id:"511\u786e\u4fdd\u4ec5\u5728\u9700\u8981\u65f6\u4f7f\u7528-cluster-admin-\u89d2\u8272\u624b\u52a8",level:3},{value:"5.1.2\u5c3d\u91cf\u51cf\u5c11\u5bf9\u5bc6\u6587\u7684\u8bbf\u95ee\uff08\u624b\u52a8\uff09",id:"512\u5c3d\u91cf\u51cf\u5c11\u5bf9\u5bc6\u6587\u7684\u8bbf\u95ee\u624b\u52a8",level:3},{value:"5.1.3\u5c3d\u91cf\u51cf\u5c11\u89d2\u8272\u548c ClusterRoles \u4e2d\u901a\u914d\u7b26\u7684\u4f7f\u7528\uff08\u624b\u52a8\uff09",id:"513\u5c3d\u91cf\u51cf\u5c11\u89d2\u8272\u548c-clusterroles-\u4e2d\u901a\u914d\u7b26\u7684\u4f7f\u7528\u624b\u52a8",level:3},{value:"5.1.4\u5c3d\u91cf\u51cf\u5c11\u521b\u5efa pod \u7684\u8bbf\u95ee\uff08\u624b\u52a8\uff09",id:"514\u5c3d\u91cf\u51cf\u5c11\u521b\u5efa-pod-\u7684\u8bbf\u95ee\u624b\u52a8",level:3},{value:"5.1.5\u786e\u4fdd\u672a\u4e3b\u52a8\u4f7f\u7528\u9ed8\u8ba4 ServiceAccount\u3002\uff08\u81ea\u52a8\uff09",id:"515\u786e\u4fdd\u672a\u4e3b\u52a8\u4f7f\u7528\u9ed8\u8ba4-serviceaccount\u81ea\u52a8",level:3},{value:"5.1.6\u786e\u4fdd\u4ec5\u5728\u5fc5\u8981\u65f6\u6302\u8f7d ServiceAccount \u4ee4\u724c\uff08\u624b\u52a8\uff09",id:"516\u786e\u4fdd\u4ec5\u5728\u5fc5\u8981\u65f6\u6302\u8f7d-serviceaccount-\u4ee4\u724c\u624b\u52a8",level:3},{value:"5.2Pod \u5b89\u5168\u7b56\u7565",id:"52pod-\u5b89\u5168\u7b56\u7565",level:2},{value:"5.2.1\u6700\u5c0f\u5316\u7279\u6743\u5bb9\u5668\u7684\u51c6\u5165\uff08\u624b\u52a8\uff09",id:"521\u6700\u5c0f\u5316\u7279\u6743\u5bb9\u5668\u7684\u51c6\u5165\u624b\u52a8",level:3},{value:"5.2.2\u6700\u5c0f\u5316\u9700\u8981\u5171\u4eab\u4e3b\u673a\u8fdb\u7a0b ID \u547d\u540d\u7a7a\u95f4\u7684\u5bb9\u5668\u51c6\u5165\uff08\u81ea\u52a8\uff09",id:"522\u6700\u5c0f\u5316\u9700\u8981\u5171\u4eab\u4e3b\u673a\u8fdb\u7a0b-id-\u547d\u540d\u7a7a\u95f4\u7684\u5bb9\u5668\u51c6\u5165\u81ea\u52a8",level:3},{value:"5.2.3\u6700\u5c0f\u5316\u9700\u8981\u5171\u4eab\u4e3b\u673a IPC \u547d\u540d\u7a7a\u95f4\u7684\u5bb9\u5668\u51c6\u5165\uff08\u81ea\u52a8\uff09",id:"523\u6700\u5c0f\u5316\u9700\u8981\u5171\u4eab\u4e3b\u673a-ipc-\u547d\u540d\u7a7a\u95f4\u7684\u5bb9\u5668\u51c6\u5165\u81ea\u52a8",level:3},{value:"5.2.4\u6700\u5c0f\u5316\u9700\u8981\u5171\u4eab\u4e3b\u673a\u7f51\u7edc\u547d\u540d\u7a7a\u95f4\u7684\u5bb9\u5668\u51c6\u5165\uff08\u81ea\u52a8\uff09",id:"524\u6700\u5c0f\u5316\u9700\u8981\u5171\u4eab\u4e3b\u673a\u7f51\u7edc\u547d\u540d\u7a7a\u95f4\u7684\u5bb9\u5668\u51c6\u5165\u81ea\u52a8",level:3},{value:"5.2.5\u4f7f\u7528 allowPrivilegeEscalation\uff08\u81ea\u52a8\uff09\u6700\u5c0f\u5316\u5bb9\u5668\u7684\u51c6\u5165",id:"525\u4f7f\u7528-allowprivilegeescalation\u81ea\u52a8\u6700\u5c0f\u5316\u5bb9\u5668\u7684\u51c6\u5165",level:3},{value:"5.2.6\u6700\u5c0f\u5316\u6839\u5bb9\u5668\u7684\u51c6\u5165\uff08\u624b\u52a8\uff09",id:"526\u6700\u5c0f\u5316\u6839\u5bb9\u5668\u7684\u51c6\u5165\u624b\u52a8",level:3},{value:"5.2.7\u4f7f\u7528 NET_RAW \u529f\u80fd\u6700\u5927\u9650\u5ea6\u5730\u51cf\u5c11\u5bb9\u5668\u7684\u51c6\u5165\uff08\u624b\u52a8\uff09",id:"527\u4f7f\u7528-net_raw-\u529f\u80fd\u6700\u5927\u9650\u5ea6\u5730\u51cf\u5c11\u5bb9\u5668\u7684\u51c6\u5165\u624b\u52a8",level:3},{value:"5.2.8\u4f7f\u7528\u6dfb\u52a0\u7684\u529f\u80fd\u6700\u5927\u9650\u5ea6\u5730\u51cf\u5c11\u5bb9\u5668\u7684\u51c6\u5165\uff08\u624b\u52a8\uff09",id:"528\u4f7f\u7528\u6dfb\u52a0\u7684\u529f\u80fd\u6700\u5927\u9650\u5ea6\u5730\u51cf\u5c11\u5bb9\u5668\u7684\u51c6\u5165\u624b\u52a8",level:3},{value:"5.2.9\u4f7f\u7528\u5206\u914d\u7684\u529f\u80fd\u6700\u5927\u9650\u5ea6\u5730\u51cf\u5c11\u5bb9\u5668\u7684\u51c6\u5165\uff08\u624b\u52a8\uff09",id:"529\u4f7f\u7528\u5206\u914d\u7684\u529f\u80fd\u6700\u5927\u9650\u5ea6\u5730\u51cf\u5c11\u5bb9\u5668\u7684\u51c6\u5165\u624b\u52a8",level:3},{value:"5.3\u7f51\u7edc\u7b56\u7565\u548c \u200b\u200bCNI",id:"53\u7f51\u7edc\u7b56\u7565\u548c-cni",level:2},{value:"5.3.1\u786e\u4fdd\u4f7f\u7528\u7684 CNI \u652f\u6301\u7f51\u7edc\u7b56\u7565\uff08\u624b\u52a8\uff09",id:"531\u786e\u4fdd\u4f7f\u7528\u7684-cni-\u652f\u6301\u7f51\u7edc\u7b56\u7565\u624b\u52a8",level:3},{value:"5.3.2\u786e\u4fdd\u6240\u6709\u547d\u540d\u7a7a\u95f4\u90fd\u5b9a\u4e49\u4e86\u7f51\u7edc\u7b56\u7565\uff08\u81ea\u52a8\uff09",id:"532\u786e\u4fdd\u6240\u6709\u547d\u540d\u7a7a\u95f4\u90fd\u5b9a\u4e49\u4e86\u7f51\u7edc\u7b56\u7565\u81ea\u52a8",level:3},{value:"5.4\u5bc6\u6587\u7ba1\u7406",id:"54\u5bc6\u6587\u7ba1\u7406",level:2},{value:"5.4.1\u4f18\u5148\u4f7f\u7528\u5bc6\u6587\u6587\u4ef6\u800c\u4e0d\u662f\u5bc6\u6587\u73af\u5883\u53d8\u91cf\uff08\u624b\u52a8\uff09",id:"541\u4f18\u5148\u4f7f\u7528\u5bc6\u6587\u6587\u4ef6\u800c\u4e0d\u662f\u5bc6\u6587\u73af\u5883\u53d8\u91cf\u624b\u52a8",level:3},{value:"5.4.2\u8003\u8651\u5916\u90e8\u5bc6\u6587\u5b58\u50a8\uff08\u624b\u52a8\uff09",id:"542\u8003\u8651\u5916\u90e8\u5bc6\u6587\u5b58\u50a8\u624b\u52a8",level:3},{value:"5.5\u53ef\u6269\u5c55\u51c6\u5165\u63a7\u5236",id:"55\u53ef\u6269\u5c55\u51c6\u5165\u63a7\u5236",level:2},{value:"5.5.1\u4f7f\u7528 ImagePolicyWebhook \u51c6\u5165\u63a7\u5236\u5668\u914d\u7f6e\u955c\u50cf\u6765\u6e90\uff08\u624b\u52a8\uff09",id:"551\u4f7f\u7528-imagepolicywebhook-\u51c6\u5165\u63a7\u5236\u5668\u914d\u7f6e\u955c\u50cf\u6765\u6e90\u624b\u52a8",level:3},{value:"5.7\u901a\u7528\u7b56\u7565",id:"57\u901a\u7528\u7b56\u7565",level:2},{value:"5.7.1\u4f7f\u7528\u547d\u540d\u7a7a\u95f4\u5728\u8d44\u6e90\u4e4b\u95f4\u521b\u5efa\u7ba1\u7406\u8fb9\u754c\uff08\u624b\u52a8\uff09",id:"571\u4f7f\u7528\u547d\u540d\u7a7a\u95f4\u5728\u8d44\u6e90\u4e4b\u95f4\u521b\u5efa\u7ba1\u7406\u8fb9\u754c\u624b\u52a8",level:3},{value:"5.7.2\u786e\u4fdd seccomp \u914d\u7f6e\u6587\u4ef6\u5728\u4f60\u7684 pod \u5b9a\u4e49\u4e2d\u8bbe\u7f6e\u4e3a docker/default\uff08\u624b\u52a8\uff09",id:"572\u786e\u4fdd-seccomp-\u914d\u7f6e\u6587\u4ef6\u5728\u4f60\u7684-pod-\u5b9a\u4e49\u4e2d\u8bbe\u7f6e\u4e3a-dockerdefault\u624b\u52a8",level:3},{value:"5.7.3\u5c06\u5b89\u5168\u4e0a\u4e0b\u6587\u5e94\u7528\u5230\u4f60\u7684 Pod \u548c\u5bb9\u5668\uff08\u624b\u52a8\uff09",id:"573\u5c06\u5b89\u5168\u4e0a\u4e0b\u6587\u5e94\u7528\u5230\u4f60\u7684-pod-\u548c\u5bb9\u5668\u624b\u52a8",level:3},{value:"5.7.4\u786e\u4fdd\u4e0d\u4f7f\u7528 Default \u547d\u540d\u7a7a\u95f4\uff08\u81ea\u52a8\uff09",id:"574\u786e\u4fdd\u4e0d\u4f7f\u7528-default-\u547d\u540d\u7a7a\u95f4\u81ea\u52a8",level:3}],u={toc:c};function p(e){let{components:t,...r}=e;return(0,a.kt)("wrapper",(0,n.Z)({},u,r,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h3",{id:"rke-cis-16-kubernetes-benchmark---rancher-26-\u4e0e-kubernetes-118-\u5230-123"},"RKE CIS 1.6 Kubernetes Benchmark - Rancher 2.6 \u4e0e Kubernetes 1.18 \u5230 1.23"),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://releases.rancher.com/documents/security/2.6/Rancher_v2-6_CIS_v1-6_Benchmark_Assessment.pdf"},"\u70b9\u51fb\u6b64\u5904\u4e0b\u8f7d\u672c\u6587\u6863\u7684 PDF \u7248\u672c"),"\u3002"),(0,a.kt)("h4",{id:"\u6982\u8ff0"},"\u6982\u8ff0"),(0,a.kt)("p",null,"\u672c\u6587\u6863\u662f ",(0,a.kt)("a",{parentName:"p",href:"/zh/v2.6/reference-guides/rancher-security/rancher-v2.6-hardening-guides/rke1-hardening-guide-with-cis-v1.6-benchmark"},"Rancher 2.6 RKE \u5b89\u5168\u5f3a\u5316\u6307\u5357"),"\u7684\u914d\u5957\u6587\u4ef6\u3002\u5f3a\u5316\u6307\u5357\uff08Hardening Guide\uff09\u4e3a Rancher \u7684\u5f3a\u5316\u751f\u4ea7\u5b89\u88c5\u63d0\u4f9b\u4e86\u8bf4\u660e\uff0c\u672c Benchmark \u6307\u5357\u65e8\u5728\u5e2e\u52a9\u4f60\u6839\u636e Benchmark \u6765\u8bc4\u4f30\u5f3a\u5316\u96c6\u7fa4\u7684\u5b89\u5168\u7ea7\u522b\u3002"),(0,a.kt)("p",null,"\u672c\u6307\u5357\u5bf9\u5e94\u4ee5\u4e0b\u5f3a\u5316\u6307\u5357\u3001Rancher\u3001CIS Benchmark \u548c Kubernetes \u7248\u672c\uff1a"),(0,a.kt)("table",null,(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",{parentName:"tr",align:null},"\u5f3a\u5316\u6307\u5357\u7248\u672c"),(0,a.kt)("th",{parentName:"tr",align:null},"Rancher \u7248\u672c"),(0,a.kt)("th",{parentName:"tr",align:null},"CIS Benchmark \u7248\u672c"),(0,a.kt)("th",{parentName:"tr",align:null},"Kubernetes \u7248\u672c"))),(0,a.kt)("tbody",{parentName:"table"},(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"\u5f3a\u5316\u6307\u5357 CIS v1.6 Benchmark"),(0,a.kt)("td",{parentName:"tr",align:null},"Rancher v2.6"),(0,a.kt)("td",{parentName:"tr",align:null},"CIS v1.6"),(0,a.kt)("td",{parentName:"tr",align:null},"Kubernetes v1.18 \u5230 v1.23")))),(0,a.kt)("p",null,"\u7531\u4e8e Rancher \u548c RKE \u5c06 Kubernetes \u670d\u52a1\u5b89\u88c5\u4e3a Docker \u5bb9\u5668\uff0c\u56e0\u6b64 CIS Kubernetes Benchmark \u4e2d\u7684\u8bb8\u591a\u7ba1\u63a7\u9a8c\u8bc1\u68c0\u67e5\u90fd\u4e0d\u9002\u7528\uff0c\u4e14\u7ed3\u679c\u4f1a\u662f ",(0,a.kt)("inlineCode",{parentName:"p"},"Not Applicable"),"\u3002\u672c\u6307\u5357\u5c06\u4ecb\u7ecd\u5404\u79cd\u7ba1\u63a7\uff0c\u5e76\u63d0\u4f9b\u66f4\u65b0\u7684\u793a\u4f8b\u547d\u4ee4\u6765\u5ba1\u6838 Rancher \u521b\u5efa\u7684\u96c6\u7fa4\u7684\u5408\u89c4\u6027\u3002"),(0,a.kt)("p",null,"\u672c\u6587\u6863\u4f9b Rancher \u5f00\u53d1\u3001\u5b89\u5168\u56e2\u961f\u3001\u5ba1\u8ba1\u5458\u548c\u51b3\u7b56\u8005\u4f7f\u7528\u3002"),(0,a.kt)("p",null,"\u6709\u5173\u5404\u4e2a\u5ba1\u6838\u7684\u66f4\u591a\u8be6\u7ec6\u4fe1\u606f\uff0c\u5305\u62ec\u5931\u8d25\u6d4b\u8bd5\u7684\u7406\u7531\u548c\u4fee\u6b63\u63aa\u65bd\uff0c\u4f60\u53ef\u4ee5\u53c2\u8003 CIS Kubernetes Benchmark v1.6 \u7684\u5bf9\u5e94\u5185\u5bb9\u3002\u521b\u5efa\u514d\u8d39\u5e10\u6237\u540e\uff0c\u4f60\u53ef\u4ee5\u5728 ",(0,a.kt)("a",{parentName:"p",href:"https://www.cisecurity.org/benchmark/kubernetes/"},"Center for Internet Security (CIS)")," \u4e0b\u8f7d Benchmark\u3002"),(0,a.kt)("h4",{id:"\u6d4b\u8bd5\u7ba1\u63a7\u65b9\u6cd5"},"\u6d4b\u8bd5\u7ba1\u63a7\u65b9\u6cd5"),(0,a.kt)("p",null,"Rancher \u548c RKE \u901a\u8fc7 Docker \u5bb9\u5668\u6765\u5b89\u88c5 Kubernetes \u670d\u52a1\u3002\u914d\u7f6e\u662f\u901a\u8fc7\u521d\u59cb\u5316\u65f6\u4f20\u9012\u7ed9\u5bb9\u5668\u7684\u53c2\u6570\u5b9a\u4e49\u7684\uff0c\u800c\u4e0d\u662f\u901a\u8fc7\u914d\u7f6e\u6587\u4ef6\u5b9a\u4e49\u7684\u3002"),(0,a.kt)("p",null,"\u5982\u679c\u7ba1\u63a7\u5ba1\u8ba1\u4e0e\u539f\u59cb CIS Benchmark \u51fa\u73b0\u5dee\u5f02\uff0c\u9488\u5bf9 Rancher \u63d0\u4f9b\u7684\u7684\u5ba1\u8ba1\u547d\u4ee4\u53ef\u7528\u4e8e\u8fdb\u884c\u6d4b\u8bd5\u3002\u6267\u884c\u6d4b\u8bd5\u65f6\uff0c\u4f60\u9700\u8981\u8bbf\u95ee\u6240\u6709 RKE \u8282\u70b9\u4e3b\u673a\u4e0a\u7684\u547d\u4ee4\u884c\u3002\u8fd9\u4e9b\u547d\u4ee4\u8fd8\u4f7f\u7528\u4e86\u6d4b\u8bd5\u548c\u8bc4\u4f30\u6d4b\u8bd5\u7ed3\u679c\u6240\u9700\u7684 ",(0,a.kt)("a",{parentName:"p",href:"https://kubernetes.io/docs/tasks/tools/"},"kubectl"),"\uff08\u5e26\u6709\u6709\u6548\u7684\u914d\u7f6e\u6587\u4ef6\uff09\u548c ",(0,a.kt)("a",{parentName:"p",href:"https://stedolan.github.io/jq/"},"jq")," \u5de5\u5177\u3002"),(0,a.kt)("admonition",{type:"note"},(0,a.kt)("p",{parentName:"admonition"},"\u672c\u6307\u5357\u4ec5\u4ecb\u7ecd ",(0,a.kt)("inlineCode",{parentName:"p"},"automated")," \u6d4b\u8bd5\uff08\u4ee5\u524d\u79f0\u4e3a ",(0,a.kt)("inlineCode",{parentName:"p"},"scored"),"\uff09\u3002")),(0,a.kt)("h3",{id:"\u7ba1\u63a7"},"\u7ba1\u63a7"),(0,a.kt)("h2",{id:"11master-\u8282\u70b9\u914d\u7f6e\u6587\u4ef6"},"1.1Master \u8282\u70b9\u914d\u7f6e\u6587\u4ef6"),(0,a.kt)("h3",{id:"111\u786e\u4fdd-api-server-pod-\u89c4\u8303\u6587\u4ef6\u6743\u9650\u5177\u6709-644-\u6216\u66f4\u4e25\u683c\u7684\u8bbe\u7f6e\u81ea\u52a8"},"1.1.1\u786e\u4fdd API Server pod \u89c4\u8303\u6587\u4ef6\u6743\u9650\u5177\u6709 644 \u6216\u66f4\u4e25\u683c\u7684\u8bbe\u7f6e\uff08\u81ea\u52a8\uff09"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1aNot Applicable"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\nRKE \u914d\u7f6e\u7684\u96c6\u7fa4\u4e0d\u9700\u8981\u6216\u7ef4\u62a4 kube-apiserver \u7684\u914d\u7f6e\u6587\u4ef6\u3002\n\u6240\u6709\u914d\u7f6e\u5728\u5bb9\u5668\u8fd0\u884c\u65f6\u4f5c\u4e3a\u53c2\u6570\u4f20\u5165\u3002"),(0,a.kt)("h3",{id:"112\u786e\u4fdd-api-server-pod-\u89c4\u8303\u6587\u4ef6\u6240\u6709\u6743\u8bbe\u7f6e\u4e3a-rootroot\u81ea\u52a8"},"1.1.2\u786e\u4fdd API Server pod \u89c4\u8303\u6587\u4ef6\u6240\u6709\u6743\u8bbe\u7f6e\u4e3a root:root\uff08\u81ea\u52a8\uff09"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1aNot Applicable"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\nRKE \u914d\u7f6e\u7684\u96c6\u7fa4\u4e0d\u9700\u8981\u6216\u7ef4\u62a4 kube-apiserver \u7684\u914d\u7f6e\u6587\u4ef6\u3002\n\u6240\u6709\u914d\u7f6e\u5728\u5bb9\u5668\u8fd0\u884c\u65f6\u4f5c\u4e3a\u53c2\u6570\u4f20\u5165\u3002"),(0,a.kt)("h3",{id:"113\u786e\u4fdd-controller-manager-pod-\u89c4\u8303\u6587\u4ef6\u6743\u9650\u5177\u6709-644-\u6216\u66f4\u4e25\u683c\u7684\u8bbe\u7f6e\u81ea\u52a8"},"1.1.3\u786e\u4fdd Controller Manager pod \u89c4\u8303\u6587\u4ef6\u6743\u9650\u5177\u6709 644 \u6216\u66f4\u4e25\u683c\u7684\u8bbe\u7f6e\uff08\u81ea\u52a8\uff09"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1aNot Applicable"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\nRKE \u914d\u7f6e\u7684\u96c6\u7fa4\u4e0d\u9700\u8981\u6216\u7ef4\u62a4 controller-manager \u7684\u914d\u7f6e\u6587\u4ef6\u3002\n\u6240\u6709\u914d\u7f6e\u5728\u5bb9\u5668\u8fd0\u884c\u65f6\u4f5c\u4e3a\u53c2\u6570\u4f20\u5165\u3002"),(0,a.kt)("h3",{id:"114\u786e\u4fdd-controller-manager-pod-\u89c4\u8303\u6587\u4ef6\u6240\u6709\u6743\u8bbe\u7f6e\u4e3a-rootroot\u81ea\u52a8"},"1.1.4\u786e\u4fdd Controller Manager pod \u89c4\u8303\u6587\u4ef6\u6240\u6709\u6743\u8bbe\u7f6e\u4e3a root:root\uff08\u81ea\u52a8\uff09"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1aNot Applicable"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\nRKE \u914d\u7f6e\u7684\u96c6\u7fa4\u4e0d\u9700\u8981\u6216\u7ef4\u62a4 controller-manager \u7684\u914d\u7f6e\u6587\u4ef6\u3002\n\u6240\u6709\u914d\u7f6e\u5728\u5bb9\u5668\u8fd0\u884c\u65f6\u4f5c\u4e3a\u53c2\u6570\u4f20\u5165\u3002"),(0,a.kt)("h3",{id:"115\u786e\u4fdd-scheduler-pod-\u89c4\u8303\u6587\u4ef6\u6743\u9650\u5177\u6709-644-\u6216\u66f4\u4e25\u683c\u7684\u8bbe\u7f6e\u81ea\u52a8"},"1.1.5\u786e\u4fdd Scheduler pod \u89c4\u8303\u6587\u4ef6\u6743\u9650\u5177\u6709 644 \u6216\u66f4\u4e25\u683c\u7684\u8bbe\u7f6e\uff08\u81ea\u52a8\uff09"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1aNot Applicable"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\nRKE \u914d\u7f6e\u7684\u96c6\u7fa4\u4e0d\u9700\u8981\u6216\u7ef4\u62a4 Scheduler \u7684\u914d\u7f6e\u6587\u4ef6\u3002\n\u6240\u6709\u914d\u7f6e\u5728\u5bb9\u5668\u8fd0\u884c\u65f6\u4f5c\u4e3a\u53c2\u6570\u4f20\u5165\u3002"),(0,a.kt)("h3",{id:"116\u786e\u4fdd-scheduler-pod-\u89c4\u8303\u6587\u4ef6\u6240\u6709\u6743\u8bbe\u7f6e\u4e3a-rootroot\u81ea\u52a8"},"1.1.6\u786e\u4fdd Scheduler pod \u89c4\u8303\u6587\u4ef6\u6240\u6709\u6743\u8bbe\u7f6e\u4e3a root:root\uff08\u81ea\u52a8\uff09"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1aNot Applicable"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\nRKE \u914d\u7f6e\u7684\u96c6\u7fa4\u4e0d\u9700\u8981\u6216\u7ef4\u62a4 Scheduler \u7684\u914d\u7f6e\u6587\u4ef6\u3002\n\u6240\u6709\u914d\u7f6e\u5728\u5bb9\u5668\u8fd0\u884c\u65f6\u4f5c\u4e3a\u53c2\u6570\u4f20\u5165\u3002"),(0,a.kt)("h3",{id:"117\u786e\u4fdd-etcd-pod-\u89c4\u8303\u6587\u4ef6\u6743\u9650\u5177\u6709-644-\u6216\u66f4\u4e25\u683c\u7684\u8bbe\u7f6e\u81ea\u52a8"},"1.1.7\u786e\u4fdd etcd pod \u89c4\u8303\u6587\u4ef6\u6743\u9650\u5177\u6709 644 \u6216\u66f4\u4e25\u683c\u7684\u8bbe\u7f6e\uff08\u81ea\u52a8\uff09"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1aNot Applicable"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\nRKE \u914d\u7f6e\u7684\u96c6\u7fa4\u4e0d\u9700\u8981\u6216\u7ef4\u62a4 etcd \u7684\u914d\u7f6e\u6587\u4ef6\u3002\n\u6240\u6709\u914d\u7f6e\u5728\u5bb9\u5668\u8fd0\u884c\u65f6\u4f5c\u4e3a\u53c2\u6570\u4f20\u5165\u3002"),(0,a.kt)("h3",{id:"118\u786e\u4fdd-etcd-pod-\u89c4\u8303\u6587\u4ef6\u6240\u6709\u6743\u8bbe\u7f6e\u4e3a-rootroot\u81ea\u52a8"},"1.1.8\u786e\u4fdd etcd pod \u89c4\u8303\u6587\u4ef6\u6240\u6709\u6743\u8bbe\u7f6e\u4e3a root:root\uff08\u81ea\u52a8\uff09"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1aNot Applicable"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\nRKE \u914d\u7f6e\u7684\u96c6\u7fa4\u4e0d\u9700\u8981\u6216\u7ef4\u62a4 etcd \u7684\u914d\u7f6e\u6587\u4ef6\u3002\n\u6240\u6709\u914d\u7f6e\u5728\u5bb9\u5668\u8fd0\u884c\u65f6\u4f5c\u4e3a\u53c2\u6570\u4f20\u5165\u3002"),(0,a.kt)("h3",{id:"119\u786e\u4fdd\u5bb9\u5668\u7f51\u7edc\u63a5\u53e3\u6587\u4ef6\u6743\u9650\u8bbe\u7f6e\u4e3a-644-\u6216\u66f4\u4e25\u683c\u7684\u8bbe\u7f6e\u624b\u52a8"},"1.1.9\u786e\u4fdd\u5bb9\u5668\u7f51\u7edc\u63a5\u53e3\u6587\u4ef6\u6743\u9650\u8bbe\u7f6e\u4e3a 644 \u6216\u66f4\u4e25\u683c\u7684\u8bbe\u7f6e\uff08\u624b\u52a8\uff09"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1awarn"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u5728 Master \u8282\u70b9\u4e0a\u8fd0\u884c\u4ee5\u4e0b\u547d\u4ee4\uff08\u57fa\u4e8e\u7cfb\u7edf\u4e0a\u7684\u6587\u4ef6\u4f4d\u7f6e\uff09\u3002\n\u4f8b\u5982\uff1achmod 644 <path/to/cni/files>"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"stat -c permissions=%a <path/to/cni/files>\n")),(0,a.kt)("h3",{id:"1110\u786e\u4fdd\u5bb9\u5668\u7f51\u7edc\u63a5\u53e3\u6587\u4ef6\u6240\u6709\u6743\u8bbe\u7f6e\u4e3a-rootroot\u624b\u52a8"},"1.1.10\u786e\u4fdd\u5bb9\u5668\u7f51\u7edc\u63a5\u53e3\u6587\u4ef6\u6240\u6709\u6743\u8bbe\u7f6e\u4e3a root:root\uff08\u624b\u52a8\uff09"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1awarn"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u5728 Master \u8282\u70b9\u4e0a\u8fd0\u884c\u4ee5\u4e0b\u547d\u4ee4\uff08\u57fa\u4e8e\u7cfb\u7edf\u4e0a\u7684\u6587\u4ef6\u4f4d\u7f6e\uff09\u3002\n\u4f8b\u5982\uff1achown root:root <path/to/cni/files>"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"stat -c %U:%G <path/to/cni/files>\n")),(0,a.kt)("h3",{id:"1111\u786e\u4fdd-etcd-\u6570\u636e\u76ee\u5f55\u6743\u9650\u8bbe\u7f6e\u4e3a-700-\u6216\u66f4\u4e25\u683c\u7684\u8bbe\u7f6e\u81ea\u52a8"},"1.1.11\u786e\u4fdd etcd \u6570\u636e\u76ee\u5f55\u6743\u9650\u8bbe\u7f6e\u4e3a 700 \u6216\u66f4\u4e25\u683c\u7684\u8bbe\u7f6e\uff08\u81ea\u52a8\uff09"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1apass"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u5728 etcd \u670d\u52a1\u5668\u8282\u70b9\u4e0a\uff0c\u901a\u8fc7\u4ee5\u4e0b\u547d\u4ee4\u83b7\u53d6 etcd \u6570\u636e\u76ee\u5f55\uff08\u4f5c\u4e3a ",(0,a.kt)("inlineCode",{parentName:"p"},"--data-dir")," \u53c2\u6570\u4f20\u9012\uff09\u3002\nps -ef | grep etcd\n\u57fa\u4e8e\u4e0a\u9762\u627e\u5230\u7684 etcd \u6570\u636e\u76ee\u5f55\u8fd0\u884c\u4ee5\u4e0b\u547d\u4ee4\u3002\u4f8b\u5982\uff1achmod 700 /var/lib/etcd"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"stat -c %a /node/var/lib/etcd\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u9884\u671f\u7ed3\u679c"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"'700' is equal to '700'\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u8fd4\u56de\u503c"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"700\n")),(0,a.kt)("h3",{id:"1112\u786e\u4fdd-etcd-\u6570\u636e\u76ee\u5f55\u6240\u6709\u6743\u8bbe\u7f6e\u4e3a-etcdetcd\u81ea\u52a8"},"1.1.12\u786e\u4fdd etcd \u6570\u636e\u76ee\u5f55\u6240\u6709\u6743\u8bbe\u7f6e\u4e3a etcd:etcd\uff08\u81ea\u52a8\uff09"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1apass"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u5728 etcd \u670d\u52a1\u5668\u8282\u70b9\u4e0a\uff0c\u901a\u8fc7\u4ee5\u4e0b\u547d\u4ee4\u83b7\u53d6 etcd \u6570\u636e\u76ee\u5f55\uff08\u4f5c\u4e3a ",(0,a.kt)("inlineCode",{parentName:"p"},"--data-dir")," \u53c2\u6570\u4f20\u9012\uff09\u3002\nps -ef | grep etcd\n\u57fa\u4e8e\u4e0a\u9762\u627e\u5230\u7684 etcd \u6570\u636e\u76ee\u5f55\u8fd0\u884c\u4ee5\u4e0b\u547d\u4ee4\u3002\n\u4f8b\u5982\uff1achown etcd:etcd /var/lib/etcd"),(0,a.kt)("p",null,"etcd \u6570\u636e\u76ee\u5f55\u6240\u6709\u6743\u9700\u8981\u7cfb\u7edf ServiceAccount\u3002\n\u6709\u5173\u5982\u4f55\u914d\u7f6e\u6240\u6709\u6743\u7684\u66f4\u591a\u4fe1\u606f\uff0c\u8bf7\u53c2\u9605 Rancher \u7684\u5f3a\u5316\u6307\u5357\u3002"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"stat -c %U:%G /node/var/lib/etcd\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u9884\u671f\u7ed3\u679c"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"'etcd:etcd' is present\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u8fd4\u56de\u503c"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"etcd:etcd\n")),(0,a.kt)("h3",{id:"1113\u786e\u4fdd-adminconf-\u6587\u4ef6\u6743\u9650\u5177\u6709-644-\u6216\u66f4\u4e25\u683c\u7684\u8bbe\u7f6e\u81ea\u52a8"},"1.1.13\u786e\u4fdd admin.conf \u6587\u4ef6\u6743\u9650\u5177\u6709 644 \u6216\u66f4\u4e25\u683c\u7684\u8bbe\u7f6e\uff08\u81ea\u52a8\uff09"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1aNot Applicable"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\nRKE \u914d\u7f6e\u7684\u96c6\u7fa4\u4e0d\u4f1a\u5728\u8282\u70b9\u4e0a\u5b58\u50a8 kubernetes \u7684\u9ed8\u8ba4 kubeconfig \u51ed\u8bc1\u6587\u4ef6\u3002"),(0,a.kt)("h3",{id:"1114\u786e\u4fdd-adminconf-\u6587\u4ef6\u6240\u6709\u6743\u8bbe\u7f6e\u4e3a-rootroot\u81ea\u52a8"},"1.1.14\u786e\u4fdd admin.conf \u6587\u4ef6\u6240\u6709\u6743\u8bbe\u7f6e\u4e3a root:root\uff08\u81ea\u52a8\uff09"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1aNot Applicable"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\nRKE \u914d\u7f6e\u7684\u96c6\u7fa4\u4e0d\u4f1a\u5728\u8282\u70b9\u4e0a\u5b58\u50a8 kubernetes \u7684\u9ed8\u8ba4 kubeconfig \u51ed\u8bc1\u6587\u4ef6\u3002"),(0,a.kt)("h3",{id:"1115\u786e\u4fdd-schedulerconf-\u6587\u4ef6\u6743\u9650\u5177\u6709-644-\u6216\u66f4\u4e25\u683c\u7684\u8bbe\u7f6e\u81ea\u52a8"},"1.1.15\u786e\u4fdd scheduler.conf \u6587\u4ef6\u6743\u9650\u5177\u6709 644 \u6216\u66f4\u4e25\u683c\u7684\u8bbe\u7f6e\uff08\u81ea\u52a8\uff09"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1aNot Applicable"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\nRKE \u914d\u7f6e\u7684\u96c6\u7fa4\u4e0d\u9700\u8981\u6216\u7ef4\u62a4 Scheduler \u7684\u914d\u7f6e\u6587\u4ef6\u3002\n\u6240\u6709\u914d\u7f6e\u5728\u5bb9\u5668\u8fd0\u884c\u65f6\u4f5c\u4e3a\u53c2\u6570\u4f20\u5165\u3002"),(0,a.kt)("h3",{id:"1116\u786e\u4fdd-schedulerconf-\u6587\u4ef6\u6240\u6709\u6743\u8bbe\u7f6e\u4e3a-rootroot\u81ea\u52a8"},"1.1.16\u786e\u4fdd scheduler.conf \u6587\u4ef6\u6240\u6709\u6743\u8bbe\u7f6e\u4e3a root:root\uff08\u81ea\u52a8\uff09"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1aNot Applicable"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\nRKE \u914d\u7f6e\u7684\u96c6\u7fa4\u4e0d\u9700\u8981\u6216\u7ef4\u62a4 Scheduler \u7684\u914d\u7f6e\u6587\u4ef6\u3002\n\u6240\u6709\u914d\u7f6e\u5728\u5bb9\u5668\u8fd0\u884c\u65f6\u4f5c\u4e3a\u53c2\u6570\u4f20\u5165\u3002"),(0,a.kt)("h3",{id:"1117\u786e\u4fdd-controller-managerconf-\u6587\u4ef6\u6743\u9650\u5177\u6709-644-\u6216\u66f4\u4e25\u683c\u7684\u8bbe\u7f6e\u81ea\u52a8"},"1.1.17\u786e\u4fdd controller-manager.conf \u6587\u4ef6\u6743\u9650\u5177\u6709 644 \u6216\u66f4\u4e25\u683c\u7684\u8bbe\u7f6e\uff08\u81ea\u52a8\uff09"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1aNot Applicable"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\nRKE \u914d\u7f6e\u7684\u96c6\u7fa4\u4e0d\u9700\u8981\u6216\u7ef4\u62a4 controller-manager \u7684\u914d\u7f6e\u6587\u4ef6\u3002\n\u6240\u6709\u914d\u7f6e\u5728\u5bb9\u5668\u8fd0\u884c\u65f6\u4f5c\u4e3a\u53c2\u6570\u4f20\u5165\u3002"),(0,a.kt)("h3",{id:"1118\u786e\u4fdd\u5c06-controller-managerconf-\u6587\u4ef6\u6240\u6709\u6743\u8bbe\u7f6e\u4e3a-rootroot\u81ea\u52a8"},"1.1.18\u786e\u4fdd\u5c06 controller-manager.conf \u6587\u4ef6\u6240\u6709\u6743\u8bbe\u7f6e\u4e3a root:root\uff08\u81ea\u52a8\uff09"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1aNot Applicable"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\nRKE \u914d\u7f6e\u7684\u96c6\u7fa4\u4e0d\u9700\u8981\u6216\u7ef4\u62a4 controller-manager \u7684\u914d\u7f6e\u6587\u4ef6\u3002\n\u6240\u6709\u914d\u7f6e\u5728\u5bb9\u5668\u8fd0\u884c\u65f6\u4f5c\u4e3a\u53c2\u6570\u4f20\u5165\u3002"),(0,a.kt)("h3",{id:"1119\u786e\u4fdd-kubernetes-pki-\u76ee\u5f55\u548c\u6587\u4ef6\u6240\u6709\u6743\u8bbe\u7f6e\u4e3a-rootroot\u81ea\u52a8"},"1.1.19\u786e\u4fdd Kubernetes PKI \u76ee\u5f55\u548c\u6587\u4ef6\u6240\u6709\u6743\u8bbe\u7f6e\u4e3a root:root\uff08\u81ea\u52a8\uff09"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1apass"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u5728 Master \u8282\u70b9\u4e0a\u8fd0\u884c\u4ee5\u4e0b\u547d\u4ee4\uff08\u57fa\u4e8e\u7cfb\u7edf\u4e0a\u7684\u6587\u4ef6\u4f4d\u7f6e\uff09\u3002\n\u4f8b\u5982\uff1achown -R root:root /etc/kubernetes/pki/"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1\u811a\u672c"),"\uff1a",(0,a.kt)("inlineCode",{parentName:"p"},"check_files_owner_in_dir.sh")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},'#!/usr/bin/env bash\n\n# This script is used to ensure the owner is set to root:root for\n# the given directory and all the files in it\n#\n# inputs:\n#   $1 = /full/path/to/directory\n#\n# outputs:\n#   true/false\n\nINPUT_DIR=$1\n\nif [[ "${INPUT_DIR}" == "" ]]; then\n    echo "false"\n    exit\nfi\n\nif [[ $(stat -c %U:%G ${INPUT_DIR}) != "root:root" ]]; then\n    echo "false"\n    exit\nfi\n\nstatInfoLines=$(stat -c "%n %U:%G" ${INPUT_DIR}/*)\nwhile read -r statInfoLine; do\n  f=$(echo ${statInfoLine} | cut -d\' \' -f1)\n  p=$(echo ${statInfoLine} | cut -d\' \' -f2)\n\n  if [[ $(basename "$f" .pem) == "kube-etcd-"* ]]; then\n    if [[ "$p" != "root:root" && "$p" != "etcd:etcd" ]]; then\n      echo "false"\n      exit\n    fi\n  else\n    if [[ "$p" != "root:root" ]]; then\n      echo "false"\n      exit\n    fi\n  fi\ndone <<< "${statInfoLines}"\n\n\necho "true"\nexit\n\n')),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1\u6267\u884c"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"./check_files_owner_in_dir.sh /node/etc/kubernetes/ssl\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u9884\u671f\u7ed3\u679c"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"'true' is equal to 'true'\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u8fd4\u56de\u503c"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"true\n")),(0,a.kt)("h3",{id:"1120\u786e\u4fdd\u5c06-kubernetes-pki-\u8bc1\u4e66\u6587\u4ef6\u6743\u9650\u8bbe\u7f6e\u4e3a-644-\u6216\u66f4\u4e25\u683c\u7684\u8bbe\u7f6e\u81ea\u52a8"},"1.1.20\u786e\u4fdd\u5c06 Kubernetes PKI \u8bc1\u4e66\u6587\u4ef6\u6743\u9650\u8bbe\u7f6e\u4e3a 644 \u6216\u66f4\u4e25\u683c\u7684\u8bbe\u7f6e\uff08\u81ea\u52a8\uff09"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1apass"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u5728 Master \u8282\u70b9\u4e0a\u8fd0\u884c\u4ee5\u4e0b\u547d\u4ee4\uff08\u57fa\u4e8e\u7cfb\u7edf\u4e0a\u7684\u6587\u4ef6\u4f4d\u7f6e\uff09\u3002\n\u4f8b\u5982\uff1achmod -R 644 /etc/kubernetes/pki/*.crt"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1\u811a\u672c"),"\uff1a",(0,a.kt)("inlineCode",{parentName:"p"},"check_files_permissions.sh")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},'#!/usr/bin/env bash\n\n# This script is used to ensure the file permissions are set to 644 or\n# more restrictive for all files in a given directory or a wildcard\n# selection of files\n#\n# inputs:\n#   $1 = /full/path/to/directory or /path/to/fileswithpattern\n#                                   ex: !(*key).pem\n#\n#   $2 (optional) = permission (ex: 600)\n#\n# outputs:\n#   true/false\n\n# Turn on "extended glob" for use of \'!\' in wildcard\nshopt -s extglob\n\n# Turn off history to avoid surprises when using \'!\'\nset -H\n\nUSER_INPUT=$1\n\nif [[ "${USER_INPUT}" == "" ]]; then\n  echo "false"\n  exit\nfi\n\n\nif [[ -d ${USER_INPUT} ]]; then\n  PATTERN="${USER_INPUT}/*"\nelse\n  PATTERN="${USER_INPUT}"\nfi\n\nPERMISSION=""\nif [[ "$2" != "" ]]; then\n  PERMISSION=$2\nfi\n\nFILES_PERMISSIONS=$(stat -c %n\\ %a ${PATTERN})\n\nwhile read -r fileInfo; do\n  p=$(echo ${fileInfo} | cut -d\' \' -f2)\n\n  if [[ "${PERMISSION}" != "" ]]; then\n    if [[ "$p" != "${PERMISSION}" ]]; then\n      echo "false"\n      exit\n    fi\n  else\n    if [[ "$p" != "644" && "$p" != "640" && "$p" != "600" ]]; then\n      echo "false"\n      exit\n    fi\n  fi\ndone <<< "${FILES_PERMISSIONS}"\n\n\necho "true"\nexit\n\n')),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1\u6267\u884c"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"./check_files_permissions.sh /node/etc/kubernetes/ssl/!(*key).pem\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u9884\u671f\u7ed3\u679c"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"'true' is equal to 'true'\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u8fd4\u56de\u503c"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"true\n")),(0,a.kt)("h3",{id:"1121\u786e\u4fdd-kubernetes-pki-\u5bc6\u94a5\u6587\u4ef6\u6743\u9650\u8bbe\u7f6e\u4e3a-600\u81ea\u52a8"},"1.1.21\u786e\u4fdd Kubernetes PKI \u5bc6\u94a5\u6587\u4ef6\u6743\u9650\u8bbe\u7f6e\u4e3a 600\uff08\u81ea\u52a8\uff09"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1apass"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u5728 Master \u8282\u70b9\u4e0a\u8fd0\u884c\u4ee5\u4e0b\u547d\u4ee4\uff08\u57fa\u4e8e\u7cfb\u7edf\u4e0a\u7684\u6587\u4ef6\u4f4d\u7f6e\uff09\u3002\n\u4f8b\u5982\uff1achmod -R 600 /etc/kubernetes/ssl/*key.pem"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1\u811a\u672c"),"\uff1a",(0,a.kt)("inlineCode",{parentName:"p"},"check_files_permissions.sh")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},'#!/usr/bin/env bash\n\n# This script is used to ensure the file permissions are set to 644 or\n# more restrictive for all files in a given directory or a wildcard\n# selection of files\n#\n# inputs:\n#   $1 = /full/path/to/directory or /path/to/fileswithpattern\n#                                   ex: !(*key).pem\n#\n#   $2 (optional) = permission (ex: 600)\n#\n# outputs:\n#   true/false\n\n# Turn on "extended glob" for use of \'!\' in wildcard\nshopt -s extglob\n\n# Turn off history to avoid surprises when using \'!\'\nset -H\n\nUSER_INPUT=$1\n\nif [[ "${USER_INPUT}" == "" ]]; then\n  echo "false"\n  exit\nfi\n\n\nif [[ -d ${USER_INPUT} ]]; then\n  PATTERN="${USER_INPUT}/*"\nelse\n  PATTERN="${USER_INPUT}"\nfi\n\nPERMISSION=""\nif [[ "$2" != "" ]]; then\n  PERMISSION=$2\nfi\n\nFILES_PERMISSIONS=$(stat -c %n\\ %a ${PATTERN})\n\nwhile read -r fileInfo; do\n  p=$(echo ${fileInfo} | cut -d\' \' -f2)\n\n  if [[ "${PERMISSION}" != "" ]]; then\n    if [[ "$p" != "${PERMISSION}" ]]; then\n      echo "false"\n      exit\n    fi\n  else\n    if [[ "$p" != "644" && "$p" != "640" && "$p" != "600" ]]; then\n      echo "false"\n      exit\n    fi\n  fi\ndone <<< "${FILES_PERMISSIONS}"\n\n\necho "true"\nexit\n\n')),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1\u6267\u884c"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"./check_files_permissions.sh /node/etc/kubernetes/ssl/*key.pem\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u9884\u671f\u7ed3\u679c"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"'true' is equal to 'true'\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u8fd4\u56de\u503c"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"true\n")),(0,a.kt)("h2",{id:"12api-server"},"1.2API Server"),(0,a.kt)("h3",{id:"121\u786e\u4fdd---anonymous-auth-\u53c2\u6570\u8bbe\u7f6e\u4e3a-false\u81ea\u52a8"},"1.2.1\u786e\u4fdd --anonymous-auth \u53c2\u6570\u8bbe\u7f6e\u4e3a false\uff08\u81ea\u52a8\uff09"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1apass"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u5728 Master \u8282\u70b9\u4e0a\u7f16\u8f91 API Server pod \u89c4\u8303\u6587\u4ef6 /etc/kubernetes/manifests/kube-apiserver.yaml \u5e76\u8bbe\u7f6e\u4ee5\u4e0b\u53c2\u6570\u3002\n--anonymous-auth=false"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"/bin/ps -ef | grep kube-apiserver | grep -v grep\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u9884\u671f\u7ed3\u679c"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"'false' is equal to 'false'\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u8fd4\u56de\u503c"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"root 121142 121120 7 12:27 ?00:06:27 kube-apiserver --audit-log-maxsize=100 --etcd-keyfile=/etc/kubernetes/ssl/kube-node-key.pem --service-cluster-ip-range=10.43.0.0/16 --encryption-provider-config=/etc/kubernetes/ssl/encryption.yaml --requestheader-username-headers=X-Remote-User --bind-address=0.0.0.0 --advertise-address=<node_ip> --requestheader-allowed-names=kube-apiserver-proxy-client --etcd-certfile=/etc/kubernetes/ssl/kube-node.pem --requestheader-client-ca-file=/etc/kubernetes/ssl/kube-apiserver-requestheader-ca.pem --allow-privileged=true --requestheader-extra-headers-prefix=X-Remote-Extra- --admission-control-config-file=/etc/kubernetes/admission.yaml --client-ca-file=/etc/kubernetes/ssl/kube-ca.pem --service-account-lookup=true --runtime-config=policy/v1beta1/podsecuritypolicy=true --authorization-mode=Node,RBAC --audit-log-maxage=30 --profiling=false --storage-backend=etcd3 --etcd-cafile=/etc/kubernetes/ssl/kube-ca.pem --etcd-servers=https://<node_ip>:2379 --kubelet-certificate-authority=/etc/kubernetes/ssl/kube-ca.pem --secure-port=6443 --tls-cipher-suites=TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305 --insecure-port=0 --api-audiences=unknown --audit-policy-file=/etc/kubernetes/audit-policy.yaml --etcd-prefix=/registry --kubelet-client-certificate=/etc/kubernetes/ssl/kube-apiserver.pem --kubelet-client-key=/etc/kubernetes/ssl/kube-apiserver-key.pem --proxy-client-key-file=/etc/kubernetes/ssl/kube-apiserver-proxy-client-key.pem --service-account-issuer=rke --service-account-signing-key-file=/etc/kubernetes/ssl/kube-service-account-token-key.pem --kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname --requestheader-group-headers=X-Remote-Group --cloud-provider= --proxy-client-cert-file=/etc/kubernetes/ssl/kube-apiserver-proxy-client.pem --service-node-port-range=30000-32767 --tls-cert-file=/etc/kubernetes/ssl/kube-apiserver.pem --tls-private-key-file=/etc/kubernetes/ssl/kube-apiserver-key.pem --anonymous-auth=false --audit-log-path=/var/log/kube-audit/audit-log.json --audit-log-maxbackup=10 --service-account-key-file=/etc/kubernetes/ssl/kube-service-account-token-key.pem --enable-admission-plugins=NamespaceLifecycle,LimitRanger,ServiceAccount,DefaultStorageClass,DefaultTolerationSeconds,MutatingAdmissionWebhook,ValidatingAdmissionWebhook,ResourceQuota,NodeRestriction,Priority,TaintNodesByCondition,PersistentVolumeClaimResize,PodSecurityPolicy,EventRateLimit --audit-log-format=json\n")),(0,a.kt)("h3",{id:"122\u786e\u4fdd\u672a\u8bbe\u7f6e---basic-auth-file-\u53c2\u6570\u81ea\u52a8"},"1.2.2\u786e\u4fdd\u672a\u8bbe\u7f6e --basic-auth-file \u53c2\u6570\uff08\u81ea\u52a8\uff09"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1apass"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u9075\u5faa\u6587\u6863\u5e76\u914d\u7f6e\u8eab\u4efd\u9a8c\u8bc1\u7684\u66ff\u4ee3\u673a\u5236\u3002\u7136\u540e\uff0c\u5728 Master \u8282\u70b9\u4e0a\u7f16\u8f91 API Server pod \u89c4\u8303\u6587\u4ef6 /etc/kubernetes/manifests/kube-apiserver.yaml \u5e76\u79fb\u9664 ",(0,a.kt)("inlineCode",{parentName:"p"},"--basic-auth-file=<filename>")," \u53c2\u6570\u3002"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"/bin/ps -ef | grep kube-apiserver | grep -v grep\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u9884\u671f\u7ed3\u679c"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"'--basic-auth-file' is not present\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u8fd4\u56de\u503c"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"root 121142 121120 7 12:27 ?00:06:27 kube-apiserver --audit-log-maxsize=100 --etcd-keyfile=/etc/kubernetes/ssl/kube-node-key.pem --service-cluster-ip-range=10.43.0.0/16 --encryption-provider-config=/etc/kubernetes/ssl/encryption.yaml --requestheader-username-headers=X-Remote-User --bind-address=0.0.0.0 --advertise-address=<node_ip> --requestheader-allowed-names=kube-apiserver-proxy-client --etcd-certfile=/etc/kubernetes/ssl/kube-node.pem --requestheader-client-ca-file=/etc/kubernetes/ssl/kube-apiserver-requestheader-ca.pem --allow-privileged=true --requestheader-extra-headers-prefix=X-Remote-Extra- --admission-control-config-file=/etc/kubernetes/admission.yaml --client-ca-file=/etc/kubernetes/ssl/kube-ca.pem --service-account-lookup=true --runtime-config=policy/v1beta1/podsecuritypolicy=true --authorization-mode=Node,RBAC --audit-log-maxage=30 --profiling=false --storage-backend=etcd3 --etcd-cafile=/etc/kubernetes/ssl/kube-ca.pem --etcd-servers=https://<node_ip>:2379 --kubelet-certificate-authority=/etc/kubernetes/ssl/kube-ca.pem --secure-port=6443 --tls-cipher-suites=TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305 --insecure-port=0 --api-audiences=unknown --audit-policy-file=/etc/kubernetes/audit-policy.yaml --etcd-prefix=/registry --kubelet-client-certificate=/etc/kubernetes/ssl/kube-apiserver.pem --kubelet-client-key=/etc/kubernetes/ssl/kube-apiserver-key.pem --proxy-client-key-file=/etc/kubernetes/ssl/kube-apiserver-proxy-client-key.pem --service-account-issuer=rke --service-account-signing-key-file=/etc/kubernetes/ssl/kube-service-account-token-key.pem --kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname --requestheader-group-headers=X-Remote-Group --cloud-provider= --proxy-client-cert-file=/etc/kubernetes/ssl/kube-apiserver-proxy-client.pem --service-node-port-range=30000-32767 --tls-cert-file=/etc/kubernetes/ssl/kube-apiserver.pem --tls-private-key-file=/etc/kubernetes/ssl/kube-apiserver-key.pem --anonymous-auth=false --audit-log-path=/var/log/kube-audit/audit-log.json --audit-log-maxbackup=10 --service-account-key-file=/etc/kubernetes/ssl/kube-service-account-token-key.pem --enable-admission-plugins=NamespaceLifecycle,LimitRanger,ServiceAccount,DefaultStorageClass,DefaultTolerationSeconds,MutatingAdmissionWebhook,ValidatingAdmissionWebhook,ResourceQuota,NodeRestriction,Priority,TaintNodesByCondition,PersistentVolumeClaimResize,PodSecurityPolicy,EventRateLimit --audit-log-format=json\n")),(0,a.kt)("h3",{id:"123\u786e\u4fdd\u672a\u8bbe\u7f6e---token-auth-file-\u53c2\u6570\u81ea\u52a8"},"1.2.3\u786e\u4fdd\u672a\u8bbe\u7f6e --token-auth-file \u53c2\u6570\uff08\u81ea\u52a8\uff09"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1apass"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u9075\u5faa\u6587\u6863\u5e76\u914d\u7f6e\u8eab\u4efd\u9a8c\u8bc1\u7684\u66ff\u4ee3\u673a\u5236\u3002\u7136\u540e\uff0c\u5728 Master \u8282\u70b9\u4e0a\u7f16\u8f91 API Server pod \u89c4\u8303\u6587\u4ef6 /etc/kubernetes/manifests/kube-apiserver.yaml \u5e76\u79fb\u9664 ",(0,a.kt)("inlineCode",{parentName:"p"},"--token-auth-file=<filename>")," \u53c2\u6570\u3002"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"/bin/ps -ef | grep kube-apiserver | grep -v grep\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u9884\u671f\u7ed3\u679c"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"'--token-auth-file' is not present\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u8fd4\u56de\u503c"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"root 121142 121120 7 12:27 ?00:06:27 kube-apiserver --audit-log-maxsize=100 --etcd-keyfile=/etc/kubernetes/ssl/kube-node-key.pem --service-cluster-ip-range=10.43.0.0/16 --encryption-provider-config=/etc/kubernetes/ssl/encryption.yaml --requestheader-username-headers=X-Remote-User --bind-address=0.0.0.0 --advertise-address=<node_ip> --requestheader-allowed-names=kube-apiserver-proxy-client --etcd-certfile=/etc/kubernetes/ssl/kube-node.pem --requestheader-client-ca-file=/etc/kubernetes/ssl/kube-apiserver-requestheader-ca.pem --allow-privileged=true --requestheader-extra-headers-prefix=X-Remote-Extra- --admission-control-config-file=/etc/kubernetes/admission.yaml --client-ca-file=/etc/kubernetes/ssl/kube-ca.pem --service-account-lookup=true --runtime-config=policy/v1beta1/podsecuritypolicy=true --authorization-mode=Node,RBAC --audit-log-maxage=30 --profiling=false --storage-backend=etcd3 --etcd-cafile=/etc/kubernetes/ssl/kube-ca.pem --etcd-servers=https://<node_ip>:2379 --kubelet-certificate-authority=/etc/kubernetes/ssl/kube-ca.pem --secure-port=6443 --tls-cipher-suites=TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305 --insecure-port=0 --api-audiences=unknown --audit-policy-file=/etc/kubernetes/audit-policy.yaml --etcd-prefix=/registry --kubelet-client-certificate=/etc/kubernetes/ssl/kube-apiserver.pem --kubelet-client-key=/etc/kubernetes/ssl/kube-apiserver-key.pem --proxy-client-key-file=/etc/kubernetes/ssl/kube-apiserver-proxy-client-key.pem --service-account-issuer=rke --service-account-signing-key-file=/etc/kubernetes/ssl/kube-service-account-token-key.pem --kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname --requestheader-group-headers=X-Remote-Group --cloud-provider= --proxy-client-cert-file=/etc/kubernetes/ssl/kube-apiserver-proxy-client.pem --service-node-port-range=30000-32767 --tls-cert-file=/etc/kubernetes/ssl/kube-apiserver.pem --tls-private-key-file=/etc/kubernetes/ssl/kube-apiserver-key.pem --anonymous-auth=false --audit-log-path=/var/log/kube-audit/audit-log.json --audit-log-maxbackup=10 --service-account-key-file=/etc/kubernetes/ssl/kube-service-account-token-key.pem --enable-admission-plugins=NamespaceLifecycle,LimitRanger,ServiceAccount,DefaultStorageClass,DefaultTolerationSeconds,MutatingAdmissionWebhook,ValidatingAdmissionWebhook,ResourceQuota,NodeRestriction,Priority,TaintNodesByCondition,PersistentVolumeClaimResize,PodSecurityPolicy,EventRateLimit --audit-log-format=json\n")),(0,a.kt)("h3",{id:"124\u786e\u4fdd---kubelet-https-\u53c2\u6570\u8bbe\u7f6e\u4e3a-true\u81ea\u52a8"},"1.2.4\u786e\u4fdd --kubelet-https \u53c2\u6570\u8bbe\u7f6e\u4e3a true\uff08\u81ea\u52a8\uff09"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1apass"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u5728 Master \u8282\u70b9\u4e0a\u7f16\u8f91 API Server pod \u89c4\u8303\u6587\u4ef6 /etc/kubernetes/manifests/kube-apiserver.yaml \u5e76\u79fb\u9664 ",(0,a.kt)("inlineCode",{parentName:"p"},"--kubelet-https")," \u53c2\u6570\u3002"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"/bin/ps -ef | grep kube-apiserver | grep -v grep\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u9884\u671f\u7ed3\u679c"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"'--kubelet-https' is not present OR '--kubelet-https' is not present\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u8fd4\u56de\u503c"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"root 121142 121120 7 12:27 ?00:06:27 kube-apiserver --audit-log-maxsize=100 --etcd-keyfile=/etc/kubernetes/ssl/kube-node-key.pem --service-cluster-ip-range=10.43.0.0/16 --encryption-provider-config=/etc/kubernetes/ssl/encryption.yaml --requestheader-username-headers=X-Remote-User --bind-address=0.0.0.0 --advertise-address=<node_ip> --requestheader-allowed-names=kube-apiserver-proxy-client --etcd-certfile=/etc/kubernetes/ssl/kube-node.pem --requestheader-client-ca-file=/etc/kubernetes/ssl/kube-apiserver-requestheader-ca.pem --allow-privileged=true --requestheader-extra-headers-prefix=X-Remote-Extra- --admission-control-config-file=/etc/kubernetes/admission.yaml --client-ca-file=/etc/kubernetes/ssl/kube-ca.pem --service-account-lookup=true --runtime-config=policy/v1beta1/podsecuritypolicy=true --authorization-mode=Node,RBAC --audit-log-maxage=30 --profiling=false --storage-backend=etcd3 --etcd-cafile=/etc/kubernetes/ssl/kube-ca.pem --etcd-servers=https://<node_ip>:2379 --kubelet-certificate-authority=/etc/kubernetes/ssl/kube-ca.pem --secure-port=6443 --tls-cipher-suites=TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305 --insecure-port=0 --api-audiences=unknown --audit-policy-file=/etc/kubernetes/audit-policy.yaml --etcd-prefix=/registry --kubelet-client-certificate=/etc/kubernetes/ssl/kube-apiserver.pem --kubelet-client-key=/etc/kubernetes/ssl/kube-apiserver-key.pem --proxy-client-key-file=/etc/kubernetes/ssl/kube-apiserver-proxy-client-key.pem --service-account-issuer=rke --service-account-signing-key-file=/etc/kubernetes/ssl/kube-service-account-token-key.pem --kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname --requestheader-group-headers=X-Remote-Group --cloud-provider= --proxy-client-cert-file=/etc/kubernetes/ssl/kube-apiserver-proxy-client.pem --service-node-port-range=30000-32767 --tls-cert-file=/etc/kubernetes/ssl/kube-apiserver.pem --tls-private-key-file=/etc/kubernetes/ssl/kube-apiserver-key.pem --anonymous-auth=false --audit-log-path=/var/log/kube-audit/audit-log.json --audit-log-maxbackup=10 --service-account-key-file=/etc/kubernetes/ssl/kube-service-account-token-key.pem --enable-admission-plugins=NamespaceLifecycle,LimitRanger,ServiceAccount,DefaultStorageClass,DefaultTolerationSeconds,MutatingAdmissionWebhook,ValidatingAdmissionWebhook,ResourceQuota,NodeRestriction,Priority,TaintNodesByCondition,PersistentVolumeClaimResize,PodSecurityPolicy,EventRateLimit --audit-log-format=json\n")),(0,a.kt)("h3",{id:"125\u786e\u4fdd\u6b63\u786e\u8bbe\u7f6e\u4e86---kubelet-client-certificate-\u548c---kubelet-client-key-\u53c2\u6570\u81ea\u52a8"},"1.2.5\u786e\u4fdd\u6b63\u786e\u8bbe\u7f6e\u4e86 --kubelet-client-certificate \u548c --kubelet-client-key \u53c2\u6570\uff08\u81ea\u52a8\uff09"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1apass"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u9075\u5faa Kubernetes \u6587\u6863\u8bbe\u7f6e apiserver \u548c kubelets \u7684 TLS \u8fde\u63a5\u3002\u7136\u540e\uff0c\u5728 Master \u8282\u70b9\u4e0a\u7f16\u8f91 API Server pod \u89c4\u8303\u6587\u4ef6 /etc/kubernetes/manifests/kube-apiserver.yaml\uff0c\u5e76\u8bbe\u7f6e\u4ee5\u4e0b kubelet \u5ba2\u6237\u7aef\u8bc1\u4e66\u548c\u5bc6\u94a5\u53c2\u6570\u3002\n--kubelet-client-certificate=<path/to/client-certificate-file>\n--kubelet-client-key=<path/to/client-key-file>"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"/bin/ps -ef | grep kube-apiserver | grep -v grep\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u9884\u671f\u7ed3\u679c"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"'--kubelet-client-certificate' is present AND '--kubelet-client-key' is present\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u8fd4\u56de\u503c"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"root 121142 121120 7 12:27 ?00:06:27 kube-apiserver --audit-log-maxsize=100 --etcd-keyfile=/etc/kubernetes/ssl/kube-node-key.pem --service-cluster-ip-range=10.43.0.0/16 --encryption-provider-config=/etc/kubernetes/ssl/encryption.yaml --requestheader-username-headers=X-Remote-User --bind-address=0.0.0.0 --advertise-address=<node_ip> --requestheader-allowed-names=kube-apiserver-proxy-client --etcd-certfile=/etc/kubernetes/ssl/kube-node.pem --requestheader-client-ca-file=/etc/kubernetes/ssl/kube-apiserver-requestheader-ca.pem --allow-privileged=true --requestheader-extra-headers-prefix=X-Remote-Extra- --admission-control-config-file=/etc/kubernetes/admission.yaml --client-ca-file=/etc/kubernetes/ssl/kube-ca.pem --service-account-lookup=true --runtime-config=policy/v1beta1/podsecuritypolicy=true --authorization-mode=Node,RBAC --audit-log-maxage=30 --profiling=false --storage-backend=etcd3 --etcd-cafile=/etc/kubernetes/ssl/kube-ca.pem --etcd-servers=https://<node_ip>:2379 --kubelet-certificate-authority=/etc/kubernetes/ssl/kube-ca.pem --secure-port=6443 --tls-cipher-suites=TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305 --insecure-port=0 --api-audiences=unknown --audit-policy-file=/etc/kubernetes/audit-policy.yaml --etcd-prefix=/registry --kubelet-client-certificate=/etc/kubernetes/ssl/kube-apiserver.pem --kubelet-client-key=/etc/kubernetes/ssl/kube-apiserver-key.pem --proxy-client-key-file=/etc/kubernetes/ssl/kube-apiserver-proxy-client-key.pem --service-account-issuer=rke --service-account-signing-key-file=/etc/kubernetes/ssl/kube-service-account-token-key.pem --kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname --requestheader-group-headers=X-Remote-Group --cloud-provider= --proxy-client-cert-file=/etc/kubernetes/ssl/kube-apiserver-proxy-client.pem --service-node-port-range=30000-32767 --tls-cert-file=/etc/kubernetes/ssl/kube-apiserver.pem --tls-private-key-file=/etc/kubernetes/ssl/kube-apiserver-key.pem --anonymous-auth=false --audit-log-path=/var/log/kube-audit/audit-log.json --audit-log-maxbackup=10 --service-account-key-file=/etc/kubernetes/ssl/kube-service-account-token-key.pem --enable-admission-plugins=NamespaceLifecycle,LimitRanger,ServiceAccount,DefaultStorageClass,DefaultTolerationSeconds,MutatingAdmissionWebhook,ValidatingAdmissionWebhook,ResourceQuota,NodeRestriction,Priority,TaintNodesByCondition,PersistentVolumeClaimResize,PodSecurityPolicy,EventRateLimit --audit-log-format=json\n")),(0,a.kt)("h3",{id:"126\u786e\u4fdd\u6839\u636e\u9700\u8981\u8bbe\u7f6e---kubelet-certificate-authority-\u53c2\u6570\u81ea\u52a8"},"1.2.6\u786e\u4fdd\u6839\u636e\u9700\u8981\u8bbe\u7f6e --kubelet-certificate-authority \u53c2\u6570\uff08\u81ea\u52a8\uff09"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1apass"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u9075\u5faa Kubernetes \u6587\u6863\u8bbe\u7f6e apiserver \u548c kubelets \u7684 TLS \u8fde\u63a5\u3002\u7136\u540e\uff0c\u5728 Master \u8282\u70b9\u4e0a\u7f16\u8f91 API Server pod \u89c4\u8303\u6587\u4ef6 /etc/kubernetes/manifests/kube-apiserver.yaml\uff0c\u5e76\u5c06 ",(0,a.kt)("inlineCode",{parentName:"p"},"--kubelet-certificate-authority")," \u53c2\u6570\u8bbe\u7f6e\u4e3a CA \u8bc1\u4e66\u6587\u4ef6\u7684\u8def\u5f84\u3002\n",(0,a.kt)("inlineCode",{parentName:"p"},"--kubelet-certificate-authority=<ca-string>")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"/bin/ps -ef | grep kube-apiserver | grep -v grep\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u9884\u671f\u7ed3\u679c"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"'--kubelet-certificate-authority' is present\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u8fd4\u56de\u503c"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"root 121142 121120 7 12:27 ?00:06:27 kube-apiserver --audit-log-maxsize=100 --etcd-keyfile=/etc/kubernetes/ssl/kube-node-key.pem --service-cluster-ip-range=10.43.0.0/16 --encryption-provider-config=/etc/kubernetes/ssl/encryption.yaml --requestheader-username-headers=X-Remote-User --bind-address=0.0.0.0 --advertise-address=<node_ip> --requestheader-allowed-names=kube-apiserver-proxy-client --etcd-certfile=/etc/kubernetes/ssl/kube-node.pem --requestheader-client-ca-file=/etc/kubernetes/ssl/kube-apiserver-requestheader-ca.pem --allow-privileged=true --requestheader-extra-headers-prefix=X-Remote-Extra- --admission-control-config-file=/etc/kubernetes/admission.yaml --client-ca-file=/etc/kubernetes/ssl/kube-ca.pem --service-account-lookup=true --runtime-config=policy/v1beta1/podsecuritypolicy=true --authorization-mode=Node,RBAC --audit-log-maxage=30 --profiling=false --storage-backend=etcd3 --etcd-cafile=/etc/kubernetes/ssl/kube-ca.pem --etcd-servers=https://<node_ip>:2379 --kubelet-certificate-authority=/etc/kubernetes/ssl/kube-ca.pem --secure-port=6443 --tls-cipher-suites=TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305 --insecure-port=0 --api-audiences=unknown --audit-policy-file=/etc/kubernetes/audit-policy.yaml --etcd-prefix=/registry --kubelet-client-certificate=/etc/kubernetes/ssl/kube-apiserver.pem --kubelet-client-key=/etc/kubernetes/ssl/kube-apiserver-key.pem --proxy-client-key-file=/etc/kubernetes/ssl/kube-apiserver-proxy-client-key.pem --service-account-issuer=rke --service-account-signing-key-file=/etc/kubernetes/ssl/kube-service-account-token-key.pem --kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname --requestheader-group-headers=X-Remote-Group --cloud-provider= --proxy-client-cert-file=/etc/kubernetes/ssl/kube-apiserver-proxy-client.pem --service-node-port-range=30000-32767 --tls-cert-file=/etc/kubernetes/ssl/kube-apiserver.pem --tls-private-key-file=/etc/kubernetes/ssl/kube-apiserver-key.pem --anonymous-auth=false --audit-log-path=/var/log/kube-audit/audit-log.json --audit-log-maxbackup=10 --service-account-key-file=/etc/kubernetes/ssl/kube-service-account-token-key.pem --enable-admission-plugins=NamespaceLifecycle,LimitRanger,ServiceAccount,DefaultStorageClass,DefaultTolerationSeconds,MutatingAdmissionWebhook,ValidatingAdmissionWebhook,ResourceQuota,NodeRestriction,Priority,TaintNodesByCondition,PersistentVolumeClaimResize,PodSecurityPolicy,EventRateLimit --audit-log-format=json\n")),(0,a.kt)("h3",{id:"127\u786e\u4fdd---authorization-mode-\u53c2\u6570\u672a\u8bbe\u7f6e\u4e3a-alwaysallow\u81ea\u52a8"},"1.2.7\u786e\u4fdd --authorization-mode \u53c2\u6570\u672a\u8bbe\u7f6e\u4e3a AlwaysAllow\uff08\u81ea\u52a8\uff09"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1apass"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u5728 Master \u8282\u70b9\u4e0a\u7f16\u8f91 API Server pod \u89c4\u8303\u6587\u4ef6 /etc/kubernetes/manifests/kube-apiserver.yaml\uff0c\u5e76\u5c06 ",(0,a.kt)("inlineCode",{parentName:"p"},"--authorization-mode")," \u53c2\u6570\u8bbe\u7f6e\u4e3a ",(0,a.kt)("inlineCode",{parentName:"p"},"AlwaysAllow")," \u4ee5\u5916\u7684\u503c\u3002\n\u793a\u4f8b\u5982\u4e0b\u3002\n--authorization-mode=RBAC"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"/bin/ps -ef | grep kube-apiserver | grep -v grep\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u9884\u671f\u7ed3\u679c"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"'Node,RBAC' not have 'AlwaysAllow'\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u8fd4\u56de\u503c"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"root 121142 121120 7 12:27 ?00:06:27 kube-apiserver --audit-log-maxsize=100 --etcd-keyfile=/etc/kubernetes/ssl/kube-node-key.pem --service-cluster-ip-range=10.43.0.0/16 --encryption-provider-config=/etc/kubernetes/ssl/encryption.yaml --requestheader-username-headers=X-Remote-User --bind-address=0.0.0.0 --advertise-address=<node_ip> --requestheader-allowed-names=kube-apiserver-proxy-client --etcd-certfile=/etc/kubernetes/ssl/kube-node.pem --requestheader-client-ca-file=/etc/kubernetes/ssl/kube-apiserver-requestheader-ca.pem --allow-privileged=true --requestheader-extra-headers-prefix=X-Remote-Extra- --admission-control-config-file=/etc/kubernetes/admission.yaml --client-ca-file=/etc/kubernetes/ssl/kube-ca.pem --service-account-lookup=true --runtime-config=policy/v1beta1/podsecuritypolicy=true --authorization-mode=Node,RBAC --audit-log-maxage=30 --profiling=false --storage-backend=etcd3 --etcd-cafile=/etc/kubernetes/ssl/kube-ca.pem --etcd-servers=https://<node_ip>:2379 --kubelet-certificate-authority=/etc/kubernetes/ssl/kube-ca.pem --secure-port=6443 --tls-cipher-suites=TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305 --insecure-port=0 --api-audiences=unknown --audit-policy-file=/etc/kubernetes/audit-policy.yaml --etcd-prefix=/registry --kubelet-client-certificate=/etc/kubernetes/ssl/kube-apiserver.pem --kubelet-client-key=/etc/kubernetes/ssl/kube-apiserver-key.pem --proxy-client-key-file=/etc/kubernetes/ssl/kube-apiserver-proxy-client-key.pem --service-account-issuer=rke --service-account-signing-key-file=/etc/kubernetes/ssl/kube-service-account-token-key.pem --kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname --requestheader-group-headers=X-Remote-Group --cloud-provider= --proxy-client-cert-file=/etc/kubernetes/ssl/kube-apiserver-proxy-client.pem --service-node-port-range=30000-32767 --tls-cert-file=/etc/kubernetes/ssl/kube-apiserver.pem --tls-private-key-file=/etc/kubernetes/ssl/kube-apiserver-key.pem --anonymous-auth=false --audit-log-path=/var/log/kube-audit/audit-log.json --audit-log-maxbackup=10 --service-account-key-file=/etc/kubernetes/ssl/kube-service-account-token-key.pem --enable-admission-plugins=NamespaceLifecycle,LimitRanger,ServiceAccount,DefaultStorageClass,DefaultTolerationSeconds,MutatingAdmissionWebhook,ValidatingAdmissionWebhook,ResourceQuota,NodeRestriction,Priority,TaintNodesByCondition,PersistentVolumeClaimResize,PodSecurityPolicy,EventRateLimit --audit-log-format=json\n")),(0,a.kt)("h3",{id:"128\u786e\u4fdd---authorization-mode-\u53c2\u6570\u5305\u62ec-node\u81ea\u52a8"},"1.2.8\u786e\u4fdd --authorization-mode \u53c2\u6570\u5305\u62ec Node\uff08\u81ea\u52a8\uff09"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1apass"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u5728 Master \u8282\u70b9\u4e0a\u7f16\u8f91 API Server pod \u89c4\u8303\u6587\u4ef6 /etc/kubernetes/manifests/kube-apiserver.yaml\uff0c\u5e76\u5c06 ",(0,a.kt)("inlineCode",{parentName:"p"},"--authorization-mode")," \u53c2\u6570\u8bbe\u7f6e\u4e3a\u5305\u542b ",(0,a.kt)("inlineCode",{parentName:"p"},"Node")," \u7684\u503c\u3002\n--authorization-mode=Node,RBAC"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"/bin/ps -ef | grep kube-apiserver | grep -v grep\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u9884\u671f\u7ed3\u679c"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"'Node,RBAC' has 'Node'\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u8fd4\u56de\u503c"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"root 121142 121120 7 12:27 ?00:06:27 kube-apiserver --audit-log-maxsize=100 --etcd-keyfile=/etc/kubernetes/ssl/kube-node-key.pem --service-cluster-ip-range=10.43.0.0/16 --encryption-provider-config=/etc/kubernetes/ssl/encryption.yaml --requestheader-username-headers=X-Remote-User --bind-address=0.0.0.0 --advertise-address=<node_ip> --requestheader-allowed-names=kube-apiserver-proxy-client --etcd-certfile=/etc/kubernetes/ssl/kube-node.pem --requestheader-client-ca-file=/etc/kubernetes/ssl/kube-apiserver-requestheader-ca.pem --allow-privileged=true --requestheader-extra-headers-prefix=X-Remote-Extra- --admission-control-config-file=/etc/kubernetes/admission.yaml --client-ca-file=/etc/kubernetes/ssl/kube-ca.pem --service-account-lookup=true --runtime-config=policy/v1beta1/podsecuritypolicy=true --authorization-mode=Node,RBAC --audit-log-maxage=30 --profiling=false --storage-backend=etcd3 --etcd-cafile=/etc/kubernetes/ssl/kube-ca.pem --etcd-servers=https://<node_ip>:2379 --kubelet-certificate-authority=/etc/kubernetes/ssl/kube-ca.pem --secure-port=6443 --tls-cipher-suites=TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305 --insecure-port=0 --api-audiences=unknown --audit-policy-file=/etc/kubernetes/audit-policy.yaml --etcd-prefix=/registry --kubelet-client-certificate=/etc/kubernetes/ssl/kube-apiserver.pem --kubelet-client-key=/etc/kubernetes/ssl/kube-apiserver-key.pem --proxy-client-key-file=/etc/kubernetes/ssl/kube-apiserver-proxy-client-key.pem --service-account-issuer=rke --service-account-signing-key-file=/etc/kubernetes/ssl/kube-service-account-token-key.pem --kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname --requestheader-group-headers=X-Remote-Group --cloud-provider= --proxy-client-cert-file=/etc/kubernetes/ssl/kube-apiserver-proxy-client.pem --service-node-port-range=30000-32767 --tls-cert-file=/etc/kubernetes/ssl/kube-apiserver.pem --tls-private-key-file=/etc/kubernetes/ssl/kube-apiserver-key.pem --anonymous-auth=false --audit-log-path=/var/log/kube-audit/audit-log.json --audit-log-maxbackup=10 --service-account-key-file=/etc/kubernetes/ssl/kube-service-account-token-key.pem --enable-admission-plugins=NamespaceLifecycle,LimitRanger,ServiceAccount,DefaultStorageClass,DefaultTolerationSeconds,MutatingAdmissionWebhook,ValidatingAdmissionWebhook,ResourceQuota,NodeRestriction,Priority,TaintNodesByCondition,PersistentVolumeClaimResize,PodSecurityPolicy,EventRateLimit --audit-log-format=json\n")),(0,a.kt)("h3",{id:"129\u786e\u4fdd---authorization-mode-\u53c2\u6570\u5305\u62ec-rbac\u81ea\u52a8"},"1.2.9\u786e\u4fdd --authorization-mode \u53c2\u6570\u5305\u62ec RBAC\uff08\u81ea\u52a8\uff09"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1apass"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u5728 Master \u8282\u70b9\u4e0a\u7f16\u8f91 API Server pod \u89c4\u8303\u6587\u4ef6 /etc/kubernetes/manifests/kube-apiserver.yaml\uff0c\u5e76\u5c06 ",(0,a.kt)("inlineCode",{parentName:"p"},"--authorization-mode")," \u53c2\u6570\u8bbe\u7f6e\u4e3a\u5305\u542b ",(0,a.kt)("inlineCode",{parentName:"p"},"RBAC")," \u7684\u503c\u3002\n\u4f8b\u5982\uff1a--authorization-mode=Node,RBAC"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"/bin/ps -ef | grep kube-apiserver | grep -v grep\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u9884\u671f\u7ed3\u679c"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"'Node,RBAC' has 'RBAC'\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u8fd4\u56de\u503c"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"root 121142 121120 7 12:27 ?00:06:27 kube-apiserver --audit-log-maxsize=100 --etcd-keyfile=/etc/kubernetes/ssl/kube-node-key.pem --service-cluster-ip-range=10.43.0.0/16 --encryption-provider-config=/etc/kubernetes/ssl/encryption.yaml --requestheader-username-headers=X-Remote-User --bind-address=0.0.0.0 --advertise-address=<node_ip> --requestheader-allowed-names=kube-apiserver-proxy-client --etcd-certfile=/etc/kubernetes/ssl/kube-node.pem --requestheader-client-ca-file=/etc/kubernetes/ssl/kube-apiserver-requestheader-ca.pem --allow-privileged=true --requestheader-extra-headers-prefix=X-Remote-Extra- --admission-control-config-file=/etc/kubernetes/admission.yaml --client-ca-file=/etc/kubernetes/ssl/kube-ca.pem --service-account-lookup=true --runtime-config=policy/v1beta1/podsecuritypolicy=true --authorization-mode=Node,RBAC --audit-log-maxage=30 --profiling=false --storage-backend=etcd3 --etcd-cafile=/etc/kubernetes/ssl/kube-ca.pem --etcd-servers=https://<node_ip>:2379 --kubelet-certificate-authority=/etc/kubernetes/ssl/kube-ca.pem --secure-port=6443 --tls-cipher-suites=TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305 --insecure-port=0 --api-audiences=unknown --audit-policy-file=/etc/kubernetes/audit-policy.yaml --etcd-prefix=/registry --kubelet-client-certificate=/etc/kubernetes/ssl/kube-apiserver.pem --kubelet-client-key=/etc/kubernetes/ssl/kube-apiserver-key.pem --proxy-client-key-file=/etc/kubernetes/ssl/kube-apiserver-proxy-client-key.pem --service-account-issuer=rke --service-account-signing-key-file=/etc/kubernetes/ssl/kube-service-account-token-key.pem --kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname --requestheader-group-headers=X-Remote-Group --cloud-provider= --proxy-client-cert-file=/etc/kubernetes/ssl/kube-apiserver-proxy-client.pem --service-node-port-range=30000-32767 --tls-cert-file=/etc/kubernetes/ssl/kube-apiserver.pem --tls-private-key-file=/etc/kubernetes/ssl/kube-apiserver-key.pem --anonymous-auth=false --audit-log-path=/var/log/kube-audit/audit-log.json --audit-log-maxbackup=10 --service-account-key-file=/etc/kubernetes/ssl/kube-service-account-token-key.pem --enable-admission-plugins=NamespaceLifecycle,LimitRanger,ServiceAccount,DefaultStorageClass,DefaultTolerationSeconds,MutatingAdmissionWebhook,ValidatingAdmissionWebhook,ResourceQuota,NodeRestriction,Priority,TaintNodesByCondition,PersistentVolumeClaimResize,PodSecurityPolicy,EventRateLimit --audit-log-format=json\n")),(0,a.kt)("h3",{id:"1210\u786e\u4fdd\u8bbe\u7f6e\u4e86\u51c6\u5165\u63a7\u5236\u63d2\u4ef6-eventratelimit\u81ea\u52a8"},"1.2.10\u786e\u4fdd\u8bbe\u7f6e\u4e86\u51c6\u5165\u63a7\u5236\u63d2\u4ef6 EventRateLimit\uff08\u81ea\u52a8\uff09"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1apass"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u9075\u5faa Kubernetes \u6587\u6863\u5e76\u5728\u914d\u7f6e\u6587\u4ef6\u4e2d\u8bbe\u7f6e\u6240\u9700\u7684\u9650\u5236\u3002\n\u7136\u540e\uff0c\u7f16\u8f91 API Server pod \u89c4\u8303\u6587\u4ef6 /etc/kubernetes/manifests/kube-apiserver.yaml\uff0c\u5e76\u8bbe\u7f6e\u4ee5\u4e0b\u53c2\u6570\u3002\n--enable-admission-plugins=...,EventRateLimit,...\n--admission-control-config-file=<path/to/configuration/file>"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"/bin/ps -ef | grep kube-apiserver | grep -v grep\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u9884\u671f\u7ed3\u679c"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"'NamespaceLifecycle,LimitRanger,ServiceAccount,DefaultStorageClass,DefaultTolerationSeconds,MutatingAdmissionWebhook,ValidatingAdmissionWebhook,ResourceQuota,NodeRestriction,Priority,TaintNodesByCondition,PersistentVolumeClaimResize,PodSecurityPolicy,EventRateLimit' has 'EventRateLimit'\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u8fd4\u56de\u503c"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"root 121142 121120 7 12:27 ?00:06:27 kube-apiserver --audit-log-maxsize=100 --etcd-keyfile=/etc/kubernetes/ssl/kube-node-key.pem --service-cluster-ip-range=10.43.0.0/16 --encryption-provider-config=/etc/kubernetes/ssl/encryption.yaml --requestheader-username-headers=X-Remote-User --bind-address=0.0.0.0 --advertise-address=<node_ip> --requestheader-allowed-names=kube-apiserver-proxy-client --etcd-certfile=/etc/kubernetes/ssl/kube-node.pem --requestheader-client-ca-file=/etc/kubernetes/ssl/kube-apiserver-requestheader-ca.pem --allow-privileged=true --requestheader-extra-headers-prefix=X-Remote-Extra- --admission-control-config-file=/etc/kubernetes/admission.yaml --client-ca-file=/etc/kubernetes/ssl/kube-ca.pem --service-account-lookup=true --runtime-config=policy/v1beta1/podsecuritypolicy=true --authorization-mode=Node,RBAC --audit-log-maxage=30 --profiling=false --storage-backend=etcd3 --etcd-cafile=/etc/kubernetes/ssl/kube-ca.pem --etcd-servers=https://<node_ip>:2379 --kubelet-certificate-authority=/etc/kubernetes/ssl/kube-ca.pem --secure-port=6443 --tls-cipher-suites=TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305 --insecure-port=0 --api-audiences=unknown --audit-policy-file=/etc/kubernetes/audit-policy.yaml --etcd-prefix=/registry --kubelet-client-certificate=/etc/kubernetes/ssl/kube-apiserver.pem --kubelet-client-key=/etc/kubernetes/ssl/kube-apiserver-key.pem --proxy-client-key-file=/etc/kubernetes/ssl/kube-apiserver-proxy-client-key.pem --service-account-issuer=rke --service-account-signing-key-file=/etc/kubernetes/ssl/kube-service-account-token-key.pem --kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname --requestheader-group-headers=X-Remote-Group --cloud-provider= --proxy-client-cert-file=/etc/kubernetes/ssl/kube-apiserver-proxy-client.pem --service-node-port-range=30000-32767 --tls-cert-file=/etc/kubernetes/ssl/kube-apiserver.pem --tls-private-key-file=/etc/kubernetes/ssl/kube-apiserver-key.pem --anonymous-auth=false --audit-log-path=/var/log/kube-audit/audit-log.json --audit-log-maxbackup=10 --service-account-key-file=/etc/kubernetes/ssl/kube-service-account-token-key.pem --enable-admission-plugins=NamespaceLifecycle,LimitRanger,ServiceAccount,DefaultStorageClass,DefaultTolerationSeconds,MutatingAdmissionWebhook,ValidatingAdmissionWebhook,ResourceQuota,NodeRestriction,Priority,TaintNodesByCondition,PersistentVolumeClaimResize,PodSecurityPolicy,EventRateLimit --audit-log-format=json\n")),(0,a.kt)("h3",{id:"1211\u786e\u4fdd\u672a\u8bbe\u7f6e\u51c6\u5165\u63a7\u5236\u63d2\u4ef6-alwaysadmit\u81ea\u52a8"},"1.2.11\u786e\u4fdd\u672a\u8bbe\u7f6e\u51c6\u5165\u63a7\u5236\u63d2\u4ef6 AlwaysAdmit\uff08\u81ea\u52a8\uff09"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1apass"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u5728 Master \u8282\u70b9\u4e0a\u7f16\u8f91 API Server pod \u89c4\u8303\u6587\u4ef6 /etc/kubernetes/manifests/kube-apiserver.yaml\uff0c\u5e76\u5220\u9664 ",(0,a.kt)("inlineCode",{parentName:"p"},"--enable-admission-plugins")," \u53c2\u6570\uff0c\u6216\u5c06\u5176\u8bbe\u7f6e\u4e3a\u4e0d\u5305\u542b ",(0,a.kt)("inlineCode",{parentName:"p"},"AlwaysAdmit")," \u7684\u503c\u3002"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"/bin/ps -ef | grep kube-apiserver | grep -v grep\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u9884\u671f\u7ed3\u679c"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"'NamespaceLifecycle,LimitRanger,ServiceAccount,DefaultStorageClass,DefaultTolerationSeconds,MutatingAdmissionWebhook,ValidatingAdmissionWebhook,ResourceQuota,NodeRestriction,Priority,TaintNodesByCondition,PersistentVolumeClaimResize,PodSecurityPolicy,EventRateLimit' not have 'AlwaysAdmit' OR '--enable-admission-plugins' is not present\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u8fd4\u56de\u503c"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"root 121142 121120 7 12:27 ?00:06:27 kube-apiserver --audit-log-maxsize=100 --etcd-keyfile=/etc/kubernetes/ssl/kube-node-key.pem --service-cluster-ip-range=10.43.0.0/16 --encryption-provider-config=/etc/kubernetes/ssl/encryption.yaml --requestheader-username-headers=X-Remote-User --bind-address=0.0.0.0 --advertise-address=<node_ip> --requestheader-allowed-names=kube-apiserver-proxy-client --etcd-certfile=/etc/kubernetes/ssl/kube-node.pem --requestheader-client-ca-file=/etc/kubernetes/ssl/kube-apiserver-requestheader-ca.pem --allow-privileged=true --requestheader-extra-headers-prefix=X-Remote-Extra- --admission-control-config-file=/etc/kubernetes/admission.yaml --client-ca-file=/etc/kubernetes/ssl/kube-ca.pem --service-account-lookup=true --runtime-config=policy/v1beta1/podsecuritypolicy=true --authorization-mode=Node,RBAC --audit-log-maxage=30 --profiling=false --storage-backend=etcd3 --etcd-cafile=/etc/kubernetes/ssl/kube-ca.pem --etcd-servers=https://<node_ip>:2379 --kubelet-certificate-authority=/etc/kubernetes/ssl/kube-ca.pem --secure-port=6443 --tls-cipher-suites=TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305 --insecure-port=0 --api-audiences=unknown --audit-policy-file=/etc/kubernetes/audit-policy.yaml --etcd-prefix=/registry --kubelet-client-certificate=/etc/kubernetes/ssl/kube-apiserver.pem --kubelet-client-key=/etc/kubernetes/ssl/kube-apiserver-key.pem --proxy-client-key-file=/etc/kubernetes/ssl/kube-apiserver-proxy-client-key.pem --service-account-issuer=rke --service-account-signing-key-file=/etc/kubernetes/ssl/kube-service-account-token-key.pem --kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname --requestheader-group-headers=X-Remote-Group --cloud-provider= --proxy-client-cert-file=/etc/kubernetes/ssl/kube-apiserver-proxy-client.pem --service-node-port-range=30000-32767 --tls-cert-file=/etc/kubernetes/ssl/kube-apiserver.pem --tls-private-key-file=/etc/kubernetes/ssl/kube-apiserver-key.pem --anonymous-auth=false --audit-log-path=/var/log/kube-audit/audit-log.json --audit-log-maxbackup=10 --service-account-key-file=/etc/kubernetes/ssl/kube-service-account-token-key.pem --enable-admission-plugins=NamespaceLifecycle,LimitRanger,ServiceAccount,DefaultStorageClass,DefaultTolerationSeconds,MutatingAdmissionWebhook,ValidatingAdmissionWebhook,ResourceQuota,NodeRestriction,Priority,TaintNodesByCondition,PersistentVolumeClaimResize,PodSecurityPolicy,EventRateLimit --audit-log-format=json\n")),(0,a.kt)("h3",{id:"1212\u786e\u4fdd\u8bbe\u7f6e\u4e86\u51c6\u5165\u63a7\u5236\u63d2\u4ef6-alwayspullimages\u624b\u52a8"},"1.2.12\u786e\u4fdd\u8bbe\u7f6e\u4e86\u51c6\u5165\u63a7\u5236\u63d2\u4ef6 AlwaysPullImages\uff08\u624b\u52a8\uff09"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1awarn"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u5728 Master \u8282\u70b9\u4e0a\u7f16\u8f91 API Server pod \u89c4\u8303\u6587\u4ef6 /etc/kubernetes/manifests/kube-apiserver.yaml\uff0c\u5e76\u5c06 ",(0,a.kt)("inlineCode",{parentName:"p"},"--enable-admission-plugins")," \u53c2\u6570\u8bbe\u7f6e\u4e3a\u5305\u542b ",(0,a.kt)("inlineCode",{parentName:"p"},"AlwaysPullImages"),"\u3002\n--enable-admission-plugins=...,AlwaysPullImages,..."),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"/bin/ps -ef | grep kube-apiserver | grep -v grep\n")),(0,a.kt)("h3",{id:"1213\u5982\u679c\u6ca1\u6709\u4f7f\u7528-podsecuritypolicy\u8bf7\u786e\u4fdd\u8bbe\u7f6e\u4e86\u51c6\u5165\u63a7\u5236\u63d2\u4ef6-securitycontextdeny\u624b\u52a8"},"1.2.13\u5982\u679c\u6ca1\u6709\u4f7f\u7528 PodSecurityPolicy\uff0c\u8bf7\u786e\u4fdd\u8bbe\u7f6e\u4e86\u51c6\u5165\u63a7\u5236\u63d2\u4ef6 SecurityContextDeny\uff08\u624b\u52a8\uff09"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1awarn"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u5728 Master \u8282\u70b9\u4e0a\u7f16\u8f91 API Server pod \u89c4\u8303\u6587\u4ef6 /etc/kubernetes/manifests/kube-apiserver.yaml\uff0c\u5e76\u5c06 ",(0,a.kt)("inlineCode",{parentName:"p"},"--enable-admission-plugins")," \u53c2\u6570\u8bbe\u7f6e\u4e3a\u5305\u62ec ",(0,a.kt)("inlineCode",{parentName:"p"},"SecurityContextDeny"),"\uff0c\u9664\u975e\u5df2\u8bbe\u7f6e\u4e86 PodSecurityPolicy\u3002\n--enable-admission-plugins=...,SecurityContextDeny,..."),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"/bin/ps -ef | grep kube-apiserver | grep -v grep\n")),(0,a.kt)("h3",{id:"1214\u786e\u4fdd\u8bbe\u7f6e\u4e86\u51c6\u5165\u63a7\u5236\u63d2\u4ef6-serviceaccount\u81ea\u52a8"},"1.2.14\u786e\u4fdd\u8bbe\u7f6e\u4e86\u51c6\u5165\u63a7\u5236\u63d2\u4ef6 ServiceAccount\uff08\u81ea\u52a8\uff09"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1apass"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u9075\u5faa\u6587\u6863\u5e76\u6839\u636e\u4f60\u7684\u73af\u5883\u521b\u5efa ServiceAccount \u5bf9\u8c61\u3002\n\u7136\u540e\uff0c\u5728 Master \u8282\u70b9\u4e0a\u7f16\u8f91 API Server pod \u89c4\u8303\u6587\u4ef6 /etc/kubernetes/manifests/kube-apiserver.yaml\uff0c\u5e76\u786e\u4fdd ",(0,a.kt)("inlineCode",{parentName:"p"},"--disable-admission-plugins")," \u53c2\u6570\u8bbe\u7f6e\u4e3a\u4e0d\u5305\u542b ServiceAccount \u7684\u503c\u3002"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"/bin/ps -ef | grep kube-apiserver | grep -v grep\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u9884\u671f\u7ed3\u679c"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"'--disable-admission-plugins' is not present OR '--disable-admission-plugins' is not present\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u8fd4\u56de\u503c"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"root 121142 121120 7 12:27 ?00:06:28 kube-apiserver --audit-log-maxsize=100 --etcd-keyfile=/etc/kubernetes/ssl/kube-node-key.pem --service-cluster-ip-range=10.43.0.0/16 --encryption-provider-config=/etc/kubernetes/ssl/encryption.yaml --requestheader-username-headers=X-Remote-User --bind-address=0.0.0.0 --advertise-address=<node_ip> --requestheader-allowed-names=kube-apiserver-proxy-client --etcd-certfile=/etc/kubernetes/ssl/kube-node.pem --requestheader-client-ca-file=/etc/kubernetes/ssl/kube-apiserver-requestheader-ca.pem --allow-privileged=true --requestheader-extra-headers-prefix=X-Remote-Extra- --admission-control-config-file=/etc/kubernetes/admission.yaml --client-ca-file=/etc/kubernetes/ssl/kube-ca.pem --service-account-lookup=true --runtime-config=policy/v1beta1/podsecuritypolicy=true --authorization-mode=Node,RBAC --audit-log-maxage=30 --profiling=false --storage-backend=etcd3 --etcd-cafile=/etc/kubernetes/ssl/kube-ca.pem --etcd-servers=https://<node_ip>:2379 --kubelet-certificate-authority=/etc/kubernetes/ssl/kube-ca.pem --secure-port=6443 --tls-cipher-suites=TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305 --insecure-port=0 --api-audiences=unknown --audit-policy-file=/etc/kubernetes/audit-policy.yaml --etcd-prefix=/registry --kubelet-client-certificate=/etc/kubernetes/ssl/kube-apiserver.pem --kubelet-client-key=/etc/kubernetes/ssl/kube-apiserver-key.pem --proxy-client-key-file=/etc/kubernetes/ssl/kube-apiserver-proxy-client-key.pem --service-account-issuer=rke --service-account-signing-key-file=/etc/kubernetes/ssl/kube-service-account-token-key.pem --kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname --requestheader-group-headers=X-Remote-Group --cloud-provider= --proxy-client-cert-file=/etc/kubernetes/ssl/kube-apiserver-proxy-client.pem --service-node-port-range=30000-32767 --tls-cert-file=/etc/kubernetes/ssl/kube-apiserver.pem --tls-private-key-file=/etc/kubernetes/ssl/kube-apiserver-key.pem --anonymous-auth=false --audit-log-path=/var/log/kube-audit/audit-log.json --audit-log-maxbackup=10 --service-account-key-file=/etc/kubernetes/ssl/kube-service-account-token-key.pem --enable-admission-plugins=NamespaceLifecycle,LimitRanger,ServiceAccount,DefaultStorageClass,DefaultTolerationSeconds,MutatingAdmissionWebhook,ValidatingAdmissionWebhook,ResourceQuota,NodeRestriction,Priority,TaintNodesByCondition,PersistentVolumeClaimResize,PodSecurityPolicy,EventRateLimit --audit-log-format=json\n")),(0,a.kt)("h3",{id:"1215\u786e\u4fdd\u8bbe\u7f6e\u4e86\u51c6\u5165\u63a7\u5236\u63d2\u4ef6-namespacelifecycle\u81ea\u52a8"},"1.2.15\u786e\u4fdd\u8bbe\u7f6e\u4e86\u51c6\u5165\u63a7\u5236\u63d2\u4ef6 NamespaceLifecycle\uff08\u81ea\u52a8\uff09"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1apass"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u5728 Master \u8282\u70b9\u4e0a\u7f16\u8f91 API Server pod \u89c4\u8303\u6587\u4ef6 /etc/kubernetes/manifests/kube-apiserver.yaml\uff0c\u5e76\u8bbe\u7f6e ",(0,a.kt)("inlineCode",{parentName:"p"},"--disable-admission-plugins")," \u53c2\u6570\uff0c\u786e\u4fdd\u5b83\u4e0d\u5305\u542b NamespaceLifecycle\u3002"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"/bin/ps -ef | grep kube-apiserver | grep -v grep\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u9884\u671f\u7ed3\u679c"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"'--disable-admission-plugins' is not present OR '--disable-admission-plugins' is not present\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u8fd4\u56de\u503c"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"root 121142 121120 7 12:27 ?00:06:28 kube-apiserver --audit-log-maxsize=100 --etcd-keyfile=/etc/kubernetes/ssl/kube-node-key.pem --service-cluster-ip-range=10.43.0.0/16 --encryption-provider-config=/etc/kubernetes/ssl/encryption.yaml --requestheader-username-headers=X-Remote-User --bind-address=0.0.0.0 --advertise-address=<node_ip> --requestheader-allowed-names=kube-apiserver-proxy-client --etcd-certfile=/etc/kubernetes/ssl/kube-node.pem --requestheader-client-ca-file=/etc/kubernetes/ssl/kube-apiserver-requestheader-ca.pem --allow-privileged=true --requestheader-extra-headers-prefix=X-Remote-Extra- --admission-control-config-file=/etc/kubernetes/admission.yaml --client-ca-file=/etc/kubernetes/ssl/kube-ca.pem --service-account-lookup=true --runtime-config=policy/v1beta1/podsecuritypolicy=true --authorization-mode=Node,RBAC --audit-log-maxage=30 --profiling=false --storage-backend=etcd3 --etcd-cafile=/etc/kubernetes/ssl/kube-ca.pem --etcd-servers=https://<node_ip>:2379 --kubelet-certificate-authority=/etc/kubernetes/ssl/kube-ca.pem --secure-port=6443 --tls-cipher-suites=TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305 --insecure-port=0 --api-audiences=unknown --audit-policy-file=/etc/kubernetes/audit-policy.yaml --etcd-prefix=/registry --kubelet-client-certificate=/etc/kubernetes/ssl/kube-apiserver.pem --kubelet-client-key=/etc/kubernetes/ssl/kube-apiserver-key.pem --proxy-client-key-file=/etc/kubernetes/ssl/kube-apiserver-proxy-client-key.pem --service-account-issuer=rke --service-account-signing-key-file=/etc/kubernetes/ssl/kube-service-account-token-key.pem --kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname --requestheader-group-headers=X-Remote-Group --cloud-provider= --proxy-client-cert-file=/etc/kubernetes/ssl/kube-apiserver-proxy-client.pem --service-node-port-range=30000-32767 --tls-cert-file=/etc/kubernetes/ssl/kube-apiserver.pem --tls-private-key-file=/etc/kubernetes/ssl/kube-apiserver-key.pem --anonymous-auth=false --audit-log-path=/var/log/kube-audit/audit-log.json --audit-log-maxbackup=10 --service-account-key-file=/etc/kubernetes/ssl/kube-service-account-token-key.pem --enable-admission-plugins=NamespaceLifecycle,LimitRanger,ServiceAccount,DefaultStorageClass,DefaultTolerationSeconds,MutatingAdmissionWebhook,ValidatingAdmissionWebhook,ResourceQuota,NodeRestriction,Priority,TaintNodesByCondition,PersistentVolumeClaimResize,PodSecurityPolicy,EventRateLimit --audit-log-format=json\n")),(0,a.kt)("h3",{id:"1216\u786e\u4fdd\u8bbe\u7f6e\u4e86\u51c6\u5165\u63a7\u5236\u63d2\u4ef6-podsecuritypolicy\u81ea\u52a8"},"1.2.16\u786e\u4fdd\u8bbe\u7f6e\u4e86\u51c6\u5165\u63a7\u5236\u63d2\u4ef6 PodSecurityPolicy\uff08\u81ea\u52a8\uff09"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1apass"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u9075\u5faa\u6587\u6863\u5e76\u6839\u636e\u4f60\u7684\u73af\u5883\u521b\u5efa Pod \u5b89\u5168\u7b56\u7565\u5bf9\u8c61\u3002\n\u7136\u540e\uff0c\u5728 Master \u8282\u70b9\u4e0a\u7f16\u8f91 API Server pod \u89c4\u8303\u6587\u4ef6 /etc/kubernetes/manifests/kube-apiserver.yaml\uff0c\u5e76\u5c06 ",(0,a.kt)("inlineCode",{parentName:"p"},"--enable-admission-plugins")," \u53c2\u6570\u8bbe\u7f6e\u4e3a\u5305\u542b PodSecurityPolicy \u7684\u503c\uff1a\n--enable-admission-plugins=...,PodSecurityPolicy,...\n\u7136\u540e\u91cd\u65b0\u542f\u52a8 API Server\u3002"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"/bin/ps -ef | grep kube-apiserver | grep -v grep\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u9884\u671f\u7ed3\u679c"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"'NamespaceLifecycle,LimitRanger,ServiceAccount,DefaultStorageClass,DefaultTolerationSeconds,MutatingAdmissionWebhook,ValidatingAdmissionWebhook,ResourceQuota,NodeRestriction,Priority,TaintNodesByCondition,PersistentVolumeClaimResize,PodSecurityPolicy,EventRateLimit' has 'PodSecurityPolicy'\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u8fd4\u56de\u503c"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"root 121142 121120 7 12:27 ?00:06:28 kube-apiserver --audit-log-maxsize=100 --etcd-keyfile=/etc/kubernetes/ssl/kube-node-key.pem --service-cluster-ip-range=10.43.0.0/16 --encryption-provider-config=/etc/kubernetes/ssl/encryption.yaml --requestheader-username-headers=X-Remote-User --bind-address=0.0.0.0 --advertise-address=<node_ip> --requestheader-allowed-names=kube-apiserver-proxy-client --etcd-certfile=/etc/kubernetes/ssl/kube-node.pem --requestheader-client-ca-file=/etc/kubernetes/ssl/kube-apiserver-requestheader-ca.pem --allow-privileged=true --requestheader-extra-headers-prefix=X-Remote-Extra- --admission-control-config-file=/etc/kubernetes/admission.yaml --client-ca-file=/etc/kubernetes/ssl/kube-ca.pem --service-account-lookup=true --runtime-config=policy/v1beta1/podsecuritypolicy=true --authorization-mode=Node,RBAC --audit-log-maxage=30 --profiling=false --storage-backend=etcd3 --etcd-cafile=/etc/kubernetes/ssl/kube-ca.pem --etcd-servers=https://<node_ip>:2379 --kubelet-certificate-authority=/etc/kubernetes/ssl/kube-ca.pem --secure-port=6443 --tls-cipher-suites=TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305 --insecure-port=0 --api-audiences=unknown --audit-policy-file=/etc/kubernetes/audit-policy.yaml --etcd-prefix=/registry --kubelet-client-certificate=/etc/kubernetes/ssl/kube-apiserver.pem --kubelet-client-key=/etc/kubernetes/ssl/kube-apiserver-key.pem --proxy-client-key-file=/etc/kubernetes/ssl/kube-apiserver-proxy-client-key.pem --service-account-issuer=rke --service-account-signing-key-file=/etc/kubernetes/ssl/kube-service-account-token-key.pem --kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname --requestheader-group-headers=X-Remote-Group --cloud-provider= --proxy-client-cert-file=/etc/kubernetes/ssl/kube-apiserver-proxy-client.pem --service-node-port-range=30000-32767 --tls-cert-file=/etc/kubernetes/ssl/kube-apiserver.pem --tls-private-key-file=/etc/kubernetes/ssl/kube-apiserver-key.pem --anonymous-auth=false --audit-log-path=/var/log/kube-audit/audit-log.json --audit-log-maxbackup=10 --service-account-key-file=/etc/kubernetes/ssl/kube-service-account-token-key.pem --enable-admission-plugins=NamespaceLifecycle,LimitRanger,ServiceAccount,DefaultStorageClass,DefaultTolerationSeconds,MutatingAdmissionWebhook,ValidatingAdmissionWebhook,ResourceQuota,NodeRestriction,Priority,TaintNodesByCondition,PersistentVolumeClaimResize,PodSecurityPolicy,EventRateLimit --audit-log-format=json\n")),(0,a.kt)("h3",{id:"1217\u786e\u4fdd\u8bbe\u7f6e\u4e86\u51c6\u5165\u63a7\u5236\u63d2\u4ef6-noderestriction\u81ea\u52a8"},"1.2.17\u786e\u4fdd\u8bbe\u7f6e\u4e86\u51c6\u5165\u63a7\u5236\u63d2\u4ef6 NodeRestriction\uff08\u81ea\u52a8\uff09"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1apass"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u6309\u7167 Kubernetes \u6587\u6863\uff0c\u5728 kubelets \u4e0a\u914d\u7f6e NodeRestriction \u63d2\u4ef6\u3002\n\u7136\u540e\uff0c\u5728 Master \u8282\u70b9\u4e0a\u7f16\u8f91 API Server pod \u89c4\u8303\u6587\u4ef6 /etc/kubernetes/manifests/kube-apiserver.yaml\uff0c\u5e76\u5c06 ",(0,a.kt)("inlineCode",{parentName:"p"},"--enable-admission-plugins")," \u53c2\u6570\u8bbe\u7f6e\u4e3a\u5305\u542b NodeRestriction \u7684\u503c\u3002\n--enable-admission-plugins=...,NodeRestriction,..."),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"/bin/ps -ef | grep kube-apiserver | grep -v grep\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u9884\u671f\u7ed3\u679c"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"'NamespaceLifecycle,LimitRanger,ServiceAccount,DefaultStorageClass,DefaultTolerationSeconds,MutatingAdmissionWebhook,ValidatingAdmissionWebhook,ResourceQuota,NodeRestriction,Priority,TaintNodesByCondition,PersistentVolumeClaimResize,PodSecurityPolicy,EventRateLimit' has 'NodeRestriction'\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u8fd4\u56de\u503c"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"root 121142 121120 7 12:27 ?00:06:28 kube-apiserver --audit-log-maxsize=100 --etcd-keyfile=/etc/kubernetes/ssl/kube-node-key.pem --service-cluster-ip-range=10.43.0.0/16 --encryption-provider-config=/etc/kubernetes/ssl/encryption.yaml --requestheader-username-headers=X-Remote-User --bind-address=0.0.0.0 --advertise-address=<node_ip> --requestheader-allowed-names=kube-apiserver-proxy-client --etcd-certfile=/etc/kubernetes/ssl/kube-node.pem --requestheader-client-ca-file=/etc/kubernetes/ssl/kube-apiserver-requestheader-ca.pem --allow-privileged=true --requestheader-extra-headers-prefix=X-Remote-Extra- --admission-control-config-file=/etc/kubernetes/admission.yaml --client-ca-file=/etc/kubernetes/ssl/kube-ca.pem --service-account-lookup=true --runtime-config=policy/v1beta1/podsecuritypolicy=true --authorization-mode=Node,RBAC --audit-log-maxage=30 --profiling=false --storage-backend=etcd3 --etcd-cafile=/etc/kubernetes/ssl/kube-ca.pem --etcd-servers=https://<node_ip>:2379 --kubelet-certificate-authority=/etc/kubernetes/ssl/kube-ca.pem --secure-port=6443 --tls-cipher-suites=TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305 --insecure-port=0 --api-audiences=unknown --audit-policy-file=/etc/kubernetes/audit-policy.yaml --etcd-prefix=/registry --kubelet-client-certificate=/etc/kubernetes/ssl/kube-apiserver.pem --kubelet-client-key=/etc/kubernetes/ssl/kube-apiserver-key.pem --proxy-client-key-file=/etc/kubernetes/ssl/kube-apiserver-proxy-client-key.pem --service-account-issuer=rke --service-account-signing-key-file=/etc/kubernetes/ssl/kube-service-account-token-key.pem --kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname --requestheader-group-headers=X-Remote-Group --cloud-provider= --proxy-client-cert-file=/etc/kubernetes/ssl/kube-apiserver-proxy-client.pem --service-node-port-range=30000-32767 --tls-cert-file=/etc/kubernetes/ssl/kube-apiserver.pem --tls-private-key-file=/etc/kubernetes/ssl/kube-apiserver-key.pem --anonymous-auth=false --audit-log-path=/var/log/kube-audit/audit-log.json --audit-log-maxbackup=10 --service-account-key-file=/etc/kubernetes/ssl/kube-service-account-token-key.pem --enable-admission-plugins=NamespaceLifecycle,LimitRanger,ServiceAccount,DefaultStorageClass,DefaultTolerationSeconds,MutatingAdmissionWebhook,ValidatingAdmissionWebhook,ResourceQuota,NodeRestriction,Priority,TaintNodesByCondition,PersistentVolumeClaimResize,PodSecurityPolicy,EventRateLimit --audit-log-format=json\n")),(0,a.kt)("h3",{id:"1218\u786e\u4fdd\u672a\u8bbe\u7f6e---insecure-bind-address-\u53c2\u6570\u81ea\u52a8"},"1.2.18\u786e\u4fdd\u672a\u8bbe\u7f6e --insecure-bind-address \u53c2\u6570\uff08\u81ea\u52a8\uff09"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1apass"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u5728 Master \u8282\u70b9\u4e0a\u7f16\u8f91 API Server pod \u89c4\u8303\u6587\u4ef6 /etc/kubernetes/manifests/kube-apiserver.yaml \u5e76\u79fb\u9664 ",(0,a.kt)("inlineCode",{parentName:"p"},"--insecure-bind-address")," \u53c2\u6570\u3002"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"/bin/ps -ef | grep kube-apiserver | grep -v grep\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u9884\u671f\u7ed3\u679c"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"'--insecure-bind-address' is not present\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u8fd4\u56de\u503c"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"root 121142 121120 7 12:27 ?00:06:28 kube-apiserver --audit-log-maxsize=100 --etcd-keyfile=/etc/kubernetes/ssl/kube-node-key.pem --service-cluster-ip-range=10.43.0.0/16 --encryption-provider-config=/etc/kubernetes/ssl/encryption.yaml --requestheader-username-headers=X-Remote-User --bind-address=0.0.0.0 --advertise-address=<node_ip> --requestheader-allowed-names=kube-apiserver-proxy-client --etcd-certfile=/etc/kubernetes/ssl/kube-node.pem --requestheader-client-ca-file=/etc/kubernetes/ssl/kube-apiserver-requestheader-ca.pem --allow-privileged=true --requestheader-extra-headers-prefix=X-Remote-Extra- --admission-control-config-file=/etc/kubernetes/admission.yaml --client-ca-file=/etc/kubernetes/ssl/kube-ca.pem --service-account-lookup=true --runtime-config=policy/v1beta1/podsecuritypolicy=true --authorization-mode=Node,RBAC --audit-log-maxage=30 --profiling=false --storage-backend=etcd3 --etcd-cafile=/etc/kubernetes/ssl/kube-ca.pem --etcd-servers=https://<node_ip>:2379 --kubelet-certificate-authority=/etc/kubernetes/ssl/kube-ca.pem --secure-port=6443 --tls-cipher-suites=TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305 --insecure-port=0 --api-audiences=unknown --audit-policy-file=/etc/kubernetes/audit-policy.yaml --etcd-prefix=/registry --kubelet-client-certificate=/etc/kubernetes/ssl/kube-apiserver.pem --kubelet-client-key=/etc/kubernetes/ssl/kube-apiserver-key.pem --proxy-client-key-file=/etc/kubernetes/ssl/kube-apiserver-proxy-client-key.pem --service-account-issuer=rke --service-account-signing-key-file=/etc/kubernetes/ssl/kube-service-account-token-key.pem --kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname --requestheader-group-headers=X-Remote-Group --cloud-provider= --proxy-client-cert-file=/etc/kubernetes/ssl/kube-apiserver-proxy-client.pem --service-node-port-range=30000-32767 --tls-cert-file=/etc/kubernetes/ssl/kube-apiserver.pem --tls-private-key-file=/etc/kubernetes/ssl/kube-apiserver-key.pem --anonymous-auth=false --audit-log-path=/var/log/kube-audit/audit-log.json --audit-log-maxbackup=10 --service-account-key-file=/etc/kubernetes/ssl/kube-service-account-token-key.pem --enable-admission-plugins=NamespaceLifecycle,LimitRanger,ServiceAccount,DefaultStorageClass,DefaultTolerationSeconds,MutatingAdmissionWebhook,ValidatingAdmissionWebhook,ResourceQuota,NodeRestriction,Priority,TaintNodesByCondition,PersistentVolumeClaimResize,PodSecurityPolicy,EventRateLimit --audit-log-format=json\n")),(0,a.kt)("h3",{id:"1219\u786e\u4fdd---insecure-port-\u53c2\u6570\u8bbe\u7f6e\u4e3a-0\u81ea\u52a8"},"1.2.19\u786e\u4fdd --insecure-port \u53c2\u6570\u8bbe\u7f6e\u4e3a 0\uff08\u81ea\u52a8\uff09"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1apass"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u5728 Master \u8282\u70b9\u4e0a\u7f16\u8f91 API Server pod \u89c4\u8303\u6587\u4ef6 /etc/kubernetes/manifests/kube-apiserver.yaml \u5e76\u8bbe\u7f6e\u4ee5\u4e0b\u53c2\u6570\u3002\n--insecure-port=0"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"/bin/ps -ef | grep kube-apiserver | grep -v grep\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u9884\u671f\u7ed3\u679c"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"'0' is equal to '0'\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u8fd4\u56de\u503c"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"root 121142 121120 7 12:27 ?00:06:28 kube-apiserver --audit-log-maxsize=100 --etcd-keyfile=/etc/kubernetes/ssl/kube-node-key.pem --service-cluster-ip-range=10.43.0.0/16 --encryption-provider-config=/etc/kubernetes/ssl/encryption.yaml --requestheader-username-headers=X-Remote-User --bind-address=0.0.0.0 --advertise-address=<node_ip> --requestheader-allowed-names=kube-apiserver-proxy-client --etcd-certfile=/etc/kubernetes/ssl/kube-node.pem --requestheader-client-ca-file=/etc/kubernetes/ssl/kube-apiserver-requestheader-ca.pem --allow-privileged=true --requestheader-extra-headers-prefix=X-Remote-Extra- --admission-control-config-file=/etc/kubernetes/admission.yaml --client-ca-file=/etc/kubernetes/ssl/kube-ca.pem --service-account-lookup=true --runtime-config=policy/v1beta1/podsecuritypolicy=true --authorization-mode=Node,RBAC --audit-log-maxage=30 --profiling=false --storage-backend=etcd3 --etcd-cafile=/etc/kubernetes/ssl/kube-ca.pem --etcd-servers=https://<node_ip>:2379 --kubelet-certificate-authority=/etc/kubernetes/ssl/kube-ca.pem --secure-port=6443 --tls-cipher-suites=TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305 --insecure-port=0 --api-audiences=unknown --audit-policy-file=/etc/kubernetes/audit-policy.yaml --etcd-prefix=/registry --kubelet-client-certificate=/etc/kubernetes/ssl/kube-apiserver.pem --kubelet-client-key=/etc/kubernetes/ssl/kube-apiserver-key.pem --proxy-client-key-file=/etc/kubernetes/ssl/kube-apiserver-proxy-client-key.pem --service-account-issuer=rke --service-account-signing-key-file=/etc/kubernetes/ssl/kube-service-account-token-key.pem --kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname --requestheader-group-headers=X-Remote-Group --cloud-provider= --proxy-client-cert-file=/etc/kubernetes/ssl/kube-apiserver-proxy-client.pem --service-node-port-range=30000-32767 --tls-cert-file=/etc/kubernetes/ssl/kube-apiserver.pem --tls-private-key-file=/etc/kubernetes/ssl/kube-apiserver-key.pem --anonymous-auth=false --audit-log-path=/var/log/kube-audit/audit-log.json --audit-log-maxbackup=10 --service-account-key-file=/etc/kubernetes/ssl/kube-service-account-token-key.pem --enable-admission-plugins=NamespaceLifecycle,LimitRanger,ServiceAccount,DefaultStorageClass,DefaultTolerationSeconds,MutatingAdmissionWebhook,ValidatingAdmissionWebhook,ResourceQuota,NodeRestriction,Priority,TaintNodesByCondition,PersistentVolumeClaimResize,PodSecurityPolicy,EventRateLimit --audit-log-format=json\n")),(0,a.kt)("h3",{id:"1220\u786e\u4fdd---secure-port-\u53c2\u6570\u672a\u8bbe\u7f6e\u4e3a-0\u81ea\u52a8"},"1.2.20\u786e\u4fdd --secure-port \u53c2\u6570\u672a\u8bbe\u7f6e\u4e3a 0\uff08\u81ea\u52a8\uff09"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1apass"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u5728 Master \u8282\u70b9\u4e0a\u7f16\u8f91 API Server pod \u89c4\u8303\u6587\u4ef6 /etc/kubernetes/manifests/kube-apiserver.yaml\uff0c\u5e76\u5220\u9664 ",(0,a.kt)("inlineCode",{parentName:"p"},"--secure-port")," \u53c2\u6570\u6216\u5c06\u5176\u8bbe\u7f6e\u4e3a\u53e6\u4e00\u4e2a\u6240\u9700\u7aef\u53e3\uff08\u975e\u96f6\uff09\u3002"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"/bin/ps -ef | grep kube-apiserver | grep -v grep\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u9884\u671f\u7ed3\u679c"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"6443 is greater than 0 OR '--secure-port' is not present\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u8fd4\u56de\u503c"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"root 121142 121120 7 12:27 ?00:06:28 kube-apiserver --audit-log-maxsize=100 --etcd-keyfile=/etc/kubernetes/ssl/kube-node-key.pem --service-cluster-ip-range=10.43.0.0/16 --encryption-provider-config=/etc/kubernetes/ssl/encryption.yaml --requestheader-username-headers=X-Remote-User --bind-address=0.0.0.0 --advertise-address=<node_ip> --requestheader-allowed-names=kube-apiserver-proxy-client --etcd-certfile=/etc/kubernetes/ssl/kube-node.pem --requestheader-client-ca-file=/etc/kubernetes/ssl/kube-apiserver-requestheader-ca.pem --allow-privileged=true --requestheader-extra-headers-prefix=X-Remote-Extra- --admission-control-config-file=/etc/kubernetes/admission.yaml --client-ca-file=/etc/kubernetes/ssl/kube-ca.pem --service-account-lookup=true --runtime-config=policy/v1beta1/podsecuritypolicy=true --authorization-mode=Node,RBAC --audit-log-maxage=30 --profiling=false --storage-backend=etcd3 --etcd-cafile=/etc/kubernetes/ssl/kube-ca.pem --etcd-servers=https://<node_ip>:2379 --kubelet-certificate-authority=/etc/kubernetes/ssl/kube-ca.pem --secure-port=6443 --tls-cipher-suites=TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305 --insecure-port=0 --api-audiences=unknown --audit-policy-file=/etc/kubernetes/audit-policy.yaml --etcd-prefix=/registry --kubelet-client-certificate=/etc/kubernetes/ssl/kube-apiserver.pem --kubelet-client-key=/etc/kubernetes/ssl/kube-apiserver-key.pem --proxy-client-key-file=/etc/kubernetes/ssl/kube-apiserver-proxy-client-key.pem --service-account-issuer=rke --service-account-signing-key-file=/etc/kubernetes/ssl/kube-service-account-token-key.pem --kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname --requestheader-group-headers=X-Remote-Group --cloud-provider= --proxy-client-cert-file=/etc/kubernetes/ssl/kube-apiserver-proxy-client.pem --service-node-port-range=30000-32767 --tls-cert-file=/etc/kubernetes/ssl/kube-apiserver.pem --tls-private-key-file=/etc/kubernetes/ssl/kube-apiserver-key.pem --anonymous-auth=false --audit-log-path=/var/log/kube-audit/audit-log.json --audit-log-maxbackup=10 --service-account-key-file=/etc/kubernetes/ssl/kube-service-account-token-key.pem --enable-admission-plugins=NamespaceLifecycle,LimitRanger,ServiceAccount,DefaultStorageClass,DefaultTolerationSeconds,MutatingAdmissionWebhook,ValidatingAdmissionWebhook,ResourceQuota,NodeRestriction,Priority,TaintNodesByCondition,PersistentVolumeClaimResize,PodSecurityPolicy,EventRateLimit --audit-log-format=json\n")),(0,a.kt)("h3",{id:"1221\u786e\u4fdd---profiling-\u53c2\u6570\u8bbe\u7f6e\u4e3a-false\u81ea\u52a8"},"1.2.21\u786e\u4fdd --profiling \u53c2\u6570\u8bbe\u7f6e\u4e3a false\uff08\u81ea\u52a8\uff09"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1apass"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u5728 Master \u8282\u70b9\u4e0a\u7f16\u8f91 API Server pod \u89c4\u8303\u6587\u4ef6 /etc/kubernetes/manifests/kube-apiserver.yaml \u5e76\u8bbe\u7f6e\u4ee5\u4e0b\u53c2\u6570\u3002\n--profiling=false"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"/bin/ps -ef | grep kube-apiserver | grep -v grep\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u9884\u671f\u7ed3\u679c"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"'false' is equal to 'false'\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u8fd4\u56de\u503c"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"root 121142 121120 7 12:27 ?00:06:28 kube-apiserver --audit-log-maxsize=100 --etcd-keyfile=/etc/kubernetes/ssl/kube-node-key.pem --service-cluster-ip-range=10.43.0.0/16 --encryption-provider-config=/etc/kubernetes/ssl/encryption.yaml --requestheader-username-headers=X-Remote-User --bind-address=0.0.0.0 --advertise-address=<node_ip> --requestheader-allowed-names=kube-apiserver-proxy-client --etcd-certfile=/etc/kubernetes/ssl/kube-node.pem --requestheader-client-ca-file=/etc/kubernetes/ssl/kube-apiserver-requestheader-ca.pem --allow-privileged=true --requestheader-extra-headers-prefix=X-Remote-Extra- --admission-control-config-file=/etc/kubernetes/admission.yaml --client-ca-file=/etc/kubernetes/ssl/kube-ca.pem --service-account-lookup=true --runtime-config=policy/v1beta1/podsecuritypolicy=true --authorization-mode=Node,RBAC --audit-log-maxage=30 --profiling=false --storage-backend=etcd3 --etcd-cafile=/etc/kubernetes/ssl/kube-ca.pem --etcd-servers=https://<node_ip>:2379 --kubelet-certificate-authority=/etc/kubernetes/ssl/kube-ca.pem --secure-port=6443 --tls-cipher-suites=TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305 --insecure-port=0 --api-audiences=unknown --audit-policy-file=/etc/kubernetes/audit-policy.yaml --etcd-prefix=/registry --kubelet-client-certificate=/etc/kubernetes/ssl/kube-apiserver.pem --kubelet-client-key=/etc/kubernetes/ssl/kube-apiserver-key.pem --proxy-client-key-file=/etc/kubernetes/ssl/kube-apiserver-proxy-client-key.pem --service-account-issuer=rke --service-account-signing-key-file=/etc/kubernetes/ssl/kube-service-account-token-key.pem --kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname --requestheader-group-headers=X-Remote-Group --cloud-provider= --proxy-client-cert-file=/etc/kubernetes/ssl/kube-apiserver-proxy-client.pem --service-node-port-range=30000-32767 --tls-cert-file=/etc/kubernetes/ssl/kube-apiserver.pem --tls-private-key-file=/etc/kubernetes/ssl/kube-apiserver-key.pem --anonymous-auth=false --audit-log-path=/var/log/kube-audit/audit-log.json --audit-log-maxbackup=10 --service-account-key-file=/etc/kubernetes/ssl/kube-service-account-token-key.pem --enable-admission-plugins=NamespaceLifecycle,LimitRanger,ServiceAccount,DefaultStorageClass,DefaultTolerationSeconds,MutatingAdmissionWebhook,ValidatingAdmissionWebhook,ResourceQuota,NodeRestriction,Priority,TaintNodesByCondition,PersistentVolumeClaimResize,PodSecurityPolicy,EventRateLimit --audit-log-format=json\n")),(0,a.kt)("h3",{id:"1222\u786e\u4fdd\u8bbe\u7f6e\u4e86---audit-log-path-\u53c2\u6570\u81ea\u52a8"},"1.2.22\u786e\u4fdd\u8bbe\u7f6e\u4e86 --audit-log-path \u53c2\u6570\uff08\u81ea\u52a8\uff09"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1apass"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u5728 Master \u8282\u70b9\u4e0a\u7f16\u8f91 API Server pod \u89c4\u8303\u6587\u4ef6 /etc/kubernetes/manifests/kube-apiserver.yaml\uff0c\u5e76\u5c06 ",(0,a.kt)("inlineCode",{parentName:"p"},"--audit-log-path")," \u53c2\u6570\u8bbe\u7f6e\u4e3a\u6240\u9700\u7684\u8def\u5f84\u4ee5\u53ca\u8981\u5199\u5165\u5ba1\u8ba1\u65e5\u5fd7\u7684\u6587\u4ef6\u3002\n\u4f8b\u5982\uff1a--audit-log-path=/var/log/apiserver/audit.log"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"/bin/ps -ef | grep kube-apiserver | grep -v grep\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u9884\u671f\u7ed3\u679c"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"'--audit-log-path' is present\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u8fd4\u56de\u503c"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"root 121142 121120 7 12:27 ?00:06:28 kube-apiserver --audit-log-maxsize=100 --etcd-keyfile=/etc/kubernetes/ssl/kube-node-key.pem --service-cluster-ip-range=10.43.0.0/16 --encryption-provider-config=/etc/kubernetes/ssl/encryption.yaml --requestheader-username-headers=X-Remote-User --bind-address=0.0.0.0 --advertise-address=<node_ip> --requestheader-allowed-names=kube-apiserver-proxy-client --etcd-certfile=/etc/kubernetes/ssl/kube-node.pem --requestheader-client-ca-file=/etc/kubernetes/ssl/kube-apiserver-requestheader-ca.pem --allow-privileged=true --requestheader-extra-headers-prefix=X-Remote-Extra- --admission-control-config-file=/etc/kubernetes/admission.yaml --client-ca-file=/etc/kubernetes/ssl/kube-ca.pem --service-account-lookup=true --runtime-config=policy/v1beta1/podsecuritypolicy=true --authorization-mode=Node,RBAC --audit-log-maxage=30 --profiling=false --storage-backend=etcd3 --etcd-cafile=/etc/kubernetes/ssl/kube-ca.pem --etcd-servers=https://<node_ip>:2379 --kubelet-certificate-authority=/etc/kubernetes/ssl/kube-ca.pem --secure-port=6443 --tls-cipher-suites=TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305 --insecure-port=0 --api-audiences=unknown --audit-policy-file=/etc/kubernetes/audit-policy.yaml --etcd-prefix=/registry --kubelet-client-certificate=/etc/kubernetes/ssl/kube-apiserver.pem --kubelet-client-key=/etc/kubernetes/ssl/kube-apiserver-key.pem --proxy-client-key-file=/etc/kubernetes/ssl/kube-apiserver-proxy-client-key.pem --service-account-issuer=rke --service-account-signing-key-file=/etc/kubernetes/ssl/kube-service-account-token-key.pem --kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname --requestheader-group-headers=X-Remote-Group --cloud-provider= --proxy-client-cert-file=/etc/kubernetes/ssl/kube-apiserver-proxy-client.pem --service-node-port-range=30000-32767 --tls-cert-file=/etc/kubernetes/ssl/kube-apiserver.pem --tls-private-key-file=/etc/kubernetes/ssl/kube-apiserver-key.pem --anonymous-auth=false --audit-log-path=/var/log/kube-audit/audit-log.json --audit-log-maxbackup=10 --service-account-key-file=/etc/kubernetes/ssl/kube-service-account-token-key.pem --enable-admission-plugins=NamespaceLifecycle,LimitRanger,ServiceAccount,DefaultStorageClass,DefaultTolerationSeconds,MutatingAdmissionWebhook,ValidatingAdmissionWebhook,ResourceQuota,NodeRestriction,Priority,TaintNodesByCondition,PersistentVolumeClaimResize,PodSecurityPolicy,EventRateLimit --audit-log-format=json\n")),(0,a.kt)("h3",{id:"1223\u786e\u4fdd\u5c06---audit-log-maxage-\u53c2\u6570\u8bbe\u7f6e\u4e3a-30-\u6216\u9002\u5f53\u7684\u6570\u503c\u81ea\u52a8"},"1.2.23\u786e\u4fdd\u5c06 --audit-log-maxage \u53c2\u6570\u8bbe\u7f6e\u4e3a 30 \u6216\u9002\u5f53\u7684\u6570\u503c\uff08\u81ea\u52a8\uff09"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1apass"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u5728 Master \u8282\u70b9\u4e0a\u7f16\u8f91 API Server pod \u89c4\u8303\u6587\u4ef6 /etc/kubernetes/manifests/kube-apiserver.yaml\uff0c\u5e76\u5c06 ",(0,a.kt)("inlineCode",{parentName:"p"},"--audit-log-maxage")," \u53c2\u6570\u8bbe\u7f6e\u4e3a 30 \u6216\u9002\u5f53\u7684\u5929\u6570\uff1a\n--audit-log-maxage=30"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"/bin/ps -ef | grep kube-apiserver | grep -v grep\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u9884\u671f\u7ed3\u679c"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"30 is greater or equal to 30\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u8fd4\u56de\u503c"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"root 121142 121120 7 12:27 ?00:06:28 kube-apiserver --audit-log-maxsize=100 --etcd-keyfile=/etc/kubernetes/ssl/kube-node-key.pem --service-cluster-ip-range=10.43.0.0/16 --encryption-provider-config=/etc/kubernetes/ssl/encryption.yaml --requestheader-username-headers=X-Remote-User --bind-address=0.0.0.0 --advertise-address=<node_ip> --requestheader-allowed-names=kube-apiserver-proxy-client --etcd-certfile=/etc/kubernetes/ssl/kube-node.pem --requestheader-client-ca-file=/etc/kubernetes/ssl/kube-apiserver-requestheader-ca.pem --allow-privileged=true --requestheader-extra-headers-prefix=X-Remote-Extra- --admission-control-config-file=/etc/kubernetes/admission.yaml --client-ca-file=/etc/kubernetes/ssl/kube-ca.pem --service-account-lookup=true --runtime-config=policy/v1beta1/podsecuritypolicy=true --authorization-mode=Node,RBAC --audit-log-maxage=30 --profiling=false --storage-backend=etcd3 --etcd-cafile=/etc/kubernetes/ssl/kube-ca.pem --etcd-servers=https://<node_ip>:2379 --kubelet-certificate-authority=/etc/kubernetes/ssl/kube-ca.pem --secure-port=6443 --tls-cipher-suites=TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305 --insecure-port=0 --api-audiences=unknown --audit-policy-file=/etc/kubernetes/audit-policy.yaml --etcd-prefix=/registry --kubelet-client-certificate=/etc/kubernetes/ssl/kube-apiserver.pem --kubelet-client-key=/etc/kubernetes/ssl/kube-apiserver-key.pem --proxy-client-key-file=/etc/kubernetes/ssl/kube-apiserver-proxy-client-key.pem --service-account-issuer=rke --service-account-signing-key-file=/etc/kubernetes/ssl/kube-service-account-token-key.pem --kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname --requestheader-group-headers=X-Remote-Group --cloud-provider= --proxy-client-cert-file=/etc/kubernetes/ssl/kube-apiserver-proxy-client.pem --service-node-port-range=30000-32767 --tls-cert-file=/etc/kubernetes/ssl/kube-apiserver.pem --tls-private-key-file=/etc/kubernetes/ssl/kube-apiserver-key.pem --anonymous-auth=false --audit-log-path=/var/log/kube-audit/audit-log.json --audit-log-maxbackup=10 --service-account-key-file=/etc/kubernetes/ssl/kube-service-account-token-key.pem --enable-admission-plugins=NamespaceLifecycle,LimitRanger,ServiceAccount,DefaultStorageClass,DefaultTolerationSeconds,MutatingAdmissionWebhook,ValidatingAdmissionWebhook,ResourceQuota,NodeRestriction,Priority,TaintNodesByCondition,PersistentVolumeClaimResize,PodSecurityPolicy,EventRateLimit --audit-log-format=json\n")),(0,a.kt)("h3",{id:"1224\u786e\u4fdd---audit-log-maxbackup-\u53c2\u6570\u8bbe\u7f6e\u4e3a-10-\u6216\u9002\u5f53\u7684\u6570\u503c\u81ea\u52a8"},"1.2.24\u786e\u4fdd --audit-log-maxbackup \u53c2\u6570\u8bbe\u7f6e\u4e3a 10 \u6216\u9002\u5f53\u7684\u6570\u503c\uff08\u81ea\u52a8\uff09"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1apass"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u5728 Master \u8282\u70b9\u4e0a\u7f16\u8f91 API Server pod \u89c4\u8303\u6587\u4ef6 /etc/kubernetes/manifests/kube-apiserver.yaml\uff0c\u5e76\u5c06 ",(0,a.kt)("inlineCode",{parentName:"p"},"--audit-log-maxbackup")," \u53c2\u6570\u8bbe\u7f6e\u4e3a 10 \u6216\u9002\u5f53\u7684\u6570\u503c\u3002\n--audit-log-maxbackup=10"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"/bin/ps -ef | grep kube-apiserver | grep -v grep\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u9884\u671f\u7ed3\u679c"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"10 is greater or equal to 10\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u8fd4\u56de\u503c"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"root 121142 121120 7 12:27 ?00:06:28 kube-apiserver --audit-log-maxsize=100 --etcd-keyfile=/etc/kubernetes/ssl/kube-node-key.pem --service-cluster-ip-range=10.43.0.0/16 --encryption-provider-config=/etc/kubernetes/ssl/encryption.yaml --requestheader-username-headers=X-Remote-User --bind-address=0.0.0.0 --advertise-address=<node_ip> --requestheader-allowed-names=kube-apiserver-proxy-client --etcd-certfile=/etc/kubernetes/ssl/kube-node.pem --requestheader-client-ca-file=/etc/kubernetes/ssl/kube-apiserver-requestheader-ca.pem --allow-privileged=true --requestheader-extra-headers-prefix=X-Remote-Extra- --admission-control-config-file=/etc/kubernetes/admission.yaml --client-ca-file=/etc/kubernetes/ssl/kube-ca.pem --service-account-lookup=true --runtime-config=policy/v1beta1/podsecuritypolicy=true --authorization-mode=Node,RBAC --audit-log-maxage=30 --profiling=false --storage-backend=etcd3 --etcd-cafile=/etc/kubernetes/ssl/kube-ca.pem --etcd-servers=https://<node_ip>:2379 --kubelet-certificate-authority=/etc/kubernetes/ssl/kube-ca.pem --secure-port=6443 --tls-cipher-suites=TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305 --insecure-port=0 --api-audiences=unknown --audit-policy-file=/etc/kubernetes/audit-policy.yaml --etcd-prefix=/registry --kubelet-client-certificate=/etc/kubernetes/ssl/kube-apiserver.pem --kubelet-client-key=/etc/kubernetes/ssl/kube-apiserver-key.pem --proxy-client-key-file=/etc/kubernetes/ssl/kube-apiserver-proxy-client-key.pem --service-account-issuer=rke --service-account-signing-key-file=/etc/kubernetes/ssl/kube-service-account-token-key.pem --kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname --requestheader-group-headers=X-Remote-Group --cloud-provider= --proxy-client-cert-file=/etc/kubernetes/ssl/kube-apiserver-proxy-client.pem --service-node-port-range=30000-32767 --tls-cert-file=/etc/kubernetes/ssl/kube-apiserver.pem --tls-private-key-file=/etc/kubernetes/ssl/kube-apiserver-key.pem --anonymous-auth=false --audit-log-path=/var/log/kube-audit/audit-log.json --audit-log-maxbackup=10 --service-account-key-file=/etc/kubernetes/ssl/kube-service-account-token-key.pem --enable-admission-plugins=NamespaceLifecycle,LimitRanger,ServiceAccount,DefaultStorageClass,DefaultTolerationSeconds,MutatingAdmissionWebhook,ValidatingAdmissionWebhook,ResourceQuota,NodeRestriction,Priority,TaintNodesByCondition,PersistentVolumeClaimResize,PodSecurityPolicy,EventRateLimit --audit-log-format=json\n")),(0,a.kt)("h3",{id:"1225\u786e\u4fdd---audit-log-maxsize-\u53c2\u6570\u8bbe\u7f6e\u4e3a-100-\u6216\u9002\u5f53\u7684\u6570\u503c\u81ea\u52a8"},"1.2.25\u786e\u4fdd --audit-log-maxsize \u53c2\u6570\u8bbe\u7f6e\u4e3a 100 \u6216\u9002\u5f53\u7684\u6570\u503c\uff08\u81ea\u52a8\uff09"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1apass"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u5728 Master \u8282\u70b9\u4e0a\u7f16\u8f91 API Server pod \u89c4\u8303\u6587\u4ef6 /etc/kubernetes/manifests/kube-apiserver.yaml\uff0c\u5e76\u5c06 ",(0,a.kt)("inlineCode",{parentName:"p"},"--audit-log-maxsize")," \u53c2\u6570\u8bbe\u7f6e\u4e3a\u9002\u5f53\u7684\u5927\u5c0f\uff08\u4ee5 MB \u4e3a\u5355\u4f4d\uff09\u3002\n\u4f8b\u5982\uff0c\u8981\u5c06\u5176\u8bbe\u7f6e\u4e3a 100 MB\uff1a\n--audit-log-maxsize=100"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"/bin/ps -ef | grep kube-apiserver | grep -v grep\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u9884\u671f\u7ed3\u679c"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"100 is greater or equal to 100\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u8fd4\u56de\u503c"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"root 121142 121120 7 12:27 ?00:06:28 kube-apiserver --audit-log-maxsize=100 --etcd-keyfile=/etc/kubernetes/ssl/kube-node-key.pem --service-cluster-ip-range=10.43.0.0/16 --encryption-provider-config=/etc/kubernetes/ssl/encryption.yaml --requestheader-username-headers=X-Remote-User --bind-address=0.0.0.0 --advertise-address=<node_ip> --requestheader-allowed-names=kube-apiserver-proxy-client --etcd-certfile=/etc/kubernetes/ssl/kube-node.pem --requestheader-client-ca-file=/etc/kubernetes/ssl/kube-apiserver-requestheader-ca.pem --allow-privileged=true --requestheader-extra-headers-prefix=X-Remote-Extra- --admission-control-config-file=/etc/kubernetes/admission.yaml --client-ca-file=/etc/kubernetes/ssl/kube-ca.pem --service-account-lookup=true --runtime-config=policy/v1beta1/podsecuritypolicy=true --authorization-mode=Node,RBAC --audit-log-maxage=30 --profiling=false --storage-backend=etcd3 --etcd-cafile=/etc/kubernetes/ssl/kube-ca.pem --etcd-servers=https://<node_ip>:2379 --kubelet-certificate-authority=/etc/kubernetes/ssl/kube-ca.pem --secure-port=6443 --tls-cipher-suites=TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305 --insecure-port=0 --api-audiences=unknown --audit-policy-file=/etc/kubernetes/audit-policy.yaml --etcd-prefix=/registry --kubelet-client-certificate=/etc/kubernetes/ssl/kube-apiserver.pem --kubelet-client-key=/etc/kubernetes/ssl/kube-apiserver-key.pem --proxy-client-key-file=/etc/kubernetes/ssl/kube-apiserver-proxy-client-key.pem --service-account-issuer=rke --service-account-signing-key-file=/etc/kubernetes/ssl/kube-service-account-token-key.pem --kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname --requestheader-group-headers=X-Remote-Group --cloud-provider= --proxy-client-cert-file=/etc/kubernetes/ssl/kube-apiserver-proxy-client.pem --service-node-port-range=30000-32767 --tls-cert-file=/etc/kubernetes/ssl/kube-apiserver.pem --tls-private-key-file=/etc/kubernetes/ssl/kube-apiserver-key.pem --anonymous-auth=false --audit-log-path=/var/log/kube-audit/audit-log.json --audit-log-maxbackup=10 --service-account-key-file=/etc/kubernetes/ssl/kube-service-account-token-key.pem --enable-admission-plugins=NamespaceLifecycle,LimitRanger,ServiceAccount,DefaultStorageClass,DefaultTolerationSeconds,MutatingAdmissionWebhook,ValidatingAdmissionWebhook,ResourceQuota,NodeRestriction,Priority,TaintNodesByCondition,PersistentVolumeClaimResize,PodSecurityPolicy,EventRateLimit --audit-log-format=json\n")),(0,a.kt)("h3",{id:"1226\u786e\u4fdd\u80fd\u6839\u636e\u9700\u8981\u8bbe\u7f6e---request-timeout-\u53c2\u6570\u81ea\u52a8"},"1.2.26\u786e\u4fdd\u80fd\u6839\u636e\u9700\u8981\u8bbe\u7f6e --request-timeout \u53c2\u6570\uff08\u81ea\u52a8\uff09"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1apass"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u7f16\u8f91 API Server pod \u89c4\u8303\u6587\u4ef6 /etc/kubernetes/manifests/kube-apiserver.yaml\uff0c\u5e76\u6839\u636e\u9700\u8981\u8bbe\u7f6e\u4ee5\u4e0b\u53c2\u6570\u3002\n\u4f8b\u5982\uff1a--request-timeout=300s"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"/bin/ps -ef | grep kube-apiserver | grep -v grep\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u9884\u671f\u7ed3\u679c"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"'--request-timeout' is not present OR '--request-timeout' is not present\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u8fd4\u56de\u503c"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"root 121142 121120 7 12:27 ?00:06:28 kube-apiserver --audit-log-maxsize=100 --etcd-keyfile=/etc/kubernetes/ssl/kube-node-key.pem --service-cluster-ip-range=10.43.0.0/16 --encryption-provider-config=/etc/kubernetes/ssl/encryption.yaml --requestheader-username-headers=X-Remote-User --bind-address=0.0.0.0 --advertise-address=<node_ip> --requestheader-allowed-names=kube-apiserver-proxy-client --etcd-certfile=/etc/kubernetes/ssl/kube-node.pem --requestheader-client-ca-file=/etc/kubernetes/ssl/kube-apiserver-requestheader-ca.pem --allow-privileged=true --requestheader-extra-headers-prefix=X-Remote-Extra- --admission-control-config-file=/etc/kubernetes/admission.yaml --client-ca-file=/etc/kubernetes/ssl/kube-ca.pem --service-account-lookup=true --runtime-config=policy/v1beta1/podsecuritypolicy=true --authorization-mode=Node,RBAC --audit-log-maxage=30 --profiling=false --storage-backend=etcd3 --etcd-cafile=/etc/kubernetes/ssl/kube-ca.pem --etcd-servers=https://<node_ip>:2379 --kubelet-certificate-authority=/etc/kubernetes/ssl/kube-ca.pem --secure-port=6443 --tls-cipher-suites=TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305 --insecure-port=0 --api-audiences=unknown --audit-policy-file=/etc/kubernetes/audit-policy.yaml --etcd-prefix=/registry --kubelet-client-certificate=/etc/kubernetes/ssl/kube-apiserver.pem --kubelet-client-key=/etc/kubernetes/ssl/kube-apiserver-key.pem --proxy-client-key-file=/etc/kubernetes/ssl/kube-apiserver-proxy-client-key.pem --service-account-issuer=rke --service-account-signing-key-file=/etc/kubernetes/ssl/kube-service-account-token-key.pem --kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname --requestheader-group-headers=X-Remote-Group --cloud-provider= --proxy-client-cert-file=/etc/kubernetes/ssl/kube-apiserver-proxy-client.pem --service-node-port-range=30000-32767 --tls-cert-file=/etc/kubernetes/ssl/kube-apiserver.pem --tls-private-key-file=/etc/kubernetes/ssl/kube-apiserver-key.pem --anonymous-auth=false --audit-log-path=/var/log/kube-audit/audit-log.json --audit-log-maxbackup=10 --service-account-key-file=/etc/kubernetes/ssl/kube-service-account-token-key.pem --enable-admission-plugins=NamespaceLifecycle,LimitRanger,ServiceAccount,DefaultStorageClass,DefaultTolerationSeconds,MutatingAdmissionWebhook,ValidatingAdmissionWebhook,ResourceQuota,NodeRestriction,Priority,TaintNodesByCondition,PersistentVolumeClaimResize,PodSecurityPolicy,EventRateLimit --audit-log-format=json\n")),(0,a.kt)("h3",{id:"1227\u786e\u4fdd---service-account-lookup-\u53c2\u6570\u8bbe\u7f6e\u4e3a-true\u81ea\u52a8"},"1.2.27\u786e\u4fdd --service-account-lookup \u53c2\u6570\u8bbe\u7f6e\u4e3a true\uff08\u81ea\u52a8\uff09"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1apass"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u5728 Master \u8282\u70b9\u4e0a\u7f16\u8f91 API Server pod \u89c4\u8303\u6587\u4ef6 /etc/kubernetes/manifests/kube-apiserver.yaml \u5e76\u8bbe\u7f6e\u4ee5\u4e0b\u53c2\u6570\u3002\n--service-account-lookup=true"),(0,a.kt)("p",null,"\u4f60\u4e5f\u53ef\u4ee5\u5220\u9664\u6b64\u6587\u4ef6\u7684 --service-account-lookup \u53c2\u6570\uff0c\u4ece\u800c\u4f7f\u9ed8\u8ba4\u8bbe\u7f6e\u751f\u6548\u3002"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"/bin/ps -ef | grep kube-apiserver | grep -v grep\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u9884\u671f\u7ed3\u679c"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"'--service-account-lookup' is not present OR 'true' is equal to 'true'\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u8fd4\u56de\u503c"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"root 121142 121120 7 12:27 ?00:06:28 kube-apiserver --audit-log-maxsize=100 --etcd-keyfile=/etc/kubernetes/ssl/kube-node-key.pem --service-cluster-ip-range=10.43.0.0/16 --encryption-provider-config=/etc/kubernetes/ssl/encryption.yaml --requestheader-username-headers=X-Remote-User --bind-address=0.0.0.0 --advertise-address=<node_ip> --requestheader-allowed-names=kube-apiserver-proxy-client --etcd-certfile=/etc/kubernetes/ssl/kube-node.pem --requestheader-client-ca-file=/etc/kubernetes/ssl/kube-apiserver-requestheader-ca.pem --allow-privileged=true --requestheader-extra-headers-prefix=X-Remote-Extra- --admission-control-config-file=/etc/kubernetes/admission.yaml --client-ca-file=/etc/kubernetes/ssl/kube-ca.pem --service-account-lookup=true --runtime-config=policy/v1beta1/podsecuritypolicy=true --authorization-mode=Node,RBAC --audit-log-maxage=30 --profiling=false --storage-backend=etcd3 --etcd-cafile=/etc/kubernetes/ssl/kube-ca.pem --etcd-servers=https://<node_ip>:2379 --kubelet-certificate-authority=/etc/kubernetes/ssl/kube-ca.pem --secure-port=6443 --tls-cipher-suites=TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305 --insecure-port=0 --api-audiences=unknown --audit-policy-file=/etc/kubernetes/audit-policy.yaml --etcd-prefix=/registry --kubelet-client-certificate=/etc/kubernetes/ssl/kube-apiserver.pem --kubelet-client-key=/etc/kubernetes/ssl/kube-apiserver-key.pem --proxy-client-key-file=/etc/kubernetes/ssl/kube-apiserver-proxy-client-key.pem --service-account-issuer=rke --service-account-signing-key-file=/etc/kubernetes/ssl/kube-service-account-token-key.pem --kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname --requestheader-group-headers=X-Remote-Group --cloud-provider= --proxy-client-cert-file=/etc/kubernetes/ssl/kube-apiserver-proxy-client.pem --service-node-port-range=30000-32767 --tls-cert-file=/etc/kubernetes/ssl/kube-apiserver.pem --tls-private-key-file=/etc/kubernetes/ssl/kube-apiserver-key.pem --anonymous-auth=false --audit-log-path=/var/log/kube-audit/audit-log.json --audit-log-maxbackup=10 --service-account-key-file=/etc/kubernetes/ssl/kube-service-account-token-key.pem --enable-admission-plugins=NamespaceLifecycle,LimitRanger,ServiceAccount,DefaultStorageClass,DefaultTolerationSeconds,MutatingAdmissionWebhook,ValidatingAdmissionWebhook,ResourceQuota,NodeRestriction,Priority,TaintNodesByCondition,PersistentVolumeClaimResize,PodSecurityPolicy,EventRateLimit --audit-log-format=json\n")),(0,a.kt)("h3",{id:"1228\u786e\u4fdd\u6839\u636e\u9700\u8981\u8bbe\u7f6e---service-account-key-file-\u53c2\u6570\u81ea\u52a8"},"1.2.28\u786e\u4fdd\u6839\u636e\u9700\u8981\u8bbe\u7f6e --service-account-key-file \u53c2\u6570\uff08\u81ea\u52a8\uff09"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1apass"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u5728 Master \u8282\u70b9\u4e0a\u7f16\u8f91 API Server pod \u89c4\u8303\u6587\u4ef6 /etc/kubernetes/manifests/kube-apiserver.yaml\uff0c\u5e76\u4e3a ServiceAccount \u5c06 ",(0,a.kt)("inlineCode",{parentName:"p"},"--service-account-key-file")," \u53c2\u6570\u8bbe\u7f6e\u4e3a\u516c\u94a5\u6587\u4ef6\uff1a\n",(0,a.kt)("inlineCode",{parentName:"p"},"--service-account-key-file=<filename>")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"/bin/ps -ef | grep kube-apiserver | grep -v grep\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u9884\u671f\u7ed3\u679c"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"'--service-account-key-file' is present\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u8fd4\u56de\u503c"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"root 121142 121120 7 12:27 ?00:06:28 kube-apiserver --audit-log-maxsize=100 --etcd-keyfile=/etc/kubernetes/ssl/kube-node-key.pem --service-cluster-ip-range=10.43.0.0/16 --encryption-provider-config=/etc/kubernetes/ssl/encryption.yaml --requestheader-username-headers=X-Remote-User --bind-address=0.0.0.0 --advertise-address=<node_ip> --requestheader-allowed-names=kube-apiserver-proxy-client --etcd-certfile=/etc/kubernetes/ssl/kube-node.pem --requestheader-client-ca-file=/etc/kubernetes/ssl/kube-apiserver-requestheader-ca.pem --allow-privileged=true --requestheader-extra-headers-prefix=X-Remote-Extra- --admission-control-config-file=/etc/kubernetes/admission.yaml --client-ca-file=/etc/kubernetes/ssl/kube-ca.pem --service-account-lookup=true --runtime-config=policy/v1beta1/podsecuritypolicy=true --authorization-mode=Node,RBAC --audit-log-maxage=30 --profiling=false --storage-backend=etcd3 --etcd-cafile=/etc/kubernetes/ssl/kube-ca.pem --etcd-servers=https://<node_ip>:2379 --kubelet-certificate-authority=/etc/kubernetes/ssl/kube-ca.pem --secure-port=6443 --tls-cipher-suites=TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305 --insecure-port=0 --api-audiences=unknown --audit-policy-file=/etc/kubernetes/audit-policy.yaml --etcd-prefix=/registry --kubelet-client-certificate=/etc/kubernetes/ssl/kube-apiserver.pem --kubelet-client-key=/etc/kubernetes/ssl/kube-apiserver-key.pem --proxy-client-key-file=/etc/kubernetes/ssl/kube-apiserver-proxy-client-key.pem --service-account-issuer=rke --service-account-signing-key-file=/etc/kubernetes/ssl/kube-service-account-token-key.pem --kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname --requestheader-group-headers=X-Remote-Group --cloud-provider= --proxy-client-cert-file=/etc/kubernetes/ssl/kube-apiserver-proxy-client.pem --service-node-port-range=30000-32767 --tls-cert-file=/etc/kubernetes/ssl/kube-apiserver.pem --tls-private-key-file=/etc/kubernetes/ssl/kube-apiserver-key.pem --anonymous-auth=false --audit-log-path=/var/log/kube-audit/audit-log.json --audit-log-maxbackup=10 --service-account-key-file=/etc/kubernetes/ssl/kube-service-account-token-key.pem --enable-admission-plugins=NamespaceLifecycle,LimitRanger,ServiceAccount,DefaultStorageClass,DefaultTolerationSeconds,MutatingAdmissionWebhook,ValidatingAdmissionWebhook,ResourceQuota,NodeRestriction,Priority,TaintNodesByCondition,PersistentVolumeClaimResize,PodSecurityPolicy,EventRateLimit --audit-log-format=json\n")),(0,a.kt)("h3",{id:"1229\u786e\u4fdd\u6839\u636e\u9700\u8981\u8bbe\u7f6e---etcd-certfile-\u548c---etcd-keyfile-\u53c2\u6570\u81ea\u52a8"},"1.2.29\u786e\u4fdd\u6839\u636e\u9700\u8981\u8bbe\u7f6e --etcd-certfile \u548c --etcd-keyfile \u53c2\u6570\uff08\u81ea\u52a8\uff09"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1apass"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u9075\u5faa Kubernetes \u6587\u6863\u8bbe\u7f6e apiserver \u548c etcd \u7684 TLS \u8fde\u63a5\u3002\n\u7136\u540e\uff0c\u5728 Master \u8282\u70b9\u4e0a\u7f16\u8f91 API Server pod \u89c4\u8303\u6587\u4ef6 /etc/kubernetes/manifests/kube-apiserver.yaml\uff0c\u5e76\u8bbe\u7f6e etcd \u8bc1\u4e66\u548c\u5bc6\u94a5\u6587\u4ef6\u53c2\u6570\u3002\n",(0,a.kt)("inlineCode",{parentName:"p"},"--etcd-certfile=<path/to/client-certificate-file>"),"\n",(0,a.kt)("inlineCode",{parentName:"p"},"--etcd-keyfile=<path/to/client-key-file>")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"/bin/ps -ef | grep kube-apiserver | grep -v grep\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u9884\u671f\u7ed3\u679c"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"'--etcd-certfile' is present AND '--etcd-keyfile' is present\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u8fd4\u56de\u503c"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"root 121142 121120 7 12:27 ?00:06:28 kube-apiserver --audit-log-maxsize=100 --etcd-keyfile=/etc/kubernetes/ssl/kube-node-key.pem --service-cluster-ip-range=10.43.0.0/16 --encryption-provider-config=/etc/kubernetes/ssl/encryption.yaml --requestheader-username-headers=X-Remote-User --bind-address=0.0.0.0 --advertise-address=<node_ip> --requestheader-allowed-names=kube-apiserver-proxy-client --etcd-certfile=/etc/kubernetes/ssl/kube-node.pem --requestheader-client-ca-file=/etc/kubernetes/ssl/kube-apiserver-requestheader-ca.pem --allow-privileged=true --requestheader-extra-headers-prefix=X-Remote-Extra- --admission-control-config-file=/etc/kubernetes/admission.yaml --client-ca-file=/etc/kubernetes/ssl/kube-ca.pem --service-account-lookup=true --runtime-config=policy/v1beta1/podsecuritypolicy=true --authorization-mode=Node,RBAC --audit-log-maxage=30 --profiling=false --storage-backend=etcd3 --etcd-cafile=/etc/kubernetes/ssl/kube-ca.pem --etcd-servers=https://<node_ip>:2379 --kubelet-certificate-authority=/etc/kubernetes/ssl/kube-ca.pem --secure-port=6443 --tls-cipher-suites=TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305 --insecure-port=0 --api-audiences=unknown --audit-policy-file=/etc/kubernetes/audit-policy.yaml --etcd-prefix=/registry --kubelet-client-certificate=/etc/kubernetes/ssl/kube-apiserver.pem --kubelet-client-key=/etc/kubernetes/ssl/kube-apiserver-key.pem --proxy-client-key-file=/etc/kubernetes/ssl/kube-apiserver-proxy-client-key.pem --service-account-issuer=rke --service-account-signing-key-file=/etc/kubernetes/ssl/kube-service-account-token-key.pem --kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname --requestheader-group-headers=X-Remote-Group --cloud-provider= --proxy-client-cert-file=/etc/kubernetes/ssl/kube-apiserver-proxy-client.pem --service-node-port-range=30000-32767 --tls-cert-file=/etc/kubernetes/ssl/kube-apiserver.pem --tls-private-key-file=/etc/kubernetes/ssl/kube-apiserver-key.pem --anonymous-auth=false --audit-log-path=/var/log/kube-audit/audit-log.json --audit-log-maxbackup=10 --service-account-key-file=/etc/kubernetes/ssl/kube-service-account-token-key.pem --enable-admission-plugins=NamespaceLifecycle,LimitRanger,ServiceAccount,DefaultStorageClass,DefaultTolerationSeconds,MutatingAdmissionWebhook,ValidatingAdmissionWebhook,ResourceQuota,NodeRestriction,Priority,TaintNodesByCondition,PersistentVolumeClaimResize,PodSecurityPolicy,EventRateLimit --audit-log-format=json\n")),(0,a.kt)("h3",{id:"1230\u786e\u4fdd\u6839\u636e\u9700\u8981\u8bbe\u7f6e---tls-cert-file-\u548c---tls-private-key-file-\u53c2\u6570\u81ea\u52a8"},"1.2.30\u786e\u4fdd\u6839\u636e\u9700\u8981\u8bbe\u7f6e --tls-cert-file \u548c --tls-private-key-file \u53c2\u6570\uff08\u81ea\u52a8\uff09"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1apass"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u9075\u5faa Kubernetes \u6587\u6863\u5e76\u5728 apiserver \u4e0a\u8bbe\u7f6e TLS \u8fde\u63a5\u3002\n\u7136\u540e\uff0c\u5728 Master \u8282\u70b9\u4e0a\u7f16\u8f91 API Server pod \u89c4\u8303\u6587\u4ef6 /etc/kubernetes/manifests/kube-apiserver.yaml\uff0c\u5e76\u8bbe\u7f6e TLS \u8bc1\u4e66\u548c\u79c1\u94a5\u6587\u4ef6\u53c2\u6570\u3002\n",(0,a.kt)("inlineCode",{parentName:"p"},"--tls-cert-file=<path/to/tls-certificate-file>"),"\n",(0,a.kt)("inlineCode",{parentName:"p"},"--tls-private-key-file=<path/to/tls-key-file>")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"/bin/ps -ef | grep kube-apiserver | grep -v grep\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u9884\u671f\u7ed3\u679c"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"'--tls-cert-file' is present AND '--tls-private-key-file' is present\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u8fd4\u56de\u503c"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"root 121142 121120 7 12:27 ?00:06:28 kube-apiserver --audit-log-maxsize=100 --etcd-keyfile=/etc/kubernetes/ssl/kube-node-key.pem --service-cluster-ip-range=10.43.0.0/16 --encryption-provider-config=/etc/kubernetes/ssl/encryption.yaml --requestheader-username-headers=X-Remote-User --bind-address=0.0.0.0 --advertise-address=<node_ip> --requestheader-allowed-names=kube-apiserver-proxy-client --etcd-certfile=/etc/kubernetes/ssl/kube-node.pem --requestheader-client-ca-file=/etc/kubernetes/ssl/kube-apiserver-requestheader-ca.pem --allow-privileged=true --requestheader-extra-headers-prefix=X-Remote-Extra- --admission-control-config-file=/etc/kubernetes/admission.yaml --client-ca-file=/etc/kubernetes/ssl/kube-ca.pem --service-account-lookup=true --runtime-config=policy/v1beta1/podsecuritypolicy=true --authorization-mode=Node,RBAC --audit-log-maxage=30 --profiling=false --storage-backend=etcd3 --etcd-cafile=/etc/kubernetes/ssl/kube-ca.pem --etcd-servers=https://<node_ip>:2379 --kubelet-certificate-authority=/etc/kubernetes/ssl/kube-ca.pem --secure-port=6443 --tls-cipher-suites=TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305 --insecure-port=0 --api-audiences=unknown --audit-policy-file=/etc/kubernetes/audit-policy.yaml --etcd-prefix=/registry --kubelet-client-certificate=/etc/kubernetes/ssl/kube-apiserver.pem --kubelet-client-key=/etc/kubernetes/ssl/kube-apiserver-key.pem --proxy-client-key-file=/etc/kubernetes/ssl/kube-apiserver-proxy-client-key.pem --service-account-issuer=rke --service-account-signing-key-file=/etc/kubernetes/ssl/kube-service-account-token-key.pem --kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname --requestheader-group-headers=X-Remote-Group --cloud-provider= --proxy-client-cert-file=/etc/kubernetes/ssl/kube-apiserver-proxy-client.pem --service-node-port-range=30000-32767 --tls-cert-file=/etc/kubernetes/ssl/kube-apiserver.pem --tls-private-key-file=/etc/kubernetes/ssl/kube-apiserver-key.pem --anonymous-auth=false --audit-log-path=/var/log/kube-audit/audit-log.json --audit-log-maxbackup=10 --service-account-key-file=/etc/kubernetes/ssl/kube-service-account-token-key.pem --enable-admission-plugins=NamespaceLifecycle,LimitRanger,ServiceAccount,DefaultStorageClass,DefaultTolerationSeconds,MutatingAdmissionWebhook,ValidatingAdmissionWebhook,ResourceQuota,NodeRestriction,Priority,TaintNodesByCondition,PersistentVolumeClaimResize,PodSecurityPolicy,EventRateLimit --audit-log-format=json\n")),(0,a.kt)("h3",{id:"1231\u786e\u4fdd\u6839\u636e\u9700\u8981\u8bbe\u7f6e---client-ca-file-\u53c2\u6570\u81ea\u52a8"},"1.2.31\u786e\u4fdd\u6839\u636e\u9700\u8981\u8bbe\u7f6e --client-ca-file \u53c2\u6570\uff08\u81ea\u52a8\uff09"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1apass"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u9075\u5faa Kubernetes \u6587\u6863\u5e76\u5728 apiserver \u4e0a\u8bbe\u7f6e TLS \u8fde\u63a5\u3002\n\u7136\u540e\uff0c\u5728 Master \u8282\u70b9\u4e0a\u7f16\u8f91 API Server pod \u89c4\u8303\u6587\u4ef6 /etc/kubernetes/manifests/kube-apiserver.yaml\uff0c\u5e76\u8bbe\u7f6e\u5ba2\u6237\u7aef CA \u6587\u4ef6\u3002\n",(0,a.kt)("inlineCode",{parentName:"p"},"--client-ca-file=<path/to/client-ca-file>")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"/bin/ps -ef | grep kube-apiserver | grep -v grep\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u9884\u671f\u7ed3\u679c"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"'--client-ca-file' is present\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u8fd4\u56de\u503c"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"root 121142 121120 7 12:27 ?00:06:28 kube-apiserver --audit-log-maxsize=100 --etcd-keyfile=/etc/kubernetes/ssl/kube-node-key.pem --service-cluster-ip-range=10.43.0.0/16 --encryption-provider-config=/etc/kubernetes/ssl/encryption.yaml --requestheader-username-headers=X-Remote-User --bind-address=0.0.0.0 --advertise-address=<node_ip> --requestheader-allowed-names=kube-apiserver-proxy-client --etcd-certfile=/etc/kubernetes/ssl/kube-node.pem --requestheader-client-ca-file=/etc/kubernetes/ssl/kube-apiserver-requestheader-ca.pem --allow-privileged=true --requestheader-extra-headers-prefix=X-Remote-Extra- --admission-control-config-file=/etc/kubernetes/admission.yaml --client-ca-file=/etc/kubernetes/ssl/kube-ca.pem --service-account-lookup=true --runtime-config=policy/v1beta1/podsecuritypolicy=true --authorization-mode=Node,RBAC --audit-log-maxage=30 --profiling=false --storage-backend=etcd3 --etcd-cafile=/etc/kubernetes/ssl/kube-ca.pem --etcd-servers=https://<node_ip>:2379 --kubelet-certificate-authority=/etc/kubernetes/ssl/kube-ca.pem --secure-port=6443 --tls-cipher-suites=TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305 --insecure-port=0 --api-audiences=unknown --audit-policy-file=/etc/kubernetes/audit-policy.yaml --etcd-prefix=/registry --kubelet-client-certificate=/etc/kubernetes/ssl/kube-apiserver.pem --kubelet-client-key=/etc/kubernetes/ssl/kube-apiserver-key.pem --proxy-client-key-file=/etc/kubernetes/ssl/kube-apiserver-proxy-client-key.pem --service-account-issuer=rke --service-account-signing-key-file=/etc/kubernetes/ssl/kube-service-account-token-key.pem --kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname --requestheader-group-headers=X-Remote-Group --cloud-provider= --proxy-client-cert-file=/etc/kubernetes/ssl/kube-apiserver-proxy-client.pem --service-node-port-range=30000-32767 --tls-cert-file=/etc/kubernetes/ssl/kube-apiserver.pem --tls-private-key-file=/etc/kubernetes/ssl/kube-apiserver-key.pem --anonymous-auth=false --audit-log-path=/var/log/kube-audit/audit-log.json --audit-log-maxbackup=10 --service-account-key-file=/etc/kubernetes/ssl/kube-service-account-token-key.pem --enable-admission-plugins=NamespaceLifecycle,LimitRanger,ServiceAccount,DefaultStorageClass,DefaultTolerationSeconds,MutatingAdmissionWebhook,ValidatingAdmissionWebhook,ResourceQuota,NodeRestriction,Priority,TaintNodesByCondition,PersistentVolumeClaimResize,PodSecurityPolicy,EventRateLimit --audit-log-format=json\n")),(0,a.kt)("h3",{id:"1232\u786e\u4fdd---etcd-cafile-\u53c2\u6570\u8bbe\u7f6e\u6b63\u786e\u81ea\u52a8"},"1.2.32\u786e\u4fdd --etcd-cafile \u53c2\u6570\u8bbe\u7f6e\u6b63\u786e\uff08\u81ea\u52a8\uff09"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1apass"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u9075\u5faa Kubernetes \u6587\u6863\u8bbe\u7f6e apiserver \u548c etcd \u7684 TLS \u8fde\u63a5\u3002\n\u7136\u540e\uff0c\u5728 Master \u8282\u70b9\u4e0a\u7f16\u8f91 API Server pod \u89c4\u8303\u6587\u4ef6 /etc/kubernetes/manifests/kube-apiserver.yaml\uff0c\u5e76\u8bbe\u7f6e etcd CA \u6587\u4ef6\u53c2\u6570\u3002\n",(0,a.kt)("inlineCode",{parentName:"p"},"--etcd-cafile=<path/to/ca-file>")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"/bin/ps -ef | grep kube-apiserver | grep -v grep\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u9884\u671f\u7ed3\u679c"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"'--etcd-cafile' is present\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u8fd4\u56de\u503c"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"root 121142 121120 7 12:27 ?00:06:28 kube-apiserver --audit-log-maxsize=100 --etcd-keyfile=/etc/kubernetes/ssl/kube-node-key.pem --service-cluster-ip-range=10.43.0.0/16 --encryption-provider-config=/etc/kubernetes/ssl/encryption.yaml --requestheader-username-headers=X-Remote-User --bind-address=0.0.0.0 --advertise-address=<node_ip> --requestheader-allowed-names=kube-apiserver-proxy-client --etcd-certfile=/etc/kubernetes/ssl/kube-node.pem --requestheader-client-ca-file=/etc/kubernetes/ssl/kube-apiserver-requestheader-ca.pem --allow-privileged=true --requestheader-extra-headers-prefix=X-Remote-Extra- --admission-control-config-file=/etc/kubernetes/admission.yaml --client-ca-file=/etc/kubernetes/ssl/kube-ca.pem --service-account-lookup=true --runtime-config=policy/v1beta1/podsecuritypolicy=true --authorization-mode=Node,RBAC --audit-log-maxage=30 --profiling=false --storage-backend=etcd3 --etcd-cafile=/etc/kubernetes/ssl/kube-ca.pem --etcd-servers=https://<node_ip>:2379 --kubelet-certificate-authority=/etc/kubernetes/ssl/kube-ca.pem --secure-port=6443 --tls-cipher-suites=TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305 --insecure-port=0 --api-audiences=unknown --audit-policy-file=/etc/kubernetes/audit-policy.yaml --etcd-prefix=/registry --kubelet-client-certificate=/etc/kubernetes/ssl/kube-apiserver.pem --kubelet-client-key=/etc/kubernetes/ssl/kube-apiserver-key.pem --proxy-client-key-file=/etc/kubernetes/ssl/kube-apiserver-proxy-client-key.pem --service-account-issuer=rke --service-account-signing-key-file=/etc/kubernetes/ssl/kube-service-account-token-key.pem --kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname --requestheader-group-headers=X-Remote-Group --cloud-provider= --proxy-client-cert-file=/etc/kubernetes/ssl/kube-apiserver-proxy-client.pem --service-node-port-range=30000-32767 --tls-cert-file=/etc/kubernetes/ssl/kube-apiserver.pem --tls-private-key-file=/etc/kubernetes/ssl/kube-apiserver-key.pem --anonymous-auth=false --audit-log-path=/var/log/kube-audit/audit-log.json --audit-log-maxbackup=10 --service-account-key-file=/etc/kubernetes/ssl/kube-service-account-token-key.pem --enable-admission-plugins=NamespaceLifecycle,LimitRanger,ServiceAccount,DefaultStorageClass,DefaultTolerationSeconds,MutatingAdmissionWebhook,ValidatingAdmissionWebhook,ResourceQuota,NodeRestriction,Priority,TaintNodesByCondition,PersistentVolumeClaimResize,PodSecurityPolicy,EventRateLimit --audit-log-format=json\n")),(0,a.kt)("h3",{id:"1233\u786e\u4fdd\u6839\u636e\u9700\u8981\u8bbe\u7f6e---encryption-provider-config-\u53c2\u6570\u81ea\u52a8"},"1.2.33\u786e\u4fdd\u6839\u636e\u9700\u8981\u8bbe\u7f6e --encryption-provider-config \u53c2\u6570\uff08\u81ea\u52a8\uff09"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1apass"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u6309\u7167 Kubernetes \u6587\u6863\u5e76\u914d\u7f6e EncryptionConfig \u6587\u4ef6\u3002\n\u7136\u540e\uff0c\u5728 Master \u8282\u70b9\u4e0a\u7f16\u8f91 API Server pod \u89c4\u8303\u6587\u4ef6 /etc/kubernetes/manifests/kube-apiserver.yaml\uff0c\u5e76\u5c06 ",(0,a.kt)("inlineCode",{parentName:"p"},"--encryption-provider-config")," \u53c2\u6570\u8bbe\u7f6e\u4e3a\u8be5\u6587\u4ef6\u7684\u8def\u5f84\uff1a\n--encryption-provider-config=</path/to/EncryptionConfig/File>"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"/bin/ps -ef | grep kube-apiserver | grep -v grep\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u9884\u671f\u7ed3\u679c"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"'--encryption-provider-config' is present\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u8fd4\u56de\u503c"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"root 121142 121120 7 12:27 ?00:06:28 kube-apiserver --audit-log-maxsize=100 --etcd-keyfile=/etc/kubernetes/ssl/kube-node-key.pem --service-cluster-ip-range=10.43.0.0/16 --encryption-provider-config=/etc/kubernetes/ssl/encryption.yaml --requestheader-username-headers=X-Remote-User --bind-address=0.0.0.0 --advertise-address=<node_ip> --requestheader-allowed-names=kube-apiserver-proxy-client --etcd-certfile=/etc/kubernetes/ssl/kube-node.pem --requestheader-client-ca-file=/etc/kubernetes/ssl/kube-apiserver-requestheader-ca.pem --allow-privileged=true --requestheader-extra-headers-prefix=X-Remote-Extra- --admission-control-config-file=/etc/kubernetes/admission.yaml --client-ca-file=/etc/kubernetes/ssl/kube-ca.pem --service-account-lookup=true --runtime-config=policy/v1beta1/podsecuritypolicy=true --authorization-mode=Node,RBAC --audit-log-maxage=30 --profiling=false --storage-backend=etcd3 --etcd-cafile=/etc/kubernetes/ssl/kube-ca.pem --etcd-servers=https://<node_ip>:2379 --kubelet-certificate-authority=/etc/kubernetes/ssl/kube-ca.pem --secure-port=6443 --tls-cipher-suites=TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305 --insecure-port=0 --api-audiences=unknown --audit-policy-file=/etc/kubernetes/audit-policy.yaml --etcd-prefix=/registry --kubelet-client-certificate=/etc/kubernetes/ssl/kube-apiserver.pem --kubelet-client-key=/etc/kubernetes/ssl/kube-apiserver-key.pem --proxy-client-key-file=/etc/kubernetes/ssl/kube-apiserver-proxy-client-key.pem --service-account-issuer=rke --service-account-signing-key-file=/etc/kubernetes/ssl/kube-service-account-token-key.pem --kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname --requestheader-group-headers=X-Remote-Group --cloud-provider= --proxy-client-cert-file=/etc/kubernetes/ssl/kube-apiserver-proxy-client.pem --service-node-port-range=30000-32767 --tls-cert-file=/etc/kubernetes/ssl/kube-apiserver.pem --tls-private-key-file=/etc/kubernetes/ssl/kube-apiserver-key.pem --anonymous-auth=false --audit-log-path=/var/log/kube-audit/audit-log.json --audit-log-maxbackup=10 --service-account-key-file=/etc/kubernetes/ssl/kube-service-account-token-key.pem --enable-admission-plugins=NamespaceLifecycle,LimitRanger,ServiceAccount,DefaultStorageClass,DefaultTolerationSeconds,MutatingAdmissionWebhook,ValidatingAdmissionWebhook,ResourceQuota,NodeRestriction,Priority,TaintNodesByCondition,PersistentVolumeClaimResize,PodSecurityPolicy,EventRateLimit --audit-log-format=json\n")),(0,a.kt)("h3",{id:"1234\u786e\u4fdd\u6b63\u786e\u914d\u7f6e\u52a0\u5bc6\u63d0\u4f9b\u7a0b\u5e8f\u81ea\u52a8"},"1.2.34\u786e\u4fdd\u6b63\u786e\u914d\u7f6e\u52a0\u5bc6\u63d0\u4f9b\u7a0b\u5e8f\uff08\u81ea\u52a8\uff09"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1apass"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u6309\u7167 Kubernetes \u6587\u6863\u5e76\u914d\u7f6e EncryptionConfig \u6587\u4ef6\u3002\n\u5728\u6b64\u6587\u4ef6\u4e2d\uff0c\u9009\u62e9 aescbc\u3001kms \u6216 secretbox \u4f5c\u4e3a\u52a0\u5bc6\u63d0\u4f9b\u7a0b\u5e8f\u3002"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1\u811a\u672c"),"\uff1a",(0,a.kt)("inlineCode",{parentName:"p"},"check_encryption_provider_config.sh")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},'#!/usr/bin/env bash\n\n# This script is used to check the encrption provider config is set to aesbc\n#\n# outputs:\n#   true/false\n\n# TODO: Figure out the file location from the kube-apiserver commandline args\nENCRYPTION_CONFIG_FILE="/node/etc/kubernetes/ssl/encryption.yaml"\n\nif [[ !-f "${ENCRYPTION_CONFIG_FILE}" ]]; then\n  echo "false"\n  exit\nfi\n\nfor provider in "$@"\ndo\n  if grep "$provider" "${ENCRYPTION_CONFIG_FILE}"; then\n    echo "true"\n    exit\n  fi\ndone\n\necho "false"\nexit\n\n')),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1\u6267\u884c"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"./check_encryption_provider_config.sh aescbc\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u9884\u671f\u7ed3\u679c"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"'true' is equal to 'true'\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u8fd4\u56de\u503c"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"- aescbc: true\n")),(0,a.kt)("h3",{id:"1235\u786e\u4fdd-api-server-\u4ec5\u4f7f\u7528\u5f3a\u5bc6\u7801\u81ea\u52a8"},"1.2.35\u786e\u4fdd API Server \u4ec5\u4f7f\u7528\u5f3a\u5bc6\u7801\uff08\u81ea\u52a8\uff09"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1awarn"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u5728 Master \u8282\u70b9\u4e0a\u7f16\u8f91 API Server pod \u89c4\u8303\u6587\u4ef6 /etc/kubernetes/manifests/kube-apiserver.yaml \u5e76\u8bbe\u7f6e\u4ee5\u4e0b\u53c2\u6570\u3002\n--tls-cipher-suites=TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_128_GCM\n_SHA256,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_AES_256_GCM\n_SHA384,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_ECDSA_WITH_AES_256_GCM\n_SHA384"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"/bin/ps -ef | grep kube-apiserver | grep -v grep\n")),(0,a.kt)("h2",{id:"13controller-manager"},"1.3Controller Manager"),(0,a.kt)("h3",{id:"131\u786e\u4fdd\u6b63\u786e\u8bbe\u7f6e---terminated-pod-gc-threshold-\u53c2\u6570\u81ea\u52a8"},"1.3.1\u786e\u4fdd\u6b63\u786e\u8bbe\u7f6e --terminated-pod-gc-threshold \u53c2\u6570\uff08\u81ea\u52a8\uff09"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1apass"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u5728 Master \u8282\u70b9\u4e0a\u7f16\u8f91 Controller Manager pod \u89c4\u8303\u6587\u4ef6 /etc/kubernetes/manifests/kube-controller-manager.yaml\uff0c\u5e76\u5c06 ",(0,a.kt)("inlineCode",{parentName:"p"},"--terminated-pod-gc-threshold")," \u8bbe\u7f6e\u4e3a\u9002\u5f53\u7684\u9608\u503c\u3002\n\u4f8b\u5982\uff1a--terminated-pod-gc-threshold=10"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"/bin/ps -ef | grep kube-controller-manager | grep -v grep\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u9884\u671f\u7ed3\u679c"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"'--terminated-pod-gc-threshold' is present\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u8fd4\u56de\u503c"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"root 121366 121346 1 12:27 ?00:01:13 kube-controller-manager --cluster-cidr=10.42.0.0/16 --kubeconfig=/etc/kubernetes/ssl/kubecfg-kube-controller-manager.yaml --allocate-node-cidrs=true --configure-cloud-routes=false --leader-elect=true --pod-eviction-timeout=5m0s --authentication-kubeconfig=/etc/kubernetes/ssl/kubecfg-kube-controller-manager.yaml --feature-gates=RotateKubeletServerCertificate=true --bind-address=127.0.0.1 --enable-hostpath-provisioner=false --address=127.0.0.1 --tls-cipher-suites=TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_AES_128_GCM_SHA256 --cloud-provider= --service-account-private-key-file=/etc/kubernetes/ssl/kube-service-account-token-key.pem --service-cluster-ip-range=10.43.0.0/16 --authorization-kubeconfig=/etc/kubernetes/ssl/kubecfg-kube-controller-manager.yaml --root-ca-file=/etc/kubernetes/ssl/kube-ca.pem --node-monitor-grace-period=40s --profiling=false --terminated-pod-gc-threshold=1000 --v=2 --allow-untagged-cloud=true --use-service-account-credentials=true\n")),(0,a.kt)("h3",{id:"132\u786e\u4fdd---profiling-\u53c2\u6570\u8bbe\u7f6e\u4e3a-false\u81ea\u52a8"},"1.3.2\u786e\u4fdd --profiling \u53c2\u6570\u8bbe\u7f6e\u4e3a false\uff08\u81ea\u52a8\uff09"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1apass"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u5728 Master \u8282\u70b9\u4e0a\u7f16\u8f91 Controller Manager pod \u89c4\u8303\u6587\u4ef6 /etc/kubernetes/manifests/kube-controller-manager.yaml\uff0c\u5e76\u8bbe\u7f6e\u4ee5\u4e0b\u53c2\u6570\u3002\n--profiling=false"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"/bin/ps -ef | grep kube-controller-manager | grep -v grep\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u9884\u671f\u7ed3\u679c"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"'false' is equal to 'false'\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u8fd4\u56de\u503c"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"root 121366 121346 1 12:27 ?00:01:13 kube-controller-manager --cluster-cidr=10.42.0.0/16 --kubeconfig=/etc/kubernetes/ssl/kubecfg-kube-controller-manager.yaml --allocate-node-cidrs=true --configure-cloud-routes=false --leader-elect=true --pod-eviction-timeout=5m0s --authentication-kubeconfig=/etc/kubernetes/ssl/kubecfg-kube-controller-manager.yaml --feature-gates=RotateKubeletServerCertificate=true --bind-address=127.0.0.1 --enable-hostpath-provisioner=false --address=127.0.0.1 --tls-cipher-suites=TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_AES_128_GCM_SHA256 --cloud-provider= --service-account-private-key-file=/etc/kubernetes/ssl/kube-service-account-token-key.pem --service-cluster-ip-range=10.43.0.0/16 --authorization-kubeconfig=/etc/kubernetes/ssl/kubecfg-kube-controller-manager.yaml --root-ca-file=/etc/kubernetes/ssl/kube-ca.pem --node-monitor-grace-period=40s --profiling=false --terminated-pod-gc-threshold=1000 --v=2 --allow-untagged-cloud=true --use-service-account-credentials=true\n")),(0,a.kt)("h3",{id:"133\u786e\u4fdd---use-service-account-credentials-\u53c2\u6570\u8bbe\u7f6e\u4e3a-true\u81ea\u52a8"},"1.3.3\u786e\u4fdd --use-service-account-credentials \u53c2\u6570\u8bbe\u7f6e\u4e3a true\uff08\u81ea\u52a8\uff09"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1apass"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u5728 Master \u8282\u70b9\u4e0a\u7f16\u8f91 Controller Manager pod \u89c4\u8303\u6587\u4ef6 /etc/kubernetes/manifests/kube-controller-manager.yaml\uff0c\u5e76\u8bbe\u7f6e\u4ee5\u4e0b\u53c2\u6570\u3002\n--use-service-account-credentials=true"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"/bin/ps -ef | grep kube-controller-manager | grep -v grep\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u9884\u671f\u7ed3\u679c"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"'true' is not equal to 'false'\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u8fd4\u56de\u503c"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"root 121366 121346 1 12:27 ?00:01:13 kube-controller-manager --cluster-cidr=10.42.0.0/16 --kubeconfig=/etc/kubernetes/ssl/kubecfg-kube-controller-manager.yaml --allocate-node-cidrs=true --configure-cloud-routes=false --leader-elect=true --pod-eviction-timeout=5m0s --authentication-kubeconfig=/etc/kubernetes/ssl/kubecfg-kube-controller-manager.yaml --feature-gates=RotateKubeletServerCertificate=true --bind-address=127.0.0.1 --enable-hostpath-provisioner=false --address=127.0.0.1 --tls-cipher-suites=TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_AES_128_GCM_SHA256 --cloud-provider= --service-account-private-key-file=/etc/kubernetes/ssl/kube-service-account-token-key.pem --service-cluster-ip-range=10.43.0.0/16 --authorization-kubeconfig=/etc/kubernetes/ssl/kubecfg-kube-controller-manager.yaml --root-ca-file=/etc/kubernetes/ssl/kube-ca.pem --node-monitor-grace-period=40s --profiling=false --terminated-pod-gc-threshold=1000 --v=2 --allow-untagged-cloud=true --use-service-account-credentials=true\n")),(0,a.kt)("h3",{id:"134\u786e\u4fdd\u6839\u636e\u9700\u8981\u8bbe\u7f6e---service-account-private-key-file-\u53c2\u6570\u81ea\u52a8"},"1.3.4\u786e\u4fdd\u6839\u636e\u9700\u8981\u8bbe\u7f6e --service-account-private-key-file \u53c2\u6570\uff08\u81ea\u52a8\uff09"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1apass"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u5728 Master \u8282\u70b9\u4e0a\u7f16\u8f91 Controller Manager pod \u89c4\u8303\u6587\u4ef6 /etc/kubernetes/manifests/kube-controller-manager.yaml\uff0c\u5e76\u4e3a ServiceAccount \u5c06 ",(0,a.kt)("inlineCode",{parentName:"p"},"--service-account-private-key-file")," \u53c2\u6570\u8bbe\u7f6e\u4e3a\u79c1\u94a5\u6587\u4ef6\u3002\n",(0,a.kt)("inlineCode",{parentName:"p"},"--service-account-private-key-file=<filename>")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"/bin/ps -ef | grep kube-controller-manager | grep -v grep\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u9884\u671f\u7ed3\u679c"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"'--service-account-private-key-file' is present\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u8fd4\u56de\u503c"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"root 121366 121346 1 12:27 ?00:01:13 kube-controller-manager --cluster-cidr=10.42.0.0/16 --kubeconfig=/etc/kubernetes/ssl/kubecfg-kube-controller-manager.yaml --allocate-node-cidrs=true --configure-cloud-routes=false --leader-elect=true --pod-eviction-timeout=5m0s --authentication-kubeconfig=/etc/kubernetes/ssl/kubecfg-kube-controller-manager.yaml --feature-gates=RotateKubeletServerCertificate=true --bind-address=127.0.0.1 --enable-hostpath-provisioner=false --address=127.0.0.1 --tls-cipher-suites=TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_AES_128_GCM_SHA256 --cloud-provider= --service-account-private-key-file=/etc/kubernetes/ssl/kube-service-account-token-key.pem --service-cluster-ip-range=10.43.0.0/16 --authorization-kubeconfig=/etc/kubernetes/ssl/kubecfg-kube-controller-manager.yaml --root-ca-file=/etc/kubernetes/ssl/kube-ca.pem --node-monitor-grace-period=40s --profiling=false --terminated-pod-gc-threshold=1000 --v=2 --allow-untagged-cloud=true --use-service-account-credentials=true\n")),(0,a.kt)("h3",{id:"135\u786e\u4fdd\u6839\u636e\u9700\u8981\u8bbe\u7f6e---root-ca-file-\u53c2\u6570\u81ea\u52a8"},"1.3.5\u786e\u4fdd\u6839\u636e\u9700\u8981\u8bbe\u7f6e --root-ca-file \u53c2\u6570\uff08\u81ea\u52a8\uff09"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1apass"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u5728 Master \u8282\u70b9\u4e0a\u7f16\u8f91 Controller Manager pod \u89c4\u8303\u6587\u4ef6 /etc/kubernetes/manifests/kube-controller-manager.yaml\uff0c\u5e76\u5c06 ",(0,a.kt)("inlineCode",{parentName:"p"},"--root-ca-file")," \u53c2\u6570\u8bbe\u7f6e\u4e3a\u8bc1\u4e66\u7ed1\u5b9a\u6587\u4ef6\u3002\n",(0,a.kt)("inlineCode",{parentName:"p"},"--root-ca-file=<path/to/file>")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"/bin/ps -ef | grep kube-controller-manager | grep -v grep\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u9884\u671f\u7ed3\u679c"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"'--root-ca-file' is present\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u8fd4\u56de\u503c"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"root 121366 121346 1 12:27 ?00:01:13 kube-controller-manager --cluster-cidr=10.42.0.0/16 --kubeconfig=/etc/kubernetes/ssl/kubecfg-kube-controller-manager.yaml --allocate-node-cidrs=true --configure-cloud-routes=false --leader-elect=true --pod-eviction-timeout=5m0s --authentication-kubeconfig=/etc/kubernetes/ssl/kubecfg-kube-controller-manager.yaml --feature-gates=RotateKubeletServerCertificate=true --bind-address=127.0.0.1 --enable-hostpath-provisioner=false --address=127.0.0.1 --tls-cipher-suites=TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_AES_128_GCM_SHA256 --cloud-provider= --service-account-private-key-file=/etc/kubernetes/ssl/kube-service-account-token-key.pem --service-cluster-ip-range=10.43.0.0/16 --authorization-kubeconfig=/etc/kubernetes/ssl/kubecfg-kube-controller-manager.yaml --root-ca-file=/etc/kubernetes/ssl/kube-ca.pem --node-monitor-grace-period=40s --profiling=false --terminated-pod-gc-threshold=1000 --v=2 --allow-untagged-cloud=true --use-service-account-credentials=true\n")),(0,a.kt)("h3",{id:"136\u786e\u4fdd-rotatekubeletservercertificate-\u53c2\u6570\u8bbe\u7f6e\u4e3a-true\u81ea\u52a8"},"1.3.6\u786e\u4fdd RotateKubeletServerCertificate \u53c2\u6570\u8bbe\u7f6e\u4e3a true\uff08\u81ea\u52a8\uff09"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1aNot Applicable"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u5728 Master \u8282\u70b9\u4e0a\u7f16\u8f91 Controller Manager pod \u89c4\u8303\u6587\u4ef6 /etc/kubernetes/manifests/kube-controller-manager.yaml\uff0c\u5e76\u5c06 ",(0,a.kt)("inlineCode",{parentName:"p"},"--feature-gates")," \u53c2\u6570\u8bbe\u7f6e\u4e3a\u5305\u542b ",(0,a.kt)("inlineCode",{parentName:"p"},"RotateKubeletServerCertificate=true"),"\u3002\n--feature-gates=RotateKubeletServerCertificate=true"),(0,a.kt)("p",null,"RKE \u914d\u7f6e\u7684\u96c6\u7fa4\u76f4\u63a5\u4f7f\u7528 RKE \u5904\u7406\u8bc1\u4e66\u8f6e\u6362\u3002"),(0,a.kt)("h3",{id:"137\u786e\u4fdd---bind-address-\u53c2\u6570\u8bbe\u7f6e\u4e3a-127001\u81ea\u52a8"},"1.3.7\u786e\u4fdd --bind-address \u53c2\u6570\u8bbe\u7f6e\u4e3a 127.0.0.1\uff08\u81ea\u52a8\uff09"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1apass"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u5728 Master \u8282\u70b9\u4e0a\u7f16\u8f91 Controller Manager pod \u89c4\u8303\u6587\u4ef6 /etc/kubernetes/manifests/kube-controller-manager.yaml\uff0c\u5e76\u786e\u4fdd ",(0,a.kt)("inlineCode",{parentName:"p"},"--bind-address")," \u53c2\u6570\u7684\u503c\u6b63\u786e\u3002"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"/bin/ps -ef | grep kube-controller-manager | grep -v grep\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u9884\u671f\u7ed3\u679c"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"'127.0.0.1' is equal to '127.0.0.1' OR '--bind-address' is not present\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u8fd4\u56de\u503c"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"root 121366 121346 1 12:27 ?00:01:13 kube-controller-manager --cluster-cidr=10.42.0.0/16 --kubeconfig=/etc/kubernetes/ssl/kubecfg-kube-controller-manager.yaml --allocate-node-cidrs=true --configure-cloud-routes=false --leader-elect=true --pod-eviction-timeout=5m0s --authentication-kubeconfig=/etc/kubernetes/ssl/kubecfg-kube-controller-manager.yaml --feature-gates=RotateKubeletServerCertificate=true --bind-address=127.0.0.1 --enable-hostpath-provisioner=false --address=127.0.0.1 --tls-cipher-suites=TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_AES_128_GCM_SHA256 --cloud-provider= --service-account-private-key-file=/etc/kubernetes/ssl/kube-service-account-token-key.pem --service-cluster-ip-range=10.43.0.0/16 --authorization-kubeconfig=/etc/kubernetes/ssl/kubecfg-kube-controller-manager.yaml --root-ca-file=/etc/kubernetes/ssl/kube-ca.pem --node-monitor-grace-period=40s --profiling=false --terminated-pod-gc-threshold=1000 --v=2 --allow-untagged-cloud=true --use-service-account-credentials=true\n")),(0,a.kt)("h2",{id:"14scheduler"},"1.4Scheduler"),(0,a.kt)("h3",{id:"141\u786e\u4fdd---profiling-\u53c2\u6570\u8bbe\u7f6e\u4e3a-false\u81ea\u52a8"},"1.4.1\u786e\u4fdd --profiling \u53c2\u6570\u8bbe\u7f6e\u4e3a false\uff08\u81ea\u52a8\uff09"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1apass"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u5728 Master \u8282\u70b9\u4e0a\u7f16\u8f91 Scheduler pod \u89c4\u8303\u6587\u4ef6 /etc/kubernetes/manifests/kube-scheduler.yaml \u6587\u4ef6\uff0c\u5e76\u8bbe\u7f6e\u4ee5\u4e0b\u53c2\u6570\u3002\n--profiling=false"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"/bin/ps -ef | grep kube-scheduler | grep -v grep\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u9884\u671f\u7ed3\u679c"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"'false' is equal to 'false'\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u8fd4\u56de\u503c"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"root 121587 121567 0 12:27 ?00:00:12 kube-scheduler --kubeconfig=/etc/kubernetes/ssl/kubecfg-kube-scheduler.yaml --address=127.0.0.1 --leader-elect=true --profiling=false --v=2 --bind-address=127.0.0.1 --tls-cipher-suites=TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_AES_128_GCM_SHA256\n")),(0,a.kt)("h3",{id:"142\u786e\u4fdd---bind-address-\u53c2\u6570\u8bbe\u7f6e\u4e3a-127001\u81ea\u52a8"},"1.4.2\u786e\u4fdd --bind-address \u53c2\u6570\u8bbe\u7f6e\u4e3a 127.0.0.1\uff08\u81ea\u52a8\uff09"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1apass"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u5728 Master \u8282\u70b9\u4e0a\u7f16\u8f91 Scheduler pod \u89c4\u8303\u6587\u4ef6 /etc/kubernetes/manifests/kube-scheduler.yaml\uff0c\u5e76\u786e\u4fdd ",(0,a.kt)("inlineCode",{parentName:"p"},"--bind-address")," \u53c2\u6570\u7684\u503c\u6b63\u786e\u3002"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"/bin/ps -ef | grep kube-scheduler | grep -v grep\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u9884\u671f\u7ed3\u679c"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"'127.0.0.1' is equal to '127.0.0.1' OR '--bind-address' is not present\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u8fd4\u56de\u503c"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"root 121587 121567 0 12:27 ?00:00:12 kube-scheduler --kubeconfig=/etc/kubernetes/ssl/kubecfg-kube-scheduler.yaml --address=127.0.0.1 --leader-elect=true --profiling=false --v=2 --bind-address=127.0.0.1 --tls-cipher-suites=TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_AES_128_GCM_SHA256\n")),(0,a.kt)("h2",{id:"2-etcd-node-configuration-files"},"2 Etcd Node Configuration Files"),(0,a.kt)("h3",{id:"21\u786e\u4fdd\u6839\u636e\u9700\u8981\u8bbe\u7f6e---cert-file-\u548c---key-file-\u53c2\u6570\u81ea\u52a8"},"2.1\u786e\u4fdd\u6839\u636e\u9700\u8981\u8bbe\u7f6e --cert-file \u548c --key-file \u53c2\u6570\uff08\u81ea\u52a8\uff09"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1apass"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u6309\u7167 etcd \u670d\u52a1\u6587\u6863\u914d\u7f6e TLS \u52a0\u5bc6\u3002\n\u7136\u540e\uff0c\u5728 Master \u8282\u70b9\u4e0a\u7f16\u8f91 etcd pod \u89c4\u8303\u6587\u4ef6 /etc/kubernetes/manifests/etcd.yaml\uff0c\u5e76\u8bbe\u7f6e\u4ee5\u4e0b\u53c2\u6570\u3002\n",(0,a.kt)("inlineCode",{parentName:"p"},"--cert-file=</path/to/ca-file>"),"\n",(0,a.kt)("inlineCode",{parentName:"p"},"--key-file=</path/to/key-file>")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"/bin/ps -ef | /bin/grep etcd | /bin/grep -v grep\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u9884\u671f\u7ed3\u679c"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"'--cert-file' is present AND '--key-file' is present\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u8fd4\u56de\u503c"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"etcd 120679 120657 1 12:27 ?00:01:17 /usr/local/bin/etcd --trusted-ca-file=/etc/kubernetes/ssl/kube-ca.pem --cert-file=/etc/kubernetes/ssl/kube-etcd-<node_ip>.pem --heartbeat-interval=500 --election-timeout=5000 --initial-cluster-token=etcd-cluster-1 --initial-cluster=etcd-<external_ip>=https://<node_ip>:2380 --peer-trusted-ca-file=/etc/kubernetes/ssl/kube-ca.pem --peer-cert-file=/etc/kubernetes/ssl/kube-etcd-<node_ip>.pem --peer-key-file=/etc/kubernetes/ssl/kube-etcd-<node_ip>-key.pem --peer-client-cert-auth=true --data-dir=/var/lib/rancher/etcd/ --initial-advertise-peer-urls=https://<node_ip>:2380 --initial-cluster-state=new --advertise-client-urls=https://<node_ip>:2379 --client-cert-auth=true --enable-v2=true --name=etcd-<external_ip> --listen-client-urls=https://<node_ip>:2379 --listen-peer-urls=https://<node_ip>:2380 --key-file=/etc/kubernetes/ssl/kube-etcd-<node_ip>-key.pem --cipher-suites=TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384 root 120728 120707 0 12:27 ?00:00:00 /opt/rke-tools/rke-etcd-backup etcd-backup save --cacert /etc/kubernetes/ssl/kube-ca.pem --cert /etc/kubernetes/ssl/kube-node.pem --key /etc/kubernetes/ssl/kube-node-key.pem --name etcd-rolling-snapshots --endpoints=<node_ip>:2379 --retention=72h --creation=12h root 121142 121120 7 12:27 ?00:06:27 kube-apiserver --audit-log-maxsize=100 --etcd-keyfile=/etc/kubernetes/ssl/kube-node-key.pem --service-cluster-ip-range=10.43.0.0/16 --encryption-provider-config=/etc/kubernetes/ssl/encryption.yaml --requestheader-username-headers=X-Remote-User --bind-address=0.0.0.0 --advertise-address=<node_ip> --requestheader-allowed-names=kube-apiserver-proxy-client --etcd-certfile=/etc/kubernetes/ssl/kube-node.pem --requestheader-client-ca-file=/etc/kubernetes/ssl/kube-apiserver-requestheader-ca.pem --allow-privileged=true --requestheader-extra-headers-prefix=X-Remote-Extra- --admission-control-config-file=/etc/kubernetes/admission.yaml --client-ca-file=/etc/kubernetes/ssl/kube-ca.pem --service-account-lookup=true --runtime-config=policy/v1beta1/podsecuritypolicy=true --authorization-mode=Node,RBAC --audit-log-maxage=30 --profiling=false --storage-backend=etcd3 --etcd-cafile=/etc/kubernetes/ssl/kube-ca.pem --etcd-servers=https://<node_ip>:2379 --kubelet-certificate-authority=/etc/kubernetes/ssl/kube-ca.pem --secure-port=6443 --tls-cipher-suites=TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305 --insecure-port=0 --api-audiences=unknown --audit-policy-file=/etc/kubernetes/audit-policy.yaml --etcd-prefix=/registry --kubelet-client-certificate=/etc/kubernetes/ssl/kube-apiserver.pem --kubelet-client-key=/etc/kubernetes/ssl/kube-apiserver-key.pem --proxy-client-key-file=/etc/kubernetes/ssl/kube-apiserver-proxy-client-key.pem --service-account-issuer=rke --service-account-signing-key-file=/etc/kubernetes/ssl/kube-service-account-token-key.pem --kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname --requestheader-group-headers=X-Remote-Group --cloud-provider= --proxy-client-cert-file=/etc/kubernetes/ssl/kube-apiserver-proxy-client.pem --service-node-port-range=30000-32767 --tls-cert-file=/etc/kubernetes/ssl/kube-apiserver.pem --tls-private-key-file=/etc/kubernetes/ssl/kube-apiserver-key.pem --anonymous-auth=false --audit-log-path=/var/log/kube-audit/audit-log.json --audit-log-maxbackup=10 --service-account-key-file=/etc/kubernetes/ssl/kube-service-account-token-key.pem --enable-admission-plugins=NamespaceLifecycle,LimitRanger,ServiceAccount,DefaultStorageClass,DefaultTolerationSeconds,MutatingAdmissionWebhook,ValidatingAdmissionWebhook,ResourceQuota,NodeRestriction,Priority,TaintNodesByCondition,PersistentVolumeClaimResize,PodSecurityPolicy,EventRateLimit --audit-log-format=json root 214939 214868 2 13:56 ?00:00:00 kube-bench run --targets etcd --scored --nosummary --noremediations --v=5 --config-dir=/etc/kube-bench/cfg --benchmark rke-cis-1.6-hardened --json --log_dir /tmp/results/logs --outputfile /tmp/results/etcd.json\n")),(0,a.kt)("h3",{id:"22\u786e\u4fdd---client-cert-auth-\u53c2\u6570\u8bbe\u7f6e\u4e3a-true\u81ea\u52a8"},"2.2\u786e\u4fdd --client-cert-auth \u53c2\u6570\u8bbe\u7f6e\u4e3a true\uff08\u81ea\u52a8\uff09"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1apass"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),'\uff1a\n\u5728 Master \u8282\u70b9\u4e0a\u7f16\u8f91 etcd pod \u89c4\u8303\u6587\u4ef6 /etc/kubernetes/manifests/etcd.yaml\uff0c\u5e76\u8bbe\u7f6e\u4ee5\u4e0b\u53c2\u6570\u3002\n--client-cert-auth="true"'),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"/bin/ps -ef | /bin/grep etcd | /bin/grep -v grep\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u9884\u671f\u7ed3\u679c"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"'--client-cert-auth' is present OR 'true' is equal to 'true'\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u8fd4\u56de\u503c"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"etcd 120679 120657 1 12:27 ?00:01:17 /usr/local/bin/etcd --trusted-ca-file=/etc/kubernetes/ssl/kube-ca.pem --cert-file=/etc/kubernetes/ssl/kube-etcd-<node_ip>.pem --heartbeat-interval=500 --election-timeout=5000 --initial-cluster-token=etcd-cluster-1 --initial-cluster=etcd-<external_ip>=https://<node_ip>:2380 --peer-trusted-ca-file=/etc/kubernetes/ssl/kube-ca.pem --peer-cert-file=/etc/kubernetes/ssl/kube-etcd-<node_ip>.pem --peer-key-file=/etc/kubernetes/ssl/kube-etcd-<node_ip>-key.pem --peer-client-cert-auth=true --data-dir=/var/lib/rancher/etcd/ --initial-advertise-peer-urls=https://<node_ip>:2380 --initial-cluster-state=new --advertise-client-urls=https://<node_ip>:2379 --client-cert-auth=true --enable-v2=true --name=etcd-<external_ip> --listen-client-urls=https://<node_ip>:2379 --listen-peer-urls=https://<node_ip>:2380 --key-file=/etc/kubernetes/ssl/kube-etcd-<node_ip>-key.pem --cipher-suites=TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384 root 120728 120707 0 12:27 ?00:00:00 /opt/rke-tools/rke-etcd-backup etcd-backup save --cacert /etc/kubernetes/ssl/kube-ca.pem --cert /etc/kubernetes/ssl/kube-node.pem --key /etc/kubernetes/ssl/kube-node-key.pem --name etcd-rolling-snapshots --endpoints=<node_ip>:2379 --retention=72h --creation=12h root 121142 121120 7 12:27 ?00:06:27 kube-apiserver --audit-log-maxsize=100 --etcd-keyfile=/etc/kubernetes/ssl/kube-node-key.pem --service-cluster-ip-range=10.43.0.0/16 --encryption-provider-config=/etc/kubernetes/ssl/encryption.yaml --requestheader-username-headers=X-Remote-User --bind-address=0.0.0.0 --advertise-address=<node_ip> --requestheader-allowed-names=kube-apiserver-proxy-client --etcd-certfile=/etc/kubernetes/ssl/kube-node.pem --requestheader-client-ca-file=/etc/kubernetes/ssl/kube-apiserver-requestheader-ca.pem --allow-privileged=true --requestheader-extra-headers-prefix=X-Remote-Extra- --admission-control-config-file=/etc/kubernetes/admission.yaml --client-ca-file=/etc/kubernetes/ssl/kube-ca.pem --service-account-lookup=true --runtime-config=policy/v1beta1/podsecuritypolicy=true --authorization-mode=Node,RBAC --audit-log-maxage=30 --profiling=false --storage-backend=etcd3 --etcd-cafile=/etc/kubernetes/ssl/kube-ca.pem --etcd-servers=https://<node_ip>:2379 --kubelet-certificate-authority=/etc/kubernetes/ssl/kube-ca.pem --secure-port=6443 --tls-cipher-suites=TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305 --insecure-port=0 --api-audiences=unknown --audit-policy-file=/etc/kubernetes/audit-policy.yaml --etcd-prefix=/registry --kubelet-client-certificate=/etc/kubernetes/ssl/kube-apiserver.pem --kubelet-client-key=/etc/kubernetes/ssl/kube-apiserver-key.pem --proxy-client-key-file=/etc/kubernetes/ssl/kube-apiserver-proxy-client-key.pem --service-account-issuer=rke --service-account-signing-key-file=/etc/kubernetes/ssl/kube-service-account-token-key.pem --kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname --requestheader-group-headers=X-Remote-Group --cloud-provider= --proxy-client-cert-file=/etc/kubernetes/ssl/kube-apiserver-proxy-client.pem --service-node-port-range=30000-32767 --tls-cert-file=/etc/kubernetes/ssl/kube-apiserver.pem --tls-private-key-file=/etc/kubernetes/ssl/kube-apiserver-key.pem --anonymous-auth=false --audit-log-path=/var/log/kube-audit/audit-log.json --audit-log-maxbackup=10 --service-account-key-file=/etc/kubernetes/ssl/kube-service-account-token-key.pem --enable-admission-plugins=NamespaceLifecycle,LimitRanger,ServiceAccount,DefaultStorageClass,DefaultTolerationSeconds,MutatingAdmissionWebhook,ValidatingAdmissionWebhook,ResourceQuota,NodeRestriction,Priority,TaintNodesByCondition,PersistentVolumeClaimResize,PodSecurityPolicy,EventRateLimit --audit-log-format=json root 214939 214868 2 13:56 ?00:00:00 kube-bench run --targets etcd --scored --nosummary --noremediations --v=5 --config-dir=/etc/kube-bench/cfg --benchmark rke-cis-1.6-hardened --json --log_dir /tmp/results/logs --outputfile /tmp/results/etcd.json\n")),(0,a.kt)("h3",{id:"23\u786e\u4fdd---auto-tls-\u53c2\u6570\u672a\u8bbe\u7f6e\u4e3a-true\u81ea\u52a8"},"2.3\u786e\u4fdd --auto-tls \u53c2\u6570\u672a\u8bbe\u7f6e\u4e3a true\uff08\u81ea\u52a8\uff09"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1apass"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u5728 Master \u8282\u70b9\u4e0a\u7f16\u8f91 etcd pod \u89c4\u8303\u6587\u4ef6 /etc/kubernetes/manifests/etcd.yaml\uff0c\u5e76\u5220\u9664 ",(0,a.kt)("inlineCode",{parentName:"p"},"--auto-tls")," \u53c2\u6570\u6216\u5c06\u5176\u8bbe\u7f6e\u4e3a false\u3002\n--auto-tls=false"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"/bin/ps -ef | /bin/grep etcd | /bin/grep -v grep\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u9884\u671f\u7ed3\u679c"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"'--auto-tls' is not present OR '--auto-tls' is not present\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u8fd4\u56de\u503c"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"etcd 120679 120657 1 12:27 ?00:01:17 /usr/local/bin/etcd --trusted-ca-file=/etc/kubernetes/ssl/kube-ca.pem --cert-file=/etc/kubernetes/ssl/kube-etcd-<node_ip>.pem --heartbeat-interval=500 --election-timeout=5000 --initial-cluster-token=etcd-cluster-1 --initial-cluster=etcd-<external_ip>=https://<node_ip>:2380 --peer-trusted-ca-file=/etc/kubernetes/ssl/kube-ca.pem --peer-cert-file=/etc/kubernetes/ssl/kube-etcd-<node_ip>.pem --peer-key-file=/etc/kubernetes/ssl/kube-etcd-<node_ip>-key.pem --peer-client-cert-auth=true --data-dir=/var/lib/rancher/etcd/ --initial-advertise-peer-urls=https://<node_ip>:2380 --initial-cluster-state=new --advertise-client-urls=https://<node_ip>:2379 --client-cert-auth=true --enable-v2=true --name=etcd-<external_ip> --listen-client-urls=https://<node_ip>:2379 --listen-peer-urls=https://<node_ip>:2380 --key-file=/etc/kubernetes/ssl/kube-etcd-<node_ip>-key.pem --cipher-suites=TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384 root 120728 120707 0 12:27 ?00:00:00 /opt/rke-tools/rke-etcd-backup etcd-backup save --cacert /etc/kubernetes/ssl/kube-ca.pem --cert /etc/kubernetes/ssl/kube-node.pem --key /etc/kubernetes/ssl/kube-node-key.pem --name etcd-rolling-snapshots --endpoints=<node_ip>:2379 --retention=72h --creation=12h root 121142 121120 7 12:27 ?00:06:27 kube-apiserver --audit-log-maxsize=100 --etcd-keyfile=/etc/kubernetes/ssl/kube-node-key.pem --service-cluster-ip-range=10.43.0.0/16 --encryption-provider-config=/etc/kubernetes/ssl/encryption.yaml --requestheader-username-headers=X-Remote-User --bind-address=0.0.0.0 --advertise-address=<node_ip> --requestheader-allowed-names=kube-apiserver-proxy-client --etcd-certfile=/etc/kubernetes/ssl/kube-node.pem --requestheader-client-ca-file=/etc/kubernetes/ssl/kube-apiserver-requestheader-ca.pem --allow-privileged=true --requestheader-extra-headers-prefix=X-Remote-Extra- --admission-control-config-file=/etc/kubernetes/admission.yaml --client-ca-file=/etc/kubernetes/ssl/kube-ca.pem --service-account-lookup=true --runtime-config=policy/v1beta1/podsecuritypolicy=true --authorization-mode=Node,RBAC --audit-log-maxage=30 --profiling=false --storage-backend=etcd3 --etcd-cafile=/etc/kubernetes/ssl/kube-ca.pem --etcd-servers=https://<node_ip>:2379 --kubelet-certificate-authority=/etc/kubernetes/ssl/kube-ca.pem --secure-port=6443 --tls-cipher-suites=TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305 --insecure-port=0 --api-audiences=unknown --audit-policy-file=/etc/kubernetes/audit-policy.yaml --etcd-prefix=/registry --kubelet-client-certificate=/etc/kubernetes/ssl/kube-apiserver.pem --kubelet-client-key=/etc/kubernetes/ssl/kube-apiserver-key.pem --proxy-client-key-file=/etc/kubernetes/ssl/kube-apiserver-proxy-client-key.pem --service-account-issuer=rke --service-account-signing-key-file=/etc/kubernetes/ssl/kube-service-account-token-key.pem --kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname --requestheader-group-headers=X-Remote-Group --cloud-provider= --proxy-client-cert-file=/etc/kubernetes/ssl/kube-apiserver-proxy-client.pem --service-node-port-range=30000-32767 --tls-cert-file=/etc/kubernetes/ssl/kube-apiserver.pem --tls-private-key-file=/etc/kubernetes/ssl/kube-apiserver-key.pem --anonymous-auth=false --audit-log-path=/var/log/kube-audit/audit-log.json --audit-log-maxbackup=10 --service-account-key-file=/etc/kubernetes/ssl/kube-service-account-token-key.pem --enable-admission-plugins=NamespaceLifecycle,LimitRanger,ServiceAccount,DefaultStorageClass,DefaultTolerationSeconds,MutatingAdmissionWebhook,ValidatingAdmissionWebhook,ResourceQuota,NodeRestriction,Priority,TaintNodesByCondition,PersistentVolumeClaimResize,PodSecurityPolicy,EventRateLimit --audit-log-format=json root 214939 214868 1 13:56 ?00:00:00 kube-bench run --targets etcd --scored --nosummary --noremediations --v=5 --config-dir=/etc/kube-bench/cfg --benchmark rke-cis-1.6-hardened --json --log_dir /tmp/results/logs --outputfile /tmp/results/etcd.json\n")),(0,a.kt)("h3",{id:"24\u786e\u4fdd\u6839\u636e\u9700\u8981\u8bbe\u7f6e---peer-cert-file-\u548c---peer-key-file-\u53c2\u6570\u81ea\u52a8"},"2.4\u786e\u4fdd\u6839\u636e\u9700\u8981\u8bbe\u7f6e --peer-cert-file \u548c --peer-key-file \u53c2\u6570\uff08\u81ea\u52a8\uff09"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1apass"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u9075\u5faa etcd \u670d\u52a1\u6587\u6863\uff0c\u6839\u636e\u9700\u8981\u4e3a\u4f60\u7684 etcd \u96c6\u7fa4\u914d\u7f6e\u5bf9\u7b49 TLS \u52a0\u5bc6\u3002\n\u7136\u540e\uff0c\u5728 Master \u8282\u70b9\u4e0a\u7f16\u8f91 etcd pod \u89c4\u8303\u6587\u4ef6 /etc/kubernetes/manifests/etcd.yaml\uff0c\u5e76\u8bbe\u7f6e\u4ee5\u4e0b\u53c2\u6570\u3002\n",(0,a.kt)("inlineCode",{parentName:"p"},"--peer-client-file=</path/to/peer-cert-file>"),"\n",(0,a.kt)("inlineCode",{parentName:"p"},"--peer-key-file=</path/to/peer-key-file>")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"/bin/ps -ef | /bin/grep etcd | /bin/grep -v grep\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u9884\u671f\u7ed3\u679c"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"'--peer-cert-file' is present AND '--peer-key-file' is present\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u8fd4\u56de\u503c"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"etcd 120679 120657 1 12:27 ?00:01:17 /usr/local/bin/etcd --trusted-ca-file=/etc/kubernetes/ssl/kube-ca.pem --cert-file=/etc/kubernetes/ssl/kube-etcd-<node_ip>.pem --heartbeat-interval=500 --election-timeout=5000 --initial-cluster-token=etcd-cluster-1 --initial-cluster=etcd-<external_ip>=https://<node_ip>:2380 --peer-trusted-ca-file=/etc/kubernetes/ssl/kube-ca.pem --peer-cert-file=/etc/kubernetes/ssl/kube-etcd-<node_ip>.pem --peer-key-file=/etc/kubernetes/ssl/kube-etcd-<node_ip>-key.pem --peer-client-cert-auth=true --data-dir=/var/lib/rancher/etcd/ --initial-advertise-peer-urls=https://<node_ip>:2380 --initial-cluster-state=new --advertise-client-urls=https://<node_ip>:2379 --client-cert-auth=true --enable-v2=true --name=etcd-<external_ip> --listen-client-urls=https://<node_ip>:2379 --listen-peer-urls=https://<node_ip>:2380 --key-file=/etc/kubernetes/ssl/kube-etcd-<node_ip>-key.pem --cipher-suites=TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384 root 120728 120707 0 12:27 ?00:00:00 /opt/rke-tools/rke-etcd-backup etcd-backup save --cacert /etc/kubernetes/ssl/kube-ca.pem --cert /etc/kubernetes/ssl/kube-node.pem --key /etc/kubernetes/ssl/kube-node-key.pem --name etcd-rolling-snapshots --endpoints=<node_ip>:2379 --retention=72h --creation=12h root 121142 121120 7 12:27 ?00:06:27 kube-apiserver --audit-log-maxsize=100 --etcd-keyfile=/etc/kubernetes/ssl/kube-node-key.pem --service-cluster-ip-range=10.43.0.0/16 --encryption-provider-config=/etc/kubernetes/ssl/encryption.yaml --requestheader-username-headers=X-Remote-User --bind-address=0.0.0.0 --advertise-address=<node_ip> --requestheader-allowed-names=kube-apiserver-proxy-client --etcd-certfile=/etc/kubernetes/ssl/kube-node.pem --requestheader-client-ca-file=/etc/kubernetes/ssl/kube-apiserver-requestheader-ca.pem --allow-privileged=true --requestheader-extra-headers-prefix=X-Remote-Extra- --admission-control-config-file=/etc/kubernetes/admission.yaml --client-ca-file=/etc/kubernetes/ssl/kube-ca.pem --service-account-lookup=true --runtime-config=policy/v1beta1/podsecuritypolicy=true --authorization-mode=Node,RBAC --audit-log-maxage=30 --profiling=false --storage-backend=etcd3 --etcd-cafile=/etc/kubernetes/ssl/kube-ca.pem --etcd-servers=https://<node_ip>:2379 --kubelet-certificate-authority=/etc/kubernetes/ssl/kube-ca.pem --secure-port=6443 --tls-cipher-suites=TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305 --insecure-port=0 --api-audiences=unknown --audit-policy-file=/etc/kubernetes/audit-policy.yaml --etcd-prefix=/registry --kubelet-client-certificate=/etc/kubernetes/ssl/kube-apiserver.pem --kubelet-client-key=/etc/kubernetes/ssl/kube-apiserver-key.pem --proxy-client-key-file=/etc/kubernetes/ssl/kube-apiserver-proxy-client-key.pem --service-account-issuer=rke --service-account-signing-key-file=/etc/kubernetes/ssl/kube-service-account-token-key.pem --kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname --requestheader-group-headers=X-Remote-Group --cloud-provider= --proxy-client-cert-file=/etc/kubernetes/ssl/kube-apiserver-proxy-client.pem --service-node-port-range=30000-32767 --tls-cert-file=/etc/kubernetes/ssl/kube-apiserver.pem --tls-private-key-file=/etc/kubernetes/ssl/kube-apiserver-key.pem --anonymous-auth=false --audit-log-path=/var/log/kube-audit/audit-log.json --audit-log-maxbackup=10 --service-account-key-file=/etc/kubernetes/ssl/kube-service-account-token-key.pem --enable-admission-plugins=NamespaceLifecycle,LimitRanger,ServiceAccount,DefaultStorageClass,DefaultTolerationSeconds,MutatingAdmissionWebhook,ValidatingAdmissionWebhook,ResourceQuota,NodeRestriction,Priority,TaintNodesByCondition,PersistentVolumeClaimResize,PodSecurityPolicy,EventRateLimit --audit-log-format=json root 214939 214868 5 13:56 ?00:00:00 kube-bench run --targets etcd --scored --nosummary --noremediations --v=5 --config-dir=/etc/kube-bench/cfg --benchmark rke-cis-1.6-hardened --json --log_dir /tmp/results/logs --outputfile /tmp/results/etcd.json\n")),(0,a.kt)("h3",{id:"25\u786e\u4fdd---peer-client-cert-auth-\u53c2\u6570\u8bbe\u7f6e\u4e3a-true\u81ea\u52a8"},"2.5\u786e\u4fdd --peer-client-cert-auth \u53c2\u6570\u8bbe\u7f6e\u4e3a true\uff08\u81ea\u52a8\uff09"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1apass"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u5728 Master \u8282\u70b9\u4e0a\u7f16\u8f91 etcd pod \u89c4\u8303\u6587\u4ef6 /etc/kubernetes/manifests/etcd.yaml\uff0c\u5e76\u8bbe\u7f6e\u4ee5\u4e0b\u53c2\u6570\u3002\n--peer-client-cert-auth=true"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"/bin/ps -ef | /bin/grep etcd | /bin/grep -v grep\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u9884\u671f\u7ed3\u679c"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"'--peer-client-cert-auth' is present OR 'true' is equal to 'true'\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u8fd4\u56de\u503c"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"etcd 120679 120657 1 12:27 ?00:01:17 /usr/local/bin/etcd --trusted-ca-file=/etc/kubernetes/ssl/kube-ca.pem --cert-file=/etc/kubernetes/ssl/kube-etcd-<node_ip>.pem --heartbeat-interval=500 --election-timeout=5000 --initial-cluster-token=etcd-cluster-1 --initial-cluster=etcd-<external_ip>=https://<node_ip>:2380 --peer-trusted-ca-file=/etc/kubernetes/ssl/kube-ca.pem --peer-cert-file=/etc/kubernetes/ssl/kube-etcd-<node_ip>.pem --peer-key-file=/etc/kubernetes/ssl/kube-etcd-<node_ip>-key.pem --peer-client-cert-auth=true --data-dir=/var/lib/rancher/etcd/ --initial-advertise-peer-urls=https://<node_ip>:2380 --initial-cluster-state=new --advertise-client-urls=https://<node_ip>:2379 --client-cert-auth=true --enable-v2=true --name=etcd-<external_ip> --listen-client-urls=https://<node_ip>:2379 --listen-peer-urls=https://<node_ip>:2380 --key-file=/etc/kubernetes/ssl/kube-etcd-<node_ip>-key.pem --cipher-suites=TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384 root 120728 120707 0 12:27 ?00:00:00 /opt/rke-tools/rke-etcd-backup etcd-backup save --cacert /etc/kubernetes/ssl/kube-ca.pem --cert /etc/kubernetes/ssl/kube-node.pem --key /etc/kubernetes/ssl/kube-node-key.pem --name etcd-rolling-snapshots --endpoints=<node_ip>:2379 --retention=72h --creation=12h root 121142 121120 7 12:27 ?00:06:27 kube-apiserver --audit-log-maxsize=100 --etcd-keyfile=/etc/kubernetes/ssl/kube-node-key.pem --service-cluster-ip-range=10.43.0.0/16 --encryption-provider-config=/etc/kubernetes/ssl/encryption.yaml --requestheader-username-headers=X-Remote-User --bind-address=0.0.0.0 --advertise-address=<node_ip> --requestheader-allowed-names=kube-apiserver-proxy-client --etcd-certfile=/etc/kubernetes/ssl/kube-node.pem --requestheader-client-ca-file=/etc/kubernetes/ssl/kube-apiserver-requestheader-ca.pem --allow-privileged=true --requestheader-extra-headers-prefix=X-Remote-Extra- --admission-control-config-file=/etc/kubernetes/admission.yaml --client-ca-file=/etc/kubernetes/ssl/kube-ca.pem --service-account-lookup=true --runtime-config=policy/v1beta1/podsecuritypolicy=true --authorization-mode=Node,RBAC --audit-log-maxage=30 --profiling=false --storage-backend=etcd3 --etcd-cafile=/etc/kubernetes/ssl/kube-ca.pem --etcd-servers=https://<node_ip>:2379 --kubelet-certificate-authority=/etc/kubernetes/ssl/kube-ca.pem --secure-port=6443 --tls-cipher-suites=TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305 --insecure-port=0 --api-audiences=unknown --audit-policy-file=/etc/kubernetes/audit-policy.yaml --etcd-prefix=/registry --kubelet-client-certificate=/etc/kubernetes/ssl/kube-apiserver.pem --kubelet-client-key=/etc/kubernetes/ssl/kube-apiserver-key.pem --proxy-client-key-file=/etc/kubernetes/ssl/kube-apiserver-proxy-client-key.pem --service-account-issuer=rke --service-account-signing-key-file=/etc/kubernetes/ssl/kube-service-account-token-key.pem --kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname --requestheader-group-headers=X-Remote-Group --cloud-provider= --proxy-client-cert-file=/etc/kubernetes/ssl/kube-apiserver-proxy-client.pem --service-node-port-range=30000-32767 --tls-cert-file=/etc/kubernetes/ssl/kube-apiserver.pem --tls-private-key-file=/etc/kubernetes/ssl/kube-apiserver-key.pem --anonymous-auth=false --audit-log-path=/var/log/kube-audit/audit-log.json --audit-log-maxbackup=10 --service-account-key-file=/etc/kubernetes/ssl/kube-service-account-token-key.pem --enable-admission-plugins=NamespaceLifecycle,LimitRanger,ServiceAccount,DefaultStorageClass,DefaultTolerationSeconds,MutatingAdmissionWebhook,ValidatingAdmissionWebhook,ResourceQuota,NodeRestriction,Priority,TaintNodesByCondition,PersistentVolumeClaimResize,PodSecurityPolicy,EventRateLimit --audit-log-format=json root 214939 214868 4 13:56 ?00:00:00 kube-bench run --targets etcd --scored --nosummary --noremediations --v=5 --config-dir=/etc/kube-bench/cfg --benchmark rke-cis-1.6-hardened --json --log_dir /tmp/results/logs --outputfile /tmp/results/etcd.json\n")),(0,a.kt)("h3",{id:"26\u786e\u4fdd---peer-auto-tls-\u53c2\u6570\u672a\u8bbe\u7f6e\u4e3a-true\u81ea\u52a8"},"2.6\u786e\u4fdd --peer-auto-tls \u53c2\u6570\u672a\u8bbe\u7f6e\u4e3a true\uff08\u81ea\u52a8\uff09"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1apass"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u5728 Master \u8282\u70b9\u4e0a\u7f16\u8f91 etcd pod \u89c4\u8303\u6587\u4ef6 /etc/kubernetes/manifests/etcd.yaml\uff0c\u5e76\u5220\u9664 ",(0,a.kt)("inlineCode",{parentName:"p"},"--peer-auto-tls")," \u53c2\u6570\u6216\u5c06\u5176\u8bbe\u7f6e\u4e3a false\u3002\n--peer-auto-tls=false"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"/bin/ps -ef | /bin/grep etcd | /bin/grep -v grep\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u9884\u671f\u7ed3\u679c"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"'--peer-auto-tls' is not present OR '--peer-auto-tls' is present\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u8fd4\u56de\u503c"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"etcd 120679 120657 1 12:27 ?00:01:17 /usr/local/bin/etcd --trusted-ca-file=/etc/kubernetes/ssl/kube-ca.pem --cert-file=/etc/kubernetes/ssl/kube-etcd-<node_ip>.pem --heartbeat-interval=500 --election-timeout=5000 --initial-cluster-token=etcd-cluster-1 --initial-cluster=etcd-<external_ip>=https://<node_ip>:2380 --peer-trusted-ca-file=/etc/kubernetes/ssl/kube-ca.pem --peer-cert-file=/etc/kubernetes/ssl/kube-etcd-<node_ip>.pem --peer-key-file=/etc/kubernetes/ssl/kube-etcd-<node_ip>-key.pem --peer-client-cert-auth=true --data-dir=/var/lib/rancher/etcd/ --initial-advertise-peer-urls=https://<node_ip>:2380 --initial-cluster-state=new --advertise-client-urls=https://<node_ip>:2379 --client-cert-auth=true --enable-v2=true --name=etcd-<external_ip> --listen-client-urls=https://<node_ip>:2379 --listen-peer-urls=https://<node_ip>:2380 --key-file=/etc/kubernetes/ssl/kube-etcd-<node_ip>-key.pem --cipher-suites=TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384 root 120728 120707 0 12:27 ?00:00:00 /opt/rke-tools/rke-etcd-backup etcd-backup save --cacert /etc/kubernetes/ssl/kube-ca.pem --cert /etc/kubernetes/ssl/kube-node.pem --key /etc/kubernetes/ssl/kube-node-key.pem --name etcd-rolling-snapshots --endpoints=<node_ip>:2379 --retention=72h --creation=12h root 121142 121120 7 12:27 ?00:06:27 kube-apiserver --audit-log-maxsize=100 --etcd-keyfile=/etc/kubernetes/ssl/kube-node-key.pem --service-cluster-ip-range=10.43.0.0/16 --encryption-provider-config=/etc/kubernetes/ssl/encryption.yaml --requestheader-username-headers=X-Remote-User --bind-address=0.0.0.0 --advertise-address=<node_ip> --requestheader-allowed-names=kube-apiserver-proxy-client --etcd-certfile=/etc/kubernetes/ssl/kube-node.pem --requestheader-client-ca-file=/etc/kubernetes/ssl/kube-apiserver-requestheader-ca.pem --allow-privileged=true --requestheader-extra-headers-prefix=X-Remote-Extra- --admission-control-config-file=/etc/kubernetes/admission.yaml --client-ca-file=/etc/kubernetes/ssl/kube-ca.pem --service-account-lookup=true --runtime-config=policy/v1beta1/podsecuritypolicy=true --authorization-mode=Node,RBAC --audit-log-maxage=30 --profiling=false --storage-backend=etcd3 --etcd-cafile=/etc/kubernetes/ssl/kube-ca.pem --etcd-servers=https://<node_ip>:2379 --kubelet-certificate-authority=/etc/kubernetes/ssl/kube-ca.pem --secure-port=6443 --tls-cipher-suites=TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305 --insecure-port=0 --api-audiences=unknown --audit-policy-file=/etc/kubernetes/audit-policy.yaml --etcd-prefix=/registry --kubelet-client-certificate=/etc/kubernetes/ssl/kube-apiserver.pem --kubelet-client-key=/etc/kubernetes/ssl/kube-apiserver-key.pem --proxy-client-key-file=/etc/kubernetes/ssl/kube-apiserver-proxy-client-key.pem --service-account-issuer=rke --service-account-signing-key-file=/etc/kubernetes/ssl/kube-service-account-token-key.pem --kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname --requestheader-group-headers=X-Remote-Group --cloud-provider= --proxy-client-cert-file=/etc/kubernetes/ssl/kube-apiserver-proxy-client.pem --service-node-port-range=30000-32767 --tls-cert-file=/etc/kubernetes/ssl/kube-apiserver.pem --tls-private-key-file=/etc/kubernetes/ssl/kube-apiserver-key.pem --anonymous-auth=false --audit-log-path=/var/log/kube-audit/audit-log.json --audit-log-maxbackup=10 --service-account-key-file=/etc/kubernetes/ssl/kube-service-account-token-key.pem --enable-admission-plugins=NamespaceLifecycle,LimitRanger,ServiceAccount,DefaultStorageClass,DefaultTolerationSeconds,MutatingAdmissionWebhook,ValidatingAdmissionWebhook,ResourceQuota,NodeRestriction,Priority,TaintNodesByCondition,PersistentVolumeClaimResize,PodSecurityPolicy,EventRateLimit --audit-log-format=json root 214939 214868 4 13:56 ?00:00:00 kube-bench run --targets etcd --scored --nosummary --noremediations --v=5 --config-dir=/etc/kube-bench/cfg --benchmark rke-cis-1.6-hardened --json --log_dir /tmp/results/logs --outputfile /tmp/results/etcd.json\n")),(0,a.kt)("h3",{id:"27\u786e\u4fdd-etcd-\u4f7f\u7528\u552f\u4e00\u7684-ca\u81ea\u52a8"},"2.7\u786e\u4fdd etcd \u4f7f\u7528\u552f\u4e00\u7684 CA\uff08\u81ea\u52a8\uff09"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1apass"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n","[\u624b\u52a8\u6d4b\u8bd5]","\n\u9075\u5faa etcd \u6587\u6863\uff0c\u4e3a etcd \u670d\u52a1\u521b\u5efa\u4e13\u7528\u7684 CA \u8bbe\u7f6e\u3002\n\u7136\u540e\uff0c\u5728 Master \u8282\u70b9\u4e0a\u7f16\u8f91 etcd pod \u89c4\u8303\u6587\u4ef6 /etc/kubernetes/manifests/etcd.yaml\uff0c\u5e76\u8bbe\u7f6e\u4ee5\u4e0b\u53c2\u6570\u3002\n",(0,a.kt)("inlineCode",{parentName:"p"},"--trusted-ca-file=</path/to/ca-file>")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"/bin/ps -ef | /bin/grep etcd | /bin/grep -v grep\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u9884\u671f\u7ed3\u679c"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"'--trusted-ca-file' is present\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u8fd4\u56de\u503c"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"etcd 120679 120657 1 12:27 ?00:01:17 /usr/local/bin/etcd --trusted-ca-file=/etc/kubernetes/ssl/kube-ca.pem --cert-file=/etc/kubernetes/ssl/kube-etcd-<node_ip>.pem --heartbeat-interval=500 --election-timeout=5000 --initial-cluster-token=etcd-cluster-1 --initial-cluster=etcd-<external_ip>=https://<node_ip>:2380 --peer-trusted-ca-file=/etc/kubernetes/ssl/kube-ca.pem --peer-cert-file=/etc/kubernetes/ssl/kube-etcd-<node_ip>.pem --peer-key-file=/etc/kubernetes/ssl/kube-etcd-<node_ip>-key.pem --peer-client-cert-auth=true --data-dir=/var/lib/rancher/etcd/ --initial-advertise-peer-urls=https://<node_ip>:2380 --initial-cluster-state=new --advertise-client-urls=https://<node_ip>:2379 --client-cert-auth=true --enable-v2=true --name=etcd-<external_ip> --listen-client-urls=https://<node_ip>:2379 --listen-peer-urls=https://<node_ip>:2380 --key-file=/etc/kubernetes/ssl/kube-etcd-<node_ip>-key.pem --cipher-suites=TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384 root 120728 120707 0 12:27 ?00:00:00 /opt/rke-tools/rke-etcd-backup etcd-backup save --cacert /etc/kubernetes/ssl/kube-ca.pem --cert /etc/kubernetes/ssl/kube-node.pem --key /etc/kubernetes/ssl/kube-node-key.pem --name etcd-rolling-snapshots --endpoints=<node_ip>:2379 --retention=72h --creation=12h root 121142 121120 7 12:27 ?00:06:27 kube-apiserver --audit-log-maxsize=100 --etcd-keyfile=/etc/kubernetes/ssl/kube-node-key.pem --service-cluster-ip-range=10.43.0.0/16 --encryption-provider-config=/etc/kubernetes/ssl/encryption.yaml --requestheader-username-headers=X-Remote-User --bind-address=0.0.0.0 --advertise-address=<node_ip> --requestheader-allowed-names=kube-apiserver-proxy-client --etcd-certfile=/etc/kubernetes/ssl/kube-node.pem --requestheader-client-ca-file=/etc/kubernetes/ssl/kube-apiserver-requestheader-ca.pem --allow-privileged=true --requestheader-extra-headers-prefix=X-Remote-Extra- --admission-control-config-file=/etc/kubernetes/admission.yaml --client-ca-file=/etc/kubernetes/ssl/kube-ca.pem --service-account-lookup=true --runtime-config=policy/v1beta1/podsecuritypolicy=true --authorization-mode=Node,RBAC --audit-log-maxage=30 --profiling=false --storage-backend=etcd3 --etcd-cafile=/etc/kubernetes/ssl/kube-ca.pem --etcd-servers=https://<node_ip>:2379 --kubelet-certificate-authority=/etc/kubernetes/ssl/kube-ca.pem --secure-port=6443 --tls-cipher-suites=TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305 --insecure-port=0 --api-audiences=unknown --audit-policy-file=/etc/kubernetes/audit-policy.yaml --etcd-prefix=/registry --kubelet-client-certificate=/etc/kubernetes/ssl/kube-apiserver.pem --kubelet-client-key=/etc/kubernetes/ssl/kube-apiserver-key.pem --proxy-client-key-file=/etc/kubernetes/ssl/kube-apiserver-proxy-client-key.pem --service-account-issuer=rke --service-account-signing-key-file=/etc/kubernetes/ssl/kube-service-account-token-key.pem --kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname --requestheader-group-headers=X-Remote-Group --cloud-provider= --proxy-client-cert-file=/etc/kubernetes/ssl/kube-apiserver-proxy-client.pem --service-node-port-range=30000-32767 --tls-cert-file=/etc/kubernetes/ssl/kube-apiserver.pem --tls-private-key-file=/etc/kubernetes/ssl/kube-apiserver-key.pem --anonymous-auth=false --audit-log-path=/var/log/kube-audit/audit-log.json --audit-log-maxbackup=10 --service-account-key-file=/etc/kubernetes/ssl/kube-service-account-token-key.pem --enable-admission-plugins=NamespaceLifecycle,LimitRanger,ServiceAccount,DefaultStorageClass,DefaultTolerationSeconds,MutatingAdmissionWebhook,ValidatingAdmissionWebhook,ResourceQuota,NodeRestriction,Priority,TaintNodesByCondition,PersistentVolumeClaimResize,PodSecurityPolicy,EventRateLimit --audit-log-format=json root 214939 214868 3 13:56 ?00:00:00 kube-bench run --targets etcd --scored --nosummary --noremediations --v=5 --config-dir=/etc/kube-bench/cfg --benchmark rke-cis-1.6-hardened --json --log_dir /tmp/results/logs --outputfile /tmp/results/etcd.json\n")),(0,a.kt)("h2",{id:"31\u8ba4\u8bc1\u548c\u6388\u6743"},"3.1\u8ba4\u8bc1\u548c\u6388\u6743"),(0,a.kt)("h3",{id:"311\u4e0d\u80fd\u5c06\u5ba2\u6237\u7aef\u8bc1\u4e66\u8eab\u4efd\u9a8c\u8bc1\u5e94\u7528\u4e8e\u7528\u6237\u624b\u52a8"},"3.1.1\u4e0d\u80fd\u5c06\u5ba2\u6237\u7aef\u8bc1\u4e66\u8eab\u4efd\u9a8c\u8bc1\u5e94\u7528\u4e8e\u7528\u6237\uff08\u624b\u52a8\uff09"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1awarn"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\nKubernetes \u63d0\u4f9b\u7684\u66ff\u4ee3\u673a\u5236\uff08\u4f8b\u5982 OIDC\uff09\u5e94\u8be5\u4ee3\u66ff\u5ba2\u6237\u7aef\u8bc1\u4e66\u7684\u5b9e\u73b0\u3002"),(0,a.kt)("h2",{id:"32logging"},"3.2Logging"),(0,a.kt)("h3",{id:"321\u786e\u4fdd\u521b\u5efa\u6700\u5c0f\u5ba1\u8ba1\u7b56\u7565\u81ea\u52a8"},"3.2.1\u786e\u4fdd\u521b\u5efa\u6700\u5c0f\u5ba1\u8ba1\u7b56\u7565\uff08\u81ea\u52a8\uff09"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1apass"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u4e3a\u4f60\u7684\u96c6\u7fa4\u521b\u5efa\u4e00\u4e2a\u5ba1\u8ba1\u7b56\u7565\u6587\u4ef6\u3002"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"/bin/ps -ef | grep kube-apiserver | grep -v grep\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u9884\u671f\u7ed3\u679c"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"'--audit-policy-file' is present\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u8fd4\u56de\u503c"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"root 121142 121120 7 12:27 ?00:06:28 kube-apiserver --audit-log-maxsize=100 --etcd-keyfile=/etc/kubernetes/ssl/kube-node-key.pem --service-cluster-ip-range=10.43.0.0/16 --encryption-provider-config=/etc/kubernetes/ssl/encryption.yaml --requestheader-username-headers=X-Remote-User --bind-address=0.0.0.0 --advertise-address=<node_ip> --requestheader-allowed-names=kube-apiserver-proxy-client --etcd-certfile=/etc/kubernetes/ssl/kube-node.pem --requestheader-client-ca-file=/etc/kubernetes/ssl/kube-apiserver-requestheader-ca.pem --allow-privileged=true --requestheader-extra-headers-prefix=X-Remote-Extra- --admission-control-config-file=/etc/kubernetes/admission.yaml --client-ca-file=/etc/kubernetes/ssl/kube-ca.pem --service-account-lookup=true --runtime-config=policy/v1beta1/podsecuritypolicy=true --authorization-mode=Node,RBAC --audit-log-maxage=30 --profiling=false --storage-backend=etcd3 --etcd-cafile=/etc/kubernetes/ssl/kube-ca.pem --etcd-servers=https://<node_ip>:2379 --kubelet-certificate-authority=/etc/kubernetes/ssl/kube-ca.pem --secure-port=6443 --tls-cipher-suites=TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305 --insecure-port=0 --api-audiences=unknown --audit-policy-file=/etc/kubernetes/audit-policy.yaml --etcd-prefix=/registry --kubelet-client-certificate=/etc/kubernetes/ssl/kube-apiserver.pem --kubelet-client-key=/etc/kubernetes/ssl/kube-apiserver-key.pem --proxy-client-key-file=/etc/kubernetes/ssl/kube-apiserver-proxy-client-key.pem --service-account-issuer=rke --service-account-signing-key-file=/etc/kubernetes/ssl/kube-service-account-token-key.pem --kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname --requestheader-group-headers=X-Remote-Group --cloud-provider= --proxy-client-cert-file=/etc/kubernetes/ssl/kube-apiserver-proxy-client.pem --service-node-port-range=30000-32767 --tls-cert-file=/etc/kubernetes/ssl/kube-apiserver.pem --tls-private-key-file=/etc/kubernetes/ssl/kube-apiserver-key.pem --anonymous-auth=false --audit-log-path=/var/log/kube-audit/audit-log.json --audit-log-maxbackup=10 --service-account-key-file=/etc/kubernetes/ssl/kube-service-account-token-key.pem --enable-admission-plugins=NamespaceLifecycle,LimitRanger,ServiceAccount,DefaultStorageClass,DefaultTolerationSeconds,MutatingAdmissionWebhook,ValidatingAdmissionWebhook,ResourceQuota,NodeRestriction,Priority,TaintNodesByCondition,PersistentVolumeClaimResize,PodSecurityPolicy,EventRateLimit --audit-log-format=json\n")),(0,a.kt)("h3",{id:"322\u786e\u4fdd\u5ba1\u8ba1\u7b56\u7565\u6db5\u76d6\u5173\u952e\u5b89\u5168\u95ee\u9898\u624b\u52a8"},"3.2.2\u786e\u4fdd\u5ba1\u8ba1\u7b56\u7565\u6db5\u76d6\u5173\u952e\u5b89\u5168\u95ee\u9898\uff08\u624b\u52a8\uff09"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1awarn"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u8003\u8651\u4fee\u6539\u96c6\u7fa4\u4e0a\u4f7f\u7528\u7684\u5ba1\u8ba1\u7b56\u7565\uff0c\u81f3\u5c11\u8981\u5305\u62ec\u8fd9\u4e9b\u9879\u76ee\u3002"),(0,a.kt)("h2",{id:"41worker-\u8282\u70b9\u914d\u7f6e\u6587\u4ef6"},"4.1Worker \u8282\u70b9\u914d\u7f6e\u6587\u4ef6"),(0,a.kt)("h3",{id:"411\u786e\u4fdd-kubelet-\u670d\u52a1\u6587\u4ef6\u6743\u9650\u5177\u6709-644-\u6216\u66f4\u4e25\u683c\u7684\u8bbe\u7f6e\u81ea\u52a8"},"4.1.1\u786e\u4fdd kubelet \u670d\u52a1\u6587\u4ef6\u6743\u9650\u5177\u6709 644 \u6216\u66f4\u4e25\u683c\u7684\u8bbe\u7f6e\uff08\u81ea\u52a8\uff09"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1aNot Applicable"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\nRKE \u914d\u7f6e\u7684\u96c6\u7fa4\u4e0d\u9700\u8981\u6216\u7ef4\u62a4 kubelet \u670d\u52a1\u7684\u914d\u7f6e\u6587\u4ef6\u3002\n\u6240\u6709\u914d\u7f6e\u5728\u5bb9\u5668\u8fd0\u884c\u65f6\u4f5c\u4e3a\u53c2\u6570\u4f20\u5165\u3002"),(0,a.kt)("h3",{id:"412\u786e\u4fdd-kubelet-\u670d\u52a1\u6587\u4ef6\u6240\u6709\u6743\u8bbe\u7f6e\u4e3a-rootroot\u81ea\u52a8"},"4.1.2\u786e\u4fdd kubelet \u670d\u52a1\u6587\u4ef6\u6240\u6709\u6743\u8bbe\u7f6e\u4e3a root:root\uff08\u81ea\u52a8\uff09"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1aNot Applicable"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\nRKE \u914d\u7f6e\u7684\u96c6\u7fa4\u4e0d\u9700\u8981\u6216\u7ef4\u62a4 kubelet \u670d\u52a1\u7684\u914d\u7f6e\u6587\u4ef6\u3002\n\u6240\u6709\u914d\u7f6e\u5728\u5bb9\u5668\u8fd0\u884c\u65f6\u4f5c\u4e3a\u53c2\u6570\u4f20\u5165\u3002"),(0,a.kt)("h3",{id:"413\u5982\u679c\u4ee3\u7406-kubeconfig-\u6587\u4ef6\u5b58\u5728\u8bf7\u786e\u4fdd\u6743\u9650\u5177\u6709-644-\u6216\u66f4\u4e25\u683c\u7684\u8bbe\u7f6e\u81ea\u52a8"},"4.1.3\u5982\u679c\u4ee3\u7406 kubeconfig \u6587\u4ef6\u5b58\u5728\uff0c\u8bf7\u786e\u4fdd\u6743\u9650\u5177\u6709 644 \u6216\u66f4\u4e25\u683c\u7684\u8bbe\u7f6e\uff08\u81ea\u52a8\uff09"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1apass"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u5728\u6bcf\u4e2a Worker \u8282\u70b9\u4e0a\u8fd0\u884c\u4ee5\u4e0b\u547d\u4ee4\uff08\u57fa\u4e8e\u7cfb\u7edf\u4e0a\u7684\u6587\u4ef6\u4f4d\u7f6e\uff09\u3002\n\u4f8b\u5982\uff1achmod 644 $proykubeconfig"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"/bin/sh -c 'if test -e /node/etc/kubernetes/ssl/kubecfg-kube-proxy.yaml; then stat -c %a /node/etc/kubernetes/ssl/kubecfg-kube-proxy.yaml; fi'\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u9884\u671f\u7ed3\u679c"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"'644' is present OR '640' is present OR '600' is equal to '600' OR '444' is present OR '440' is present OR '400' is present OR '000' is present\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u8fd4\u56de\u503c"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"600\n")),(0,a.kt)("h3",{id:"414\u786e\u4fdd\u4ee3\u7406-kubeconfig-\u6587\u4ef6\u6240\u6709\u6743\u8bbe\u7f6e\u4e3a-rootroot\u81ea\u52a8"},"4.1.4\u786e\u4fdd\u4ee3\u7406 kubeconfig \u6587\u4ef6\u6240\u6709\u6743\u8bbe\u7f6e\u4e3a root:root\uff08\u81ea\u52a8\uff09"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1apass"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u5728\u6bcf\u4e2a Worker \u8282\u70b9\u4e0a\u8fd0\u884c\u4ee5\u4e0b\u547d\u4ee4\uff08\u57fa\u4e8e\u7cfb\u7edf\u4e0a\u7684\u6587\u4ef6\u4f4d\u7f6e\uff09\u3002\n\u4f8b\u5982\uff1achown root:root /etc/kubernetes/ssl/kubecfg-kube-proxy.yaml"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"/bin/sh -c 'if test -e /etc/kubernetes/ssl/kubecfg-kube-proxy.yaml; then stat -c %U:%G /etc/kubernetes/ssl/kubecfg-kube-proxy.yaml; fi'\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u9884\u671f\u7ed3\u679c"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"'root:root' is not present OR '/etc/kubernetes/ssl/kubecfg-kube-proxy.yaml' is not present\n")),(0,a.kt)("h3",{id:"415\u786e\u4fdd---kubeconfig-kubeletconf-\u6587\u4ef6\u6743\u9650\u5177\u6709-644-\u6216\u66f4\u4e25\u683c\u7684\u8bbe\u7f6e\u81ea\u52a8"},"4.1.5\u786e\u4fdd --kubeconfig kubelet.conf \u6587\u4ef6\u6743\u9650\u5177\u6709 644 \u6216\u66f4\u4e25\u683c\u7684\u8bbe\u7f6e\uff08\u81ea\u52a8\uff09"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1apass"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u5728\u6bcf\u4e2a Worker \u8282\u70b9\u4e0a\u8fd0\u884c\u4ee5\u4e0b\u547d\u4ee4\uff08\u57fa\u4e8e\u7cfb\u7edf\u4e0a\u7684\u6587\u4ef6\u4f4d\u7f6e\uff09\u3002\n\u4f8b\u5982\uff1achmod 644 /etc/kubernetes/ssl/kubecfg-kube-node.yaml"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"/bin/sh -c 'if test -e /etc/kubernetes/ssl/kubecfg-kube-node.yaml; then stat -c permissions=%a /etc/kubernetes/ssl/kubecfg-kube-node.yaml; fi'\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u9884\u671f\u7ed3\u679c"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"'permissions' is not present\n")),(0,a.kt)("h3",{id:"416\u786e\u4fdd---kubeconfig-kubeletconf-\u6587\u4ef6\u6240\u6709\u6743\u8bbe\u7f6e\u4e3a-rootroot\u81ea\u52a8"},"4.1.6\u786e\u4fdd --kubeconfig kubelet.conf \u6587\u4ef6\u6240\u6709\u6743\u8bbe\u7f6e\u4e3a root:root\uff08\u81ea\u52a8\uff09"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1apass"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u5728\u6bcf\u4e2a Worker \u8282\u70b9\u4e0a\u8fd0\u884c\u4ee5\u4e0b\u547d\u4ee4\uff08\u57fa\u4e8e\u7cfb\u7edf\u4e0a\u7684\u6587\u4ef6\u4f4d\u7f6e\uff09\u3002\n\u4f8b\u5982\uff1achown root:root /etc/kubernetes/ssl/kubecfg-kube-node.yaml"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"/bin/sh -c 'if test -e /node/etc/kubernetes/ssl/kubecfg-kube-node.yaml; then stat -c %U:%G /node/etc/kubernetes/ssl/kubecfg-kube-node.yaml; fi'\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u9884\u671f\u7ed3\u679c"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"'root:root' is equal to 'root:root'\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u8fd4\u56de\u503c"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"root:root\n")),(0,a.kt)("h3",{id:"417\u786e\u4fdd-ca-\u6587\u4ef6\u6743\u9650\u5177\u6709-644-\u6216\u66f4\u4e25\u683c\u7684\u8bbe\u7f6e\u81ea\u52a8"},"4.1.7\u786e\u4fdd CA \u6587\u4ef6\u6743\u9650\u5177\u6709 644 \u6216\u66f4\u4e25\u683c\u7684\u8bbe\u7f6e\uff08\u81ea\u52a8\uff09"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1apass"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u8fd0\u884c\u4ee5\u4e0b\u547d\u4ee4\u4fee\u6539 ",(0,a.kt)("inlineCode",{parentName:"p"},"--client-ca-file chmod 644 <filename>")," \u7684\u6587\u4ef6\u6743\u9650\u3002"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1\u811a\u672c"),"\uff1a",(0,a.kt)("inlineCode",{parentName:"p"},"check_cafile_permissions.sh")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"#!/usr/bin/env bash\n\nCAFILE=$(ps -ef | grep kubelet | grep -v apiserver | grep -- --client-ca-file= | awk -F '--client-ca-file=' '{print $2}' | awk '{print $1}')\nif test -z $CAFILE; then CAFILE=$kubeletcafile; fi\nif test -e $CAFILE; then stat -c permissions=%a $CAFILE; fi\n\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1\u6267\u884c"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"./check_cafile_permissions.sh\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u9884\u671f\u7ed3\u679c"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"'permissions' is not present\n")),(0,a.kt)("h3",{id:"418\u786e\u4fdd\u5ba2\u6237\u7aef-ca-\u6587\u4ef6\u6240\u6709\u6743\u8bbe\u7f6e\u4e3a-rootroot\u81ea\u52a8"},"4.1.8\u786e\u4fdd\u5ba2\u6237\u7aef CA \u6587\u4ef6\u6240\u6709\u6743\u8bbe\u7f6e\u4e3a root:root\uff08\u81ea\u52a8\uff09"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1apass"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u8fd0\u884c\u4ee5\u4e0b\u547d\u4ee4\u6765\u4fee\u6539 ",(0,a.kt)("inlineCode",{parentName:"p"},"--client-ca-file")," \u7684\u6240\u6709\u6743\u3002\n",(0,a.kt)("inlineCode",{parentName:"p"},"chown root:root <filename>")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1\u811a\u672c"),"\uff1a",(0,a.kt)("inlineCode",{parentName:"p"},"check_cafile_ownership.sh")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"#!/usr/bin/env bash\n\nCAFILE=$(ps -ef | grep kubelet | grep -v apiserver | grep -- --client-ca-file= | awk -F '--client-ca-file=' '{print $2}' | awk '{print $1}')\nif test -z $CAFILE; then CAFILE=$kubeletcafile; fi\nif test -e $CAFILE; then stat -c %U:%G $CAFILE; fi\n\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1\u6267\u884c"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"./check_cafile_ownership.sh\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u9884\u671f\u7ed3\u679c"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"'root:root' is not present\n")),(0,a.kt)("h3",{id:"419\u786e\u4fdd-kubelet---config-\u914d\u7f6e\u6587\u4ef6\u6743\u9650\u5177\u6709-644-\u6216\u66f4\u4e25\u683c\u7684\u8bbe\u7f6e\u81ea\u52a8"},"4.1.9\u786e\u4fdd kubelet --config \u914d\u7f6e\u6587\u4ef6\u6743\u9650\u5177\u6709 644 \u6216\u66f4\u4e25\u683c\u7684\u8bbe\u7f6e\uff08\u81ea\u52a8\uff09"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1aNot Applicable"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u8fd0\u884c\u4ee5\u4e0b\u547d\u4ee4\uff08\u4f7f\u7528\u5ba1\u8ba1\u6b65\u9aa4\u4e2d\u786e\u5b9a\u7684\u914d\u7f6e\u6587\u4ef6\u4f4d\u7f6e\uff09\uff1a\nchmod 644 /var/lib/kubelet/config.yaml"),(0,a.kt)("p",null,"RKE \u914d\u7f6e\u7684\u96c6\u7fa4\u4e0d\u9700\u8981\u6216\u7ef4\u62a4 kubelet \u7684\u914d\u7f6e\u6587\u4ef6\u3002\n\u6240\u6709\u914d\u7f6e\u5728\u5bb9\u5668\u8fd0\u884c\u65f6\u4f5c\u4e3a\u53c2\u6570\u4f20\u5165\u3002"),(0,a.kt)("h3",{id:"4110\u786e\u4fdd-kubelet---config-\u914d\u7f6e\u6587\u4ef6\u6240\u6709\u6743\u8bbe\u7f6e\u4e3a-rootroot\u81ea\u52a8"},"4.1.10\u786e\u4fdd kubelet --config \u914d\u7f6e\u6587\u4ef6\u6240\u6709\u6743\u8bbe\u7f6e\u4e3a root:root\uff08\u81ea\u52a8\uff09"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1aNot Applicable"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u8fd0\u884c\u4ee5\u4e0b\u547d\u4ee4\uff08\u4f7f\u7528\u5ba1\u8ba1\u6b65\u9aa4\u4e2d\u786e\u5b9a\u7684\u914d\u7f6e\u6587\u4ef6\u4f4d\u7f6e\uff09\uff1a\nchown root:root /var/lib/kubelet/config.yaml"),(0,a.kt)("p",null,"RKE \u914d\u7f6e\u7684\u96c6\u7fa4\u4e0d\u9700\u8981\u6216\u7ef4\u62a4 kubelet \u7684\u914d\u7f6e\u6587\u4ef6\u3002\n\u6240\u6709\u914d\u7f6e\u5728\u5bb9\u5668\u8fd0\u884c\u65f6\u4f5c\u4e3a\u53c2\u6570\u4f20\u5165\u3002"),(0,a.kt)("h2",{id:"42kubelet"},"4.2Kubelet"),(0,a.kt)("h3",{id:"421\u786e\u4fdd\u5c06-anonymous-auth-\u53c2\u6570\u8bbe\u7f6e\u4e3a-false\u81ea\u52a8"},"4.2.1\u786e\u4fdd\u5c06 anonymous-auth \u53c2\u6570\u8bbe\u7f6e\u4e3a false\uff08\u81ea\u52a8\uff09"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1apass"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u5982\u679c\u4f7f\u7528 Kubelet \u914d\u7f6e\u6587\u4ef6\uff0c\u8bf7\u7f16\u8f91\u8be5\u6587\u4ef6\uff0c\u5c06 authentication: anonymous \u8bbe\u7f6e\u4e3a ",(0,a.kt)("inlineCode",{parentName:"p"},"false"),"\u3002\n\u5982\u679c\u4f7f\u7528\u53ef\u6267\u884c\u53c2\u6570\uff0c\u8bf7\u5728\u6bcf\u4e2a Worker \u8282\u70b9\u4e2d\u7f16\u8f91 kubelet \u670d\u52a1\u6587\u4ef6 /etc/systemd/system/kubelet.service.d/10-kubeadm.conf\uff0c\u5e76\u5728 ",(0,a.kt)("inlineCode",{parentName:"p"},"KUBELET_SYSTEM_PODS_ARGS")," \u53d8\u91cf\u4e2d\u8bbe\u7f6e\u4ee5\u4e0b\u53c2\u6570\u3002\n--anonymous-auth=false\n\u6839\u636e\u4f60\u7684\u7cfb\u7edf\uff0c\u91cd\u65b0\u542f\u52a8 kubelet \u670d\u52a1\u3002\u4f8b\u5982\uff1a\nsystemctl daemon-reload\nsystemctl restart kubelet.service"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"/bin/ps -fC kubelet\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1\u914d\u7f6e"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"/bin/cat /var/lib/kubelet/config.yaml\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u9884\u671f\u7ed3\u679c"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"'' is not present\n")),(0,a.kt)("h3",{id:"422\u786e\u4fdd---authorization-mode-\u53c2\u6570\u672a\u8bbe\u7f6e\u4e3a-alwaysallow\u81ea\u52a8"},"4.2.2\u786e\u4fdd --authorization-mode \u53c2\u6570\u672a\u8bbe\u7f6e\u4e3a AlwaysAllow\uff08\u81ea\u52a8\uff09"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1apass"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u5982\u679c\u4f7f\u7528 Kubelet \u914d\u7f6e\u6587\u4ef6\uff0c\u8bf7\u7f16\u8f91\u8be5\u6587\u4ef6\uff0c\u5c06 authorization: mode \u8bbe\u7f6e\u4e3a ",(0,a.kt)("inlineCode",{parentName:"p"},"Webhook"),"\u3002\u5982\u679c\u4f7f\u7528\u53ef\u6267\u884c\u53c2\u6570\uff0c\u8bf7\u5728\u6bcf\u4e2a Worker \u8282\u70b9\u4e2d\u7f16\u8f91 kubelet \u670d\u52a1\u6587\u4ef6 /etc/systemd/system/kubelet.service.d/10-kubeadm.conf\uff0c\u5e76\u5728 ",(0,a.kt)("inlineCode",{parentName:"p"},"KUBELET_AUTHZ_ARGS")," \u53d8\u91cf\u4e2d\u8bbe\u7f6e\u4ee5\u4e0b\u53c2\u6570\u3002\n--authorization-mode=Webhook\n\u6839\u636e\u4f60\u7684\u7cfb\u7edf\uff0c\u91cd\u65b0\u542f\u52a8 kubelet \u670d\u52a1\u3002\u4f8b\u5982\uff1a\nsystemctl daemon-reload\nsystemctl restart kubelet.service"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"/bin/ps -fC kubelet\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1\u914d\u7f6e"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"/bin/cat /var/lib/kubelet/config.yaml\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u9884\u671f\u7ed3\u679c"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"'' is not present\n")),(0,a.kt)("h3",{id:"423\u786e\u4fdd\u6839\u636e\u9700\u8981\u8bbe\u7f6e---client-ca-file-\u53c2\u6570\u81ea\u52a8"},"4.2.3\u786e\u4fdd\u6839\u636e\u9700\u8981\u8bbe\u7f6e --client-ca-file \u53c2\u6570\uff08\u81ea\u52a8\uff09"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1apass"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u5982\u679c\u4f7f\u7528 Kubelet \u914d\u7f6e\u6587\u4ef6\uff0c\u8bf7\u7f16\u8f91\u6587\u4ef6\uff0c\u5c06 authentication: x509: clientCAFile \u8bbe\u7f6e\u4e3a\u5ba2\u6237\u7aef CA \u6587\u4ef6\u7684\u4f4d\u7f6e\u3002\n\u5982\u679c\u4f7f\u7528\u547d\u4ee4\u884c\u53c2\u6570\uff0c\u8bf7\u5728\u6bcf\u4e2a Worker \u8282\u70b9\u4e2d\u7f16\u8f91 kubelet \u670d\u52a1\u6587\u4ef6 /etc/systemd/system/kubelet.service.d/10-kubeadm.conf\uff0c\u5e76\u5728 ",(0,a.kt)("inlineCode",{parentName:"p"},"KUBELET_AUTHZ_ARGS")," \u53d8\u91cf\u4e2d\u8bbe\u7f6e\u4ee5\u4e0b\u53c2\u6570\u3002\n",(0,a.kt)("inlineCode",{parentName:"p"},"--client-ca-file=<path/to/client-ca-file>"),"\n\u6839\u636e\u4f60\u7684\u7cfb\u7edf\uff0c\u91cd\u65b0\u542f\u52a8 kubelet \u670d\u52a1\u3002\u4f8b\u5982\uff1a\nsystemctl daemon-reload\nsystemctl restart kubelet.service"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"/bin/ps -fC kubelet\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1\u914d\u7f6e"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"/bin/cat /var/lib/kubelet/config.yaml\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u9884\u671f\u7ed3\u679c"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"'' is not present\n")),(0,a.kt)("h3",{id:"424\u786e\u4fdd---read-only-port-\u53c2\u6570\u8bbe\u7f6e\u4e3a-0\u81ea\u52a8"},"4.2.4\u786e\u4fdd --read-only-port \u53c2\u6570\u8bbe\u7f6e\u4e3a 0\uff08\u81ea\u52a8\uff09"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1apass"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u5982\u679c\u4f7f\u7528 Kubelet \u914d\u7f6e\u6587\u4ef6\uff0c\u8bf7\u7f16\u8f91\u8be5\u6587\u4ef6\uff0c\u5c06 ",(0,a.kt)("inlineCode",{parentName:"p"},"readOnlyPort")," \u8bbe\u7f6e\u4e3a 0\u3002\n\u5982\u679c\u4f7f\u7528\u547d\u4ee4\u884c\u53c2\u6570\uff0c\u8bf7\u5728\u6bcf\u4e2a Worker \u8282\u70b9\u4e2d\u7f16\u8f91 kubelet \u670d\u52a1\u6587\u4ef6 /etc/systemd/system/kubelet.service.d/10-kubeadm.conf\uff0c\u5e76\u5728 ",(0,a.kt)("inlineCode",{parentName:"p"},"KUBELET_SYSTEM_PODS_ARGS")," \u53d8\u91cf\u4e2d\u8bbe\u7f6e\u4ee5\u4e0b\u53c2\u6570\u3002\n--read-only-port=0\n\u6839\u636e\u4f60\u7684\u7cfb\u7edf\uff0c\u91cd\u65b0\u542f\u52a8 kubelet \u670d\u52a1\u3002\u4f8b\u5982\uff1a\nsystemctl daemon-reload\nsystemctl restart kubelet.service"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"/bin/ps -fC kubelet\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1\u914d\u7f6e"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"/bin/cat /var/lib/kubelet/config.yaml\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u9884\u671f\u7ed3\u679c"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"'' is not present OR '' is not present\n")),(0,a.kt)("h3",{id:"425\u786e\u4fdd---streaming-connection-idle-timeout-\u53c2\u6570\u672a\u8bbe\u7f6e\u4e3a-0\u81ea\u52a8"},"4.2.5\u786e\u4fdd --streaming-connection-idle-timeout \u53c2\u6570\u672a\u8bbe\u7f6e\u4e3a 0\uff08\u81ea\u52a8\uff09"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1apass"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u5982\u679c\u4f7f\u7528 Kubelet \u914d\u7f6e\u6587\u4ef6\uff0c\u8bf7\u7f16\u8f91\u8be5\u6587\u4ef6\uff0c\u5c06 ",(0,a.kt)("inlineCode",{parentName:"p"},"streamingConnectionIdleTimeout")," \u8bbe\u7f6e\u4e3a 0 \u4ee5\u5916\u7684\u503c\u3002\n\u5982\u679c\u4f7f\u7528\u547d\u4ee4\u884c\u53c2\u6570\uff0c\u8bf7\u5728\u6bcf\u4e2a Worker \u8282\u70b9\u4e2d\u7f16\u8f91 kubelet \u670d\u52a1\u6587\u4ef6 /etc/systemd/system/kubelet.service.d/10-kubeadm.conf\uff0c\u5e76\u5728 ",(0,a.kt)("inlineCode",{parentName:"p"},"KUBELET_SYSTEM_PODS_ARGS")," \u53d8\u91cf\u4e2d\u8bbe\u7f6e\u4ee5\u4e0b\u53c2\u6570\u3002\n--streaming-connection-idle-timeout=5m\n\u6839\u636e\u4f60\u7684\u7cfb\u7edf\uff0c\u91cd\u65b0\u542f\u52a8 kubelet \u670d\u52a1\u3002\u4f8b\u5982\uff1a\nsystemctl daemon-reload\nsystemctl restart kubelet.service"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"/bin/ps -fC kubelet\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1\u914d\u7f6e"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"/bin/cat /var/lib/kubelet/config.yaml\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u9884\u671f\u7ed3\u679c"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"'30m' is not equal to '0' OR '--streaming-connection-idle-timeout' is not present\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u8fd4\u56de\u503c"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"UID PID PPID C STIME TTY TIME CMD root 121813 121792 4 12:27 ?00:03:37 kubelet --fail-swap-on=false --resolv-conf=/etc/resolv.conf --authorization-mode=Webhook --kubeconfig=/etc/kubernetes/ssl/kubecfg-kube-node.yaml --v=2 --volume-plugin-dir=/var/lib/kubelet/volumeplugins --address=0.0.0.0 --make-iptables-util-chains=true --client-ca-file=/etc/kubernetes/ssl/kube-ca.pem --hostname-override=<external_ip> --tls-cert-file=/etc/kubernetes/ssl/kube-kubelet-<node_ip>.pem --network-plugin=cni --streaming-connection-idle-timeout=30m --root-dir=/var/lib/kubelet --event-qps=0 --feature-gates=RotateKubeletServerCertificate=true --protect-kernel-defaults=true --cloud-provider= --tls-private-key-file=/etc/kubernetes/ssl/kube-kubelet-<node_ip>-key.pem --cgroups-per-qos=True --cni-bin-dir=/opt/cni/bin --cni-conf-dir=/etc/cni/net.d --pod-infra-container-image=rancher/mirrored-pause:3.5 --tls-cipher-suites=TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_AES_128_GCM_SHA256 --anonymous-auth=false --authentication-token-webhook=true --node-ip=<node_ip> --cluster-dns=10.43.0.10 --cluster-domain=cluster.local --read-only-port=0 --cgroup-driver=cgroupfs --resolv-conf=/run/systemd/resolve/resolv.conf\n")),(0,a.kt)("h3",{id:"426\u786e\u4fdd---protect-kernel-defaults-\u53c2\u6570\u8bbe\u7f6e\u4e3a-true\u81ea\u52a8"},"4.2.6\u786e\u4fdd --protect-kernel-defaults \u53c2\u6570\u8bbe\u7f6e\u4e3a true\uff08\u81ea\u52a8\uff09"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1apass"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u5982\u679c\u4f7f\u7528 Kubelet \u914d\u7f6e\u6587\u4ef6\uff0c\u8bf7\u7f16\u8f91\u8be5\u6587\u4ef6\u4ee5\u8bbe\u7f6e ",(0,a.kt)("inlineCode",{parentName:"p"},"protectKernelDefaults: true"),"\u3002\n\u5982\u679c\u4f7f\u7528\u547d\u4ee4\u884c\u53c2\u6570\uff0c\u8bf7\u5728\u6bcf\u4e2a Worker \u8282\u70b9\u4e2d\u7f16\u8f91 kubelet \u670d\u52a1\u6587\u4ef6 /etc/systemd/system/kubelet.service.d/10-kubeadm.conf\uff0c\u5e76\u5728 ",(0,a.kt)("inlineCode",{parentName:"p"},"KUBELET_SYSTEM_PODS_ARGS")," \u53d8\u91cf\u4e2d\u8bbe\u7f6e\u4ee5\u4e0b\u53c2\u6570\u3002\n--protect-kernel-defaults=true\n\u6839\u636e\u4f60\u7684\u7cfb\u7edf\uff0c\u91cd\u65b0\u542f\u52a8 kubelet \u670d\u52a1\u3002\u4f8b\u5982\uff1a\nsystemctl daemon-reload\nsystemctl restart kubelet.service"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"/bin/ps -fC kubelet\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1\u914d\u7f6e"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"/bin/cat /var/lib/kubelet/config.yaml\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u9884\u671f\u7ed3\u679c"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"'' is not present\n")),(0,a.kt)("h3",{id:"427\u786e\u4fdd---make-iptables-util-chains-\u53c2\u6570\u8bbe\u7f6e\u4e3a-true\u81ea\u52a8"},"4.2.7\u786e\u4fdd --make-iptables-util-chains \u53c2\u6570\u8bbe\u7f6e\u4e3a true\uff08\u81ea\u52a8\uff09"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1apass"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u5982\u679c\u4f7f\u7528 Kubelet \u914d\u7f6e\u6587\u4ef6\uff0c\u8bf7\u7f16\u8f91\u8be5\u6587\u4ef6\u4ee5\u8bbe\u7f6e ",(0,a.kt)("inlineCode",{parentName:"p"},"makeIPTablesUtilChains: true"),"\u3002\n\u5982\u679c\u4f7f\u7528\u547d\u4ee4\u884c\u53c2\u6570\uff0c\u8bf7\u5728\u6bcf\u4e2a Worker \u8282\u70b9\u4e0a\u7f16\u8f91 kubelet \u670d\u52a1\u6587\u4ef6 /etc/systemd/system/kubelet.service.d/10-kubeadm.conf\uff0c\u5e76\u5220\u9664 ",(0,a.kt)("inlineCode",{parentName:"p"},"KUBELET_SYSTEM_PODS_ARGS")," \u53d8\u91cf\u4e2d\u7684 ",(0,a.kt)("inlineCode",{parentName:"p"},"--make-iptables-util-chains")," \u53c2\u6570\u3002\n\u6839\u636e\u4f60\u7684\u7cfb\u7edf\uff0c\u91cd\u65b0\u542f\u52a8 kubelet \u670d\u52a1\u3002\u4f8b\u5982\uff1a\nsystemctl daemon-reload\nsystemctl restart kubelet.service"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"/bin/ps -fC kubelet\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1\u914d\u7f6e"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"/bin/cat /var/lib/kubelet/config.yaml\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u9884\u671f\u7ed3\u679c"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"'' is not present OR '' is not present\n")),(0,a.kt)("h3",{id:"428\u786e\u4fdd\u672a\u8bbe\u7f6e---hostname-override-\u53c2\u6570\u624b\u52a8"},"4.2.8\u786e\u4fdd\u672a\u8bbe\u7f6e --hostname-override \u53c2\u6570\uff08\u624b\u52a8\uff09"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1aNot Applicable"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u5728\u6bcf\u4e2a Worker \u8282\u70b9\u4e0a\u7f16\u8f91 kubelet \u670d\u52a1\u6587\u4ef6 /etc/systemd/system/kubelet.service.d/10-kubeadm.conf\uff0c\u5e76\u5220\u9664 ",(0,a.kt)("inlineCode",{parentName:"p"},"KUBELET_SYSTEM_PODS_ARGS")," \u53d8\u91cf\u4e2d\u7684 ",(0,a.kt)("inlineCode",{parentName:"p"},"--hostname-override")," \u53c2\u6570\u3002\n\u6839\u636e\u4f60\u7684\u7cfb\u7edf\uff0c\u91cd\u65b0\u542f\u52a8 kubelet \u670d\u52a1\u3002\u4f8b\u5982\uff1a\nsystemctl daemon-reload\nsystemctl restart kubelet.service"),(0,a.kt)("p",null,"RKE \u914d\u7f6e\u7684\u96c6\u7fa4\u4f1a\u8bbe\u7f6e ",(0,a.kt)("inlineCode",{parentName:"p"},"--hostname-override"),"\uff0c\u4ece\u800c\u907f\u514d\u4e3b\u673a\u540d\u914d\u7f6e\u9519\u8bef\u3002"),(0,a.kt)("h3",{id:"429\u786e\u4fdd---event-qps-\u53c2\u6570\u8bbe\u7f6e\u4e3a-0-\u6216\u80fd\u9002\u5f53\u6293\u53d6\u4e8b\u4ef6\u7684\u7ea7\u522b\u81ea\u52a8"},"4.2.9\u786e\u4fdd --event-qps \u53c2\u6570\u8bbe\u7f6e\u4e3a 0 \u6216\u80fd\u9002\u5f53\u6293\u53d6\u4e8b\u4ef6\u7684\u7ea7\u522b\uff08\u81ea\u52a8\uff09"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1apass"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u5982\u679c\u4f7f\u7528 Kubelet \u914d\u7f6e\u6587\u4ef6\uff0c\u8bf7\u7f16\u8f91\u8be5\u6587\u4ef6\u4ee5\u5c06 ",(0,a.kt)("inlineCode",{parentName:"p"},"eventRecordQPS")," \u8bbe\u7f6e\u4e3a\u9002\u5f53\u7684\u7ea7\u522b\u3002\n\u5982\u679c\u4f7f\u7528\u547d\u4ee4\u884c\u53c2\u6570\uff0c\u8bf7\u5728\u6bcf\u4e2a Worker \u8282\u70b9\u4e2d\u7f16\u8f91 kubelet \u670d\u52a1\u6587\u4ef6 /etc/systemd/system/kubelet.service.d/10-kubeadm.conf\uff0c\u5e76\u5728 ",(0,a.kt)("inlineCode",{parentName:"p"},"KUBELET_SYSTEM_PODS_ARGS")," \u53d8\u91cf\u4e2d\u8bbe\u7f6e\u4ee5\u4e0b\u53c2\u6570\u3002\n\u6839\u636e\u4f60\u7684\u7cfb\u7edf\uff0c\u91cd\u65b0\u542f\u52a8 kubelet \u670d\u52a1\u3002\u4f8b\u5982\uff1a\nsystemctl daemon-reload\nsystemctl restart kubelet.service"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"/bin/ps -fC kubelet\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1\u914d\u7f6e"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"/bin/cat /var/lib/kubelet/config.yaml\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u9884\u671f\u7ed3\u679c"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"'' is not present\n")),(0,a.kt)("h3",{id:"4210\u786e\u4fdd\u6839\u636e\u9700\u8981\u8bbe\u7f6e---tls-cert-file-\u548c---tls-private-key-file-\u53c2\u6570\u81ea\u52a8"},"4.2.10\u786e\u4fdd\u6839\u636e\u9700\u8981\u8bbe\u7f6e --tls-cert-file \u548c --tls-private-key-file \u53c2\u6570\uff08\u81ea\u52a8\uff09"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1apass"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u5982\u679c\u4f7f\u7528 Kubelet \u914d\u7f6e\u6587\u4ef6\uff0c\u8bf7\u7f16\u8f91\u8be5\u6587\u4ef6\u4ee5\u5c06 ",(0,a.kt)("inlineCode",{parentName:"p"},"tlsCertFile")," \u8bbe\u7f6e\u4e3a\u8bc1\u4e66\u6587\u4ef6\u7684\u4f4d\u7f6e\u6765\u4f7f\u7528 Kubelet \u7684\u6807\u8bc6\u7b26\uff0c\u5e76\u5c06 ",(0,a.kt)("inlineCode",{parentName:"p"},"tlsPrivateKeyFile")," \u8bbe\u7f6e\u4e3a\u5bf9\u5e94\u7684\u79c1\u94a5\u6587\u4ef6\u7684\u4f4d\u7f6e\u3002\n\u5982\u679c\u4f7f\u7528\u547d\u4ee4\u884c\u53c2\u6570\uff0c\u8bf7\u5728\u6bcf\u4e2a Worker \u8282\u70b9\u4e2d\u7f16\u8f91 kubelet \u670d\u52a1\u6587\u4ef6 /etc/systemd/system/kubelet.service.d/10-kubeadm.conf\uff0c\u5e76\u5728 ",(0,a.kt)("inlineCode",{parentName:"p"},"KUBELET_CERTIFICATE_ARGS")," \u53d8\u91cf\u4e2d\u8bbe\u7f6e\u4ee5\u4e0b\u53c2\u6570\u3002\n",(0,a.kt)("inlineCode",{parentName:"p"},"--tls-cert-file=<path/to/tls-certificate-file>"),"\n",(0,a.kt)("inlineCode",{parentName:"p"},"--tls-private-key-file=<path/to/tls-key-file>"),"\n\u6839\u636e\u4f60\u7684\u7cfb\u7edf\uff0c\u91cd\u65b0\u542f\u52a8 kubelet \u670d\u52a1\u3002\u4f8b\u5982\uff1a\nsystemctl daemon-reload\nsystemctl restart kubelet.service"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"/bin/ps -fC kubelet\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1\u914d\u7f6e"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"/bin/cat /var/lib/kubelet/config.yaml\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u9884\u671f\u7ed3\u679c"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"'' is not present AND '' is not present\n")),(0,a.kt)("h3",{id:"4211\u786e\u4fdd---rotate-certificates-\u53c2\u6570\u672a\u8bbe\u7f6e\u4e3a-false\u81ea\u52a8"},"4.2.11\u786e\u4fdd --rotate-certificates \u53c2\u6570\u672a\u8bbe\u7f6e\u4e3a false\uff08\u81ea\u52a8\uff09"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1apass"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u5982\u679c\u4f7f\u7528 Kubelet \u914d\u7f6e\u6587\u4ef6\uff0c\u8bf7\u7f16\u8f91\u6587\u4ef6\u4ee5\u6dfb\u52a0\u884c ",(0,a.kt)("inlineCode",{parentName:"p"},"rotateCertificates: true"),"\uff0c\u6216\u5b8c\u5168\u5220\u9664\u5b83\u4ee5\u4f7f\u7528\u9ed8\u8ba4\u503c\u3002\n\u5982\u679c\u4f7f\u7528\u547d\u4ee4\u884c\u53c2\u6570\uff0c\u8bf7\u5728\u6bcf\u4e2a Worker \u8282\u70b9\u4e0a\u7f16\u8f91 kubelet \u670d\u52a1\u6587\u4ef6 /etc/systemd/system/kubelet.service.d/10-kubeadm.conf\uff0c\u5e76\u5220\u9664 ",(0,a.kt)("inlineCode",{parentName:"p"},"KUBELET_CERTIFICATE_ARGS")," \u53d8\u91cf\u4e2d\u7684 ",(0,a.kt)("inlineCode",{parentName:"p"},"--rotate-certificates=false")," \u53c2\u6570\u3002\n\u6839\u636e\u4f60\u7684\u7cfb\u7edf\uff0c\u91cd\u65b0\u542f\u52a8 kubelet \u670d\u52a1\u3002\u4f8b\u5982\uff1a\nsystemctl daemon-reload\nsystemctl restart kubelet.service"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"/bin/ps -fC kubelet\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1\u914d\u7f6e"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"/bin/cat /var/lib/kubelet/config.yaml\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u9884\u671f\u7ed3\u679c"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"'--rotate-certificates' is not present OR '--rotate-certificates' is not present\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u8fd4\u56de\u503c"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"UID PID PPID C STIME TTY TIME CMD root 121813 121792 4 12:27 ?00:03:37 kubelet --fail-swap-on=false --resolv-conf=/etc/resolv.conf --authorization-mode=Webhook --kubeconfig=/etc/kubernetes/ssl/kubecfg-kube-node.yaml --v=2 --volume-plugin-dir=/var/lib/kubelet/volumeplugins --address=0.0.0.0 --make-iptables-util-chains=true --client-ca-file=/etc/kubernetes/ssl/kube-ca.pem --hostname-override=<external_ip> --tls-cert-file=/etc/kubernetes/ssl/kube-kubelet-<node_ip>.pem --network-plugin=cni --streaming-connection-idle-timeout=30m --root-dir=/var/lib/kubelet --event-qps=0 --feature-gates=RotateKubeletServerCertificate=true --protect-kernel-defaults=true --cloud-provider= --tls-private-key-file=/etc/kubernetes/ssl/kube-kubelet-<node_ip>-key.pem --cgroups-per-qos=True --cni-bin-dir=/opt/cni/bin --cni-conf-dir=/etc/cni/net.d --pod-infra-container-image=rancher/mirrored-pause:3.5 --tls-cipher-suites=TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_AES_128_GCM_SHA256 --anonymous-auth=false --authentication-token-webhook=true --node-ip=<node_ip> --cluster-dns=10.43.0.10 --cluster-domain=cluster.local --read-only-port=0 --cgroup-driver=cgroupfs --resolv-conf=/run/systemd/resolve/resolv.conf\n")),(0,a.kt)("h3",{id:"4212\u9a8c\u8bc1-rotatekubeletservercertificate-\u53c2\u6570\u662f\u5426\u8bbe\u7f6e\u4e3a-true\u81ea\u52a8"},"4.2.12\u9a8c\u8bc1 RotateKubeletServerCertificate \u53c2\u6570\u662f\u5426\u8bbe\u7f6e\u4e3a true\uff08\u81ea\u52a8\uff09"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1aNot Applicable"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u5728\u6bcf\u4e2a Worker \u8282\u70b9\u4e0a\u7f16\u8f91 kubelet \u670d\u52a1\u6587\u4ef6 /etc/systemd/system/kubelet.service.d/10-kubeadm.conf\uff0c\u5e76\u5728 ",(0,a.kt)("inlineCode",{parentName:"p"},"KUBELET_CERTIFICATE_ARGS")," \u53d8\u91cf\u4e2d\u8bbe\u7f6e\u4ee5\u4e0b\u53c2\u6570\u3002\n--feature-gates=RotateKubeletServerCertificate=true\n\u6839\u636e\u4f60\u7684\u7cfb\u7edf\uff0c\u91cd\u65b0\u542f\u52a8 kubelet \u670d\u52a1\u3002\u4f8b\u5982\uff1a\nsystemctl daemon-reload\nsystemctl restart kubelet.service"),(0,a.kt)("p",null,"RKE \u914d\u7f6e\u7684\u96c6\u7fa4\u76f4\u63a5\u4f7f\u7528 RKE \u5904\u7406\u8bc1\u4e66\u8f6e\u6362\u3002"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1\u914d\u7f6e"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"/bin/cat /var/lib/kubelet/config.yaml\n")),(0,a.kt)("h3",{id:"4213\u786e\u4fdd-kubelet-\u4ec5\u4f7f\u7528\u5f3a\u5bc6\u7801\u81ea\u52a8"},"4.2.13\u786e\u4fdd Kubelet \u4ec5\u4f7f\u7528\u5f3a\u5bc6\u7801\uff08\u81ea\u52a8\uff09"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1apass"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u5982\u679c\u4f7f\u7528 Kubelet \u914d\u7f6e\u6587\u4ef6\uff0c\u8bf7\u7f16\u8f91\u8be5\u6587\u4ef6\u4ee5\u5c06 ",(0,a.kt)("inlineCode",{parentName:"p"},"TLSCipherSuites")," \u8bbe\u7f6e\u4e3a\nTLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_AES_128_GCM_SHA256 \u6216\u8fd9\u4e9b\u503c\u7684\u5b50\u96c6\u3002\n\u5982\u679c\u4f7f\u7528\u53ef\u6267\u884c\u53c2\u6570\uff0c\u8bf7\u5728\u6bcf\u4e2a Worker \u8282\u70b9\u4e0a\u7f16\u8f91 kubelet \u670d\u52a1\u6587\u4ef6 /etc/systemd/system/kubelet.service.d/10-kubeadm.conf\uff0c\u5e76\u5c06 ",(0,a.kt)("inlineCode",{parentName:"p"},"--tls-cipher-suites")," \u53c2\u6570\u8bbe\u7f6e\u5982\u4e0b\u503c\uff0c\u6216\u8fd9\u4e9b\u503c\u7684\u5b50\u96c6\u3002\n--tls-cipher-suites=TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_AES_128_GCM_SHA256\n\u6839\u636e\u4f60\u7684\u7cfb\u7edf\uff0c\u91cd\u65b0\u542f\u52a8 kubelet \u670d\u52a1\u3002\u4f8b\u5982\uff1a\nsystemctl daemon-reload\nsystemctl restart kubelet.service"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"/bin/ps -fC kubelet\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1\u914d\u7f6e"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"/bin/cat /var/lib/kubelet/config.yaml\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u9884\u671f\u7ed3\u679c"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"'' is not present\n")),(0,a.kt)("h2",{id:"51rbac-\u548c-serviceaccount"},"5.1RBAC \u548c ServiceAccount"),(0,a.kt)("h3",{id:"511\u786e\u4fdd\u4ec5\u5728\u9700\u8981\u65f6\u4f7f\u7528-cluster-admin-\u89d2\u8272\u624b\u52a8"},"5.1.1\u786e\u4fdd\u4ec5\u5728\u9700\u8981\u65f6\u4f7f\u7528 cluster-admin \u89d2\u8272\uff08\u624b\u52a8\uff09"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1awarn"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u8bc6\u522b cluster-admin \u89d2\u8272\u7684\u6240\u6709 clusterrolebindings\u3002\u68c0\u67e5\u5b83\u4eec\u662f\u5426\u88ab\u4f7f\u7528\uff0c\u5b83\u4eec\u662f\u5426\u9700\u8981\u8fd9\u4e2a\u89d2\u8272\uff0c\u6216\u8005\u662f\u5426\u53ef\u4ee5\u4f7f\u7528\u8f83\u4f4e\u6743\u9650\u7684\u89d2\u8272\u3002\n\u5728\u53ef\u80fd\u7684\u60c5\u51b5\u4e0b\uff0c\u5148\u5c06\u7528\u6237\u7ed1\u5b9a\u5230\u8f83\u4f4e\u6743\u9650\u7684\u89d2\u8272\uff0c\u7136\u540e\u5220\u9664\u7ed1\u5b9a\u5230 cluster-admin \u89d2\u8272\u7684 clusterrolebinding\uff1a\nkubectl delete clusterrolebinding ","[name]"),(0,a.kt)("h3",{id:"512\u5c3d\u91cf\u51cf\u5c11\u5bf9\u5bc6\u6587\u7684\u8bbf\u95ee\u624b\u52a8"},"5.1.2\u5c3d\u91cf\u51cf\u5c11\u5bf9\u5bc6\u6587\u7684\u8bbf\u95ee\uff08\u624b\u52a8\uff09"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1awarn"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u5728\u53ef\u80fd\u7684\u60c5\u51b5\u4e0b\uff0c\u5220\u9664\u5bf9\u96c6\u7fa4\u4e2d\u5bc6\u6587\u5bf9\u8c61\u7684 get\u3001list \u548c watch \u8bbf\u95ee\u3002"),(0,a.kt)("h3",{id:"513\u5c3d\u91cf\u51cf\u5c11\u89d2\u8272\u548c-clusterroles-\u4e2d\u901a\u914d\u7b26\u7684\u4f7f\u7528\u624b\u52a8"},"5.1.3\u5c3d\u91cf\u51cf\u5c11\u89d2\u8272\u548c ClusterRoles \u4e2d\u901a\u914d\u7b26\u7684\u4f7f\u7528\uff08\u624b\u52a8\uff09"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1awarn"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u5728\u53ef\u80fd\u7684\u60c5\u51b5\u4e0b\uff0c\u5c06\u96c6\u7fa4\u89d2\u8272\u548c\u89d2\u8272\u4e2d\u7684\u901a\u914d\u7b26\u66ff\u6362\u4e3a\u7279\u5b9a\u7684\u5bf9\u8c61\u6216\u52a8\u4f5c\u3002"),(0,a.kt)("h3",{id:"514\u5c3d\u91cf\u51cf\u5c11\u521b\u5efa-pod-\u7684\u8bbf\u95ee\u624b\u52a8"},"5.1.4\u5c3d\u91cf\u51cf\u5c11\u521b\u5efa pod \u7684\u8bbf\u95ee\uff08\u624b\u52a8\uff09"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1awarn"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u5728\u53ef\u80fd\u7684\u60c5\u51b5\u4e0b\uff0c\u5220\u9664\u5bf9\u96c6\u7fa4\u4e2d pod \u5bf9\u8c61\u7684\u521b\u5efa\u8bbf\u95ee\u6743\u9650\u3002"),(0,a.kt)("h3",{id:"515\u786e\u4fdd\u672a\u4e3b\u52a8\u4f7f\u7528\u9ed8\u8ba4-serviceaccount\u81ea\u52a8"},"5.1.5\u786e\u4fdd\u672a\u4e3b\u52a8\u4f7f\u7528\u9ed8\u8ba4 ServiceAccount\u3002\uff08\u81ea\u52a8\uff09"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1apass"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u5728 Kubernetes \u5de5\u4f5c\u8d1f\u8f7d\u9700\u8981\u5bf9 Kubernetes API Server \u8fdb\u884c\u7279\u5b9a\u8bbf\u95ee\u65f6\uff0c\u521b\u5efa\u663e\u5f0f\u7684 ServiceAccount\u3002\n\u4fee\u6539\u6bcf\u4e2a\u9ed8\u8ba4 ServiceAccount \u7684\u914d\u7f6e\u4ee5\u5305\u542b\u6b64\u503c\nautomountServiceAccountToken: false"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1\u811a\u672c"),"\uff1a",(0,a.kt)("inlineCode",{parentName:"p"},"check_for_default_sa.sh")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},'#!/bin/bash\n\nset -eE\n\nhandle_error() {\n    echo "false"\n}\n\ntrap \'handle_error\' ERR\n\ncount_sa=$(kubectl get serviceaccounts --all-namespaces -o json | jq -r \'.items[] | select(.metadata.name=="default") | select((.automountServiceAccountToken == null) or (.automountServiceAccountToken == true))\' | jq .metadata.namespace | wc -l)\nif [[ ${count_sa} -gt 0 ]]; then\n    echo "false"\n    exit\nfi\n\nfor ns in $(kubectl get ns --no-headers -o custom-columns=":metadata.name")\ndo\n    for result in $(kubectl get clusterrolebinding,rolebinding -n $ns -o json | jq -r \'.items[] | select((.subjects[].kind=="ServiceAccount" and .subjects[].name=="default") or (.subjects[].kind=="Group" and .subjects[].name=="system:serviceaccounts"))\' | jq -r \'"\\(.roleRef.kind),\\(.roleRef.name)"\')\n    do\n        read kind name <<<$(IFS=","; echo $result)\n        resource_count=$(kubectl get $kind $name -n $ns -o json | jq -r \'.rules[] | select(.resources[] != "podsecuritypolicies")\' | wc -l)\n        if [[ ${resource_count} -gt 0 ]]; then\n            echo "false"\n            exit\n        fi\n    done\ndone\n\n\necho "true"\n')),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1\u6267\u884c"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"./check_for_default_sa.sh\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u9884\u671f\u7ed3\u679c"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"'true' is equal to 'true'\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u8fd4\u56de\u503c"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"true\n")),(0,a.kt)("h3",{id:"516\u786e\u4fdd\u4ec5\u5728\u5fc5\u8981\u65f6\u6302\u8f7d-serviceaccount-\u4ee4\u724c\u624b\u52a8"},"5.1.6\u786e\u4fdd\u4ec5\u5728\u5fc5\u8981\u65f6\u6302\u8f7d ServiceAccount \u4ee4\u724c\uff08\u624b\u52a8\uff09"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1awarn"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u4fee\u6539\u4e0d\u9700\u8981\u6302\u8f7d ServiceAccount \u4ee4\u724c\u7684 pod \u548c ServiceAccount \u7684\u5b9a\u4e49\uff0c\u4f7f\u5176\u7981\u7528\u3002"),(0,a.kt)("h2",{id:"52pod-\u5b89\u5168\u7b56\u7565"},"5.2Pod \u5b89\u5168\u7b56\u7565"),(0,a.kt)("h3",{id:"521\u6700\u5c0f\u5316\u7279\u6743\u5bb9\u5668\u7684\u51c6\u5165\u624b\u52a8"},"5.2.1\u6700\u5c0f\u5316\u7279\u6743\u5bb9\u5668\u7684\u51c6\u5165\uff08\u624b\u52a8\uff09"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1awarn"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u6309\u7167 Kubernetes \u6587\u6863\u4e2d\u7684\u8bf4\u660e\u521b\u5efa PSP\uff0c\u786e\u4fdd ",(0,a.kt)("inlineCode",{parentName:"p"},".spec.privileged")," \u5b57\u6bb5\u88ab\u7701\u7565\u6216\u8bbe\u7f6e\u4e3a false\u3002"),(0,a.kt)("h3",{id:"522\u6700\u5c0f\u5316\u9700\u8981\u5171\u4eab\u4e3b\u673a\u8fdb\u7a0b-id-\u547d\u540d\u7a7a\u95f4\u7684\u5bb9\u5668\u51c6\u5165\u81ea\u52a8"},"5.2.2\u6700\u5c0f\u5316\u9700\u8981\u5171\u4eab\u4e3b\u673a\u8fdb\u7a0b ID \u547d\u540d\u7a7a\u95f4\u7684\u5bb9\u5668\u51c6\u5165\uff08\u81ea\u52a8\uff09"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1apass"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u6309\u7167 Kubernetes \u6587\u6863\u4e2d\u7684\u8bf4\u660e\u521b\u5efa PSP\uff0c\u786e\u4fdd ",(0,a.kt)("inlineCode",{parentName:"p"},".spec.hostPID")," \u5b57\u6bb5\u88ab\u7701\u7565\u6216\u8bbe\u7f6e\u4e3a false\u3002"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"kubectl get psp -o json | jq .items[] | jq -r 'select((.spec.hostPID == null) or (.spec.hostPID == false))' | jq .metadata.name | wc -l | xargs -I {} echo '--count={}'\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u9884\u671f\u7ed3\u679c"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"1 is greater than 0\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u8fd4\u56de\u503c"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"--count=1\n")),(0,a.kt)("h3",{id:"523\u6700\u5c0f\u5316\u9700\u8981\u5171\u4eab\u4e3b\u673a-ipc-\u547d\u540d\u7a7a\u95f4\u7684\u5bb9\u5668\u51c6\u5165\u81ea\u52a8"},"5.2.3\u6700\u5c0f\u5316\u9700\u8981\u5171\u4eab\u4e3b\u673a IPC \u547d\u540d\u7a7a\u95f4\u7684\u5bb9\u5668\u51c6\u5165\uff08\u81ea\u52a8\uff09"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1apass"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u6309\u7167 Kubernetes \u6587\u6863\u4e2d\u7684\u8bf4\u660e\u521b\u5efa PSP\uff0c\u786e\u4fdd ",(0,a.kt)("inlineCode",{parentName:"p"},".spec.hostIPC")," \u5b57\u6bb5\u88ab\u7701\u7565\u6216\u8bbe\u7f6e\u4e3a false\u3002"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"kubectl get psp -o json | jq .items[] | jq -r 'select((.spec.hostIPC == null) or (.spec.hostIPC == false))' | jq .metadata.name | wc -l | xargs -I {} echo '--count={}'\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u9884\u671f\u7ed3\u679c"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"1 is greater than 0\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u8fd4\u56de\u503c"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"--count=1\n")),(0,a.kt)("h3",{id:"524\u6700\u5c0f\u5316\u9700\u8981\u5171\u4eab\u4e3b\u673a\u7f51\u7edc\u547d\u540d\u7a7a\u95f4\u7684\u5bb9\u5668\u51c6\u5165\u81ea\u52a8"},"5.2.4\u6700\u5c0f\u5316\u9700\u8981\u5171\u4eab\u4e3b\u673a\u7f51\u7edc\u547d\u540d\u7a7a\u95f4\u7684\u5bb9\u5668\u51c6\u5165\uff08\u81ea\u52a8\uff09"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1apass"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u6309\u7167 Kubernetes \u6587\u6863\u4e2d\u7684\u8bf4\u660e\u521b\u5efa PSP\uff0c\u786e\u4fdd ",(0,a.kt)("inlineCode",{parentName:"p"},".spec.hostNetwork")," \u5b57\u6bb5\u88ab\u7701\u7565\u6216\u8bbe\u7f6e\u4e3a false\u3002"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"kubectl get psp -o json | jq .items[] | jq -r 'select((.spec.hostNetwork == null) or (.spec.hostNetwork == false))' | jq .metadata.name | wc -l | xargs -I {} echo '--count={}'\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u9884\u671f\u7ed3\u679c"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"1 is greater than 0\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u8fd4\u56de\u503c"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"--count=1\n")),(0,a.kt)("h3",{id:"525\u4f7f\u7528-allowprivilegeescalation\u81ea\u52a8\u6700\u5c0f\u5316\u5bb9\u5668\u7684\u51c6\u5165"},"5.2.5\u4f7f\u7528 allowPrivilegeEscalation\uff08\u81ea\u52a8\uff09\u6700\u5c0f\u5316\u5bb9\u5668\u7684\u51c6\u5165"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1apass"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u6309\u7167 Kubernetes \u6587\u6863\u4e2d\u7684\u8bf4\u660e\u521b\u5efa PSP\uff0c\u786e\u4fdd ",(0,a.kt)("inlineCode",{parentName:"p"},".spec.allowPrivilegeEscalation")," \u5b57\u6bb5\u88ab\u7701\u7565\u6216\u8bbe\u7f6e\u4e3a false\u3002"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"kubectl get psp -o json | jq .items[] | jq -r 'select((.spec.allowPrivilegeEscalation == null) or (.spec.allowPrivilegeEscalation == false))' | jq .metadata.name | wc -l | xargs -I {} echo '--count={}'\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u9884\u671f\u7ed3\u679c"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"1 is greater than 0\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u8fd4\u56de\u503c"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"--count=1\n")),(0,a.kt)("h3",{id:"526\u6700\u5c0f\u5316\u6839\u5bb9\u5668\u7684\u51c6\u5165\u624b\u52a8"},"5.2.6\u6700\u5c0f\u5316\u6839\u5bb9\u5668\u7684\u51c6\u5165\uff08\u624b\u52a8\uff09"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1awarn"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u6309\u7167 Kubernetes \u6587\u6863\u4e2d\u7684\u8bf4\u660e\u521b\u5efa PSP\uff0c\u786e\u4fdd ",(0,a.kt)("inlineCode",{parentName:"p"},".spec.runAsUser.rule")," \u8bbe\u7f6e\u4e3a ",(0,a.kt)("inlineCode",{parentName:"p"},"MustRunAsNonRoot")," \u6216 ",(0,a.kt)("inlineCode",{parentName:"p"},"MustRunAs"),"\uff0c\u8303\u56f4\u4e3a\u4e0d\u5305\u62ec 0 \u7684 UID\u3002"),(0,a.kt)("h3",{id:"527\u4f7f\u7528-net_raw-\u529f\u80fd\u6700\u5927\u9650\u5ea6\u5730\u51cf\u5c11\u5bb9\u5668\u7684\u51c6\u5165\u624b\u52a8"},"5.2.7\u4f7f\u7528 NET_RAW \u529f\u80fd\u6700\u5927\u9650\u5ea6\u5730\u51cf\u5c11\u5bb9\u5668\u7684\u51c6\u5165\uff08\u624b\u52a8\uff09"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1awarn"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u6309\u7167 Kubernetes \u6587\u6863\u4e2d\u7684\u8bf4\u660e\u521b\u5efa PSP\uff0c\u786e\u4fdd ",(0,a.kt)("inlineCode",{parentName:"p"},".spec.requiredDropCapabilities")," \u5305\u62ec ",(0,a.kt)("inlineCode",{parentName:"p"},"NET_RAW")," \u6216 ",(0,a.kt)("inlineCode",{parentName:"p"},"ALL"),"\u3002"),(0,a.kt)("h3",{id:"528\u4f7f\u7528\u6dfb\u52a0\u7684\u529f\u80fd\u6700\u5927\u9650\u5ea6\u5730\u51cf\u5c11\u5bb9\u5668\u7684\u51c6\u5165\u624b\u52a8"},"5.2.8\u4f7f\u7528\u6dfb\u52a0\u7684\u529f\u80fd\u6700\u5927\u9650\u5ea6\u5730\u51cf\u5c11\u5bb9\u5668\u7684\u51c6\u5165\uff08\u624b\u52a8\uff09"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1awarn"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u786e\u4fdd\u96c6\u7fa4\u7684 PSP \u4e2d\u4e0d\u5b58\u5728 ",(0,a.kt)("inlineCode",{parentName:"p"},"allowedCapabilities"),"\uff0c\u9664\u975e\u5b83\u88ab\u8bbe\u7f6e\u4e3a\u4e00\u4e2a\u7a7a\u6570\u7ec4\u3002"),(0,a.kt)("h3",{id:"529\u4f7f\u7528\u5206\u914d\u7684\u529f\u80fd\u6700\u5927\u9650\u5ea6\u5730\u51cf\u5c11\u5bb9\u5668\u7684\u51c6\u5165\u624b\u52a8"},"5.2.9\u4f7f\u7528\u5206\u914d\u7684\u529f\u80fd\u6700\u5927\u9650\u5ea6\u5730\u51cf\u5c11\u5bb9\u5668\u7684\u51c6\u5165\uff08\u624b\u52a8\uff09"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1awarn"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u67e5\u770b\u96c6\u7fa4\u4e0a\u8fd0\u884c\u7684\u5e94\u7528\u7a0b\u5e8f\u4e2d\u529f\u80fd\u7684\u4f7f\u7528\u60c5\u51b5\u3002\u5982\u679c\u4e00\u4e2a\u547d\u540d\u7a7a\u95f4\u5305\u542b\u4e0d\u9700\u8981\u4efb\u4f55 Linux \u529f\u80fd\u7684\u5e94\u7528\uff0c\u4f60\u53ef\u4ee5\u8003\u8651\u6dfb\u52a0\u4e00\u4e2a PSP\uff0c\u7981\u6b62\u4e0d\u4e22\u5f03\u6240\u6709\u529f\u80fd\u7684\u5bb9\u5668\u7684\u51c6\u5165\u3002"),(0,a.kt)("h2",{id:"53\u7f51\u7edc\u7b56\u7565\u548c-cni"},"5.3\u7f51\u7edc\u7b56\u7565\u548c \u200b\u200bCNI"),(0,a.kt)("h3",{id:"531\u786e\u4fdd\u4f7f\u7528\u7684-cni-\u652f\u6301\u7f51\u7edc\u7b56\u7565\u624b\u52a8"},"5.3.1\u786e\u4fdd\u4f7f\u7528\u7684 CNI \u652f\u6301\u7f51\u7edc\u7b56\u7565\uff08\u624b\u52a8\uff09"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1awarn"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u5982\u679c\u4f7f\u7528\u7684 CNI \u63d2\u4ef6\u4e0d\u652f\u6301\u7f51\u7edc\u7b56\u7565\uff0c\u5219\u5e94\u8003\u8651\u4f7f\u7528\u4e0d\u540c\u7684\u63d2\u4ef6\uff0c\u6216\u5728 Kubernetes \u96c6\u7fa4\u4e2d\u5bfb\u627e\u66ff\u4ee3\u673a\u5236\u6765\u9650\u5236\u6d41\u91cf\u3002"),(0,a.kt)("h3",{id:"532\u786e\u4fdd\u6240\u6709\u547d\u540d\u7a7a\u95f4\u90fd\u5b9a\u4e49\u4e86\u7f51\u7edc\u7b56\u7565\u81ea\u52a8"},"5.3.2\u786e\u4fdd\u6240\u6709\u547d\u540d\u7a7a\u95f4\u90fd\u5b9a\u4e49\u4e86\u7f51\u7edc\u7b56\u7565\uff08\u81ea\u52a8\uff09"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1apass"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u9075\u5faa\u6587\u6863\u5e76\u6839\u636e\u9700\u8981\u521b\u5efa NetworkPolicy \u5bf9\u8c61\u3002"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1\u811a\u672c"),"\uff1a",(0,a.kt)("inlineCode",{parentName:"p"},"check_for_network_policies.sh")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"#!/bin/bash\n\nset -eE\n\nhandle_error() {\n    echo \"false\"\n}\n\ntrap 'handle_error' ERR\n\nfor namespace in $(kubectl get namespaces --all-namespaces -o json | jq -r '.items[].metadata.name'); do\n  policy_count=$(kubectl get networkpolicy -n ${namespace} -o json | jq '.items | length')\n  if [[ ${policy_count} -eq 0 ]]; then\n    echo \"false\"\n    exit\n  fi\ndone\n\necho \"true\"\n\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1\u6267\u884c"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"./check_for_network_policies.sh\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u9884\u671f\u7ed3\u679c"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"'true' is equal to 'true'\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u8fd4\u56de\u503c"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"true\n")),(0,a.kt)("h2",{id:"54\u5bc6\u6587\u7ba1\u7406"},"5.4\u5bc6\u6587\u7ba1\u7406"),(0,a.kt)("h3",{id:"541\u4f18\u5148\u4f7f\u7528\u5bc6\u6587\u6587\u4ef6\u800c\u4e0d\u662f\u5bc6\u6587\u73af\u5883\u53d8\u91cf\u624b\u52a8"},"5.4.1\u4f18\u5148\u4f7f\u7528\u5bc6\u6587\u6587\u4ef6\u800c\u4e0d\u662f\u5bc6\u6587\u73af\u5883\u53d8\u91cf\uff08\u624b\u52a8\uff09"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1awarn"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u5982\u679c\u53ef\u80fd\uff0c\u91cd\u5199\u5e94\u7528\u7a0b\u5e8f\u4ee3\u7801\uff0c\u4ece\u6302\u8f7d\u7684\u5bc6\u6587\u6587\u4ef6\u800c\u4e0d\u662f\u73af\u5883\u53d8\u91cf\u4e2d\u8bfb\u53d6\u5bc6\u6587\u3002"),(0,a.kt)("h3",{id:"542\u8003\u8651\u5916\u90e8\u5bc6\u6587\u5b58\u50a8\u624b\u52a8"},"5.4.2\u8003\u8651\u5916\u90e8\u5bc6\u6587\u5b58\u50a8\uff08\u624b\u52a8\uff09"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1awarn"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u8bf7\u53c2\u9605\u4f60\u7684\u4e91\u63d0\u4f9b\u5546\u6216\u7b2c\u4e09\u65b9\u5bc6\u6587\u7ba1\u7406\u89e3\u51b3\u65b9\u6848\u7684\u5bc6\u6587\u7ba1\u7406\u9009\u9879\u3002"),(0,a.kt)("h2",{id:"55\u53ef\u6269\u5c55\u51c6\u5165\u63a7\u5236"},"5.5\u53ef\u6269\u5c55\u51c6\u5165\u63a7\u5236"),(0,a.kt)("h3",{id:"551\u4f7f\u7528-imagepolicywebhook-\u51c6\u5165\u63a7\u5236\u5668\u914d\u7f6e\u955c\u50cf\u6765\u6e90\u624b\u52a8"},"5.5.1\u4f7f\u7528 ImagePolicyWebhook \u51c6\u5165\u63a7\u5236\u5668\u914d\u7f6e\u955c\u50cf\u6765\u6e90\uff08\u624b\u52a8\uff09"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1awarn"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u9075\u5faa Kubernetes \u6587\u6863\u5e76\u8bbe\u7f6e\u955c\u50cf\u6765\u6e90\u3002"),(0,a.kt)("h2",{id:"57\u901a\u7528\u7b56\u7565"},"5.7\u901a\u7528\u7b56\u7565"),(0,a.kt)("h3",{id:"571\u4f7f\u7528\u547d\u540d\u7a7a\u95f4\u5728\u8d44\u6e90\u4e4b\u95f4\u521b\u5efa\u7ba1\u7406\u8fb9\u754c\u624b\u52a8"},"5.7.1\u4f7f\u7528\u547d\u540d\u7a7a\u95f4\u5728\u8d44\u6e90\u4e4b\u95f4\u521b\u5efa\u7ba1\u7406\u8fb9\u754c\uff08\u624b\u52a8\uff09"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1awarn"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u9075\u5faa\u6587\u6863\u5e76\u6839\u636e\u9700\u8981\u4e3a Deployment \u4e2d\u7684\u5bf9\u8c61\u521b\u5efa\u547d\u540d\u7a7a\u95f4\u3002"),(0,a.kt)("h3",{id:"572\u786e\u4fdd-seccomp-\u914d\u7f6e\u6587\u4ef6\u5728\u4f60\u7684-pod-\u5b9a\u4e49\u4e2d\u8bbe\u7f6e\u4e3a-dockerdefault\u624b\u52a8"},"5.7.2\u786e\u4fdd seccomp \u914d\u7f6e\u6587\u4ef6\u5728\u4f60\u7684 pod \u5b9a\u4e49\u4e2d\u8bbe\u7f6e\u4e3a docker/default\uff08\u624b\u52a8\uff09"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1awarn"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\nSeccomp \u76ee\u524d\u662f\u4e00\u4e2a alpha \u529f\u80fd\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u6240\u6709 alpha \u529f\u80fd\u90fd\u662f\u7981\u7528\u7684\u3002\u56e0\u6b64\uff0c\u4f60\u9700\u8981\u901a\u8fc7\u4f20\u5165 ",(0,a.kt)("inlineCode",{parentName:"p"},"--feature-\ngates=AllAlpha=true")," \u53c2\u6570\u6765\u542f\u7528 apiserver \u4e2d\u7684 alpha \u529f\u80fd\u3002\n\u7f16\u8f91 Master \u8282\u70b9\u4e0a\u7684 /etc/kubernetes/apiserver \u6587\u4ef6\uff0c\u5e76\u5c06 ",(0,a.kt)("inlineCode",{parentName:"p"},"KUBE_API_ARGS")," \u53c2\u6570\u8bbe\u7f6e\u4e3a ",(0,a.kt)("inlineCode",{parentName:"p"},"--feature-gates=AllAlpha=true"),'\nKUBE_API_ARGS="--feature-gates=AllAlpha=true"\n\u6839\u636e\u4f60\u7684\u7cfb\u7edf\uff0c\u91cd\u65b0\u542f\u52a8 kube-apiserver \u670d\u52a1\u3002\u4f8b\u5982\uff1asystemctl restart kube-apiserver.service\n\u4f7f\u7528\u6ce8\u91ca\u5728\u4f60\u7684 pod \u5b9a\u4e49\u4e2d\u542f\u7528 docker/default seccomp \u914d\u7f6e\u6587\u4ef6\u3002\u4ee5\u4e0b\u662f\u4e00\u4e2a\u793a\u4f8b\uff1a\napiVersion: v1\nkind: Pod\nmetadata:\nname: trustworthy-pod\nannotations:\nseccomp.security.alpha.kubernetes.io/pod: docker/default\nspec:\ncontainers:'),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"name: trustworthy-container\nimage: sotrustworthy:latest")),(0,a.kt)("h3",{id:"573\u5c06\u5b89\u5168\u4e0a\u4e0b\u6587\u5e94\u7528\u5230\u4f60\u7684-pod-\u548c\u5bb9\u5668\u624b\u52a8"},"5.7.3\u5c06\u5b89\u5168\u4e0a\u4e0b\u6587\u5e94\u7528\u5230\u4f60\u7684 Pod \u548c\u5bb9\u5668\uff08\u624b\u52a8\uff09"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1awarn"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u9075\u5faa Kubernetes \u6587\u6863\uff0c\u5c06\u5b89\u5168\u4e0a\u4e0b\u6587\u5e94\u7528\u5230\u4f60\u7684 pod\u3002\u5173\u4e8e\u5b89\u5168\u4e0a\u4e0b\u6587\u7684\u5efa\u8bae\u6e05\u5355\uff0c\u4f60\u53ef\u4ee5\u53c2\u8003 CIS \u7684 Docker \u5bb9\u5668\u5b89\u5168 Benchmark\u3002"),(0,a.kt)("h3",{id:"574\u786e\u4fdd\u4e0d\u4f7f\u7528-default-\u547d\u540d\u7a7a\u95f4\u81ea\u52a8"},"5.7.4\u786e\u4fdd\u4e0d\u4f7f\u7528 Default \u547d\u540d\u7a7a\u95f4\uff08\u81ea\u52a8\uff09"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1apass"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u786e\u4fdd\u521b\u5efa\u547d\u540d\u7a7a\u95f4\u4ee5\u5141\u8bb8\u5bf9 Kubernetes \u8fdb\u884c\u9002\u5f53\u7684\u9694\u79bb\u8d44\u6e90\uff0c\u5e76\u4e14\u6240\u6709\u65b0\u8d44\u6e90\u90fd\u521b\u5efa\u5728\u7279\u5b9a\u7684\u547d\u540d\u7a7a\u95f4\u4e2d\u3002"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1\u811a\u672c"),"\uff1a",(0,a.kt)("inlineCode",{parentName:"p"},"check_for_default_ns.sh")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},'#!/bin/bash\n\nset -eE\n\nhandle_error() {\n    echo "false"\n}\n\ntrap \'handle_error\' ERR\n\ncount=$(kubectl get all -n default -o json | jq .items[] | jq -r \'select((.metadata.name!="kubernetes"))\' | jq .metadata.name | wc -l)\nif [[ ${count} -gt 0 ]]; then\n    echo "false"\n    exit\nfi\n\necho "true"\n\n\n')),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1\u6267\u884c"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"./check_for_default_ns.sh\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u9884\u671f\u7ed3\u679c"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"'true' is equal to 'true'\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u8fd4\u56de\u503c"),"\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"true\n")))}p.isMDXComponent=!0}}]);