"use strict";(self.webpackChunkrancher_docs=self.webpackChunkrancher_docs||[]).push([[55353],{3905:(e,t,n)=>{n.d(t,{Zo:()=>d,kt:()=>s});var a=n(67294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function p(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},l=Object.keys(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var o=a.createContext({}),c=function(e){var t=a.useContext(o),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},d=function(e){var t=c(e.components);return a.createElement(o.Provider,{value:t},e.children)},k={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},m=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,l=e.originalType,o=e.parentName,d=p(e,["components","mdxType","originalType","parentName"]),m=c(n),s=r,u=m["".concat(o,".").concat(s)]||m[s]||k[s]||l;return n?a.createElement(u,i(i({ref:t},d),{},{components:n})):a.createElement(u,i({ref:t},d))}));function s(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var l=n.length,i=new Array(l);i[0]=m;var p={};for(var o in t)hasOwnProperty.call(t,o)&&(p[o]=t[o]);p.originalType=e,p.mdxType="string"==typeof e?e:r,i[1]=p;for(var c=2;c<l;c++)i[c]=n[c];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}m.displayName="MDXCreateElement"},70210:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>o,contentTitle:()=>i,default:()=>k,frontMatter:()=>l,metadata:()=>p,toc:()=>c});var a=n(87462),r=(n(67294),n(3905));const l={title:"\u5907\u4efd\u914d\u7f6e"},i=void 0,p={unversionedId:"reference-guides/backup-restore-configuration/backup-configuration",id:"version-2.6/reference-guides/backup-restore-configuration/backup-configuration",title:"\u5907\u4efd\u914d\u7f6e",description:"\u4f60\u53ef\u4ee5\u5728\u5907\u4efd\u521b\u5efa\u9875\u9762\u914d\u7f6e\u8c03\u5ea6\uff0c\u542f\u7528\u52a0\u5bc6\uff0c\u5e76\u6307\u5b9a\u5907\u4efd\u7684\u5b58\u50a8\u4f4d\u7f6e\u3002",source:"@site/i18n/zh/docusaurus-plugin-content-docs/version-2.6/reference-guides/backup-restore-configuration/backup-configuration.md",sourceDirName:"reference-guides/backup-restore-configuration",slug:"/reference-guides/backup-restore-configuration/backup-configuration",permalink:"/zh/v2.6/reference-guides/backup-restore-configuration/backup-configuration",draft:!1,editUrl:"https://github.com/rancher/rancher-docs/edit/main/versioned_docs/version-2.6/reference-guides/backup-restore-configuration/backup-configuration.md",tags:[],version:"2.6",lastUpdatedAt:1677468884,formattedLastUpdatedAt:"2023\u5e742\u670827\u65e5",frontMatter:{title:"\u5907\u4efd\u914d\u7f6e"},sidebar:"tutorialSidebar",previous:{title:"Rancher \u5907\u4efd\u914d\u7f6e\u53c2\u8003",permalink:"/zh/v2.6/pages-for-subheaders/backup-restore-configuration"},next:{title:"\u8fd8\u539f\u914d\u7f6e",permalink:"/zh/v2.6/reference-guides/backup-restore-configuration/restore-configuration"}},o={},c=[{value:"\u8c03\u5ea6",id:"\u8c03\u5ea6",level:2},{value:"\u52a0\u5bc6",id:"\u52a0\u5bc6",level:2},{value:"\u5b58\u50a8\u4f4d\u7f6e",id:"\u5b58\u50a8\u4f4d\u7f6e",level:2},{value:"S3",id:"s3",level:3},{value:"S3 \u5b58\u50a8\u914d\u7f6e\u793a\u4f8b",id:"s3-\u5b58\u50a8\u914d\u7f6e\u793a\u4f8b",level:3},{value:"MinIO \u914d\u7f6e\u793a\u4f8b",id:"minio-\u914d\u7f6e\u793a\u4f8b",level:3},{value:"credentialSecret \u793a\u4f8b",id:"credentialsecret-\u793a\u4f8b",level:3},{value:"EC2 \u8282\u70b9\u8bbf\u95ee S3 \u7684 IAM \u6743\u9650",id:"ec2-\u8282\u70b9\u8bbf\u95ee-s3-\u7684-iam-\u6743\u9650",level:3},{value:"\u793a\u4f8b",id:"\u793a\u4f8b",level:2}],d={toc:c};function k(e){let{components:t,...l}=e;return(0,r.kt)("wrapper",(0,a.Z)({},d,l,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"\u4f60\u53ef\u4ee5\u5728\u5907\u4efd\u521b\u5efa\u9875\u9762\u914d\u7f6e\u8c03\u5ea6\uff0c\u542f\u7528\u52a0\u5bc6\uff0c\u5e76\u6307\u5b9a\u5907\u4efd\u7684\u5b58\u50a8\u4f4d\u7f6e\u3002"),(0,r.kt)("h2",{id:"\u8c03\u5ea6"},"\u8c03\u5ea6"),(0,r.kt)("p",null,"\u9009\u62e9\u7b2c\u4e00\u4e2a\u9009\u9879\u6765\u6267\u884c\u4e00\u6b21\u6027\u5907\u4efd\uff0c\u6216\u9009\u62e9\u7b2c\u4e8c\u4e2a\u9009\u9879\u6765\u5b89\u6392\u5b9a\u671f\u5907\u4efd\u3002\u9009\u62e9",(0,r.kt)("strong",{parentName:"p"},"\u5b9a\u671f\u5907\u4efd"),"\u540e\uff0c\u4f60\u53ef\u4ee5\u914d\u7f6e\u4ee5\u4e0b\u4e24\u4e2a\u5b57\u6bb5\uff1a"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"\u8c03\u5ea6"),"\uff1a\u8be5\u5b57\u6bb5\u652f\u6301",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"\u6807\u51c6 ",(0,r.kt)("a",{parentName:"li",href:"https://en.wikipedia.org/wiki/Cron"},"cron \u8868\u8fbe\u5f0f"),"\uff0c\u4f8b\u5982 ",(0,r.kt)("inlineCode",{parentName:"li"},'"0 * * * *"')),(0,r.kt)("li",{parentName:"ul"},"\u63cf\u8ff0\u7b26\uff0c\u4f8b\u5982 ",(0,r.kt)("inlineCode",{parentName:"li"},'"@midnight"')," \u6216 ",(0,r.kt)("inlineCode",{parentName:"li"},'"@every 1h30m"')))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"\u4fdd\u7559\u6570\u91cf"),"\uff1a\u6307\u5b9a\u5fc5\u987b\u4fdd\u7559\u7684\u5907\u4efd\u6587\u4ef6\u6570\u91cf\u3002\u5982\u679c\u6587\u4ef6\u6570\u91cf\u8d85\u8fc7 ",(0,r.kt)("inlineCode",{parentName:"li"},"retentionCount")," \u8bbe\u7f6e\u7684\u503c\uff0c\u6700\u65e7\u7684\u6587\u4ef6\u5c06\u88ab\u5220\u9664\u3002\u9ed8\u8ba4\u503c\u4e3a 10\u3002")),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"YAML \u6307\u4ee4\u540d\u79f0"),(0,r.kt)("th",{parentName:"tr",align:null},"\u63cf\u8ff0"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"schedule")),(0,r.kt)("td",{parentName:"tr",align:null},"\u63d0\u4f9b\u7528\u4e8e\u8c03\u5ea6\u5b9a\u671f\u5907\u4efd\u7684 cron \u5b57\u7b26\u4e32\u3002")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"retentionCount")),(0,r.kt)("td",{parentName:"tr",align:null},"\u63d0\u4f9b\u8981\u4fdd\u7559\u7684\u5907\u4efd\u6587\u4ef6\u6570\u91cf\u3002")))),(0,r.kt)("h2",{id:"\u52a0\u5bc6"},"\u52a0\u5bc6"),(0,r.kt)("p",null,"rancher-backup \u901a\u8fc7\u8c03\u7528 kube-apiserver \u6765\u6536\u96c6\u8d44\u6e90\u3002apiserver \u8fd4\u56de\u7684\u5bf9\u8c61\u4f1a\u88ab\u89e3\u5bc6\uff0c\u6240\u4ee5\u5373\u4f7f\u542f\u7528\u4e86",(0,r.kt)("a",{parentName:"p",href:"https://kubernetes.io/docs/tasks/administer-cluster/encrypt-data/"},"\u9759\u6001\u52a0\u5bc6"),"\uff0c\u5907\u4efd\u6536\u96c6\u7684\u52a0\u5bc6\u5bf9\u8c61\u4e5f\u4f1a\u662f\u660e\u6587\u3002"),(0,r.kt)("p",null,"\u4e3a\u907f\u514d\u4ee5\u660e\u6587\u5f62\u5f0f\u5b58\u50a8\u8d44\u6e90\uff0c\u4f60\u53ef\u4ee5\u4f7f\u7528\u4e0e\u9759\u6001\u52a0\u5bc6\u76f8\u540c\u7684 ",(0,r.kt)("inlineCode",{parentName:"p"},"EncryptionConfiguration")," \u6587\u4ef6\u6765\u52a0\u5bc6\u5907\u4efd\u4e2d\u7684\u7279\u5b9a\u8d44\u6e90\u3002"),(0,r.kt)("admonition",{title:"\u91cd\u8981\u63d0\u793a\uff1a",type:"note"},(0,r.kt)("p",{parentName:"admonition"},"rancher-backup Operator \u4e0d\u4f1a\u4fdd\u5b58 ",(0,r.kt)("inlineCode",{parentName:"p"},"EncryptionConfiguration"),"\uff0c\u56e0\u6b64\u5728\u5907\u4efd\u4e2d\u52a0\u5bc6\u5bf9\u8c61\u65f6\uff0c\u4f60\u5fc5\u987b\u81ea\u884c\u4fdd\u5b58\u8be5\u6587\u4ef6\u3002"),(0,r.kt)("p",{parentName:"admonition"},"\u4f8b\u5982\uff0c",(0,r.kt)("a",{parentName:"p",href:"/zh/v2.6/how-to-guides/new-user-guides/backup-restore-and-disaster-recovery/migrate-rancher-to-new-cluster"},"\u5c06 Rancher \u8fc1\u79fb\u5230\u65b0\u96c6\u7fa4"),"\u65f6\uff0c\u8be5\u6587\u4ef6\u53ef\u7528\u4e8e\u5728\u65b0\u96c6\u7fa4\u200b\u200b\u4e2d\u91cd\u65b0\u521b\u5efa secret\u3002")),(0,r.kt)("p",null,"Operator \u5c06 ",(0,r.kt)("inlineCode",{parentName:"p"},"EncryptionConfiguration")," \u7528\u4f5c ",(0,r.kt)("inlineCode",{parentName:"p"},"cattle-resources-system")," \u547d\u540d\u7a7a\u95f4\u4e2d\u7684 Kubernetes Secret\uff0c\u5728 Secret \u6570\u636e\u4e2d\uff0c\u5b83\u4f4d\u4e8e\u540d\u4e3a ",(0,r.kt)("inlineCode",{parentName:"p"},"encryption-provider-config.yaml")," \u7684 key \u4e0b\u9762\u3002"),(0,r.kt)("p",null,"\u5bf9\u4e8e ",(0,r.kt)("inlineCode",{parentName:"p"},"EncryptionConfiguration"),"\uff0c\u4f60\u53ef\u4ee5\u4f7f\u7528 ",(0,r.kt)("a",{parentName:"p",href:"https://kubernetes.io/docs/tasks/administer-cluster/encrypt-data/#understanding-the-encryption-at-rest-configuration"},"Kubernetes \u6587\u6863\u4e2d\u63d0\u4f9b\u7684\u793a\u4f8b"),"\u3002"),(0,r.kt)("p",null,"\u4e3a\u786e\u4fdd\u5728 secret \u4e2d\u4f7f\u7528\u6b63\u786e\u7684\u5bc6\u94a5\uff0c\u52a0\u5bc6\u914d\u7f6e\u6587\u4ef6\u5fc5\u987b\u547d\u540d\u4e3a ",(0,r.kt)("inlineCode",{parentName:"p"},"encryption-provider-config.yaml"),"\u3002\u4e0b\u9762\u7684\u547d\u4ee4\u4f7f\u7528 ",(0,r.kt)("inlineCode",{parentName:"p"},"--from-file")," \u6807\u5fd7\u6765\u521b\u5efa\u5177\u6709\u6b63\u786e\u5bc6\u94a5\u540d\u79f0\u7684 Secret\u3002"),(0,r.kt)("p",null,"\u5c06 ",(0,r.kt)("inlineCode",{parentName:"p"},"EncryptionConfiguration")," \u4fdd\u5b58\u5230\u540d\u4e3a ",(0,r.kt)("inlineCode",{parentName:"p"},"encryption-provider-config.yaml")," \u7684\u6587\u4ef6\u4e2d\uff0c\u5e76\u8fd0\u884c\u4ee5\u4e0b\u547d\u4ee4\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"kubectl create secret generic encryptionconfig \\\n  --from-file=./encryption-provider-config.yaml \\\n  -n cattle-resources-system\n")),(0,r.kt)("p",null,"\u8fd9\u5c06\u786e\u4fdd\u5bc6\u6587\u5305\u542b\u4e00\u4e2a\u540d\u4e3a ",(0,r.kt)("inlineCode",{parentName:"p"},"encryption-provider-config.yaml")," \u7684 key\uff0c\u800c\u4e14 operator \u4f1a\u4f7f\u7528\u8be5 key \u6765\u83b7\u53d6\u52a0\u5bc6\u914d\u7f6e\u3002"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"Encryption Config Secret")," \u4e0b\u62c9\u83dc\u5355\u5c06\u8fc7\u6ee4\u5e76\u4ec5\u5217\u51fa\u62e5\u6709\u8fd9\u4e2a key \u7684\u5bc6\u6587\u3002"),(0,r.kt)("p",null,(0,r.kt)("img",{src:n(61687).Z,width:"1203",height:"376"})),(0,r.kt)("p",null,"\u5728\u4e0a\u9762\u7684\u793a\u4f8b\u547d\u4ee4\u4e2d\uff0c",(0,r.kt)("inlineCode",{parentName:"p"},"encryptionconfig")," \u8fd9\u4e2a\u540d\u79f0\u53ef\u4ee5\u4efb\u610f\u4fee\u6539\u3002"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"YAML \u6307\u4ee4\u540d\u79f0"),(0,r.kt)("th",{parentName:"tr",align:null},"\u63cf\u8ff0"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"encryptionConfigSecretName")),(0,r.kt)("td",{parentName:"tr",align:null},"\u63d0\u4f9b ",(0,r.kt)("inlineCode",{parentName:"td"},"cattle-resources-system")," \u547d\u540d\u7a7a\u95f4\u4e2d\u5305\u542b\u52a0\u5bc6\u914d\u7f6e\u6587\u4ef6\u7684\u5bc6\u6587\u7684\u540d\u79f0\u3002")))),(0,r.kt)("h2",{id:"\u5b58\u50a8\u4f4d\u7f6e"},"\u5b58\u50a8\u4f4d\u7f6e"),(0,r.kt)("p",null,"\u5982\u679c\u5728\u5907\u4efd\u4e2d\u6307\u5b9a\u4e86 ",(0,r.kt)("inlineCode",{parentName:"p"},"StorageLocation"),"\uff0coperator \u5c06\u4ece\u8be5\u7279\u5b9a\u7684 S3 \u5b58\u50a8\u6876\u4e2d\u68c0\u7d22\u5907\u4efd\u4f4d\u7f6e\u3002\u5982\u679c\u6ca1\u6709\u6307\u5b9a\uff0coperator \u5c06\u5c1d\u8bd5\u5728\u9ed8\u8ba4 operator \u7ea7\u522b\u7684 S3 \u5b58\u50a8\u548c operator \u7ea7\u522b\u7684 PVC \u5b58\u50a8\u4e2d\u67e5\u627e\u8fd9\u4e2a\u6587\u4ef6\u3002\u9ed8\u8ba4\u5b58\u50a8\u4f4d\u7f6e\u662f\u5728\u90e8\u7f72 ",(0,r.kt)("inlineCode",{parentName:"p"},"rancher-backup")," operator \u65f6\u914d\u7f6e\u7684\u3002"),(0,r.kt)("p",null,"\u5982\u679c\u4f60\u9009\u62e9\u7b2c\u4e00\u4e2a\u9009\u9879\uff0c\u5907\u4efd\u5c06\u5b58\u50a8\u5728\u5b89\u88c5 rancher-backup Chart \u65f6\u914d\u7f6e\u7684\u5b58\u50a8\u4f4d\u7f6e\u4e2d\u3002\u5982\u679c\u4f60\u9009\u62e9\u7b2c\u4e8c\u4e2a\u9009\u9879\uff0c\u4f60\u53ef\u4ee5\u914d\u7f6e\u4e0d\u540c\u7684\u517c\u5bb9 S3 \u7684\u5bf9\u8c61\u5b58\u50a8\u4f5c\u4e3a\u5907\u4efd\u5b58\u50a8\u4f4d\u7f6e\u3002"),(0,r.kt)("h3",{id:"s3"},"S3"),(0,r.kt)("p",null,"S3 \u5b58\u50a8\u4f4d\u7f6e\u5305\u542b\u4ee5\u4e0b\u914d\u7f6e\u5b57\u6bb5\uff1a"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("strong",{parentName:"li"},"\u51ed\u8bc1\u5bc6\u6587"),"\uff08\u53ef\u9009\uff09\uff1a\u5982\u679c\u4f60\u9700\u8981\u4f7f\u7528 AWS \u8bbf\u95ee\u5bc6\u94a5\uff08access key\uff09\u548c\u5bc6\u6587\u5bc6\u94a5\uff08secret key\uff09\u6765\u8bbf\u95ee S3 \u5b58\u50a8\u6876\uff0c\u8bf7\u4f7f\u7528\u5e26\u6709\u5bc6\u94a5\u548c\u6307\u4ee4 ",(0,r.kt)("inlineCode",{parentName:"li"},"accessKey")," \u548c ",(0,r.kt)("inlineCode",{parentName:"li"},"secretKey")," \u7684\u51ed\u8bc1\u6765\u521b\u5efa\u5bc6\u6587\u3002\u5b83\u53ef\u4ee5\u662f\u4efb\u610f\u4e00\u4e2a\u547d\u540d\u7a7a\u95f4\u3002\u4f60\u53ef\u4ee5\u70b9\u51fb",(0,r.kt)("a",{parentName:"li",href:"#credentialsecret-%E7%A4%BA%E4%BE%8B"},"\u6b64\u5904"),"\u67e5\u770b\u793a\u4f8b\u5bc6\u6587\u3002\u5982\u679c\u8fd0\u884c operator \u7684\u8282\u70b9\u5728 EC2 \u4e2d\uff0c\u5e76\u4e14\u8bbe\u7f6e\u4e86\u5141\u8bb8\u5b83\u4eec\u8bbf\u95ee S3 \u7684 IAM \u6743\u9650\uff0c\u5219\u6b64\u6307\u4ee4\u662f\u4e0d\u5fc5\u8981\u7684\uff08\u5982",(0,r.kt)("a",{parentName:"li",href:"#ec2-%E8%8A%82%E7%82%B9%E8%AE%BF%E9%97%AE-s3-%E7%9A%84-iam-%E6%9D%83%E9%99%90"},"\u672c\u8282"),"\u6240\u8ff0\uff09\u3002\u51ed\u8bc1\u5bc6\u6587\u4e0b\u62c9\u83dc\u5355\u5217\u51fa\u4e86\u6240\u6709\u547d\u540d\u7a7a\u95f4\u7684\u5bc6\u6587\u3002"),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("strong",{parentName:"li"},"\u5b58\u50a8\u6876\u540d\u79f0"),"\uff1a\u5b58\u50a8\u5907\u4efd\u6587\u4ef6\u7684 S3 \u5b58\u50a8\u6876\u7684\u540d\u79f0\u3002"),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("strong",{parentName:"li"},"\u533a\u57df"),"\uff08\u53ef\u9009\uff09\uff1aS3 \u5b58\u50a8\u6876\u6240\u5728\u7684 AWS ",(0,r.kt)("a",{parentName:"li",href:"https://aws.amazon.com/about-aws/global-infrastructure/regions_az/"},"\u533a\u57df"),"\u3002\u914d\u7f6e MinIO \u65f6\u4e0d\u9700\u8981\u8be5\u5b57\u6bb5\u3002"),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("strong",{parentName:"li"},"\u6587\u4ef6\u5939"),"\uff08\u53ef\u9009\uff09\uff1aS3 \u5b58\u50a8\u6876\u4e2d\u5b58\u50a8\u5907\u4efd\u6587\u4ef6\u7684\u6587\u4ef6\u5939\u540d\u79f0\u3002\u4e0d\u652f\u6301\u5d4c\u5957\u6587\u4ef6\u5939\uff08\u4f8b\u5982\uff0c ",(0,r.kt)("inlineCode",{parentName:"li"},"rancher/cluster1"),"\uff09\u3002\u5982\u679c\u6b64\u5b57\u6bb5\u7559\u7a7a\uff0c\u5219\u9ed8\u8ba4\u5c06\u5907\u4efd\u6587\u4ef6\u5b58\u50a8\u5728 S3 \u5b58\u50a8\u6876\u7684\u6839\u6587\u4ef6\u5939\u4e2d\u3002"),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("strong",{parentName:"li"},"\u7aef\u70b9"),"\uff1a\u7528\u4e8e\u8bbf\u95ee\u5b58\u50a8\u6876\u533a\u57df\u4e2d\u7684 S3 \u7684",(0,r.kt)("a",{parentName:"li",href:"https://docs.aws.amazon.com/general/latest/gr/s3.html"},"\u7aef\u70b9"),"\u3002"),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("strong",{parentName:"li"},"\u7aef\u70b9 CA"),"\uff08\u53ef\u9009\uff09\uff1aBase64 \u7f16\u7801\u7684 CA \u8bc1\u4e66\u3002\u5982\u9700\u83b7\u53d6\u793a\u4f8b\uff0c\u8bf7\u53c2\u89c1 ",(0,r.kt)("a",{parentName:"li",href:"#s3-%E5%AD%98%E5%82%A8%E9%85%8D%E7%BD%AE%E7%A4%BA%E4%BE%8B"},"S3 \u517c\u5bb9\u914d\u7f6e\u793a\u4f8b"),"\u3002"),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("strong",{parentName:"li"},"\u8df3\u8fc7 TLS \u9a8c\u8bc1"),"\uff08\u53ef\u9009\uff09\uff1a\u5982\u679c\u4f60\u4e0d\u4f7f\u7528 TLS\uff0c\u5219\u8bbe\u7f6e\u4e3a ",(0,r.kt)("inlineCode",{parentName:"li"},"true"),"\u3002")),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"YAML \u6307\u4ee4\u540d\u79f0"),(0,r.kt)("th",{parentName:"tr",align:null},"\u63cf\u8ff0"),(0,r.kt)("th",{parentName:"tr",align:null},"\u5fc5\u586b"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"credentialSecretName")),(0,r.kt)("td",{parentName:"tr",align:null},"\u5982\u679c\u4f60\u9700\u8981\u4f7f\u7528 AWS \u8bbf\u95ee\u5bc6\u94a5\uff08access key\uff09\u548c\u5bc6\u6587\u5bc6\u94a5\uff08secret key\uff09\u6765\u8bbf\u95ee S3 \u5b58\u50a8\u6876\uff0c\u8bf7\u4f7f\u7528\u5e26\u6709\u5bc6\u94a5\u548c\u6307\u4ee4 ",(0,r.kt)("inlineCode",{parentName:"td"},"accessKey")," \u548c ",(0,r.kt)("inlineCode",{parentName:"td"},"secretKey")," \u7684\u51ed\u8bc1\u6765\u521b\u5efa\u5bc6\u6587\u3002\u5b83\u53ef\u4ee5\u5728\u4efb\u4f55\u547d\u540d\u7a7a\u95f4\u4e2d\uff0c\u53ea\u8981\u4f60\u5728 ",(0,r.kt)("inlineCode",{parentName:"td"},"credentialSecretNamespace")," \u4e2d\u63d0\u4f9b\u8be5\u547d\u540d\u7a7a\u95f4\u3002\u70b9\u51fb",(0,r.kt)("a",{parentName:"td",href:"#credentialsecret-%E7%A4%BA%E4%BE%8B"},"\u8fd9\u91cc"),"\u67e5\u770b\u793a\u4f8b\u5bc6\u6587\u3002\u5982\u679c\u8fd0\u884c operator \u7684\u8282\u70b9\u5728 EC2 \u4e2d\uff0c\u5e76\u4e14\u8bbe\u7f6e\u4e86\u5141\u8bb8\u5b83\u4eec\u8bbf\u95ee S3 \u7684 IAM \u6743\u9650\uff0c\u5219\u6b64\u6307\u4ee4\u662f\u4e0d\u5fc5\u8981\u7684\uff08\u5982",(0,r.kt)("a",{parentName:"td",href:"#ec2-%E8%8A%82%E7%82%B9%E8%AE%BF%E9%97%AE-s3-%E7%9A%84-iam-%E6%9D%83%E9%99%90"},"\u672c\u8282"),"\u6240\u8ff0\uff09\u3002"),(0,r.kt)("td",{parentName:"tr",align:null})),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"credentialSecretNamespace")),(0,r.kt)("td",{parentName:"tr",align:null},"\u5305\u542b\u8bbf\u95ee S3 \u7684\u51ed\u8bc1\u7684\u5bc6\u6587\u7684\u547d\u540d\u7a7a\u95f4\u3002\u5982\u679c\u8fd0\u884c operator \u7684\u8282\u70b9\u5728 EC2 \u4e2d\uff0c\u5e76\u4e14\u8bbe\u7f6e\u4e86\u5141\u8bb8\u5b83\u4eec\u8bbf\u95ee S3 \u7684 IAM \u6743\u9650\uff0c\u5219\u6b64\u6307\u4ee4\u662f\u4e0d\u5fc5\u8981\u7684\uff08\u5982",(0,r.kt)("a",{parentName:"td",href:"#ec2-%E8%8A%82%E7%82%B9%E8%AE%BF%E9%97%AE-s3-%E7%9A%84-iam-%E6%9D%83%E9%99%90"},"\u672c\u8282"),"\u6240\u8ff0\uff09\u3002"),(0,r.kt)("td",{parentName:"tr",align:null})),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"bucketName")),(0,r.kt)("td",{parentName:"tr",align:null},"\u5b58\u50a8\u5907\u4efd\u6587\u4ef6\u7684 S3 \u5b58\u50a8\u6876\u7684\u540d\u79f0\u3002"),(0,r.kt)("td",{parentName:"tr",align:null},"\u2713")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"folder")),(0,r.kt)("td",{parentName:"tr",align:null},"S3 \u5b58\u50a8\u6876\u4e2d\u5b58\u50a8\u5907\u4efd\u6587\u4ef6\u7684\u6587\u4ef6\u5939\u540d\u79f0\u3002\u4e0d\u652f\u6301\u5d4c\u5957\u6587\u4ef6\u5939\uff08\u4f8b\u5982\uff0c ",(0,r.kt)("inlineCode",{parentName:"td"},"rancher/cluster1"),"\uff09\u3002\u5982\u679c\u6b64\u5b57\u6bb5\u7559\u7a7a\uff0c\u5219\u9ed8\u8ba4\u5c06\u5907\u4efd\u6587\u4ef6\u5b58\u50a8\u5728 S3 \u5b58\u50a8\u6876\u7684\u6839\u6587\u4ef6\u5939\u4e2d\u3002"),(0,r.kt)("td",{parentName:"tr",align:null})),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"region")),(0,r.kt)("td",{parentName:"tr",align:null},"S3 \u5b58\u50a8\u6876\u6240\u5728\u7684 AWS ",(0,r.kt)("a",{parentName:"td",href:"https://aws.amazon.com/about-aws/global-infrastructure/regions_az/"},"\u533a\u57df"),"\u3002"),(0,r.kt)("td",{parentName:"tr",align:null},"\u2713")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"endpoint")),(0,r.kt)("td",{parentName:"tr",align:null},"\u7528\u4e8e\u8bbf\u95ee\u5b58\u50a8\u6876\u533a\u57df\u4e2d\u7684 S3 \u7684",(0,r.kt)("a",{parentName:"td",href:"https://docs.aws.amazon.com/general/latest/gr/s3.html"},"\u7aef\u70b9"),"\u3002"),(0,r.kt)("td",{parentName:"tr",align:null},"\u2713")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"endpointCA")),(0,r.kt)("td",{parentName:"tr",align:null},"Base64 \u7f16\u7801\u7684 CA \u8bc1\u4e66\u3002\u5982\u9700\u83b7\u53d6\u793a\u4f8b\uff0c\u8bf7\u53c2\u89c1 ",(0,r.kt)("a",{parentName:"td",href:"#s3-%E5%AD%98%E5%82%A8%E9%85%8D%E7%BD%AE%E7%A4%BA%E4%BE%8B"},"S3 \u517c\u5bb9\u914d\u7f6e\u793a\u4f8b"),"\u3002"),(0,r.kt)("td",{parentName:"tr",align:null})),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"insecureTLSSkipVerify")),(0,r.kt)("td",{parentName:"tr",align:null},"\u5982\u679c\u4f60\u4e0d\u4f7f\u7528 TLS\uff0c\u5219\u8bbe\u7f6e\u4e3a ",(0,r.kt)("inlineCode",{parentName:"td"},"true"),"\u3002"),(0,r.kt)("td",{parentName:"tr",align:null})))),(0,r.kt)("h3",{id:"s3-\u5b58\u50a8\u914d\u7f6e\u793a\u4f8b"},"S3 \u5b58\u50a8\u914d\u7f6e\u793a\u4f8b"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"s3:\n  credentialSecretName: s3-creds\n  credentialSecretNamespace: default\n  bucketName: rancher-backups\n  folder: rancher\n  region: us-west-2\n  endpoint: s3.us-west-2.amazonaws.com\n")),(0,r.kt)("h3",{id:"minio-\u914d\u7f6e\u793a\u4f8b"},"MinIO \u914d\u7f6e\u793a\u4f8b"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"s3:\n  credentialSecretName: minio-creds\n  bucketName: rancherbackups\n  endpoint: minio.35.202.130.254.xip.io\n  endpointCA: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURHakNDQWdLZ0F3SUJBZ0lKQUtpWFZpNEpBb0J5TUEwR0NTcUdTSWIzRFFFQkN3VUFNQkl4RURBT0JnTlYKQkFNTUIzUmxjM1F0WTJFd0hoY05NakF3T0RNd01UZ3lOVFE1V2hjTk1qQXhNREk1TVRneU5UUTVXakFTTVJBdwpEZ1lEVlFRRERBZDBaWE4wTFdOaE1JSUJJakFOQmdrcWhraUc5dzBCQVFFRkFBT0NBUThBTUlJQkNnS0NBUUVBCjA4dnV3Q2Y0SEhtR2Q2azVNTmozRW5NOG00T2RpS3czSGszd1NlOUlXQkwyVzY5WDZxenBhN2I2M3U2L05mMnkKSnZWNDVqeXplRFB6bFJycjlpbEpWaVZ1NFNqWlFjdG9jWmFCaVNsL0xDbEFDdkFaUlYvKzN0TFVTZSs1ZDY0QQpWcUhDQlZObU5xM3E3aVY0TE1aSVpRc3N6K0FxaU1Sd0pOMVVKQTZ6V0tUc2Yzc3ByQ0J2dWxJWmZsVXVETVAyCnRCTCt6cXZEc0pDdWlhNEEvU2JNT29tVmM2WnNtTGkwMjdub3dGRld3MnRpSkM5d0xMRE14NnJoVHQ4a3VvVHYKQXJpUjB4WktiRU45L1Uzb011eUVKbHZyck9YS2ZuUDUwbk8ycGNaQnZCb3pUTStYZnRvQ1d5UnhKUmI5cFNTRApKQjlmUEFtLzNZcFpMMGRKY2sxR1h3SURBUUFCbzNNd2NUQWRCZ05WSFE0RUZnUVU5NHU4WXlMdmE2MTJnT1pyCm44QnlFQ2NucVFjd1FnWURWUjBqQkRzd09ZQVU5NHU4WXlMdmE2MTJnT1pybjhCeUVDY25xUWVoRnFRVU1CSXgKRURBT0JnTlZCQU1NQjNSbGMzUXRZMkdDQ1FDb2wxWXVDUUtBY2pBTUJnTlZIUk1FQlRBREFRSC9NQTBHQ1NxRwpTSWIzRFFFQkN3VUFBNElCQVFER1JRZ1RtdzdVNXRQRHA5Q2psOXlLRW9Vd2pYWWM2UlAwdm1GSHpubXJ3dUVLCjFrTkVJNzhBTUw1MEpuS29CY0ljVDNEeGQ3TGdIbTNCRE5mVVh2anArNnZqaXhJYXR2UWhsSFNVaWIyZjJsSTkKVEMxNzVyNCtROFkzelc1RlFXSDdLK08vY3pJTGh5ei93aHRDUlFkQ29lS1dXZkFiby8wd0VSejZzNkhkVFJzNwpHcWlGNWZtWGp6S0lOcTBjMHRyZ0xtalNKd1hwSnU0ZnNGOEcyZUh4b2pOKzdJQ1FuSkg5cGRIRVpUQUtOL2ppCnIvem04RlZtd1kvdTBndEZneWVQY1ZWbXBqRm03Y0ZOSkc4Y2ZYd0QzcEFwVjhVOGNocTZGeFBHTkVvWFZnclMKY1VRMklaU0RJd1FFY3FvSzFKSGdCUWw2RXBaUVpWMW1DRklrdFBwSQotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0t\n")),(0,r.kt)("h3",{id:"credentialsecret-\u793a\u4f8b"},"credentialSecret \u793a\u4f8b"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"apiVersion: v1\nkind: Secret\nmetadata:\n  name: creds\ntype: Opaque\ndata:\n  accessKey: <base64-encoded access key>\n  secretKey: <base64-encoded secret key>\n")),(0,r.kt)("admonition",{type:"note"},(0,r.kt)("p",{parentName:"admonition"},"\u4e3a\u907f\u514d\u7f16\u7801\u95ee\u9898\uff0c\u4f60\u53ef\u4ee5\u4f7f\u7528\u4ee5\u4e0b\u547d\u4ee4\u521b\u5efa ",(0,r.kt)("inlineCode",{parentName:"p"},"credentialSecret"),"\uff0c\u66f4\u65b0 ",(0,r.kt)("inlineCode",{parentName:"p"},"accessKey")," \u548c ",(0,r.kt)("inlineCode",{parentName:"p"},"secretKey")," \u7684\u503c\u3002"),(0,r.kt)("pre",{parentName:"admonition"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"kubectl create secret generic s3-creds \\\n  --from-literal=accessKey=<access key> \\\n  --from-literal=secretKey=<secret key>\n"))),(0,r.kt)("h3",{id:"ec2-\u8282\u70b9\u8bbf\u95ee-s3-\u7684-iam-\u6743\u9650"},"EC2 \u8282\u70b9\u8bbf\u95ee S3 \u7684 IAM \u6743\u9650"),(0,r.kt)("p",null,"\u6709\u4e24\u79cd\u65b9\u6cd5\u53ef\u4ee5\u8bbe\u7f6e ",(0,r.kt)("inlineCode",{parentName:"p"},"rancher-backup")," operator \u6765\u4f7f\u7528 S3 \u4f5c\u4e3a\u5907\u4efd\u5b58\u50a8\u4f4d\u7f6e\u3002"),(0,r.kt)("p",null,"\u4e00\u79cd\u65b9\u6cd5\u662f\u5728 Backup \u81ea\u5b9a\u4e49\u8d44\u6e90\u4e2d\u914d\u7f6e ",(0,r.kt)("inlineCode",{parentName:"p"},"credentialSecretName"),"\uff08\u5373\u53ef\u4ee5\u8bbf\u95ee S3 \u7684 AWS \u51ed\u8bc1\uff09\u3002"),(0,r.kt)("p",null,"\u5982\u679c\u96c6\u7fa4\u8282\u70b9\u5728 Amazon EC2 \u4e2d\uff0c\u4f60\u4e5f\u53ef\u4ee5\u7ed9 EC2 \u8282\u70b9\u5206\u914d IAM \u6743\u9650\uff0c\u4f7f\u5176\u53ef\u4ee5\u8bbf\u95ee S3\u3002"),(0,r.kt)("p",null,"\u8981\u5141\u8bb8\u8282\u70b9\u8bbf\u95ee S3\uff0c\u8bf7\u6309\u7167 ",(0,r.kt)("a",{parentName:"p",href:"https://aws.amazon.com/premiumsupport/knowledge-center/ec2-instance-access-s3-bucket/"},"AWS \u6587\u6863"),"\u4e2d\u7684\u8bf4\u660e\uff0c\u4e3a EC2 \u521b\u5efa\u4e00\u4e2a IAM \u89d2\u8272\u3002\u5728\u5411\u89d2\u8272\u6dfb\u52a0\u81ea\u5b9a\u4e49\u7b56\u7565\u65f6\uff0c\u6dfb\u52a0\u4ee5\u4e0b\u6743\u9650\uff0c\u5e76\u5c06 ",(0,r.kt)("inlineCode",{parentName:"p"},"Resource")," \u66ff\u6362\u4e3a\u4f60\u7684\u5b58\u50a8\u6876\u540d\u79f0\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "Version": "2012-10-17",\n  "Statement": [\n    {\n      "Effect": "Allow",\n      "Action": [\n        "s3:ListBucket"\n      ],\n     "Resource": [\n        "arn:aws:s3:::rancher-backups"\n      ]\n    },\n    {\n      "Effect": "Allow",\n      "Action": [\n        "s3:PutObject",\n        "s3:GetObject",\n        "s3:DeleteObject",\n        "s3:PutObjectAcl"\n      ],\n      "Resource": [\n         "arn:aws:s3:::rancher-backups/*"\n      ]\n    }\n  ]\n}\n')),(0,r.kt)("p",null,"\u5728\u521b\u5efa\u89d2\u8272\u5e76\u5c06\u76f8\u5e94\u7684\u5b9e\u4f8b\u914d\u7f6e\u6587\u4ef6\u9644\u52a0 EC2 \u5b9e\u4f8b\u540e\uff0cBackup \u81ea\u5b9a\u4e49\u8d44\u6e90\u4e2d\u7684 ",(0,r.kt)("inlineCode",{parentName:"p"},"credentialSecretName")," \u6307\u4ee4\u53ef\u4ee5\u7559\u7a7a\u3002"),(0,r.kt)("h2",{id:"\u793a\u4f8b"},"\u793a\u4f8b"),(0,r.kt)("p",null,"\u5982\u9700\u83b7\u53d6 Backup \u81ea\u5b9a\u4e49\u8d44\u6e90\u7684\u793a\u4f8b\uff0c\u8bf7\u53c2\u89c1",(0,r.kt)("a",{parentName:"p",href:"/zh/v2.6/reference-guides/backup-restore-configuration/examples#%E5%A4%87%E4%BB%BD"},"\u672c\u9875"),"\u3002"))}k.isMDXComponent=!0},61687:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/encryption-764e07a9a1c79ccb857802bdba719cb8.png"}}]);