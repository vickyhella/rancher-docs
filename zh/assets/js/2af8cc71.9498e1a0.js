"use strict";(self.webpackChunkrancher_docs=self.webpackChunkrancher_docs||[]).push([[64375],{3905:function(e,r,t){t.d(r,{Zo:function(){return u},kt:function(){return v}});var a=t(67294);function l(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function n(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);r&&(a=a.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,a)}return t}function s(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?n(Object(t),!0).forEach((function(r){l(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):n(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}function i(e,r){if(null==e)return{};var t,a,l=function(e,r){if(null==e)return{};var t,a,l={},n=Object.keys(e);for(a=0;a<n.length;a++)t=n[a],r.indexOf(t)>=0||(l[t]=e[t]);return l}(e,r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);for(a=0;a<n.length;a++)t=n[a],r.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(l[t]=e[t])}return l}var c=a.createContext({}),o=function(e){var r=a.useContext(c),t=r;return e&&(t="function"==typeof e?e(r):s(s({},r),e)),t},u=function(e){var r=o(e.components);return a.createElement(c.Provider,{value:r},e.children)},k={inlineCode:"code",wrapper:function(e){var r=e.children;return a.createElement(a.Fragment,{},r)}},p=a.forwardRef((function(e,r){var t=e.components,l=e.mdxType,n=e.originalType,c=e.parentName,u=i(e,["components","mdxType","originalType","parentName"]),p=o(t),v=l,d=p["".concat(c,".").concat(v)]||p[v]||k[v]||n;return t?a.createElement(d,s(s({ref:r},u),{},{components:t})):a.createElement(d,s({ref:r},u))}));function v(e,r){var t=arguments,l=r&&r.mdxType;if("string"==typeof e||l){var n=t.length,s=new Array(n);s[0]=p;var i={};for(var c in r)hasOwnProperty.call(r,c)&&(i[c]=r[c]);i.originalType=e,i.mdxType="string"==typeof e?e:l,s[1]=i;for(var o=2;o<n;o++)s[o]=t[o];return a.createElement.apply(null,s)}return a.createElement.apply(null,t)}p.displayName="MDXCreateElement"},15709:function(e,r,t){t.r(r),t.d(r,{assets:function(){return u},contentTitle:function(){return c},default:function(){return v},frontMatter:function(){return i},metadata:function(){return o},toc:function(){return k}});var a=t(87462),l=t(63366),n=(t(67294),t(3905)),s=["components"],i={title:"RKE2 CIS 1.6 Benchmark - \u81ea\u6211\u8bc4\u4f30\u6307\u5357 - Rancher 2.6"},c=void 0,o={unversionedId:"reference-guides/rancher-security/rancher-v2.6-hardening-guides/rke2-self-assessment-guide-with-cis-v1.6-benchmark",id:"reference-guides/rancher-security/rancher-v2.6-hardening-guides/rke2-self-assessment-guide-with-cis-v1.6-benchmark",title:"RKE2 CIS 1.6 Benchmark - \u81ea\u6211\u8bc4\u4f30\u6307\u5357 - Rancher 2.6",description:"CIS 1.6 Kubernetes Benchmark - Rancher 2.6 RKE2 \u4e0e Kubernetes 1.21 \u5230 1.23",source:"@site/i18n/zh/docusaurus-plugin-content-docs/current/reference-guides/rancher-security/rancher-v2.6-hardening-guides/rke2-self-assessment-guide-with-cis-v1.6-benchmark.md",sourceDirName:"reference-guides/rancher-security/rancher-v2.6-hardening-guides",slug:"/reference-guides/rancher-security/rancher-v2.6-hardening-guides/rke2-self-assessment-guide-with-cis-v1.6-benchmark",permalink:"/zh/reference-guides/rancher-security/rancher-v2.6-hardening-guides/rke2-self-assessment-guide-with-cis-v1.6-benchmark",draft:!1,editUrl:"https://github.com/rancher/rancher-docs/edit/main/docs/reference-guides/rancher-security/rancher-v2.6-hardening-guides/rke2-self-assessment-guide-with-cis-v1.6-benchmark.md",tags:[],version:"current",lastUpdatedAt:1663953084,formattedLastUpdatedAt:"2022/9/23",frontMatter:{title:"RKE2 CIS 1.6 Benchmark - \u81ea\u6211\u8bc4\u4f30\u6307\u5357 - Rancher 2.6"},sidebar:"tutorialSidebar",previous:{title:"\u4f7f\u7528 CIS 1.6 Benchmark \u7684 RKE2 \u5f3a\u5316\u6307\u5357",permalink:"/zh/reference-guides/rancher-security/rancher-v2.6-hardening-guides/rke2-hardening-guide-with-cis-v1.6-benchmark"},next:{title:"SELinux RPM",permalink:"/zh/pages-for-subheaders/selinux-rpm"}},u={},k=[{value:"CIS 1.6 Kubernetes Benchmark - Rancher 2.6 RKE2 \u4e0e Kubernetes 1.21 \u5230 1.23",id:"cis-16-kubernetes-benchmark---rancher-26-rke2-\u4e0e-kubernetes-121-\u5230-123",level:3},{value:"\u6982\u8ff0",id:"\u6982\u8ff0",level:4},{value:"\u6d4b\u8bd5\u7ba1\u63a7\u65b9\u6cd5",id:"\u6d4b\u8bd5\u7ba1\u63a7\u65b9\u6cd5",level:4},{value:"\u7ba1\u63a7",id:"\u7ba1\u63a7",level:3},{value:"1.1Master \u8282\u70b9\u914d\u7f6e\u6587\u4ef6",id:"11master-\u8282\u70b9\u914d\u7f6e\u6587\u4ef6",level:2},{value:"1.1.1\u786e\u4fdd API Server pod \u89c4\u8303\u6587\u4ef6\u6743\u9650\u5177\u6709 644 \u6216\u66f4\u4e25\u683c\u7684\u8bbe\u7f6e\uff08\u81ea\u52a8\uff09",id:"111\u786e\u4fdd-api-server-pod-\u89c4\u8303\u6587\u4ef6\u6743\u9650\u5177\u6709-644-\u6216\u66f4\u4e25\u683c\u7684\u8bbe\u7f6e\u81ea\u52a8",level:3},{value:"1.1.2\u786e\u4fdd API Server pod \u89c4\u8303\u6587\u4ef6\u6240\u6709\u6743\u8bbe\u7f6e\u4e3a root:root\uff08\u81ea\u52a8\uff09",id:"112\u786e\u4fdd-api-server-pod-\u89c4\u8303\u6587\u4ef6\u6240\u6709\u6743\u8bbe\u7f6e\u4e3a-rootroot\u81ea\u52a8",level:3},{value:"1.1.3\u786e\u4fdd Controller Manager pod \u89c4\u8303\u6587\u4ef6\u6743\u9650\u5177\u6709 644 \u6216\u66f4\u4e25\u683c\u7684\u8bbe\u7f6e\uff08\u81ea\u52a8\uff09",id:"113\u786e\u4fdd-controller-manager-pod-\u89c4\u8303\u6587\u4ef6\u6743\u9650\u5177\u6709-644-\u6216\u66f4\u4e25\u683c\u7684\u8bbe\u7f6e\u81ea\u52a8",level:3},{value:"1.1.4\u786e\u4fdd Controller Manager pod \u89c4\u8303\u6587\u4ef6\u6240\u6709\u6743\u8bbe\u7f6e\u4e3a root:root\uff08\u81ea\u52a8\uff09",id:"114\u786e\u4fdd-controller-manager-pod-\u89c4\u8303\u6587\u4ef6\u6240\u6709\u6743\u8bbe\u7f6e\u4e3a-rootroot\u81ea\u52a8",level:3},{value:"1.1.5\u786e\u4fdd Scheduler pod \u89c4\u8303\u6587\u4ef6\u6743\u9650\u5177\u6709 644 \u6216\u66f4\u4e25\u683c\u7684\u8bbe\u7f6e\uff08\u81ea\u52a8\uff09",id:"115\u786e\u4fdd-scheduler-pod-\u89c4\u8303\u6587\u4ef6\u6743\u9650\u5177\u6709-644-\u6216\u66f4\u4e25\u683c\u7684\u8bbe\u7f6e\u81ea\u52a8",level:3},{value:"1.1.6\u786e\u4fdd Scheduler pod \u89c4\u8303\u6587\u4ef6\u6240\u6709\u6743\u8bbe\u7f6e\u4e3a root:root\uff08\u81ea\u52a8\uff09",id:"116\u786e\u4fdd-scheduler-pod-\u89c4\u8303\u6587\u4ef6\u6240\u6709\u6743\u8bbe\u7f6e\u4e3a-rootroot\u81ea\u52a8",level:3},{value:"1.1.7\u786e\u4fdd etcd pod \u89c4\u8303\u6587\u4ef6\u6743\u9650\u5177\u6709 644 \u6216\u66f4\u4e25\u683c\u7684\u8bbe\u7f6e\uff08\u81ea\u52a8\uff09",id:"117\u786e\u4fdd-etcd-pod-\u89c4\u8303\u6587\u4ef6\u6743\u9650\u5177\u6709-644-\u6216\u66f4\u4e25\u683c\u7684\u8bbe\u7f6e\u81ea\u52a8",level:3},{value:"1.1.8\u786e\u4fdd etcd pod \u89c4\u8303\u6587\u4ef6\u6240\u6709\u6743\u8bbe\u7f6e\u4e3a root:root\uff08\u81ea\u52a8\uff09",id:"118\u786e\u4fdd-etcd-pod-\u89c4\u8303\u6587\u4ef6\u6240\u6709\u6743\u8bbe\u7f6e\u4e3a-rootroot\u81ea\u52a8",level:3},{value:"1.1.9\u786e\u4fdd\u5bb9\u5668\u7f51\u7edc\u63a5\u53e3\u6587\u4ef6\u6743\u9650\u8bbe\u7f6e\u4e3a 644 \u6216\u66f4\u4e25\u683c\u7684\u8bbe\u7f6e\uff08\u624b\u52a8\uff09",id:"119\u786e\u4fdd\u5bb9\u5668\u7f51\u7edc\u63a5\u53e3\u6587\u4ef6\u6743\u9650\u8bbe\u7f6e\u4e3a-644-\u6216\u66f4\u4e25\u683c\u7684\u8bbe\u7f6e\u624b\u52a8",level:3},{value:"1.1.10\u786e\u4fdd\u5bb9\u5668\u7f51\u7edc\u63a5\u53e3\u6587\u4ef6\u6240\u6709\u6743\u8bbe\u7f6e\u4e3a root:root\uff08\u624b\u52a8\uff09",id:"1110\u786e\u4fdd\u5bb9\u5668\u7f51\u7edc\u63a5\u53e3\u6587\u4ef6\u6240\u6709\u6743\u8bbe\u7f6e\u4e3a-rootroot\u624b\u52a8",level:3},{value:"1.1.11\u786e\u4fdd etcd \u6570\u636e\u76ee\u5f55\u6743\u9650\u8bbe\u7f6e\u4e3a 700 \u6216\u66f4\u4e25\u683c\u7684\u8bbe\u7f6e\uff08\u81ea\u52a8\uff09",id:"1111\u786e\u4fdd-etcd-\u6570\u636e\u76ee\u5f55\u6743\u9650\u8bbe\u7f6e\u4e3a-700-\u6216\u66f4\u4e25\u683c\u7684\u8bbe\u7f6e\u81ea\u52a8",level:3},{value:"1.1.12\u786e\u4fdd etcd \u6570\u636e\u76ee\u5f55\u6240\u6709\u6743\u8bbe\u7f6e\u4e3a etcd:etcd\uff08\u81ea\u52a8\uff09",id:"1112\u786e\u4fdd-etcd-\u6570\u636e\u76ee\u5f55\u6240\u6709\u6743\u8bbe\u7f6e\u4e3a-etcdetcd\u81ea\u52a8",level:3},{value:"1.1.13\u786e\u4fdd admin.conf \u6587\u4ef6\u6743\u9650\u5177\u6709 644 \u6216\u66f4\u4e25\u683c\u7684\u8bbe\u7f6e\uff08\u81ea\u52a8\uff09",id:"1113\u786e\u4fdd-adminconf-\u6587\u4ef6\u6743\u9650\u5177\u6709-644-\u6216\u66f4\u4e25\u683c\u7684\u8bbe\u7f6e\u81ea\u52a8",level:3},{value:"1.1.14\u786e\u4fdd admin.conf \u6587\u4ef6\u6240\u6709\u6743\u8bbe\u7f6e\u4e3a root:root\uff08\u81ea\u52a8\uff09",id:"1114\u786e\u4fdd-adminconf-\u6587\u4ef6\u6240\u6709\u6743\u8bbe\u7f6e\u4e3a-rootroot\u81ea\u52a8",level:3},{value:"1.1.15\u786e\u4fdd scheduler.conf \u6587\u4ef6\u6743\u9650\u5177\u6709 644 \u6216\u66f4\u4e25\u683c\u7684\u8bbe\u7f6e\uff08\u81ea\u52a8\uff09",id:"1115\u786e\u4fdd-schedulerconf-\u6587\u4ef6\u6743\u9650\u5177\u6709-644-\u6216\u66f4\u4e25\u683c\u7684\u8bbe\u7f6e\u81ea\u52a8",level:3},{value:"1.1.16\u786e\u4fdd scheduler.conf \u6587\u4ef6\u6240\u6709\u6743\u8bbe\u7f6e\u4e3a root:root\uff08\u81ea\u52a8\uff09",id:"1116\u786e\u4fdd-schedulerconf-\u6587\u4ef6\u6240\u6709\u6743\u8bbe\u7f6e\u4e3a-rootroot\u81ea\u52a8",level:3},{value:"1.1.17\u786e\u4fdd controller-manager.conf \u6587\u4ef6\u6743\u9650\u5177\u6709 644 \u6216\u66f4\u4e25\u683c\u7684\u8bbe\u7f6e\uff08\u81ea\u52a8\uff09",id:"1117\u786e\u4fdd-controller-managerconf-\u6587\u4ef6\u6743\u9650\u5177\u6709-644-\u6216\u66f4\u4e25\u683c\u7684\u8bbe\u7f6e\u81ea\u52a8",level:3},{value:"1.1.18\u786e\u4fdd\u5c06 controller-manager.conf \u6587\u4ef6\u6240\u6709\u6743\u8bbe\u7f6e\u4e3a root:root\uff08\u81ea\u52a8\uff09",id:"1118\u786e\u4fdd\u5c06-controller-managerconf-\u6587\u4ef6\u6240\u6709\u6743\u8bbe\u7f6e\u4e3a-rootroot\u81ea\u52a8",level:3},{value:"1.1.19\u786e\u4fdd Kubernetes PKI \u76ee\u5f55\u548c\u6587\u4ef6\u6240\u6709\u6743\u8bbe\u7f6e\u4e3a root:root\uff08\u81ea\u52a8\uff09",id:"1119\u786e\u4fdd-kubernetes-pki-\u76ee\u5f55\u548c\u6587\u4ef6\u6240\u6709\u6743\u8bbe\u7f6e\u4e3a-rootroot\u81ea\u52a8",level:3},{value:"1.1.20\u786e\u4fdd\u5c06 Kubernetes PKI \u8bc1\u4e66\u6587\u4ef6\u6743\u9650\u8bbe\u7f6e\u4e3a 644 \u6216\u66f4\u4e25\u683c\u7684\u8bbe\u7f6e\uff08\u624b\u52a8\uff09",id:"1120\u786e\u4fdd\u5c06-kubernetes-pki-\u8bc1\u4e66\u6587\u4ef6\u6743\u9650\u8bbe\u7f6e\u4e3a-644-\u6216\u66f4\u4e25\u683c\u7684\u8bbe\u7f6e\u624b\u52a8",level:3},{value:"1.1.21\u786e\u4fdd Kubernetes PKI \u5bc6\u94a5\u6587\u4ef6\u6743\u9650\u8bbe\u7f6e\u4e3a 600\uff08\u624b\u52a8\uff09",id:"1121\u786e\u4fdd-kubernetes-pki-\u5bc6\u94a5\u6587\u4ef6\u6743\u9650\u8bbe\u7f6e\u4e3a-600\u624b\u52a8",level:3},{value:"1.2API Server",id:"12api-server",level:2},{value:"1.2.1\u786e\u4fdd --anonymous-auth \u53c2\u6570\u8bbe\u7f6e\u4e3a false\uff08\u624b\u52a8\uff09",id:"121\u786e\u4fdd---anonymous-auth-\u53c2\u6570\u8bbe\u7f6e\u4e3a-false\u624b\u52a8",level:3},{value:"1.2.2\u786e\u4fdd\u672a\u8bbe\u7f6e --basic-auth-file \u53c2\u6570\uff08\u81ea\u52a8\uff09",id:"122\u786e\u4fdd\u672a\u8bbe\u7f6e---basic-auth-file-\u53c2\u6570\u81ea\u52a8",level:3},{value:"1.2.3\u786e\u4fdd\u672a\u8bbe\u7f6e --token-auth-file \u53c2\u6570\uff08\u81ea\u52a8\uff09",id:"123\u786e\u4fdd\u672a\u8bbe\u7f6e---token-auth-file-\u53c2\u6570\u81ea\u52a8",level:3},{value:"1.2.4\u786e\u4fdd --kubelet-https \u53c2\u6570\u8bbe\u7f6e\u4e3a true\uff08\u81ea\u52a8\uff09",id:"124\u786e\u4fdd---kubelet-https-\u53c2\u6570\u8bbe\u7f6e\u4e3a-true\u81ea\u52a8",level:3},{value:"1.2.5\u786e\u4fdd\u6b63\u786e\u8bbe\u7f6e\u4e86 --kubelet-client-certificate \u548c --kubelet-client-key \u53c2\u6570\uff08\u81ea\u52a8\uff09",id:"125\u786e\u4fdd\u6b63\u786e\u8bbe\u7f6e\u4e86---kubelet-client-certificate-\u548c---kubelet-client-key-\u53c2\u6570\u81ea\u52a8",level:3},{value:"1.2.6\u786e\u4fdd\u6839\u636e\u9700\u8981\u8bbe\u7f6e --kubelet-certificate-authority \u53c2\u6570\uff08\u81ea\u52a8\uff09",id:"126\u786e\u4fdd\u6839\u636e\u9700\u8981\u8bbe\u7f6e---kubelet-certificate-authority-\u53c2\u6570\u81ea\u52a8",level:3},{value:"1.2.7\u786e\u4fdd --authorization-mode \u53c2\u6570\u672a\u8bbe\u7f6e\u4e3a AlwaysAllow\uff08\u81ea\u52a8\uff09",id:"127\u786e\u4fdd---authorization-mode-\u53c2\u6570\u672a\u8bbe\u7f6e\u4e3a-alwaysallow\u81ea\u52a8",level:3},{value:"1.2.8\u786e\u4fdd --authorization-mode \u53c2\u6570\u5305\u62ec Node\uff08\u81ea\u52a8\uff09",id:"128\u786e\u4fdd---authorization-mode-\u53c2\u6570\u5305\u62ec-node\u81ea\u52a8",level:3},{value:"1.2.9\u786e\u4fdd --authorization-mode \u53c2\u6570\u5305\u62ec RBAC\uff08\u81ea\u52a8\uff09",id:"129\u786e\u4fdd---authorization-mode-\u53c2\u6570\u5305\u62ec-rbac\u81ea\u52a8",level:3},{value:"1.2.10\u786e\u4fdd\u8bbe\u7f6e\u4e86\u51c6\u5165\u63a7\u5236\u63d2\u4ef6 EventRateLimit\uff08\u624b\u52a8\uff09",id:"1210\u786e\u4fdd\u8bbe\u7f6e\u4e86\u51c6\u5165\u63a7\u5236\u63d2\u4ef6-eventratelimit\u624b\u52a8",level:3},{value:"1.2.11\u786e\u4fdd\u672a\u8bbe\u7f6e\u51c6\u5165\u63a7\u5236\u63d2\u4ef6 AlwaysAdmit\uff08\u81ea\u52a8\uff09",id:"1211\u786e\u4fdd\u672a\u8bbe\u7f6e\u51c6\u5165\u63a7\u5236\u63d2\u4ef6-alwaysadmit\u81ea\u52a8",level:3},{value:"1.2.12\u786e\u4fdd\u8bbe\u7f6e\u4e86\u51c6\u5165\u63a7\u5236\u63d2\u4ef6 AlwaysPullImages\uff08\u624b\u52a8\uff09",id:"1212\u786e\u4fdd\u8bbe\u7f6e\u4e86\u51c6\u5165\u63a7\u5236\u63d2\u4ef6-alwayspullimages\u624b\u52a8",level:3},{value:"1.2.13\u5982\u679c\u6ca1\u6709\u4f7f\u7528 PodSecurityPolicy\uff0c\u8bf7\u786e\u4fdd\u8bbe\u7f6e\u4e86\u51c6\u5165\u63a7\u5236\u63d2\u4ef6 SecurityContextDeny\uff08\u624b\u52a8\uff09",id:"1213\u5982\u679c\u6ca1\u6709\u4f7f\u7528-podsecuritypolicy\u8bf7\u786e\u4fdd\u8bbe\u7f6e\u4e86\u51c6\u5165\u63a7\u5236\u63d2\u4ef6-securitycontextdeny\u624b\u52a8",level:3},{value:"1.2.14\u786e\u4fdd\u8bbe\u7f6e\u4e86\u51c6\u5165\u63a7\u5236\u63d2\u4ef6 ServiceAccount\uff08\u81ea\u52a8\uff09",id:"1214\u786e\u4fdd\u8bbe\u7f6e\u4e86\u51c6\u5165\u63a7\u5236\u63d2\u4ef6-serviceaccount\u81ea\u52a8",level:3},{value:"1.2.15\u786e\u4fdd\u8bbe\u7f6e\u4e86\u51c6\u5165\u63a7\u5236\u63d2\u4ef6 NamespaceLifecycle\uff08\u81ea\u52a8\uff09",id:"1215\u786e\u4fdd\u8bbe\u7f6e\u4e86\u51c6\u5165\u63a7\u5236\u63d2\u4ef6-namespacelifecycle\u81ea\u52a8",level:3},{value:"1.2.16\u786e\u4fdd\u8bbe\u7f6e\u4e86\u51c6\u5165\u63a7\u5236\u63d2\u4ef6 PodSecurityPolicy\uff08\u81ea\u52a8\uff09",id:"1216\u786e\u4fdd\u8bbe\u7f6e\u4e86\u51c6\u5165\u63a7\u5236\u63d2\u4ef6-podsecuritypolicy\u81ea\u52a8",level:3},{value:"1.2.17\u786e\u4fdd\u8bbe\u7f6e\u4e86\u51c6\u5165\u63a7\u5236\u63d2\u4ef6 NodeRestriction\uff08\u81ea\u52a8\uff09",id:"1217\u786e\u4fdd\u8bbe\u7f6e\u4e86\u51c6\u5165\u63a7\u5236\u63d2\u4ef6-noderestriction\u81ea\u52a8",level:3},{value:"1.2.18\u786e\u4fdd\u672a\u8bbe\u7f6e --insecure-bind-address \u53c2\u6570\uff08\u81ea\u52a8\uff09",id:"1218\u786e\u4fdd\u672a\u8bbe\u7f6e---insecure-bind-address-\u53c2\u6570\u81ea\u52a8",level:3},{value:"1.2.19\u786e\u4fdd --insecure-port \u53c2\u6570\u8bbe\u7f6e\u4e3a 0\uff08\u81ea\u52a8\uff09",id:"1219\u786e\u4fdd---insecure-port-\u53c2\u6570\u8bbe\u7f6e\u4e3a-0\u81ea\u52a8",level:3},{value:"1.2.20\u786e\u4fdd --secure-port \u53c2\u6570\u672a\u8bbe\u7f6e\u4e3a 0\uff08\u81ea\u52a8\uff09",id:"1220\u786e\u4fdd---secure-port-\u53c2\u6570\u672a\u8bbe\u7f6e\u4e3a-0\u81ea\u52a8",level:3},{value:"1.2.21\u786e\u4fdd --profiling \u53c2\u6570\u8bbe\u7f6e\u4e3a false\uff08\u81ea\u52a8\uff09",id:"1221\u786e\u4fdd---profiling-\u53c2\u6570\u8bbe\u7f6e\u4e3a-false\u81ea\u52a8",level:3},{value:"1.2.22\u786e\u4fdd\u8bbe\u7f6e\u4e86 --audit-log-path \u53c2\u6570\uff08\u81ea\u52a8\uff09",id:"1222\u786e\u4fdd\u8bbe\u7f6e\u4e86---audit-log-path-\u53c2\u6570\u81ea\u52a8",level:3},{value:"1.2.23\u786e\u4fdd\u5c06 --audit-log-maxage \u53c2\u6570\u8bbe\u7f6e\u4e3a 30 \u6216\u9002\u5f53\u7684\u6570\u503c\uff08\u81ea\u52a8\uff09",id:"1223\u786e\u4fdd\u5c06---audit-log-maxage-\u53c2\u6570\u8bbe\u7f6e\u4e3a-30-\u6216\u9002\u5f53\u7684\u6570\u503c\u81ea\u52a8",level:3},{value:"1.2.24\u786e\u4fdd --audit-log-maxbackup \u53c2\u6570\u8bbe\u7f6e\u4e3a 10 \u6216\u9002\u5f53\u7684\u6570\u503c\uff08\u81ea\u52a8\uff09",id:"1224\u786e\u4fdd---audit-log-maxbackup-\u53c2\u6570\u8bbe\u7f6e\u4e3a-10-\u6216\u9002\u5f53\u7684\u6570\u503c\u81ea\u52a8",level:3},{value:"1.2.25\u786e\u4fdd --audit-log-maxsize \u53c2\u6570\u8bbe\u7f6e\u4e3a 100 \u6216\u9002\u5f53\u7684\u6570\u503c\uff08\u81ea\u52a8\uff09",id:"1225\u786e\u4fdd---audit-log-maxsize-\u53c2\u6570\u8bbe\u7f6e\u4e3a-100-\u6216\u9002\u5f53\u7684\u6570\u503c\u81ea\u52a8",level:3},{value:"1.2.26\u786e\u4fdd\u80fd\u6839\u636e\u9700\u8981\u8bbe\u7f6e --request-timeout \u53c2\u6570\uff08\u81ea\u52a8\uff09",id:"1226\u786e\u4fdd\u80fd\u6839\u636e\u9700\u8981\u8bbe\u7f6e---request-timeout-\u53c2\u6570\u81ea\u52a8",level:3},{value:"1.2.27\u786e\u4fdd --service-account-lookup \u53c2\u6570\u8bbe\u7f6e\u4e3a true\uff08\u81ea\u52a8\uff09",id:"1227\u786e\u4fdd---service-account-lookup-\u53c2\u6570\u8bbe\u7f6e\u4e3a-true\u81ea\u52a8",level:3},{value:"1.2.28\u786e\u4fdd\u6839\u636e\u9700\u8981\u8bbe\u7f6e --service-account-key-file \u53c2\u6570\uff08\u81ea\u52a8\uff09",id:"1228\u786e\u4fdd\u6839\u636e\u9700\u8981\u8bbe\u7f6e---service-account-key-file-\u53c2\u6570\u81ea\u52a8",level:3},{value:"1.2.29\u786e\u4fdd\u6839\u636e\u9700\u8981\u8bbe\u7f6e --etcd-certfile \u548c --etcd-keyfile \u53c2\u6570\uff08\u81ea\u52a8\uff09",id:"1229\u786e\u4fdd\u6839\u636e\u9700\u8981\u8bbe\u7f6e---etcd-certfile-\u548c---etcd-keyfile-\u53c2\u6570\u81ea\u52a8",level:3},{value:"1.2.30\u786e\u4fdd\u6839\u636e\u9700\u8981\u8bbe\u7f6e --tls-cert-file \u548c --tls-private-key-file \u53c2\u6570\uff08\u81ea\u52a8\uff09",id:"1230\u786e\u4fdd\u6839\u636e\u9700\u8981\u8bbe\u7f6e---tls-cert-file-\u548c---tls-private-key-file-\u53c2\u6570\u81ea\u52a8",level:3},{value:"1.2.31\u786e\u4fdd\u6839\u636e\u9700\u8981\u8bbe\u7f6e --client-ca-file \u53c2\u6570\uff08\u81ea\u52a8\uff09",id:"1231\u786e\u4fdd\u6839\u636e\u9700\u8981\u8bbe\u7f6e---client-ca-file-\u53c2\u6570\u81ea\u52a8",level:3},{value:"1.2.32\u786e\u4fdd --etcd-cafile \u53c2\u6570\u8bbe\u7f6e\u6b63\u786e\uff08\u81ea\u52a8\uff09",id:"1232\u786e\u4fdd---etcd-cafile-\u53c2\u6570\u8bbe\u7f6e\u6b63\u786e\u81ea\u52a8",level:3},{value:"1.2.33\u786e\u4fdd\u6839\u636e\u9700\u8981\u8bbe\u7f6e --encryption-provider-config \u53c2\u6570\uff08\u81ea\u52a8\uff09",id:"1233\u786e\u4fdd\u6839\u636e\u9700\u8981\u8bbe\u7f6e---encryption-provider-config-\u53c2\u6570\u81ea\u52a8",level:3},{value:"1.2.34\u786e\u4fdd\u6b63\u786e\u914d\u7f6e\u52a0\u5bc6\u63d0\u4f9b\u7a0b\u5e8f\uff08\u81ea\u52a8\uff09",id:"1234\u786e\u4fdd\u6b63\u786e\u914d\u7f6e\u52a0\u5bc6\u63d0\u4f9b\u7a0b\u5e8f\u81ea\u52a8",level:3},{value:"1.2.35\u786e\u4fdd API Server \u4ec5\u4f7f\u7528\u5f3a\u5bc6\u7801\uff08\u624b\u52a8\uff09",id:"1235\u786e\u4fdd-api-server-\u4ec5\u4f7f\u7528\u5f3a\u5bc6\u7801\u624b\u52a8",level:3},{value:"1.3Controller Manager",id:"13controller-manager",level:2},{value:"1.3.1\u786e\u4fdd\u6b63\u786e\u8bbe\u7f6e --terminated-pod-gc-threshold \u53c2\u6570\uff08\u81ea\u52a8\uff09",id:"131\u786e\u4fdd\u6b63\u786e\u8bbe\u7f6e---terminated-pod-gc-threshold-\u53c2\u6570\u81ea\u52a8",level:3},{value:"1.3.2\u786e\u4fdd --profiling \u53c2\u6570\u8bbe\u7f6e\u4e3a false\uff08\u81ea\u52a8\uff09",id:"132\u786e\u4fdd---profiling-\u53c2\u6570\u8bbe\u7f6e\u4e3a-false\u81ea\u52a8",level:3},{value:"1.3.3\u786e\u4fdd --use-service-account-credentials \u53c2\u6570\u8bbe\u7f6e\u4e3a true\uff08\u81ea\u52a8\uff09",id:"133\u786e\u4fdd---use-service-account-credentials-\u53c2\u6570\u8bbe\u7f6e\u4e3a-true\u81ea\u52a8",level:3},{value:"1.3.4\u786e\u4fdd\u6839\u636e\u9700\u8981\u8bbe\u7f6e --service-account-private-key-file \u53c2\u6570\uff08\u81ea\u52a8\uff09",id:"134\u786e\u4fdd\u6839\u636e\u9700\u8981\u8bbe\u7f6e---service-account-private-key-file-\u53c2\u6570\u81ea\u52a8",level:3},{value:"1.3.5\u786e\u4fdd\u6839\u636e\u9700\u8981\u8bbe\u7f6e --root-ca-file \u53c2\u6570\uff08\u81ea\u52a8\uff09",id:"135\u786e\u4fdd\u6839\u636e\u9700\u8981\u8bbe\u7f6e---root-ca-file-\u53c2\u6570\u81ea\u52a8",level:3},{value:"1.3.6\u786e\u4fdd RotateKubeletServerCertificate \u53c2\u6570\u8bbe\u7f6e\u4e3a true\uff08\u81ea\u52a8\uff09",id:"136\u786e\u4fdd-rotatekubeletservercertificate-\u53c2\u6570\u8bbe\u7f6e\u4e3a-true\u81ea\u52a8",level:3},{value:"1.3.7\u786e\u4fdd --bind-address \u53c2\u6570\u8bbe\u7f6e\u4e3a 127.0.0.1\uff08\u81ea\u52a8\uff09",id:"137\u786e\u4fdd---bind-address-\u53c2\u6570\u8bbe\u7f6e\u4e3a-127001\u81ea\u52a8",level:3},{value:"1.4Scheduler",id:"14scheduler",level:2},{value:"1.4.1\u786e\u4fdd --profiling \u53c2\u6570\u8bbe\u7f6e\u4e3a false\uff08\u81ea\u52a8\uff09",id:"141\u786e\u4fdd---profiling-\u53c2\u6570\u8bbe\u7f6e\u4e3a-false\u81ea\u52a8",level:3},{value:"1.4.2\u786e\u4fdd --bind-address \u53c2\u6570\u8bbe\u7f6e\u4e3a 127.0.0.1\uff08\u81ea\u52a8\uff09",id:"142\u786e\u4fdd---bind-address-\u53c2\u6570\u8bbe\u7f6e\u4e3a-127001\u81ea\u52a8",level:3},{value:"2 Etcd Node Configuration Files",id:"2-etcd-node-configuration-files",level:2},{value:"2.1\u786e\u4fdd\u6839\u636e\u9700\u8981\u8bbe\u7f6e --cert-file \u548c --key-file \u53c2\u6570\uff08\u81ea\u52a8\uff09",id:"21\u786e\u4fdd\u6839\u636e\u9700\u8981\u8bbe\u7f6e---cert-file-\u548c---key-file-\u53c2\u6570\u81ea\u52a8",level:3},{value:"2.2\u786e\u4fdd --client-cert-auth \u53c2\u6570\u8bbe\u7f6e\u4e3a true\uff08\u81ea\u52a8\uff09",id:"22\u786e\u4fdd---client-cert-auth-\u53c2\u6570\u8bbe\u7f6e\u4e3a-true\u81ea\u52a8",level:3},{value:"2.3\u786e\u4fdd --auto-tls \u53c2\u6570\u672a\u8bbe\u7f6e\u4e3a true\uff08\u81ea\u52a8\uff09",id:"23\u786e\u4fdd---auto-tls-\u53c2\u6570\u672a\u8bbe\u7f6e\u4e3a-true\u81ea\u52a8",level:3},{value:"2.4\u786e\u4fdd\u6839\u636e\u9700\u8981\u8bbe\u7f6e --peer-cert-file \u548c --peer-key-file \u53c2\u6570\uff08\u81ea\u52a8\uff09",id:"24\u786e\u4fdd\u6839\u636e\u9700\u8981\u8bbe\u7f6e---peer-cert-file-\u548c---peer-key-file-\u53c2\u6570\u81ea\u52a8",level:3},{value:"2.5\u786e\u4fdd --peer-client-cert-auth \u53c2\u6570\u8bbe\u7f6e\u4e3a true\uff08\u81ea\u52a8\uff09",id:"25\u786e\u4fdd---peer-client-cert-auth-\u53c2\u6570\u8bbe\u7f6e\u4e3a-true\u81ea\u52a8",level:3},{value:"2.6\u786e\u4fdd --peer-auto-tls \u53c2\u6570\u672a\u8bbe\u7f6e\u4e3a true\uff08\u81ea\u52a8\uff09",id:"26\u786e\u4fdd---peer-auto-tls-\u53c2\u6570\u672a\u8bbe\u7f6e\u4e3a-true\u81ea\u52a8",level:3},{value:"2.7\u786e\u4fdd etcd \u4f7f\u7528\u552f\u4e00\u7684 CA\uff08\u624b\u52a8\uff09",id:"27\u786e\u4fdd-etcd-\u4f7f\u7528\u552f\u4e00\u7684-ca\u624b\u52a8",level:3},{value:"3.1\u8ba4\u8bc1\u548c\u6388\u6743",id:"31\u8ba4\u8bc1\u548c\u6388\u6743",level:2},{value:"3.1.1\u4e0d\u80fd\u5c06\u5ba2\u6237\u7aef\u8bc1\u4e66\u8eab\u4efd\u9a8c\u8bc1\u5e94\u7528\u4e8e\u7528\u6237\uff08\u624b\u52a8\uff09",id:"311\u4e0d\u80fd\u5c06\u5ba2\u6237\u7aef\u8bc1\u4e66\u8eab\u4efd\u9a8c\u8bc1\u5e94\u7528\u4e8e\u7528\u6237\u624b\u52a8",level:3},{value:"3.2Logging",id:"32logging",level:2},{value:"3.2.1\u786e\u4fdd\u521b\u5efa\u6700\u5c0f\u5ba1\u8ba1\u7b56\u7565\uff08\u81ea\u52a8\uff09",id:"321\u786e\u4fdd\u521b\u5efa\u6700\u5c0f\u5ba1\u8ba1\u7b56\u7565\u81ea\u52a8",level:3},{value:"3.2.2\u786e\u4fdd\u5ba1\u8ba1\u7b56\u7565\u6db5\u76d6\u5173\u952e\u5b89\u5168\u95ee\u9898\uff08\u624b\u52a8\uff09",id:"322\u786e\u4fdd\u5ba1\u8ba1\u7b56\u7565\u6db5\u76d6\u5173\u952e\u5b89\u5168\u95ee\u9898\u624b\u52a8",level:3},{value:"4.1Worker \u8282\u70b9\u914d\u7f6e\u6587\u4ef6",id:"41worker-\u8282\u70b9\u914d\u7f6e\u6587\u4ef6",level:2},{value:"4.1.1\u786e\u4fdd kubelet \u670d\u52a1\u6587\u4ef6\u6743\u9650\u5177\u6709 644 \u6216\u66f4\u4e25\u683c\u7684\u8bbe\u7f6e\uff08\u81ea\u52a8\uff09",id:"411\u786e\u4fdd-kubelet-\u670d\u52a1\u6587\u4ef6\u6743\u9650\u5177\u6709-644-\u6216\u66f4\u4e25\u683c\u7684\u8bbe\u7f6e\u81ea\u52a8",level:3},{value:"4.1.2\u786e\u4fdd kubelet \u670d\u52a1\u6587\u4ef6\u6240\u6709\u6743\u8bbe\u7f6e\u4e3a root:root\uff08\u81ea\u52a8\uff09",id:"412\u786e\u4fdd-kubelet-\u670d\u52a1\u6587\u4ef6\u6240\u6709\u6743\u8bbe\u7f6e\u4e3a-rootroot\u81ea\u52a8",level:3},{value:"4.1.3\u5982\u679c\u4ee3\u7406 kubeconfig \u6587\u4ef6\u5b58\u5728\uff0c\u8bf7\u786e\u4fdd\u6743\u9650\u5177\u6709 644 \u6216\u66f4\u4e25\u683c\u7684\u8bbe\u7f6e\uff08\u624b\u52a8\uff09",id:"413\u5982\u679c\u4ee3\u7406-kubeconfig-\u6587\u4ef6\u5b58\u5728\u8bf7\u786e\u4fdd\u6743\u9650\u5177\u6709-644-\u6216\u66f4\u4e25\u683c\u7684\u8bbe\u7f6e\u624b\u52a8",level:3},{value:"4.1.4\u786e\u4fdd\u4ee3\u7406 kubeconfig \u6587\u4ef6\u6240\u6709\u6743\u8bbe\u7f6e\u4e3a root:root\uff08\u624b\u52a8\uff09",id:"414\u786e\u4fdd\u4ee3\u7406-kubeconfig-\u6587\u4ef6\u6240\u6709\u6743\u8bbe\u7f6e\u4e3a-rootroot\u624b\u52a8",level:3},{value:"4.1.5\u786e\u4fdd --kubeconfig kubelet.conf \u6587\u4ef6\u6743\u9650\u5177\u6709 644 \u6216\u66f4\u4e25\u683c\u7684\u8bbe\u7f6e\uff08\u81ea\u52a8\uff09",id:"415\u786e\u4fdd---kubeconfig-kubeletconf-\u6587\u4ef6\u6743\u9650\u5177\u6709-644-\u6216\u66f4\u4e25\u683c\u7684\u8bbe\u7f6e\u81ea\u52a8",level:3},{value:"4.1.6\u786e\u4fdd --kubeconfig kubelet.conf \u6587\u4ef6\u6240\u6709\u6743\u8bbe\u7f6e\u4e3a root:root\uff08\u81ea\u52a8\uff09",id:"416\u786e\u4fdd---kubeconfig-kubeletconf-\u6587\u4ef6\u6240\u6709\u6743\u8bbe\u7f6e\u4e3a-rootroot\u81ea\u52a8",level:3},{value:"4.1.7\u786e\u4fdd CA \u6587\u4ef6\u6743\u9650\u5177\u6709 644 \u6216\u66f4\u4e25\u683c\u7684\u8bbe\u7f6e\uff08\u624b\u52a8\uff09",id:"417\u786e\u4fdd-ca-\u6587\u4ef6\u6743\u9650\u5177\u6709-644-\u6216\u66f4\u4e25\u683c\u7684\u8bbe\u7f6e\u624b\u52a8",level:3},{value:"4.1.8\u786e\u4fdd\u5ba2\u6237\u7aef CA \u6587\u4ef6\u6240\u6709\u6743\u8bbe\u7f6e\u4e3a root:root\uff08\u81ea\u52a8\uff09",id:"418\u786e\u4fdd\u5ba2\u6237\u7aef-ca-\u6587\u4ef6\u6240\u6709\u6743\u8bbe\u7f6e\u4e3a-rootroot\u81ea\u52a8",level:3},{value:"4.1.9\u786e\u4fdd kubelet --config \u914d\u7f6e\u6587\u4ef6\u6743\u9650\u5177\u6709 644 \u6216\u66f4\u4e25\u683c\u7684\u8bbe\u7f6e\uff08\u81ea\u52a8\uff09",id:"419\u786e\u4fdd-kubelet---config-\u914d\u7f6e\u6587\u4ef6\u6743\u9650\u5177\u6709-644-\u6216\u66f4\u4e25\u683c\u7684\u8bbe\u7f6e\u81ea\u52a8",level:3},{value:"4.1.10\u786e\u4fdd kubelet --config \u914d\u7f6e\u6587\u4ef6\u6240\u6709\u6743\u8bbe\u7f6e\u4e3a root:root\uff08\u81ea\u52a8\uff09",id:"4110\u786e\u4fdd-kubelet---config-\u914d\u7f6e\u6587\u4ef6\u6240\u6709\u6743\u8bbe\u7f6e\u4e3a-rootroot\u81ea\u52a8",level:3},{value:"4.2Kubelet",id:"42kubelet",level:2},{value:"4.2.1\u786e\u4fdd\u5c06 anonymous-auth \u53c2\u6570\u8bbe\u7f6e\u4e3a false\uff08\u81ea\u52a8\uff09",id:"421\u786e\u4fdd\u5c06-anonymous-auth-\u53c2\u6570\u8bbe\u7f6e\u4e3a-false\u81ea\u52a8",level:3},{value:"4.2.2\u786e\u4fdd --authorization-mode \u53c2\u6570\u672a\u8bbe\u7f6e\u4e3a AlwaysAllow\uff08\u81ea\u52a8\uff09",id:"422\u786e\u4fdd---authorization-mode-\u53c2\u6570\u672a\u8bbe\u7f6e\u4e3a-alwaysallow\u81ea\u52a8",level:3},{value:"4.2.3\u786e\u4fdd\u6839\u636e\u9700\u8981\u8bbe\u7f6e --client-ca-file \u53c2\u6570\uff08\u81ea\u52a8\uff09",id:"423\u786e\u4fdd\u6839\u636e\u9700\u8981\u8bbe\u7f6e---client-ca-file-\u53c2\u6570\u81ea\u52a8",level:3},{value:"4.2.4\u786e\u4fdd --read-only-port \u53c2\u6570\u8bbe\u7f6e\u4e3a 0\uff08\u81ea\u52a8\uff09",id:"424\u786e\u4fdd---read-only-port-\u53c2\u6570\u8bbe\u7f6e\u4e3a-0\u81ea\u52a8",level:3},{value:"4.2.5\u786e\u4fdd --streaming-connection-idle-timeout \u53c2\u6570\u672a\u8bbe\u7f6e\u4e3a 0\uff08\u81ea\u52a8\uff09",id:"425\u786e\u4fdd---streaming-connection-idle-timeout-\u53c2\u6570\u672a\u8bbe\u7f6e\u4e3a-0\u81ea\u52a8",level:3},{value:"4.2.6\u786e\u4fdd --protect-kernel-defaults \u53c2\u6570\u8bbe\u7f6e\u4e3a true\uff08\u81ea\u52a8\uff09",id:"426\u786e\u4fdd---protect-kernel-defaults-\u53c2\u6570\u8bbe\u7f6e\u4e3a-true\u81ea\u52a8",level:3},{value:"4.2.7\u786e\u4fdd --make-iptables-util-chains \u53c2\u6570\u8bbe\u7f6e\u4e3a true\uff08\u81ea\u52a8\uff09",id:"427\u786e\u4fdd---make-iptables-util-chains-\u53c2\u6570\u8bbe\u7f6e\u4e3a-true\u81ea\u52a8",level:3},{value:"4.2.8\u786e\u4fdd\u672a\u8bbe\u7f6e --hostname-override \u53c2\u6570\uff08\u624b\u52a8\uff09",id:"428\u786e\u4fdd\u672a\u8bbe\u7f6e---hostname-override-\u53c2\u6570\u624b\u52a8",level:3},{value:"4.2.9\u786e\u4fdd --event-qps \u53c2\u6570\u8bbe\u7f6e\u4e3a 0 \u6216\u80fd\u9002\u5f53\u6293\u53d6\u4e8b\u4ef6\u7684\u7ea7\u522b\uff08\u624b\u52a8\uff09",id:"429\u786e\u4fdd---event-qps-\u53c2\u6570\u8bbe\u7f6e\u4e3a-0-\u6216\u80fd\u9002\u5f53\u6293\u53d6\u4e8b\u4ef6\u7684\u7ea7\u522b\u624b\u52a8",level:3},{value:"4.2.10\u786e\u4fdd\u6839\u636e\u9700\u8981\u8bbe\u7f6e --tls-cert-file \u548c --tls-private-key-file \u53c2\u6570\uff08\u81ea\u52a8\uff09",id:"4210\u786e\u4fdd\u6839\u636e\u9700\u8981\u8bbe\u7f6e---tls-cert-file-\u548c---tls-private-key-file-\u53c2\u6570\u81ea\u52a8",level:3},{value:"4.2.11\u786e\u4fdd --rotate-certificates \u53c2\u6570\u672a\u8bbe\u7f6e\u4e3a false\uff08\u624b\u52a8\uff09",id:"4211\u786e\u4fdd---rotate-certificates-\u53c2\u6570\u672a\u8bbe\u7f6e\u4e3a-false\u624b\u52a8",level:3},{value:"4.2.12\u9a8c\u8bc1 RotateKubeletServerCertificate \u53c2\u6570\u662f\u5426\u8bbe\u7f6e\u4e3a true\uff08\u624b\u52a8\uff09",id:"4212\u9a8c\u8bc1-rotatekubeletservercertificate-\u53c2\u6570\u662f\u5426\u8bbe\u7f6e\u4e3a-true\u624b\u52a8",level:3},{value:"4.2.13\u786e\u4fdd Kubelet \u4ec5\u4f7f\u7528\u5f3a\u5bc6\u7801\uff08\u624b\u52a8\uff09",id:"4213\u786e\u4fdd-kubelet-\u4ec5\u4f7f\u7528\u5f3a\u5bc6\u7801\u624b\u52a8",level:3},{value:"5.1RBAC \u548c ServiceAccount",id:"51rbac-\u548c-serviceaccount",level:2},{value:"5.1.1\u786e\u4fdd\u4ec5\u5728\u9700\u8981\u65f6\u4f7f\u7528 cluster-admin \u89d2\u8272\uff08\u624b\u52a8\uff09",id:"511\u786e\u4fdd\u4ec5\u5728\u9700\u8981\u65f6\u4f7f\u7528-cluster-admin-\u89d2\u8272\u624b\u52a8",level:3},{value:"5.1.2\u5c3d\u91cf\u51cf\u5c11\u5bf9\u5bc6\u6587\u7684\u8bbf\u95ee\uff08\u624b\u52a8\uff09",id:"512\u5c3d\u91cf\u51cf\u5c11\u5bf9\u5bc6\u6587\u7684\u8bbf\u95ee\u624b\u52a8",level:3},{value:"5.1.3\u5c3d\u91cf\u51cf\u5c11\u89d2\u8272\u548c ClusterRoles \u4e2d\u901a\u914d\u7b26\u7684\u4f7f\u7528\uff08\u624b\u52a8\uff09",id:"513\u5c3d\u91cf\u51cf\u5c11\u89d2\u8272\u548c-clusterroles-\u4e2d\u901a\u914d\u7b26\u7684\u4f7f\u7528\u624b\u52a8",level:3},{value:"5.1.4\u5c3d\u91cf\u51cf\u5c11\u521b\u5efa pod \u7684\u8bbf\u95ee\uff08\u624b\u52a8\uff09",id:"514\u5c3d\u91cf\u51cf\u5c11\u521b\u5efa-pod-\u7684\u8bbf\u95ee\u624b\u52a8",level:3},{value:"5.1.5\u786e\u4fdd\u672a\u4e3b\u52a8\u4f7f\u7528\u9ed8\u8ba4 ServiceAccount\u3002\uff08\u81ea\u52a8\uff09",id:"515\u786e\u4fdd\u672a\u4e3b\u52a8\u4f7f\u7528\u9ed8\u8ba4-serviceaccount\u81ea\u52a8",level:3},{value:"5.1.6\u786e\u4fdd\u4ec5\u5728\u5fc5\u8981\u65f6\u6302\u8f7d ServiceAccount \u4ee4\u724c\uff08\u624b\u52a8\uff09",id:"516\u786e\u4fdd\u4ec5\u5728\u5fc5\u8981\u65f6\u6302\u8f7d-serviceaccount-\u4ee4\u724c\u624b\u52a8",level:3},{value:"5.2Pod \u5b89\u5168\u7b56\u7565",id:"52pod-\u5b89\u5168\u7b56\u7565",level:2},{value:"5.2.1\u6700\u5c0f\u5316\u7279\u6743\u5bb9\u5668\u7684\u51c6\u5165\uff08\u81ea\u52a8\uff09",id:"521\u6700\u5c0f\u5316\u7279\u6743\u5bb9\u5668\u7684\u51c6\u5165\u81ea\u52a8",level:3},{value:"5.2.2\u6700\u5c0f\u5316\u9700\u8981\u5171\u4eab\u4e3b\u673a\u8fdb\u7a0b ID \u547d\u540d\u7a7a\u95f4\u7684\u5bb9\u5668\u51c6\u5165\uff08\u81ea\u52a8\uff09",id:"522\u6700\u5c0f\u5316\u9700\u8981\u5171\u4eab\u4e3b\u673a\u8fdb\u7a0b-id-\u547d\u540d\u7a7a\u95f4\u7684\u5bb9\u5668\u51c6\u5165\u81ea\u52a8",level:3},{value:"5.2.3\u6700\u5c0f\u5316\u9700\u8981\u5171\u4eab\u4e3b\u673a IPC \u547d\u540d\u7a7a\u95f4\u7684\u5bb9\u5668\u51c6\u5165\uff08\u81ea\u52a8\uff09",id:"523\u6700\u5c0f\u5316\u9700\u8981\u5171\u4eab\u4e3b\u673a-ipc-\u547d\u540d\u7a7a\u95f4\u7684\u5bb9\u5668\u51c6\u5165\u81ea\u52a8",level:3},{value:"5.2.4\u6700\u5c0f\u5316\u9700\u8981\u5171\u4eab\u4e3b\u673a\u7f51\u7edc\u547d\u540d\u7a7a\u95f4\u7684\u5bb9\u5668\u51c6\u5165\uff08\u81ea\u52a8\uff09",id:"524\u6700\u5c0f\u5316\u9700\u8981\u5171\u4eab\u4e3b\u673a\u7f51\u7edc\u547d\u540d\u7a7a\u95f4\u7684\u5bb9\u5668\u51c6\u5165\u81ea\u52a8",level:3},{value:"5.2.5\u4f7f\u7528 allowPrivilegeEscalation\uff08\u81ea\u52a8\uff09\u6700\u5c0f\u5316\u5bb9\u5668\u7684\u51c6\u5165",id:"525\u4f7f\u7528-allowprivilegeescalation\u81ea\u52a8\u6700\u5c0f\u5316\u5bb9\u5668\u7684\u51c6\u5165",level:3},{value:"5.2.6\u6700\u5c0f\u5316\u6839\u5bb9\u5668\u7684\u51c6\u5165\uff08\u81ea\u52a8\uff09",id:"526\u6700\u5c0f\u5316\u6839\u5bb9\u5668\u7684\u51c6\u5165\u81ea\u52a8",level:3},{value:"5.2.7\u4f7f\u7528 NET_RAW \u529f\u80fd\u6700\u5927\u9650\u5ea6\u5730\u51cf\u5c11\u5bb9\u5668\u7684\u51c6\u5165\uff08\u624b\u52a8\uff09",id:"527\u4f7f\u7528-net_raw-\u529f\u80fd\u6700\u5927\u9650\u5ea6\u5730\u51cf\u5c11\u5bb9\u5668\u7684\u51c6\u5165\u624b\u52a8",level:3},{value:"5.2.8\u4f7f\u7528\u6dfb\u52a0\u7684\u529f\u80fd\u6700\u5927\u9650\u5ea6\u5730\u51cf\u5c11\u5bb9\u5668\u7684\u51c6\u5165\uff08\u624b\u52a8\uff09",id:"528\u4f7f\u7528\u6dfb\u52a0\u7684\u529f\u80fd\u6700\u5927\u9650\u5ea6\u5730\u51cf\u5c11\u5bb9\u5668\u7684\u51c6\u5165\u624b\u52a8",level:3},{value:"5.2.9\u4f7f\u7528\u5206\u914d\u7684\u529f\u80fd\u6700\u5927\u9650\u5ea6\u5730\u51cf\u5c11\u5bb9\u5668\u7684\u51c6\u5165\uff08\u624b\u52a8\uff09",id:"529\u4f7f\u7528\u5206\u914d\u7684\u529f\u80fd\u6700\u5927\u9650\u5ea6\u5730\u51cf\u5c11\u5bb9\u5668\u7684\u51c6\u5165\u624b\u52a8",level:3},{value:"5.3\u7f51\u7edc\u7b56\u7565\u548c \u200b\u200bCNI",id:"53\u7f51\u7edc\u7b56\u7565\u548c-cni",level:2},{value:"5.3.1\u786e\u4fdd\u4f7f\u7528\u7684 CNI \u652f\u6301\u7f51\u7edc\u7b56\u7565\uff08\u81ea\u52a8\uff09",id:"531\u786e\u4fdd\u4f7f\u7528\u7684-cni-\u652f\u6301\u7f51\u7edc\u7b56\u7565\u81ea\u52a8",level:3},{value:"5.3.2\u786e\u4fdd\u6240\u6709\u547d\u540d\u7a7a\u95f4\u90fd\u5b9a\u4e49\u4e86\u7f51\u7edc\u7b56\u7565\uff08\u81ea\u52a8\uff09",id:"532\u786e\u4fdd\u6240\u6709\u547d\u540d\u7a7a\u95f4\u90fd\u5b9a\u4e49\u4e86\u7f51\u7edc\u7b56\u7565\u81ea\u52a8",level:3},{value:"5.4\u5bc6\u6587\u7ba1\u7406",id:"54\u5bc6\u6587\u7ba1\u7406",level:2},{value:"5.4.1\u4f18\u5148\u4f7f\u7528\u5bc6\u6587\u6587\u4ef6\u800c\u4e0d\u662f\u5bc6\u6587\u73af\u5883\u53d8\u91cf\uff08\u624b\u52a8\uff09",id:"541\u4f18\u5148\u4f7f\u7528\u5bc6\u6587\u6587\u4ef6\u800c\u4e0d\u662f\u5bc6\u6587\u73af\u5883\u53d8\u91cf\u624b\u52a8",level:3},{value:"5.4.2\u8003\u8651\u5916\u90e8\u5bc6\u6587\u5b58\u50a8\uff08\u624b\u52a8\uff09",id:"542\u8003\u8651\u5916\u90e8\u5bc6\u6587\u5b58\u50a8\u624b\u52a8",level:3},{value:"5.5\u53ef\u6269\u5c55\u51c6\u5165\u63a7\u5236",id:"55\u53ef\u6269\u5c55\u51c6\u5165\u63a7\u5236",level:2},{value:"5.5.1\u4f7f\u7528 ImagePolicyWebhook \u51c6\u5165\u63a7\u5236\u5668\u914d\u7f6e\u955c\u50cf\u6765\u6e90\uff08\u624b\u52a8\uff09",id:"551\u4f7f\u7528-imagepolicywebhook-\u51c6\u5165\u63a7\u5236\u5668\u914d\u7f6e\u955c\u50cf\u6765\u6e90\u624b\u52a8",level:3},{value:"5.6v1.5.1 \u6307\u5357\u8df3\u8fc7 5.6 \u5e76\u4ece 5.5 \u8f6c\u5230 5.7\u3002\u6211\u4eec\u5c06\u5b83\u5305\u542b\u5728\u8fd9\u91cc\u53ea\u662f\u4e3a\u4e86\u8fdb\u884c\u89e3\u91ca\u3002",id:"56v151-\u6307\u5357\u8df3\u8fc7-56-\u5e76\u4ece-55-\u8f6c\u5230-57\u6211\u4eec\u5c06\u5b83\u5305\u542b\u5728\u8fd9\u91cc\u53ea\u662f\u4e3a\u4e86\u8fdb\u884c\u89e3\u91ca",level:2},{value:"5.7\u901a\u7528\u7b56\u7565",id:"57\u901a\u7528\u7b56\u7565",level:2},{value:"5.7.1\u4f7f\u7528\u547d\u540d\u7a7a\u95f4\u5728\u8d44\u6e90\u4e4b\u95f4\u521b\u5efa\u7ba1\u7406\u8fb9\u754c\uff08\u624b\u52a8\uff09",id:"571\u4f7f\u7528\u547d\u540d\u7a7a\u95f4\u5728\u8d44\u6e90\u4e4b\u95f4\u521b\u5efa\u7ba1\u7406\u8fb9\u754c\u624b\u52a8",level:3},{value:"5.7.2\u786e\u4fdd seccomp \u914d\u7f6e\u6587\u4ef6\u5728\u4f60\u7684 pod \u5b9a\u4e49\u4e2d\u8bbe\u7f6e\u4e3a docker/default\uff08\u624b\u52a8\uff09",id:"572\u786e\u4fdd-seccomp-\u914d\u7f6e\u6587\u4ef6\u5728\u4f60\u7684-pod-\u5b9a\u4e49\u4e2d\u8bbe\u7f6e\u4e3a-dockerdefault\u624b\u52a8",level:3},{value:"5.7.3\u5c06\u5b89\u5168\u4e0a\u4e0b\u6587\u5e94\u7528\u5230\u4f60\u7684 Pod \u548c\u5bb9\u5668\uff08\u81ea\u52a8\uff09",id:"573\u5c06\u5b89\u5168\u4e0a\u4e0b\u6587\u5e94\u7528\u5230\u4f60\u7684-pod-\u548c\u5bb9\u5668\u81ea\u52a8",level:3},{value:"5.7.4\u786e\u4fdd\u4e0d\u4f7f\u7528 Default \u547d\u540d\u7a7a\u95f4\uff08\u624b\u52a8\uff09",id:"574\u786e\u4fdd\u4e0d\u4f7f\u7528-default-\u547d\u540d\u7a7a\u95f4\u624b\u52a8",level:3}],p={toc:k};function v(e){var r=e.components,t=(0,l.Z)(e,s);return(0,n.kt)("wrapper",(0,a.Z)({},p,t,{components:r,mdxType:"MDXLayout"}),(0,n.kt)("h3",{id:"cis-16-kubernetes-benchmark---rancher-26-rke2-\u4e0e-kubernetes-121-\u5230-123"},"CIS 1.6 Kubernetes Benchmark - Rancher 2.6 RKE2 \u4e0e Kubernetes 1.21 \u5230 1.23"),(0,n.kt)("p",null,(0,n.kt)("a",{parentName:"p",href:"https://releases.rancher.com/documents/security/2.6/Rancher_RKE2_v2-6_CIS_v1-6_Benchmark_Assessment.pdf"},"\u70b9\u51fb\u6b64\u5904\u4e0b\u8f7d\u672c\u6587\u6863\u7684 PDF \u7248\u672c"),"\u3002"),(0,n.kt)("h4",{id:"\u6982\u8ff0"},"\u6982\u8ff0"),(0,n.kt)("p",null,"\u672c\u6587\u6863\u662f ",(0,n.kt)("a",{parentName:"p",href:"/zh/reference-guides/rancher-security/rancher-v2.6-hardening-guides/rke2-hardening-guide-with-cis-v1.6-benchmark"},"Rancher 2.6 RKE2 \u5b89\u5168\u5f3a\u5316\u6307\u5357"),"\u7684\u914d\u5957\u6587\u4ef6\u3002\u5f3a\u5316\u6307\u5357\uff08Hardening Guide\uff09\u4e3a\u901a\u8fc7 RKE2 \u914d\u7f6e\u96c6\u7fa4\u7684 Rancher \u5f3a\u5316\u751f\u4ea7\u5b89\u88c5\u63d0\u4f9b\u4e86\u8bf4\u660e\uff0c\u672c Benchmark \u6307\u5357\u65e8\u5728\u5e2e\u52a9\u4f60\u6839\u636e Benchmark \u6765\u8bc4\u4f30\u5f3a\u5316\u96c6\u7fa4\u7684\u5b89\u5168\u7ea7\u522b\u3002"),(0,n.kt)("p",null,"\u672c\u6307\u5357\u5bf9\u5e94\u4ee5\u4e0b\u5f3a\u5316\u6307\u5357\u3001Rancher\u3001CIS Benchmark \u548c Kubernetes \u7248\u672c\uff1a"),(0,n.kt)("table",null,(0,n.kt)("thead",{parentName:"table"},(0,n.kt)("tr",{parentName:"thead"},(0,n.kt)("th",{parentName:"tr",align:null},"\u5f3a\u5316\u6307\u5357\u7248\u672c"),(0,n.kt)("th",{parentName:"tr",align:null},"Rancher \u7248\u672c"),(0,n.kt)("th",{parentName:"tr",align:null},"CIS Benchmark \u7248\u672c"),(0,n.kt)("th",{parentName:"tr",align:null},"Kubernetes \u7248\u672c"))),(0,n.kt)("tbody",{parentName:"table"},(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null},"\u5f3a\u5316\u6307\u5357 CIS v1.6 Benchmark"),(0,n.kt)("td",{parentName:"tr",align:null},"Rancher v2.6.5+"),(0,n.kt)("td",{parentName:"tr",align:null},"CIS v1.6"),(0,n.kt)("td",{parentName:"tr",align:null},"Kubernetes v1.21 \u5230 v1.23")))),(0,n.kt)("p",null,"\u7531\u4e8e Rancher \u548c RKE2 \u5c06 Kubernetes \u670d\u52a1\u5b89\u88c5\u4e3a\u5bb9\u5668\uff0c\u56e0\u6b64 CIS Kubernetes Benchmark \u4e2d\u7684\u8bb8\u591a\u7ba1\u63a7\u9a8c\u8bc1\u68c0\u67e5\u90fd\u4e0d\u9002\u7528\uff0c\u4e14\u7ed3\u679c\u4f1a\u662f ",(0,n.kt)("inlineCode",{parentName:"p"},"Not Applicable"),"\u3002\u672c\u6307\u5357\u5c06\u4ecb\u7ecd\u5404\u79cd\u7ba1\u63a7\uff0c\u5e76\u63d0\u4f9b\u66f4\u65b0\u7684\u793a\u4f8b\u547d\u4ee4\u6765\u5ba1\u6838 Rancher \u521b\u5efa\u7684\u96c6\u7fa4\u7684\u5408\u89c4\u6027\u3002"),(0,n.kt)("p",null,"\u672c\u6587\u6863\u4f9b Rancher \u5f00\u53d1\u3001\u5b89\u5168\u56e2\u961f\u3001\u5ba1\u8ba1\u5458\u548c\u51b3\u7b56\u8005\u4f7f\u7528\u3002"),(0,n.kt)("p",null,"\u6709\u5173\u5404\u4e2a\u5ba1\u6838\u7684\u66f4\u591a\u8be6\u7ec6\u4fe1\u606f\uff0c\u5305\u62ec\u5931\u8d25\u6d4b\u8bd5\u7684\u7406\u7531\u548c\u4fee\u6b63\u63aa\u65bd\uff0c\u4f60\u53ef\u4ee5\u53c2\u8003 CIS Kubernetes Benchmark v1.6 \u7684\u5bf9\u5e94\u5185\u5bb9\u3002\u521b\u5efa\u514d\u8d39\u5e10\u6237\u540e\uff0c\u4f60\u53ef\u4ee5\u5728 ",(0,n.kt)("a",{parentName:"p",href:"https://www.cisecurity.org/benchmark/kubernetes/"},"Center for Internet Security (CIS)")," \u4e0b\u8f7d Benchmark\u3002"),(0,n.kt)("h4",{id:"\u6d4b\u8bd5\u7ba1\u63a7\u65b9\u6cd5"},"\u6d4b\u8bd5\u7ba1\u63a7\u65b9\u6cd5"),(0,n.kt)("p",null,"RKE2 \u5c06 controlplane \u7ec4\u4ef6\u4f5c\u4e3a\u7531 kubelet \u7ba1\u7406\u7684\u9759\u6001 pod \u542f\u52a8\uff0c\u5e76\u4f7f\u7528 containerd \u4f5c\u4e3a\u5bb9\u5668\u8fd0\u884c\u65f6\u3002\u914d\u7f6e\u662f\u901a\u8fc7\u521d\u59cb\u5316\u65f6\u4f20\u9012\u7ed9\u5bb9\u5668\u7684\u53c2\u6570\u6216\u914d\u7f6e\u6587\u4ef6\u5b9a\u4e49\u7684\u3002"),(0,n.kt)("p",null,"\u5982\u679c\u7ba1\u63a7\u5ba1\u8ba1\u4e0e\u539f\u59cb CIS Benchmark \u51fa\u73b0\u5dee\u5f02\uff0c\u9488\u5bf9 Rancher \u63d0\u4f9b\u7684\u7684\u5ba1\u8ba1\u547d\u4ee4\u53ef\u7528\u4e8e\u8fdb\u884c\u6d4b\u8bd5\u3002\u6267\u884c\u6d4b\u8bd5\u65f6\uff0c\u4f60\u9700\u8981\u8bbf\u95ee\u6240\u6709 RKE2 \u8282\u70b9\u4e3b\u673a\u4e0a\u7684\u547d\u4ee4\u884c\u3002\u8fd9\u4e9b\u547d\u4ee4\u8fd8\u4f7f\u7528\u4e86\u6d4b\u8bd5\u548c\u8bc4\u4f30\u6d4b\u8bd5\u7ed3\u679c\u6240\u9700\u7684 ",(0,n.kt)("a",{parentName:"p",href:"https://kubernetes.io/docs/tasks/tools/"},"kubectl"),"\uff08\u5e26\u6709\u6709\u6548\u7684\u914d\u7f6e\u6587\u4ef6\uff09\u548c ",(0,n.kt)("a",{parentName:"p",href:"https://stedolan.github.io/jq/"},"jq")," \u5de5\u5177\u3002"),(0,n.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,n.kt)("div",{parentName:"div",className:"admonition-heading"},(0,n.kt)("h5",{parentName:"div"},(0,n.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,n.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,n.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,n.kt)("div",{parentName:"div",className:"admonition-content"},(0,n.kt)("p",{parentName:"div"},"\u672c\u6307\u5357\u4ec5\u4ecb\u7ecd ",(0,n.kt)("inlineCode",{parentName:"p"},"automated")," \u6d4b\u8bd5\uff08\u4ee5\u524d\u79f0\u4e3a ",(0,n.kt)("inlineCode",{parentName:"p"},"scored"),"\uff09\u3002"))),(0,n.kt)("h3",{id:"\u7ba1\u63a7"},"\u7ba1\u63a7"),(0,n.kt)("hr",null),(0,n.kt)("h2",{id:"11master-\u8282\u70b9\u914d\u7f6e\u6587\u4ef6"},"1.1Master \u8282\u70b9\u914d\u7f6e\u6587\u4ef6"),(0,n.kt)("h3",{id:"111\u786e\u4fdd-api-server-pod-\u89c4\u8303\u6587\u4ef6\u6743\u9650\u5177\u6709-644-\u6216\u66f4\u4e25\u683c\u7684\u8bbe\u7f6e\u81ea\u52a8"},"1.1.1\u786e\u4fdd API Server pod \u89c4\u8303\u6587\u4ef6\u6743\u9650\u5177\u6709 644 \u6216\u66f4\u4e25\u683c\u7684\u8bbe\u7f6e\uff08\u81ea\u52a8\uff09"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1apass"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u5728 Master \u8282\u70b9\u4e0a\u8fd0\u884c\u4ee5\u4e0b\u547d\u4ee4\uff08\u57fa\u4e8e\u7cfb\u7edf\u4e0a\u7684\u6587\u4ef6\u4f4d\u7f6e\uff09\u3002\n\u4f8b\u5982\uff1achmod 644 /var/lib/rancher/rke2/agent/pod-manifests/kube-apiserver.yaml"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"stat -c %a /var/lib/rancher/rke2/agent/pod-manifests/kube-apiserver.yaml\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u9884\u671f\u7ed3\u679c"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},"'permissions' is not present\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u8fd4\u56de\u503c"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},"644\n")),(0,n.kt)("h3",{id:"112\u786e\u4fdd-api-server-pod-\u89c4\u8303\u6587\u4ef6\u6240\u6709\u6743\u8bbe\u7f6e\u4e3a-rootroot\u81ea\u52a8"},"1.1.2\u786e\u4fdd API Server pod \u89c4\u8303\u6587\u4ef6\u6240\u6709\u6743\u8bbe\u7f6e\u4e3a root:root\uff08\u81ea\u52a8\uff09"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1apass"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u5728 Master \u8282\u70b9\u4e0a\u8fd0\u884c\u4ee5\u4e0b\u547d\u4ee4\uff08\u57fa\u4e8e\u7cfb\u7edf\u4e0a\u7684\u6587\u4ef6\u4f4d\u7f6e\uff09\u3002\n\u4f8b\u5982\uff1achown root:root /var/lib/rancher/rke2/agent/pod-manifests/kube-apiserver.yaml"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"/bin/sh -c 'if test -e /var/lib/rancher/rke2/agent/pod-manifests/kube-apiserver.yaml; then stat -c %U:%G /var/lib/rancher/rke2/agent/pod-manifests/kube-apiserver.yaml; fi'\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u9884\u671f\u7ed3\u679c"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},"'root:root' is equal to 'root:root'\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u8fd4\u56de\u503c"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},"root:root\n")),(0,n.kt)("h3",{id:"113\u786e\u4fdd-controller-manager-pod-\u89c4\u8303\u6587\u4ef6\u6743\u9650\u5177\u6709-644-\u6216\u66f4\u4e25\u683c\u7684\u8bbe\u7f6e\u81ea\u52a8"},"1.1.3\u786e\u4fdd Controller Manager pod \u89c4\u8303\u6587\u4ef6\u6743\u9650\u5177\u6709 644 \u6216\u66f4\u4e25\u683c\u7684\u8bbe\u7f6e\uff08\u81ea\u52a8\uff09"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1apass"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u5728 Master \u8282\u70b9\u4e0a\u8fd0\u884c\u4ee5\u4e0b\u547d\u4ee4\uff08\u57fa\u4e8e\u7cfb\u7edf\u4e0a\u7684\u6587\u4ef6\u4f4d\u7f6e\uff09\u3002\n\u4f8b\u5982\uff1achmod 644 /var/lib/rancher/rke2/agent/pod-manifests/kube-controller-manager.yaml"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"/bin/sh -c 'if test -e /var/lib/rancher/rke2/agent/pod-manifests/kube-controller-manager.yaml; then stat -c %a /var/lib/rancher/rke2/agent/pod-manifests/kube-controller-manager.yaml; fi'\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u9884\u671f\u7ed3\u679c"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},"'644' is equal to '644'\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u8fd4\u56de\u503c"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},"644\n")),(0,n.kt)("h3",{id:"114\u786e\u4fdd-controller-manager-pod-\u89c4\u8303\u6587\u4ef6\u6240\u6709\u6743\u8bbe\u7f6e\u4e3a-rootroot\u81ea\u52a8"},"1.1.4\u786e\u4fdd Controller Manager pod \u89c4\u8303\u6587\u4ef6\u6240\u6709\u6743\u8bbe\u7f6e\u4e3a root:root\uff08\u81ea\u52a8\uff09"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1apass"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u5728 Master \u8282\u70b9\u4e0a\u8fd0\u884c\u4ee5\u4e0b\u547d\u4ee4\uff08\u57fa\u4e8e\u7cfb\u7edf\u4e0a\u7684\u6587\u4ef6\u4f4d\u7f6e\uff09\u3002\n\u4f8b\u5982\uff1achown root:root /var/lib/rancher/rke2/agent/pod-manifests/kube-controller-manager.yaml"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"/bin/sh -c 'if test -e /var/lib/rancher/rke2/agent/pod-manifests/kube-controller-manager.yaml; then stat -c %U:%G /var/lib/rancher/rke2/agent/pod-manifests/kube-controller-manager.yaml; fi'\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u9884\u671f\u7ed3\u679c"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},"'root:root' is equal to 'root:root'\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u8fd4\u56de\u503c"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},"root:root\n")),(0,n.kt)("h3",{id:"115\u786e\u4fdd-scheduler-pod-\u89c4\u8303\u6587\u4ef6\u6743\u9650\u5177\u6709-644-\u6216\u66f4\u4e25\u683c\u7684\u8bbe\u7f6e\u81ea\u52a8"},"1.1.5\u786e\u4fdd Scheduler pod \u89c4\u8303\u6587\u4ef6\u6743\u9650\u5177\u6709 644 \u6216\u66f4\u4e25\u683c\u7684\u8bbe\u7f6e\uff08\u81ea\u52a8\uff09"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1apass"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u5728 Master \u8282\u70b9\u4e0a\u8fd0\u884c\u4ee5\u4e0b\u547d\u4ee4\uff08\u57fa\u4e8e\u7cfb\u7edf\u4e0a\u7684\u6587\u4ef6\u4f4d\u7f6e\uff09\u3002\n\u4f8b\u5982\uff1achmod 644 /var/lib/rancher/rke2/agent/pod-manifests/kube-scheduler.yaml"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"/bin/sh -c 'if test -e /var/lib/rancher/rke2/agent/pod-manifests/kube-scheduler.yaml; then stat -c %a /var/lib/rancher/rke2/agent/pod-manifests/kube-scheduler.yaml; fi'\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u9884\u671f\u7ed3\u679c"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},"'permissions' is not present\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u8fd4\u56de\u503c"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},"644\n")),(0,n.kt)("h3",{id:"116\u786e\u4fdd-scheduler-pod-\u89c4\u8303\u6587\u4ef6\u6240\u6709\u6743\u8bbe\u7f6e\u4e3a-rootroot\u81ea\u52a8"},"1.1.6\u786e\u4fdd Scheduler pod \u89c4\u8303\u6587\u4ef6\u6240\u6709\u6743\u8bbe\u7f6e\u4e3a root:root\uff08\u81ea\u52a8\uff09"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1apass"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u5728 Master \u8282\u70b9\u4e0a\u8fd0\u884c\u4ee5\u4e0b\u547d\u4ee4\uff08\u57fa\u4e8e\u7cfb\u7edf\u4e0a\u7684\u6587\u4ef6\u4f4d\u7f6e\uff09\u3002\n\u4f8b\u5982\uff1achown root:root /var/lib/rancher/rke2/agent/pod-manifests/kube-scheduler.yaml"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"/bin/sh -c 'if test -e /var/lib/rancher/rke2/agent/pod-manifests/kube-scheduler.yaml; then stat -c %U:%G /var/lib/rancher/rke2/agent/pod-manifests/kube-scheduler.yaml; fi'\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u9884\u671f\u7ed3\u679c"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},"'root:root' is present\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u8fd4\u56de\u503c"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},"root:root\n")),(0,n.kt)("h3",{id:"117\u786e\u4fdd-etcd-pod-\u89c4\u8303\u6587\u4ef6\u6743\u9650\u5177\u6709-644-\u6216\u66f4\u4e25\u683c\u7684\u8bbe\u7f6e\u81ea\u52a8"},"1.1.7\u786e\u4fdd etcd pod \u89c4\u8303\u6587\u4ef6\u6743\u9650\u5177\u6709 644 \u6216\u66f4\u4e25\u683c\u7684\u8bbe\u7f6e\uff08\u81ea\u52a8\uff09"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1apass"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u5728 Master \u8282\u70b9\u4e0a\u8fd0\u884c\u4ee5\u4e0b\u547d\u4ee4\uff08\u57fa\u4e8e\u7cfb\u7edf\u4e0a\u7684\u6587\u4ef6\u4f4d\u7f6e\uff09\u3002\n\u4f8b\u5982\uff1achmod 644 /var/lib/rancher/rke2/agent/pod-manifests/etcd.yaml"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"/bin/sh -c 'if test -e /var/lib/rancher/rke2/agent/pod-manifests/etcd.yaml; then stat -c %a /var/lib/rancher/rke2/agent/pod-manifests/etcd.yaml; fi'\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u9884\u671f\u7ed3\u679c"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},"'644' is equal to '644'\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u8fd4\u56de\u503c"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},"644\n")),(0,n.kt)("h3",{id:"118\u786e\u4fdd-etcd-pod-\u89c4\u8303\u6587\u4ef6\u6240\u6709\u6743\u8bbe\u7f6e\u4e3a-rootroot\u81ea\u52a8"},"1.1.8\u786e\u4fdd etcd pod \u89c4\u8303\u6587\u4ef6\u6240\u6709\u6743\u8bbe\u7f6e\u4e3a root:root\uff08\u81ea\u52a8\uff09"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1apass"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u5728 Master \u8282\u70b9\u4e0a\u8fd0\u884c\u4ee5\u4e0b\u547d\u4ee4\uff08\u57fa\u4e8e\u7cfb\u7edf\u4e0a\u7684\u6587\u4ef6\u4f4d\u7f6e\uff09\u3002\n\u4f8b\u5982\uff1achown root:root /var/lib/rancher/rke2/agent/pod-manifests/etcd.yaml"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"/bin/sh -c 'if test -e /var/lib/rancher/rke2/agent/pod-manifests/etcd.yaml; then stat -c %U:%G /var/lib/rancher/rke2/agent/pod-manifests/etcd.yaml; fi'\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u9884\u671f\u7ed3\u679c"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},"'root:root' is equal to 'root:root'\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u8fd4\u56de\u503c"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},"root:root\n")),(0,n.kt)("h3",{id:"119\u786e\u4fdd\u5bb9\u5668\u7f51\u7edc\u63a5\u53e3\u6587\u4ef6\u6743\u9650\u8bbe\u7f6e\u4e3a-644-\u6216\u66f4\u4e25\u683c\u7684\u8bbe\u7f6e\u624b\u52a8"},"1.1.9\u786e\u4fdd\u5bb9\u5668\u7f51\u7edc\u63a5\u53e3\u6587\u4ef6\u6743\u9650\u8bbe\u7f6e\u4e3a 644 \u6216\u66f4\u4e25\u683c\u7684\u8bbe\u7f6e\uff08\u624b\u52a8\uff09"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1awarn"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u5728 Master \u8282\u70b9\u4e0a\u8fd0\u884c\u4ee5\u4e0b\u547d\u4ee4\uff08\u57fa\u4e8e\u7cfb\u7edf\u4e0a\u7684\u6587\u4ef6\u4f4d\u7f6e\uff09\u3002\n\u4f8b\u5982\uff1achmod 644 <path/to/cni/files>"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"stat -c %a <path/to/cni/files>\n")),(0,n.kt)("h3",{id:"1110\u786e\u4fdd\u5bb9\u5668\u7f51\u7edc\u63a5\u53e3\u6587\u4ef6\u6240\u6709\u6743\u8bbe\u7f6e\u4e3a-rootroot\u624b\u52a8"},"1.1.10\u786e\u4fdd\u5bb9\u5668\u7f51\u7edc\u63a5\u53e3\u6587\u4ef6\u6240\u6709\u6743\u8bbe\u7f6e\u4e3a root:root\uff08\u624b\u52a8\uff09"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1awarn"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u5728 Master \u8282\u70b9\u4e0a\u8fd0\u884c\u4ee5\u4e0b\u547d\u4ee4\uff08\u57fa\u4e8e\u7cfb\u7edf\u4e0a\u7684\u6587\u4ef6\u4f4d\u7f6e\uff09\u3002\n\u4f8b\u5982\uff1achown root:root <path/to/cni/files>"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"stat -c %U:%G <path/to/cni/files>\n")),(0,n.kt)("h3",{id:"1111\u786e\u4fdd-etcd-\u6570\u636e\u76ee\u5f55\u6743\u9650\u8bbe\u7f6e\u4e3a-700-\u6216\u66f4\u4e25\u683c\u7684\u8bbe\u7f6e\u81ea\u52a8"},"1.1.11\u786e\u4fdd etcd \u6570\u636e\u76ee\u5f55\u6743\u9650\u8bbe\u7f6e\u4e3a 700 \u6216\u66f4\u4e25\u683c\u7684\u8bbe\u7f6e\uff08\u81ea\u52a8\uff09"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1apass"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u5728 etcd \u670d\u52a1\u5668\u8282\u70b9\u4e0a\uff0c\u901a\u8fc7\u4ee5\u4e0b\u547d\u4ee4\u83b7\u53d6 etcd \u6570\u636e\u76ee\u5f55\uff08\u4f5c\u4e3a ",(0,n.kt)("inlineCode",{parentName:"p"},"--data-dir")," \u53c2\u6570\u4f20\u9012\uff09\u3002\nps -ef | grep etcd\n\u57fa\u4e8e\u4e0a\u9762\u627e\u5230\u7684 etcd \u6570\u636e\u76ee\u5f55\u8fd0\u884c\u4ee5\u4e0b\u547d\u4ee4\u3002\u4f8b\u5982\uff1achmod 700 /var/lib/etcd"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"stat -c %a /var/lib/rancher/rke2/server/db/etcd\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u9884\u671f\u7ed3\u679c"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},"'permissions' is not present\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u8fd4\u56de\u503c"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},"700\n")),(0,n.kt)("h3",{id:"1112\u786e\u4fdd-etcd-\u6570\u636e\u76ee\u5f55\u6240\u6709\u6743\u8bbe\u7f6e\u4e3a-etcdetcd\u81ea\u52a8"},"1.1.12\u786e\u4fdd etcd \u6570\u636e\u76ee\u5f55\u6240\u6709\u6743\u8bbe\u7f6e\u4e3a etcd:etcd\uff08\u81ea\u52a8\uff09"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1apass"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u5728 etcd \u670d\u52a1\u5668\u8282\u70b9\u4e0a\uff0c\u901a\u8fc7\u4ee5\u4e0b\u547d\u4ee4\u83b7\u53d6 etcd \u6570\u636e\u76ee\u5f55\uff08\u4f5c\u4e3a ",(0,n.kt)("inlineCode",{parentName:"p"},"--data-dir")," \u53c2\u6570\u4f20\u9012\uff09\u3002\nps -ef | grep etcd\n\u57fa\u4e8e\u4e0a\u9762\u627e\u5230\u7684 etcd \u6570\u636e\u76ee\u5f55\u8fd0\u884c\u4ee5\u4e0b\u547d\u4ee4\u3002\n\u4f8b\u5982\uff1achown etcd:etcd /var/lib/etcd"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"stat -c %U:%G /var/lib/rancher/rke2/server/db/etcd\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u9884\u671f\u7ed3\u679c"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},"'etcd:etcd' is present\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u8fd4\u56de\u503c"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},"etcd:etcd\n")),(0,n.kt)("h3",{id:"1113\u786e\u4fdd-adminconf-\u6587\u4ef6\u6743\u9650\u5177\u6709-644-\u6216\u66f4\u4e25\u683c\u7684\u8bbe\u7f6e\u81ea\u52a8"},"1.1.13\u786e\u4fdd admin.conf \u6587\u4ef6\u6743\u9650\u5177\u6709 644 \u6216\u66f4\u4e25\u683c\u7684\u8bbe\u7f6e\uff08\u81ea\u52a8\uff09"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1apass"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u5728 Master \u8282\u70b9\u4e0a\u8fd0\u884c\u4ee5\u4e0b\u547d\u4ee4\uff08\u57fa\u4e8e\u7cfb\u7edf\u4e0a\u7684\u6587\u4ef6\u4f4d\u7f6e\uff09\u3002\n\u4f8b\u5982\uff1achmod 644 /etc/kubernetes/admin.conf"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"stat -c %a /var/lib/rancher/rke2/server/cred/admin.kubeconfig\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u9884\u671f\u7ed3\u679c"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},"'permissions' is not present\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u8fd4\u56de\u503c"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},"644\n")),(0,n.kt)("h3",{id:"1114\u786e\u4fdd-adminconf-\u6587\u4ef6\u6240\u6709\u6743\u8bbe\u7f6e\u4e3a-rootroot\u81ea\u52a8"},"1.1.14\u786e\u4fdd admin.conf \u6587\u4ef6\u6240\u6709\u6743\u8bbe\u7f6e\u4e3a root:root\uff08\u81ea\u52a8\uff09"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1apass"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u5728 Master \u8282\u70b9\u4e0a\u8fd0\u884c\u4ee5\u4e0b\u547d\u4ee4\uff08\u57fa\u4e8e\u7cfb\u7edf\u4e0a\u7684\u6587\u4ef6\u4f4d\u7f6e\uff09\u3002\n\u4f8b\u5982\uff1achown root:root /etc/kubernetes/admin.conf"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"stat -c %U:%G /var/lib/rancher/rke2/server/cred/admin.kubeconfig\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u9884\u671f\u7ed3\u679c"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},"'root:root' is equal to 'root:root'\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u8fd4\u56de\u503c"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},"root:root\n")),(0,n.kt)("h3",{id:"1115\u786e\u4fdd-schedulerconf-\u6587\u4ef6\u6743\u9650\u5177\u6709-644-\u6216\u66f4\u4e25\u683c\u7684\u8bbe\u7f6e\u81ea\u52a8"},"1.1.15\u786e\u4fdd scheduler.conf \u6587\u4ef6\u6743\u9650\u5177\u6709 644 \u6216\u66f4\u4e25\u683c\u7684\u8bbe\u7f6e\uff08\u81ea\u52a8\uff09"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1apass"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u5728 Master \u8282\u70b9\u4e0a\u8fd0\u884c\u4ee5\u4e0b\u547d\u4ee4\uff08\u57fa\u4e8e\u7cfb\u7edf\u4e0a\u7684\u6587\u4ef6\u4f4d\u7f6e\uff09\u3002\n\u4f8b\u5982\uff1achmod 644 scheduler"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"stat -c %a /var/lib/rancher/rke2/server/cred/scheduler.kubeconfig\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u9884\u671f\u7ed3\u679c"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},"'permissions' is not present\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u8fd4\u56de\u503c"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},"644\n")),(0,n.kt)("h3",{id:"1116\u786e\u4fdd-schedulerconf-\u6587\u4ef6\u6240\u6709\u6743\u8bbe\u7f6e\u4e3a-rootroot\u81ea\u52a8"},"1.1.16\u786e\u4fdd scheduler.conf \u6587\u4ef6\u6240\u6709\u6743\u8bbe\u7f6e\u4e3a root:root\uff08\u81ea\u52a8\uff09"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1apass"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u5728 Master \u8282\u70b9\u4e0a\u8fd0\u884c\u4ee5\u4e0b\u547d\u4ee4\uff08\u57fa\u4e8e\u7cfb\u7edf\u4e0a\u7684\u6587\u4ef6\u4f4d\u7f6e\uff09\u3002\n\u4f8b\u5982\uff1achown root:root scheduler"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"stat -c %U:%G /var/lib/rancher/rke2/server/cred/scheduler.kubeconfig\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u9884\u671f\u7ed3\u679c"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},"'root:root' is equal to 'root:root'\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u8fd4\u56de\u503c"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},"root:root\n")),(0,n.kt)("h3",{id:"1117\u786e\u4fdd-controller-managerconf-\u6587\u4ef6\u6743\u9650\u5177\u6709-644-\u6216\u66f4\u4e25\u683c\u7684\u8bbe\u7f6e\u81ea\u52a8"},"1.1.17\u786e\u4fdd controller-manager.conf \u6587\u4ef6\u6743\u9650\u5177\u6709 644 \u6216\u66f4\u4e25\u683c\u7684\u8bbe\u7f6e\uff08\u81ea\u52a8\uff09"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1apass"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u5728 Master \u8282\u70b9\u4e0a\u8fd0\u884c\u4ee5\u4e0b\u547d\u4ee4\uff08\u57fa\u4e8e\u7cfb\u7edf\u4e0a\u7684\u6587\u4ef6\u4f4d\u7f6e\uff09\u3002\n\u4f8b\u5982\uff1achmod 644 controllermanager"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"stat -c %a /var/lib/rancher/rke2/server/cred/controller.kubeconfig\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u9884\u671f\u7ed3\u679c"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},"'permissions' is not present\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u8fd4\u56de\u503c"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},"644\n")),(0,n.kt)("h3",{id:"1118\u786e\u4fdd\u5c06-controller-managerconf-\u6587\u4ef6\u6240\u6709\u6743\u8bbe\u7f6e\u4e3a-rootroot\u81ea\u52a8"},"1.1.18\u786e\u4fdd\u5c06 controller-manager.conf \u6587\u4ef6\u6240\u6709\u6743\u8bbe\u7f6e\u4e3a root:root\uff08\u81ea\u52a8\uff09"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1apass"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u5728 Master \u8282\u70b9\u4e0a\u8fd0\u884c\u4ee5\u4e0b\u547d\u4ee4\uff08\u57fa\u4e8e\u7cfb\u7edf\u4e0a\u7684\u6587\u4ef6\u4f4d\u7f6e\uff09\u3002\n\u4f8b\u5982\uff1achown root:root controllermanager"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"stat -c %U:%G /var/lib/rancher/rke2/server/cred/controller.kubeconfig\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u9884\u671f\u7ed3\u679c"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},"'root:root' is equal to 'root:root'\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u8fd4\u56de\u503c"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},"root:root\n")),(0,n.kt)("h3",{id:"1119\u786e\u4fdd-kubernetes-pki-\u76ee\u5f55\u548c\u6587\u4ef6\u6240\u6709\u6743\u8bbe\u7f6e\u4e3a-rootroot\u81ea\u52a8"},"1.1.19\u786e\u4fdd Kubernetes PKI \u76ee\u5f55\u548c\u6587\u4ef6\u6240\u6709\u6743\u8bbe\u7f6e\u4e3a root:root\uff08\u81ea\u52a8\uff09"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1apass"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u5728 Master \u8282\u70b9\u4e0a\u8fd0\u884c\u4ee5\u4e0b\u547d\u4ee4\uff08\u57fa\u4e8e\u7cfb\u7edf\u4e0a\u7684\u6587\u4ef6\u4f4d\u7f6e\uff09\u3002\n\u4f8b\u5982\uff1achown -R root:root /etc/kubernetes/pki/"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"stat -c %U:%G /var/lib/rancher/rke2/server/tls\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u9884\u671f\u7ed3\u679c"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},"'root:root' is equal to 'root:root'\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u8fd4\u56de\u503c"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},"root:root\n")),(0,n.kt)("h3",{id:"1120\u786e\u4fdd\u5c06-kubernetes-pki-\u8bc1\u4e66\u6587\u4ef6\u6743\u9650\u8bbe\u7f6e\u4e3a-644-\u6216\u66f4\u4e25\u683c\u7684\u8bbe\u7f6e\u624b\u52a8"},"1.1.20\u786e\u4fdd\u5c06 Kubernetes PKI \u8bc1\u4e66\u6587\u4ef6\u6743\u9650\u8bbe\u7f6e\u4e3a 644 \u6216\u66f4\u4e25\u683c\u7684\u8bbe\u7f6e\uff08\u624b\u52a8\uff09"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1awarn"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u5728 Master \u8282\u70b9\u4e0a\u8fd0\u884c\u4ee5\u4e0b\u547d\u4ee4\uff08\u57fa\u4e8e\u7cfb\u7edf\u4e0a\u7684\u6587\u4ef6\u4f4d\u7f6e\uff09\u3002\n\u4f8b\u5982\uff1achmod -R 644 /var/lib/rancher/rke2/server/tls/*.crt"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1\u811a\u672c"),"\uff1a",(0,n.kt)("inlineCode",{parentName:"p"},"check_files_permissions.sh")),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},'#!/usr/bin/env bash\n\n# This script is used to ensure the file permissions are set to 644 or\n# more restrictive for all files in a given directory or a wildcard\n# selection of files\n#\n# inputs:\n#   $1 = /full/path/to/directory or /path/to/fileswithpattern\n#                                   ex: !(*key).pem\n#\n#   $2 (optional) = permission (ex: 600)\n#\n# outputs:\n#   true/false\n\n# Turn on "extended glob" for use of \'!\' in wildcard\nshopt -s extglob\n\n# Turn off history to avoid surprises when using \'!\'\nset -H\n\nUSER_INPUT=$1\n\nif [[ "${USER_INPUT}" == "" ]]; then\n  echo "false"\n  exit\nfi\n\n\nif [[ -d ${USER_INPUT} ]]; then\n  PATTERN="${USER_INPUT}/*"\nelse\n  PATTERN="${USER_INPUT}"\nfi\n\nPERMISSION=""\nif [[ "$2" != "" ]]; then\n  PERMISSION=$2\nfi\n\nFILES_PERMISSIONS=$(stat -c %n\\ %a ${PATTERN})\n\nwhile read -r fileInfo; do\n  p=$(echo ${fileInfo} | cut -d\' \' -f2)\n\n  if [[ "${PERMISSION}" != "" ]]; then\n    if [[ "$p" != "${PERMISSION}" ]]; then\n      echo "false"\n      exit\n    fi\n  else\n    if [[ "$p" != "644" && "$p" != "640" && "$p" != "600" ]]; then\n      echo "false"\n      exit\n    fi\n  fi\ndone <<< "${FILES_PERMISSIONS}"\n\n\necho "true"\nexit\n\n')),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1\u6267\u884c"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"./check_files_permissions.sh /var/lib/rancher/rke2/server/tls/*.crt\n")),(0,n.kt)("h3",{id:"1121\u786e\u4fdd-kubernetes-pki-\u5bc6\u94a5\u6587\u4ef6\u6743\u9650\u8bbe\u7f6e\u4e3a-600\u624b\u52a8"},"1.1.21\u786e\u4fdd Kubernetes PKI \u5bc6\u94a5\u6587\u4ef6\u6743\u9650\u8bbe\u7f6e\u4e3a 600\uff08\u624b\u52a8\uff09"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1apass"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u5728 Master \u8282\u70b9\u4e0a\u8fd0\u884c\u4ee5\u4e0b\u547d\u4ee4\uff08\u57fa\u4e8e\u7cfb\u7edf\u4e0a\u7684\u6587\u4ef6\u4f4d\u7f6e\uff09\u3002\n\u4f8b\u5982\uff1achmod -R 600 /etc/kubernetes/pki/*.key"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1\u811a\u672c"),"\uff1a",(0,n.kt)("inlineCode",{parentName:"p"},"check_files_permissions.sh")),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},'#!/usr/bin/env bash\n\n# This script is used to ensure the file permissions are set to 644 or\n# more restrictive for all files in a given directory or a wildcard\n# selection of files\n#\n# inputs:\n#   $1 = /full/path/to/directory or /path/to/fileswithpattern\n#                                   ex: !(*key).pem\n#\n#   $2 (optional) = permission (ex: 600)\n#\n# outputs:\n#   true/false\n\n# Turn on "extended glob" for use of \'!\' in wildcard\nshopt -s extglob\n\n# Turn off history to avoid surprises when using \'!\'\nset -H\n\nUSER_INPUT=$1\n\nif [[ "${USER_INPUT}" == "" ]]; then\n  echo "false"\n  exit\nfi\n\n\nif [[ -d ${USER_INPUT} ]]; then\n  PATTERN="${USER_INPUT}/*"\nelse\n  PATTERN="${USER_INPUT}"\nfi\n\nPERMISSION=""\nif [[ "$2" != "" ]]; then\n  PERMISSION=$2\nfi\n\nFILES_PERMISSIONS=$(stat -c %n\\ %a ${PATTERN})\n\nwhile read -r fileInfo; do\n  p=$(echo ${fileInfo} | cut -d\' \' -f2)\n\n  if [[ "${PERMISSION}" != "" ]]; then\n    if [[ "$p" != "${PERMISSION}" ]]; then\n      echo "false"\n      exit\n    fi\n  else\n    if [[ "$p" != "644" && "$p" != "640" && "$p" != "600" ]]; then\n      echo "false"\n      exit\n    fi\n  fi\ndone <<< "${FILES_PERMISSIONS}"\n\n\necho "true"\nexit\n\n')),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1\u6267\u884c"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"./check_files_permissions.sh /var/lib/rancher/rke2/server/tls/*.key\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u9884\u671f\u7ed3\u679c"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},"'permissions' is not present\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u8fd4\u56de\u503c"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},"true\n")),(0,n.kt)("h2",{id:"12api-server"},"1.2API Server"),(0,n.kt)("h3",{id:"121\u786e\u4fdd---anonymous-auth-\u53c2\u6570\u8bbe\u7f6e\u4e3a-false\u624b\u52a8"},"1.2.1\u786e\u4fdd --anonymous-auth \u53c2\u6570\u8bbe\u7f6e\u4e3a false\uff08\u624b\u52a8\uff09"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1awarn"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u5728 Master \u8282\u70b9\u4e0a\u7f16\u8f91 API Server pod \u89c4\u8303\u6587\u4ef6 /var/lib/rancher/rke2/agent/pod-manifests/kube-apiserver.yaml \u5e76\u8bbe\u7f6e\u4ee5\u4e0b\u53c2\u6570\u3002\n--anonymous-auth=false"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"/bin/ps -ef | grep kube-apiserver | grep -v grep\n")),(0,n.kt)("h3",{id:"122\u786e\u4fdd\u672a\u8bbe\u7f6e---basic-auth-file-\u53c2\u6570\u81ea\u52a8"},"1.2.2\u786e\u4fdd\u672a\u8bbe\u7f6e --basic-auth-file \u53c2\u6570\uff08\u81ea\u52a8\uff09"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1apass"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u9075\u5faa\u6587\u6863\u5e76\u914d\u7f6e\u8eab\u4efd\u9a8c\u8bc1\u7684\u66ff\u4ee3\u673a\u5236\u3002\u7136\u540e\uff0c\u5728 Master \u8282\u70b9\u4e0a\u7f16\u8f91 API Server pod \u89c4\u8303\u6587\u4ef6 /var/lib/rancher/rke2/agent/pod-manifests/kube-apiserver.yaml \u5e76\u79fb\u9664 ",(0,n.kt)("inlineCode",{parentName:"p"},"--basic-auth-file=<filename>")," \u53c2\u6570\u3002"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"/bin/ps -ef | grep kube-apiserver | grep -v grep\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u9884\u671f\u7ed3\u679c"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},"'--basic-auth-file' is not present\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u8fd4\u56de\u503c"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},"root 5275 5222 15 14:58 ?00:01:26 kube-apiserver --audit-policy-file=/etc/rancher/rke2/audit-policy.yaml --audit-log-path=/var/lib/rancher/rke2/server/logs/audit.log --audit-log-maxage=30 --audit-log-maxbackup=10 --audit-log-maxsize=100 --kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname --allow-privileged=true --anonymous-auth=false --api-audiences=https://kubernetes.default.svc.cluster.local,rke2 --authorization-mode=Node,RBAC --bind-address=0.0.0.0 --cert-dir=/var/lib/rancher/rke2/server/tls/temporary-certs --client-ca-file=/var/lib/rancher/rke2/server/tls/client-ca.crt --enable-admission-plugins=NodeRestriction,PodSecurityPolicy --encryption-provider-config=/var/lib/rancher/rke2/server/cred/encryption-config.json --etcd-cafile=/var/lib/rancher/rke2/server/tls/etcd/server-ca.crt --etcd-certfile=/var/lib/rancher/rke2/server/tls/etcd/client.crt --etcd-keyfile=/var/lib/rancher/rke2/server/tls/etcd/client.key --etcd-servers=https://127.0.0.1:2379 --insecure-port=0 --kubelet-certificate-authority=/var/lib/rancher/rke2/server/tls/server-ca.crt --kubelet-client-certificate=/var/lib/rancher/rke2/server/tls/client-kube-apiserver.crt --kubelet-client-key=/var/lib/rancher/rke2/server/tls/client-kube-apiserver.key --profiling=false --proxy-client-cert-file=/var/lib/rancher/rke2/server/tls/client-auth-proxy.crt --proxy-client-key-file=/var/lib/rancher/rke2/server/tls/client-auth-proxy.key --requestheader-allowed-names=system:auth-proxy --requestheader-client-ca-file=/var/lib/rancher/rke2/server/tls/request-header-ca.crt --requestheader-extra-headers-prefix=X-Remote-Extra- --requestheader-group-headers=X-Remote-Group --requestheader-username-headers=X-Remote-User --secure-port=6443 --service-account-issuer=https://kubernetes.default.svc.cluster.local --service-account-key-file=/var/lib/rancher/rke2/server/tls/service.key --service-account-signing-key-file=/var/lib/rancher/rke2/server/tls/service.key --service-cluster-ip-range=10.43.0.0/16 --service-node-port-range=30000-32767 --storage-backend=etcd3 --tls-cert-file=/var/lib/rancher/rke2/server/tls/serving-kube-apiserver.crt --tls-private-key-file=/var/lib/rancher/rke2/server/tls/serving-kube-apiserver.key root 5522 5416 3 14:58 ?00:00:16 kube-controller-manager --flex-volume-plugin-dir=/var/lib/kubelet/volumeplugins --terminated-pod-gc-threshold=1000 --permit-port-sharing=true --address=127.0.0.1 --allocate-node-cidrs=true --bind-address=127.0.0.1 --cert-dir=/var/lib/rancher/rke2/server/tls/kube-controller-manager --cluster-cidr=10.42.0.0/16 --cluster-signing-kube-apiserver-client-cert-file=/var/lib/rancher/rke2/server/tls/client-ca.crt --cluster-signing-kube-apiserver-client-key-file=/var/lib/rancher/rke2/server/tls/client-ca.key --cluster-signing-kubelet-client-cert-file=/var/lib/rancher/rke2/server/tls/client-ca.crt --cluster-signing-kubelet-client-key-file=/var/lib/rancher/rke2/server/tls/client-ca.key --cluster-signing-kubelet-serving-cert-file=/var/lib/rancher/rke2/server/tls/server-ca.crt --cluster-signing-kubelet-serving-key-file=/var/lib/rancher/rke2/server/tls/server-ca.key --cluster-signing-legacy-unknown-cert-file=/var/lib/rancher/rke2/server/tls/client-ca.crt --cluster-signing-legacy-unknown-key-file=/var/lib/rancher/rke2/server/tls/client-ca.key --configure-cloud-routes=false --controllers=*,-service,-route,-cloud-node-lifecycle --kubeconfig=/var/lib/rancher/rke2/server/cred/controller.kubeconfig --port=10252 --profiling=false --root-ca-file=/var/lib/rancher/rke2/server/tls/server-ca.crt --secure-port=10257 --service-account-private-key-file=/var/lib/rancher/rke2/server/tls/service.key --use-service-account-credentials=true\n")),(0,n.kt)("h3",{id:"123\u786e\u4fdd\u672a\u8bbe\u7f6e---token-auth-file-\u53c2\u6570\u81ea\u52a8"},"1.2.3\u786e\u4fdd\u672a\u8bbe\u7f6e --token-auth-file \u53c2\u6570\uff08\u81ea\u52a8\uff09"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1apass"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u9075\u5faa\u6587\u6863\u5e76\u914d\u7f6e\u8eab\u4efd\u9a8c\u8bc1\u7684\u66ff\u4ee3\u673a\u5236\u3002\u7136\u540e\uff0c\u5728 Master \u8282\u70b9\u4e0a\u7f16\u8f91 API Server pod \u89c4\u8303\u6587\u4ef6 /var/lib/rancher/rke2/agent/pod-manifests/kube-apiserver.yaml \u5e76\u79fb\u9664 ",(0,n.kt)("inlineCode",{parentName:"p"},"--token-auth-file=<filename>")," \u53c2\u6570\u3002"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"/bin/ps -ef | grep kube-apiserver | grep -v grep\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u9884\u671f\u7ed3\u679c"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},"'--token-auth-file' is not present\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u8fd4\u56de\u503c"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},"root 5275 5222 15 14:58 ?00:01:26 kube-apiserver --audit-policy-file=/etc/rancher/rke2/audit-policy.yaml --audit-log-path=/var/lib/rancher/rke2/server/logs/audit.log --audit-log-maxage=30 --audit-log-maxbackup=10 --audit-log-maxsize=100 --kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname --allow-privileged=true --anonymous-auth=false --api-audiences=https://kubernetes.default.svc.cluster.local,rke2 --authorization-mode=Node,RBAC --bind-address=0.0.0.0 --cert-dir=/var/lib/rancher/rke2/server/tls/temporary-certs --client-ca-file=/var/lib/rancher/rke2/server/tls/client-ca.crt --enable-admission-plugins=NodeRestriction,PodSecurityPolicy --encryption-provider-config=/var/lib/rancher/rke2/server/cred/encryption-config.json --etcd-cafile=/var/lib/rancher/rke2/server/tls/etcd/server-ca.crt --etcd-certfile=/var/lib/rancher/rke2/server/tls/etcd/client.crt --etcd-keyfile=/var/lib/rancher/rke2/server/tls/etcd/client.key --etcd-servers=https://127.0.0.1:2379 --insecure-port=0 --kubelet-certificate-authority=/var/lib/rancher/rke2/server/tls/server-ca.crt --kubelet-client-certificate=/var/lib/rancher/rke2/server/tls/client-kube-apiserver.crt --kubelet-client-key=/var/lib/rancher/rke2/server/tls/client-kube-apiserver.key --profiling=false --proxy-client-cert-file=/var/lib/rancher/rke2/server/tls/client-auth-proxy.crt --proxy-client-key-file=/var/lib/rancher/rke2/server/tls/client-auth-proxy.key --requestheader-allowed-names=system:auth-proxy --requestheader-client-ca-file=/var/lib/rancher/rke2/server/tls/request-header-ca.crt --requestheader-extra-headers-prefix=X-Remote-Extra- --requestheader-group-headers=X-Remote-Group --requestheader-username-headers=X-Remote-User --secure-port=6443 --service-account-issuer=https://kubernetes.default.svc.cluster.local --service-account-key-file=/var/lib/rancher/rke2/server/tls/service.key --service-account-signing-key-file=/var/lib/rancher/rke2/server/tls/service.key --service-cluster-ip-range=10.43.0.0/16 --service-node-port-range=30000-32767 --storage-backend=etcd3 --tls-cert-file=/var/lib/rancher/rke2/server/tls/serving-kube-apiserver.crt --tls-private-key-file=/var/lib/rancher/rke2/server/tls/serving-kube-apiserver.key root 5522 5416 3 14:58 ?00:00:16 kube-controller-manager --flex-volume-plugin-dir=/var/lib/kubelet/volumeplugins --terminated-pod-gc-threshold=1000 --permit-port-sharing=true --address=127.0.0.1 --allocate-node-cidrs=true --bind-address=127.0.0.1 --cert-dir=/var/lib/rancher/rke2/server/tls/kube-controller-manager --cluster-cidr=10.42.0.0/16 --cluster-signing-kube-apiserver-client-cert-file=/var/lib/rancher/rke2/server/tls/client-ca.crt --cluster-signing-kube-apiserver-client-key-file=/var/lib/rancher/rke2/server/tls/client-ca.key --cluster-signing-kubelet-client-cert-file=/var/lib/rancher/rke2/server/tls/client-ca.crt --cluster-signing-kubelet-client-key-file=/var/lib/rancher/rke2/server/tls/client-ca.key --cluster-signing-kubelet-serving-cert-file=/var/lib/rancher/rke2/server/tls/server-ca.crt --cluster-signing-kubelet-serving-key-file=/var/lib/rancher/rke2/server/tls/server-ca.key --cluster-signing-legacy-unknown-cert-file=/var/lib/rancher/rke2/server/tls/client-ca.crt --cluster-signing-legacy-unknown-key-file=/var/lib/rancher/rke2/server/tls/client-ca.key --configure-cloud-routes=false --controllers=*,-service,-route,-cloud-node-lifecycle --kubeconfig=/var/lib/rancher/rke2/server/cred/controller.kubeconfig --port=10252 --profiling=false --root-ca-file=/var/lib/rancher/rke2/server/tls/server-ca.crt --secure-port=10257 --service-account-private-key-file=/var/lib/rancher/rke2/server/tls/service.key --use-service-account-credentials=true\n")),(0,n.kt)("h3",{id:"124\u786e\u4fdd---kubelet-https-\u53c2\u6570\u8bbe\u7f6e\u4e3a-true\u81ea\u52a8"},"1.2.4\u786e\u4fdd --kubelet-https \u53c2\u6570\u8bbe\u7f6e\u4e3a true\uff08\u81ea\u52a8\uff09"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1apass"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u5728 Master \u8282\u70b9\u4e0a\u7f16\u8f91 API Server pod \u89c4\u8303\u6587\u4ef6 /var/lib/rancher/rke2/agent/pod-manifests/kube-apiserver.yaml \u5e76\u79fb\u9664 ",(0,n.kt)("inlineCode",{parentName:"p"},"--kubelet-https")," \u53c2\u6570\u3002"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"/bin/ps -ef | grep kube-apiserver | grep -v grep\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u9884\u671f\u7ed3\u679c"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},"'--kubelet-https' is not present OR '--kubelet-https' is not present\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u8fd4\u56de\u503c"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},"root 5275 5222 15 14:58 ?00:01:26 kube-apiserver --audit-policy-file=/etc/rancher/rke2/audit-policy.yaml --audit-log-path=/var/lib/rancher/rke2/server/logs/audit.log --audit-log-maxage=30 --audit-log-maxbackup=10 --audit-log-maxsize=100 --kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname --allow-privileged=true --anonymous-auth=false --api-audiences=https://kubernetes.default.svc.cluster.local,rke2 --authorization-mode=Node,RBAC --bind-address=0.0.0.0 --cert-dir=/var/lib/rancher/rke2/server/tls/temporary-certs --client-ca-file=/var/lib/rancher/rke2/server/tls/client-ca.crt --enable-admission-plugins=NodeRestriction,PodSecurityPolicy --encryption-provider-config=/var/lib/rancher/rke2/server/cred/encryption-config.json --etcd-cafile=/var/lib/rancher/rke2/server/tls/etcd/server-ca.crt --etcd-certfile=/var/lib/rancher/rke2/server/tls/etcd/client.crt --etcd-keyfile=/var/lib/rancher/rke2/server/tls/etcd/client.key --etcd-servers=https://127.0.0.1:2379 --insecure-port=0 --kubelet-certificate-authority=/var/lib/rancher/rke2/server/tls/server-ca.crt --kubelet-client-certificate=/var/lib/rancher/rke2/server/tls/client-kube-apiserver.crt --kubelet-client-key=/var/lib/rancher/rke2/server/tls/client-kube-apiserver.key --profiling=false --proxy-client-cert-file=/var/lib/rancher/rke2/server/tls/client-auth-proxy.crt --proxy-client-key-file=/var/lib/rancher/rke2/server/tls/client-auth-proxy.key --requestheader-allowed-names=system:auth-proxy --requestheader-client-ca-file=/var/lib/rancher/rke2/server/tls/request-header-ca.crt --requestheader-extra-headers-prefix=X-Remote-Extra- --requestheader-group-headers=X-Remote-Group --requestheader-username-headers=X-Remote-User --secure-port=6443 --service-account-issuer=https://kubernetes.default.svc.cluster.local --service-account-key-file=/var/lib/rancher/rke2/server/tls/service.key --service-account-signing-key-file=/var/lib/rancher/rke2/server/tls/service.key --service-cluster-ip-range=10.43.0.0/16 --service-node-port-range=30000-32767 --storage-backend=etcd3 --tls-cert-file=/var/lib/rancher/rke2/server/tls/serving-kube-apiserver.crt --tls-private-key-file=/var/lib/rancher/rke2/server/tls/serving-kube-apiserver.key root 5522 5416 3 14:58 ?00:00:16 kube-controller-manager --flex-volume-plugin-dir=/var/lib/kubelet/volumeplugins --terminated-pod-gc-threshold=1000 --permit-port-sharing=true --address=127.0.0.1 --allocate-node-cidrs=true --bind-address=127.0.0.1 --cert-dir=/var/lib/rancher/rke2/server/tls/kube-controller-manager --cluster-cidr=10.42.0.0/16 --cluster-signing-kube-apiserver-client-cert-file=/var/lib/rancher/rke2/server/tls/client-ca.crt --cluster-signing-kube-apiserver-client-key-file=/var/lib/rancher/rke2/server/tls/client-ca.key --cluster-signing-kubelet-client-cert-file=/var/lib/rancher/rke2/server/tls/client-ca.crt --cluster-signing-kubelet-client-key-file=/var/lib/rancher/rke2/server/tls/client-ca.key --cluster-signing-kubelet-serving-cert-file=/var/lib/rancher/rke2/server/tls/server-ca.crt --cluster-signing-kubelet-serving-key-file=/var/lib/rancher/rke2/server/tls/server-ca.key --cluster-signing-legacy-unknown-cert-file=/var/lib/rancher/rke2/server/tls/client-ca.crt --cluster-signing-legacy-unknown-key-file=/var/lib/rancher/rke2/server/tls/client-ca.key --configure-cloud-routes=false --controllers=*,-service,-route,-cloud-node-lifecycle --kubeconfig=/var/lib/rancher/rke2/server/cred/controller.kubeconfig --port=10252 --profiling=false --root-ca-file=/var/lib/rancher/rke2/server/tls/server-ca.crt --secure-port=10257 --service-account-private-key-file=/var/lib/rancher/rke2/server/tls/service.key --use-service-account-credentials=true\n")),(0,n.kt)("h3",{id:"125\u786e\u4fdd\u6b63\u786e\u8bbe\u7f6e\u4e86---kubelet-client-certificate-\u548c---kubelet-client-key-\u53c2\u6570\u81ea\u52a8"},"1.2.5\u786e\u4fdd\u6b63\u786e\u8bbe\u7f6e\u4e86 --kubelet-client-certificate \u548c --kubelet-client-key \u53c2\u6570\uff08\u81ea\u52a8\uff09"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1apass"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u9075\u5faa Kubernetes \u6587\u6863\u8bbe\u7f6e apiserver \u548c kubelets \u7684 TLS \u8fde\u63a5\u3002\u7136\u540e\uff0c\u5728 Master \u8282\u70b9\u4e0a\u7f16\u8f91 API Server pod \u89c4\u8303\u6587\u4ef6 /var/lib/rancher/rke2/agent/pod-manifests/kube-apiserver.yaml\uff0c\u5e76\u8bbe\u7f6e\u4ee5\u4e0b kubelet \u5ba2\u6237\u7aef\u8bc1\u4e66\u548c\u5bc6\u94a5\u53c2\u6570\u3002\n--kubelet-client-certificate=<path/to/client-certificate-file>\n--kubelet-client-key=<path/to/client-key-file>"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"/bin/ps -ef | grep kube-apiserver | grep -v grep\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u9884\u671f\u7ed3\u679c"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},"'--kubelet-client-certificate' is present AND '--kubelet-client-key' is present\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u8fd4\u56de\u503c"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},"root 5275 5222 15 14:58 ?00:01:26 kube-apiserver --audit-policy-file=/etc/rancher/rke2/audit-policy.yaml --audit-log-path=/var/lib/rancher/rke2/server/logs/audit.log --audit-log-maxage=30 --audit-log-maxbackup=10 --audit-log-maxsize=100 --kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname --allow-privileged=true --anonymous-auth=false --api-audiences=https://kubernetes.default.svc.cluster.local,rke2 --authorization-mode=Node,RBAC --bind-address=0.0.0.0 --cert-dir=/var/lib/rancher/rke2/server/tls/temporary-certs --client-ca-file=/var/lib/rancher/rke2/server/tls/client-ca.crt --enable-admission-plugins=NodeRestriction,PodSecurityPolicy --encryption-provider-config=/var/lib/rancher/rke2/server/cred/encryption-config.json --etcd-cafile=/var/lib/rancher/rke2/server/tls/etcd/server-ca.crt --etcd-certfile=/var/lib/rancher/rke2/server/tls/etcd/client.crt --etcd-keyfile=/var/lib/rancher/rke2/server/tls/etcd/client.key --etcd-servers=https://127.0.0.1:2379 --insecure-port=0 --kubelet-certificate-authority=/var/lib/rancher/rke2/server/tls/server-ca.crt --kubelet-client-certificate=/var/lib/rancher/rke2/server/tls/client-kube-apiserver.crt --kubelet-client-key=/var/lib/rancher/rke2/server/tls/client-kube-apiserver.key --profiling=false --proxy-client-cert-file=/var/lib/rancher/rke2/server/tls/client-auth-proxy.crt --proxy-client-key-file=/var/lib/rancher/rke2/server/tls/client-auth-proxy.key --requestheader-allowed-names=system:auth-proxy --requestheader-client-ca-file=/var/lib/rancher/rke2/server/tls/request-header-ca.crt --requestheader-extra-headers-prefix=X-Remote-Extra- --requestheader-group-headers=X-Remote-Group --requestheader-username-headers=X-Remote-User --secure-port=6443 --service-account-issuer=https://kubernetes.default.svc.cluster.local --service-account-key-file=/var/lib/rancher/rke2/server/tls/service.key --service-account-signing-key-file=/var/lib/rancher/rke2/server/tls/service.key --service-cluster-ip-range=10.43.0.0/16 --service-node-port-range=30000-32767 --storage-backend=etcd3 --tls-cert-file=/var/lib/rancher/rke2/server/tls/serving-kube-apiserver.crt --tls-private-key-file=/var/lib/rancher/rke2/server/tls/serving-kube-apiserver.key root 5522 5416 3 14:58 ?00:00:16 kube-controller-manager --flex-volume-plugin-dir=/var/lib/kubelet/volumeplugins --terminated-pod-gc-threshold=1000 --permit-port-sharing=true --address=127.0.0.1 --allocate-node-cidrs=true --bind-address=127.0.0.1 --cert-dir=/var/lib/rancher/rke2/server/tls/kube-controller-manager --cluster-cidr=10.42.0.0/16 --cluster-signing-kube-apiserver-client-cert-file=/var/lib/rancher/rke2/server/tls/client-ca.crt --cluster-signing-kube-apiserver-client-key-file=/var/lib/rancher/rke2/server/tls/client-ca.key --cluster-signing-kubelet-client-cert-file=/var/lib/rancher/rke2/server/tls/client-ca.crt --cluster-signing-kubelet-client-key-file=/var/lib/rancher/rke2/server/tls/client-ca.key --cluster-signing-kubelet-serving-cert-file=/var/lib/rancher/rke2/server/tls/server-ca.crt --cluster-signing-kubelet-serving-key-file=/var/lib/rancher/rke2/server/tls/server-ca.key --cluster-signing-legacy-unknown-cert-file=/var/lib/rancher/rke2/server/tls/client-ca.crt --cluster-signing-legacy-unknown-key-file=/var/lib/rancher/rke2/server/tls/client-ca.key --configure-cloud-routes=false --controllers=*,-service,-route,-cloud-node-lifecycle --kubeconfig=/var/lib/rancher/rke2/server/cred/controller.kubeconfig --port=10252 --profiling=false --root-ca-file=/var/lib/rancher/rke2/server/tls/server-ca.crt --secure-port=10257 --service-account-private-key-file=/var/lib/rancher/rke2/server/tls/service.key --use-service-account-credentials=true\n")),(0,n.kt)("h3",{id:"126\u786e\u4fdd\u6839\u636e\u9700\u8981\u8bbe\u7f6e---kubelet-certificate-authority-\u53c2\u6570\u81ea\u52a8"},"1.2.6\u786e\u4fdd\u6839\u636e\u9700\u8981\u8bbe\u7f6e --kubelet-certificate-authority \u53c2\u6570\uff08\u81ea\u52a8\uff09"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1apass"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u9075\u5faa Kubernetes \u6587\u6863\u8bbe\u7f6e apiserver \u548c kubelets \u7684 TLS \u8fde\u63a5\u3002\u7136\u540e\uff0c\u5728 Master \u8282\u70b9\u4e0a\u7f16\u8f91 API Server pod \u89c4\u8303\u6587\u4ef6 /var/lib/rancher/rke2/agent/pod-manifests/kube-apiserver.yaml\uff0c\u5e76\u5c06 ",(0,n.kt)("inlineCode",{parentName:"p"},"--kubelet-certificate-authority")," \u53c2\u6570\u8bbe\u7f6e\u4e3a CA \u8bc1\u4e66\u6587\u4ef6\u7684\u8def\u5f84\u3002\n",(0,n.kt)("inlineCode",{parentName:"p"},"--kubelet-certificate-authority=<ca-string>")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"/bin/ps -ef | grep kube-apiserver | grep -v grep\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u9884\u671f\u7ed3\u679c"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},"'--kubelet-certificate-authority' is present\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u8fd4\u56de\u503c"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},"root 5275 5222 15 14:58 ?00:01:26 kube-apiserver --audit-policy-file=/etc/rancher/rke2/audit-policy.yaml --audit-log-path=/var/lib/rancher/rke2/server/logs/audit.log --audit-log-maxage=30 --audit-log-maxbackup=10 --audit-log-maxsize=100 --kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname --allow-privileged=true --anonymous-auth=false --api-audiences=https://kubernetes.default.svc.cluster.local,rke2 --authorization-mode=Node,RBAC --bind-address=0.0.0.0 --cert-dir=/var/lib/rancher/rke2/server/tls/temporary-certs --client-ca-file=/var/lib/rancher/rke2/server/tls/client-ca.crt --enable-admission-plugins=NodeRestriction,PodSecurityPolicy --encryption-provider-config=/var/lib/rancher/rke2/server/cred/encryption-config.json --etcd-cafile=/var/lib/rancher/rke2/server/tls/etcd/server-ca.crt --etcd-certfile=/var/lib/rancher/rke2/server/tls/etcd/client.crt --etcd-keyfile=/var/lib/rancher/rke2/server/tls/etcd/client.key --etcd-servers=https://127.0.0.1:2379 --insecure-port=0 --kubelet-certificate-authority=/var/lib/rancher/rke2/server/tls/server-ca.crt --kubelet-client-certificate=/var/lib/rancher/rke2/server/tls/client-kube-apiserver.crt --kubelet-client-key=/var/lib/rancher/rke2/server/tls/client-kube-apiserver.key --profiling=false --proxy-client-cert-file=/var/lib/rancher/rke2/server/tls/client-auth-proxy.crt --proxy-client-key-file=/var/lib/rancher/rke2/server/tls/client-auth-proxy.key --requestheader-allowed-names=system:auth-proxy --requestheader-client-ca-file=/var/lib/rancher/rke2/server/tls/request-header-ca.crt --requestheader-extra-headers-prefix=X-Remote-Extra- --requestheader-group-headers=X-Remote-Group --requestheader-username-headers=X-Remote-User --secure-port=6443 --service-account-issuer=https://kubernetes.default.svc.cluster.local --service-account-key-file=/var/lib/rancher/rke2/server/tls/service.key --service-account-signing-key-file=/var/lib/rancher/rke2/server/tls/service.key --service-cluster-ip-range=10.43.0.0/16 --service-node-port-range=30000-32767 --storage-backend=etcd3 --tls-cert-file=/var/lib/rancher/rke2/server/tls/serving-kube-apiserver.crt --tls-private-key-file=/var/lib/rancher/rke2/server/tls/serving-kube-apiserver.key root 5522 5416 3 14:58 ?00:00:16 kube-controller-manager --flex-volume-plugin-dir=/var/lib/kubelet/volumeplugins --terminated-pod-gc-threshold=1000 --permit-port-sharing=true --address=127.0.0.1 --allocate-node-cidrs=true --bind-address=127.0.0.1 --cert-dir=/var/lib/rancher/rke2/server/tls/kube-controller-manager --cluster-cidr=10.42.0.0/16 --cluster-signing-kube-apiserver-client-cert-file=/var/lib/rancher/rke2/server/tls/client-ca.crt --cluster-signing-kube-apiserver-client-key-file=/var/lib/rancher/rke2/server/tls/client-ca.key --cluster-signing-kubelet-client-cert-file=/var/lib/rancher/rke2/server/tls/client-ca.crt --cluster-signing-kubelet-client-key-file=/var/lib/rancher/rke2/server/tls/client-ca.key --cluster-signing-kubelet-serving-cert-file=/var/lib/rancher/rke2/server/tls/server-ca.crt --cluster-signing-kubelet-serving-key-file=/var/lib/rancher/rke2/server/tls/server-ca.key --cluster-signing-legacy-unknown-cert-file=/var/lib/rancher/rke2/server/tls/client-ca.crt --cluster-signing-legacy-unknown-key-file=/var/lib/rancher/rke2/server/tls/client-ca.key --configure-cloud-routes=false --controllers=*,-service,-route,-cloud-node-lifecycle --kubeconfig=/var/lib/rancher/rke2/server/cred/controller.kubeconfig --port=10252 --profiling=false --root-ca-file=/var/lib/rancher/rke2/server/tls/server-ca.crt --secure-port=10257 --service-account-private-key-file=/var/lib/rancher/rke2/server/tls/service.key --use-service-account-credentials=true\n")),(0,n.kt)("h3",{id:"127\u786e\u4fdd---authorization-mode-\u53c2\u6570\u672a\u8bbe\u7f6e\u4e3a-alwaysallow\u81ea\u52a8"},"1.2.7\u786e\u4fdd --authorization-mode \u53c2\u6570\u672a\u8bbe\u7f6e\u4e3a AlwaysAllow\uff08\u81ea\u52a8\uff09"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1apass"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u5728 Master \u8282\u70b9\u4e0a\u7f16\u8f91 API Server pod \u89c4\u8303\u6587\u4ef6 /var/lib/rancher/rke2/agent/pod-manifests/kube-apiserver.yaml\uff0c\u5e76\u5c06 ",(0,n.kt)("inlineCode",{parentName:"p"},"--authorization-mode")," \u53c2\u6570\u8bbe\u7f6e\u4e3a ",(0,n.kt)("inlineCode",{parentName:"p"},"AlwaysAllow")," \u4ee5\u5916\u7684\u503c\u3002\n\u793a\u4f8b\u5982\u4e0b\u3002\n--authorization-mode=RBAC"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"/bin/ps -ef | grep kube-apiserver | grep -v grep\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u9884\u671f\u7ed3\u679c"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},"'Node,RBAC' not have 'AlwaysAllow'\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u8fd4\u56de\u503c"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},"root 5275 5222 15 14:58 ?00:01:26 kube-apiserver --audit-policy-file=/etc/rancher/rke2/audit-policy.yaml --audit-log-path=/var/lib/rancher/rke2/server/logs/audit.log --audit-log-maxage=30 --audit-log-maxbackup=10 --audit-log-maxsize=100 --kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname --allow-privileged=true --anonymous-auth=false --api-audiences=https://kubernetes.default.svc.cluster.local,rke2 --authorization-mode=Node,RBAC --bind-address=0.0.0.0 --cert-dir=/var/lib/rancher/rke2/server/tls/temporary-certs --client-ca-file=/var/lib/rancher/rke2/server/tls/client-ca.crt --enable-admission-plugins=NodeRestriction,PodSecurityPolicy --encryption-provider-config=/var/lib/rancher/rke2/server/cred/encryption-config.json --etcd-cafile=/var/lib/rancher/rke2/server/tls/etcd/server-ca.crt --etcd-certfile=/var/lib/rancher/rke2/server/tls/etcd/client.crt --etcd-keyfile=/var/lib/rancher/rke2/server/tls/etcd/client.key --etcd-servers=https://127.0.0.1:2379 --insecure-port=0 --kubelet-certificate-authority=/var/lib/rancher/rke2/server/tls/server-ca.crt --kubelet-client-certificate=/var/lib/rancher/rke2/server/tls/client-kube-apiserver.crt --kubelet-client-key=/var/lib/rancher/rke2/server/tls/client-kube-apiserver.key --profiling=false --proxy-client-cert-file=/var/lib/rancher/rke2/server/tls/client-auth-proxy.crt --proxy-client-key-file=/var/lib/rancher/rke2/server/tls/client-auth-proxy.key --requestheader-allowed-names=system:auth-proxy --requestheader-client-ca-file=/var/lib/rancher/rke2/server/tls/request-header-ca.crt --requestheader-extra-headers-prefix=X-Remote-Extra- --requestheader-group-headers=X-Remote-Group --requestheader-username-headers=X-Remote-User --secure-port=6443 --service-account-issuer=https://kubernetes.default.svc.cluster.local --service-account-key-file=/var/lib/rancher/rke2/server/tls/service.key --service-account-signing-key-file=/var/lib/rancher/rke2/server/tls/service.key --service-cluster-ip-range=10.43.0.0/16 --service-node-port-range=30000-32767 --storage-backend=etcd3 --tls-cert-file=/var/lib/rancher/rke2/server/tls/serving-kube-apiserver.crt --tls-private-key-file=/var/lib/rancher/rke2/server/tls/serving-kube-apiserver.key root 5522 5416 3 14:58 ?00:00:16 kube-controller-manager --flex-volume-plugin-dir=/var/lib/kubelet/volumeplugins --terminated-pod-gc-threshold=1000 --permit-port-sharing=true --address=127.0.0.1 --allocate-node-cidrs=true --bind-address=127.0.0.1 --cert-dir=/var/lib/rancher/rke2/server/tls/kube-controller-manager --cluster-cidr=10.42.0.0/16 --cluster-signing-kube-apiserver-client-cert-file=/var/lib/rancher/rke2/server/tls/client-ca.crt --cluster-signing-kube-apiserver-client-key-file=/var/lib/rancher/rke2/server/tls/client-ca.key --cluster-signing-kubelet-client-cert-file=/var/lib/rancher/rke2/server/tls/client-ca.crt --cluster-signing-kubelet-client-key-file=/var/lib/rancher/rke2/server/tls/client-ca.key --cluster-signing-kubelet-serving-cert-file=/var/lib/rancher/rke2/server/tls/server-ca.crt --cluster-signing-kubelet-serving-key-file=/var/lib/rancher/rke2/server/tls/server-ca.key --cluster-signing-legacy-unknown-cert-file=/var/lib/rancher/rke2/server/tls/client-ca.crt --cluster-signing-legacy-unknown-key-file=/var/lib/rancher/rke2/server/tls/client-ca.key --configure-cloud-routes=false --controllers=*,-service,-route,-cloud-node-lifecycle --kubeconfig=/var/lib/rancher/rke2/server/cred/controller.kubeconfig --port=10252 --profiling=false --root-ca-file=/var/lib/rancher/rke2/server/tls/server-ca.crt --secure-port=10257 --service-account-private-key-file=/var/lib/rancher/rke2/server/tls/service.key --use-service-account-credentials=true\n")),(0,n.kt)("h3",{id:"128\u786e\u4fdd---authorization-mode-\u53c2\u6570\u5305\u62ec-node\u81ea\u52a8"},"1.2.8\u786e\u4fdd --authorization-mode \u53c2\u6570\u5305\u62ec Node\uff08\u81ea\u52a8\uff09"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1apass"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u5728 Master \u8282\u70b9\u4e0a\u7f16\u8f91 API Server pod \u89c4\u8303\u6587\u4ef6 /var/lib/rancher/rke2/agent/pod-manifests/kube-apiserver.yaml\uff0c\u5e76\u5c06 ",(0,n.kt)("inlineCode",{parentName:"p"},"--authorization-mode")," \u53c2\u6570\u8bbe\u7f6e\u4e3a\u5305\u542b ",(0,n.kt)("inlineCode",{parentName:"p"},"Node")," \u7684\u503c\u3002\n--authorization-mode=Node,RBAC"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"/bin/ps -ef | grep kube-apiserver | grep -v grep\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u9884\u671f\u7ed3\u679c"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},"'Node,RBAC' has 'Node'\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u8fd4\u56de\u503c"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},"root 5275 5222 15 14:58 ?00:01:26 kube-apiserver --audit-policy-file=/etc/rancher/rke2/audit-policy.yaml --audit-log-path=/var/lib/rancher/rke2/server/logs/audit.log --audit-log-maxage=30 --audit-log-maxbackup=10 --audit-log-maxsize=100 --kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname --allow-privileged=true --anonymous-auth=false --api-audiences=https://kubernetes.default.svc.cluster.local,rke2 --authorization-mode=Node,RBAC --bind-address=0.0.0.0 --cert-dir=/var/lib/rancher/rke2/server/tls/temporary-certs --client-ca-file=/var/lib/rancher/rke2/server/tls/client-ca.crt --enable-admission-plugins=NodeRestriction,PodSecurityPolicy --encryption-provider-config=/var/lib/rancher/rke2/server/cred/encryption-config.json --etcd-cafile=/var/lib/rancher/rke2/server/tls/etcd/server-ca.crt --etcd-certfile=/var/lib/rancher/rke2/server/tls/etcd/client.crt --etcd-keyfile=/var/lib/rancher/rke2/server/tls/etcd/client.key --etcd-servers=https://127.0.0.1:2379 --insecure-port=0 --kubelet-certificate-authority=/var/lib/rancher/rke2/server/tls/server-ca.crt --kubelet-client-certificate=/var/lib/rancher/rke2/server/tls/client-kube-apiserver.crt --kubelet-client-key=/var/lib/rancher/rke2/server/tls/client-kube-apiserver.key --profiling=false --proxy-client-cert-file=/var/lib/rancher/rke2/server/tls/client-auth-proxy.crt --proxy-client-key-file=/var/lib/rancher/rke2/server/tls/client-auth-proxy.key --requestheader-allowed-names=system:auth-proxy --requestheader-client-ca-file=/var/lib/rancher/rke2/server/tls/request-header-ca.crt --requestheader-extra-headers-prefix=X-Remote-Extra- --requestheader-group-headers=X-Remote-Group --requestheader-username-headers=X-Remote-User --secure-port=6443 --service-account-issuer=https://kubernetes.default.svc.cluster.local --service-account-key-file=/var/lib/rancher/rke2/server/tls/service.key --service-account-signing-key-file=/var/lib/rancher/rke2/server/tls/service.key --service-cluster-ip-range=10.43.0.0/16 --service-node-port-range=30000-32767 --storage-backend=etcd3 --tls-cert-file=/var/lib/rancher/rke2/server/tls/serving-kube-apiserver.crt --tls-private-key-file=/var/lib/rancher/rke2/server/tls/serving-kube-apiserver.key root 5522 5416 3 14:58 ?00:00:16 kube-controller-manager --flex-volume-plugin-dir=/var/lib/kubelet/volumeplugins --terminated-pod-gc-threshold=1000 --permit-port-sharing=true --address=127.0.0.1 --allocate-node-cidrs=true --bind-address=127.0.0.1 --cert-dir=/var/lib/rancher/rke2/server/tls/kube-controller-manager --cluster-cidr=10.42.0.0/16 --cluster-signing-kube-apiserver-client-cert-file=/var/lib/rancher/rke2/server/tls/client-ca.crt --cluster-signing-kube-apiserver-client-key-file=/var/lib/rancher/rke2/server/tls/client-ca.key --cluster-signing-kubelet-client-cert-file=/var/lib/rancher/rke2/server/tls/client-ca.crt --cluster-signing-kubelet-client-key-file=/var/lib/rancher/rke2/server/tls/client-ca.key --cluster-signing-kubelet-serving-cert-file=/var/lib/rancher/rke2/server/tls/server-ca.crt --cluster-signing-kubelet-serving-key-file=/var/lib/rancher/rke2/server/tls/server-ca.key --cluster-signing-legacy-unknown-cert-file=/var/lib/rancher/rke2/server/tls/client-ca.crt --cluster-signing-legacy-unknown-key-file=/var/lib/rancher/rke2/server/tls/client-ca.key --configure-cloud-routes=false --controllers=*,-service,-route,-cloud-node-lifecycle --kubeconfig=/var/lib/rancher/rke2/server/cred/controller.kubeconfig --port=10252 --profiling=false --root-ca-file=/var/lib/rancher/rke2/server/tls/server-ca.crt --secure-port=10257 --service-account-private-key-file=/var/lib/rancher/rke2/server/tls/service.key --use-service-account-credentials=true\n")),(0,n.kt)("h3",{id:"129\u786e\u4fdd---authorization-mode-\u53c2\u6570\u5305\u62ec-rbac\u81ea\u52a8"},"1.2.9\u786e\u4fdd --authorization-mode \u53c2\u6570\u5305\u62ec RBAC\uff08\u81ea\u52a8\uff09"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1apass"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u5728 Master \u8282\u70b9\u4e0a\u7f16\u8f91 API Server pod \u89c4\u8303\u6587\u4ef6 /var/lib/rancher/rke2/agent/pod-manifests/kube-apiserver.yaml\uff0c\u5e76\u5c06 ",(0,n.kt)("inlineCode",{parentName:"p"},"--authorization-mode")," \u53c2\u6570\u8bbe\u7f6e\u4e3a\u5305\u542b ",(0,n.kt)("inlineCode",{parentName:"p"},"RBAC")," \u7684\u503c\u3002\n\u4f8b\u5982\uff1a--authorization-mode=Node,RBAC"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"/bin/ps -ef | grep kube-apiserver | grep -v grep\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u9884\u671f\u7ed3\u679c"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},"'Node,RBAC' has 'RBAC'\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u8fd4\u56de\u503c"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},"root 5275 5222 15 14:58 ?00:01:26 kube-apiserver --audit-policy-file=/etc/rancher/rke2/audit-policy.yaml --audit-log-path=/var/lib/rancher/rke2/server/logs/audit.log --audit-log-maxage=30 --audit-log-maxbackup=10 --audit-log-maxsize=100 --kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname --allow-privileged=true --anonymous-auth=false --api-audiences=https://kubernetes.default.svc.cluster.local,rke2 --authorization-mode=Node,RBAC --bind-address=0.0.0.0 --cert-dir=/var/lib/rancher/rke2/server/tls/temporary-certs --client-ca-file=/var/lib/rancher/rke2/server/tls/client-ca.crt --enable-admission-plugins=NodeRestriction,PodSecurityPolicy --encryption-provider-config=/var/lib/rancher/rke2/server/cred/encryption-config.json --etcd-cafile=/var/lib/rancher/rke2/server/tls/etcd/server-ca.crt --etcd-certfile=/var/lib/rancher/rke2/server/tls/etcd/client.crt --etcd-keyfile=/var/lib/rancher/rke2/server/tls/etcd/client.key --etcd-servers=https://127.0.0.1:2379 --insecure-port=0 --kubelet-certificate-authority=/var/lib/rancher/rke2/server/tls/server-ca.crt --kubelet-client-certificate=/var/lib/rancher/rke2/server/tls/client-kube-apiserver.crt --kubelet-client-key=/var/lib/rancher/rke2/server/tls/client-kube-apiserver.key --profiling=false --proxy-client-cert-file=/var/lib/rancher/rke2/server/tls/client-auth-proxy.crt --proxy-client-key-file=/var/lib/rancher/rke2/server/tls/client-auth-proxy.key --requestheader-allowed-names=system:auth-proxy --requestheader-client-ca-file=/var/lib/rancher/rke2/server/tls/request-header-ca.crt --requestheader-extra-headers-prefix=X-Remote-Extra- --requestheader-group-headers=X-Remote-Group --requestheader-username-headers=X-Remote-User --secure-port=6443 --service-account-issuer=https://kubernetes.default.svc.cluster.local --service-account-key-file=/var/lib/rancher/rke2/server/tls/service.key --service-account-signing-key-file=/var/lib/rancher/rke2/server/tls/service.key --service-cluster-ip-range=10.43.0.0/16 --service-node-port-range=30000-32767 --storage-backend=etcd3 --tls-cert-file=/var/lib/rancher/rke2/server/tls/serving-kube-apiserver.crt --tls-private-key-file=/var/lib/rancher/rke2/server/tls/serving-kube-apiserver.key root 5522 5416 3 14:58 ?00:00:16 kube-controller-manager --flex-volume-plugin-dir=/var/lib/kubelet/volumeplugins --terminated-pod-gc-threshold=1000 --permit-port-sharing=true --address=127.0.0.1 --allocate-node-cidrs=true --bind-address=127.0.0.1 --cert-dir=/var/lib/rancher/rke2/server/tls/kube-controller-manager --cluster-cidr=10.42.0.0/16 --cluster-signing-kube-apiserver-client-cert-file=/var/lib/rancher/rke2/server/tls/client-ca.crt --cluster-signing-kube-apiserver-client-key-file=/var/lib/rancher/rke2/server/tls/client-ca.key --cluster-signing-kubelet-client-cert-file=/var/lib/rancher/rke2/server/tls/client-ca.crt --cluster-signing-kubelet-client-key-file=/var/lib/rancher/rke2/server/tls/client-ca.key --cluster-signing-kubelet-serving-cert-file=/var/lib/rancher/rke2/server/tls/server-ca.crt --cluster-signing-kubelet-serving-key-file=/var/lib/rancher/rke2/server/tls/server-ca.key --cluster-signing-legacy-unknown-cert-file=/var/lib/rancher/rke2/server/tls/client-ca.crt --cluster-signing-legacy-unknown-key-file=/var/lib/rancher/rke2/server/tls/client-ca.key --configure-cloud-routes=false --controllers=*,-service,-route,-cloud-node-lifecycle --kubeconfig=/var/lib/rancher/rke2/server/cred/controller.kubeconfig --port=10252 --profiling=false --root-ca-file=/var/lib/rancher/rke2/server/tls/server-ca.crt --secure-port=10257 --service-account-private-key-file=/var/lib/rancher/rke2/server/tls/service.key --use-service-account-credentials=true\n")),(0,n.kt)("h3",{id:"1210\u786e\u4fdd\u8bbe\u7f6e\u4e86\u51c6\u5165\u63a7\u5236\u63d2\u4ef6-eventratelimit\u624b\u52a8"},"1.2.10\u786e\u4fdd\u8bbe\u7f6e\u4e86\u51c6\u5165\u63a7\u5236\u63d2\u4ef6 EventRateLimit\uff08\u624b\u52a8\uff09"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1awarn"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u9075\u5faa Kubernetes \u6587\u6863\u5e76\u5728\u914d\u7f6e\u6587\u4ef6\u4e2d\u8bbe\u7f6e\u6240\u9700\u7684\u9650\u5236\u3002\n\u7136\u540e\uff0c\u7f16\u8f91 API Server pod \u89c4\u8303\u6587\u4ef6 /var/lib/rancher/rke2/agent/pod-manifests/kube-apiserver.yaml\uff0c\u5e76\u8bbe\u7f6e\u4ee5\u4e0b\u53c2\u6570\u3002\n--enable-admission-plugins=...,EventRateLimit,...\n--admission-control-config-file=<path/to/configuration/file>"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"/bin/ps -ef | grep kube-apiserver | grep -v grep\n")),(0,n.kt)("h3",{id:"1211\u786e\u4fdd\u672a\u8bbe\u7f6e\u51c6\u5165\u63a7\u5236\u63d2\u4ef6-alwaysadmit\u81ea\u52a8"},"1.2.11\u786e\u4fdd\u672a\u8bbe\u7f6e\u51c6\u5165\u63a7\u5236\u63d2\u4ef6 AlwaysAdmit\uff08\u81ea\u52a8\uff09"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1apass"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u5728 Master \u8282\u70b9\u4e0a\u7f16\u8f91 API Server pod \u89c4\u8303\u6587\u4ef6 /var/lib/rancher/rke2/agent/pod-manifests/kube-apiserver.yaml\uff0c\u5e76\u5220\u9664 ",(0,n.kt)("inlineCode",{parentName:"p"},"--enable-admission-plugins")," \u53c2\u6570\uff0c\u6216\u5c06\u5176\u8bbe\u7f6e\u4e3a\u4e0d\u5305\u542b ",(0,n.kt)("inlineCode",{parentName:"p"},"AlwaysAdmit")," \u7684\u503c\u3002"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"/bin/ps -ef | grep kube-apiserver | grep -v grep\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u9884\u671f\u7ed3\u679c"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},"'NodeRestriction,PodSecurityPolicy' not have 'AlwaysAdmit' OR '--enable-admission-plugins' is not present\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u8fd4\u56de\u503c"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},"root 5275 5222 15 14:58 ?00:01:26 kube-apiserver --audit-policy-file=/etc/rancher/rke2/audit-policy.yaml --audit-log-path=/var/lib/rancher/rke2/server/logs/audit.log --audit-log-maxage=30 --audit-log-maxbackup=10 --audit-log-maxsize=100 --kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname --allow-privileged=true --anonymous-auth=false --api-audiences=https://kubernetes.default.svc.cluster.local,rke2 --authorization-mode=Node,RBAC --bind-address=0.0.0.0 --cert-dir=/var/lib/rancher/rke2/server/tls/temporary-certs --client-ca-file=/var/lib/rancher/rke2/server/tls/client-ca.crt --enable-admission-plugins=NodeRestriction,PodSecurityPolicy --encryption-provider-config=/var/lib/rancher/rke2/server/cred/encryption-config.json --etcd-cafile=/var/lib/rancher/rke2/server/tls/etcd/server-ca.crt --etcd-certfile=/var/lib/rancher/rke2/server/tls/etcd/client.crt --etcd-keyfile=/var/lib/rancher/rke2/server/tls/etcd/client.key --etcd-servers=https://127.0.0.1:2379 --insecure-port=0 --kubelet-certificate-authority=/var/lib/rancher/rke2/server/tls/server-ca.crt --kubelet-client-certificate=/var/lib/rancher/rke2/server/tls/client-kube-apiserver.crt --kubelet-client-key=/var/lib/rancher/rke2/server/tls/client-kube-apiserver.key --profiling=false --proxy-client-cert-file=/var/lib/rancher/rke2/server/tls/client-auth-proxy.crt --proxy-client-key-file=/var/lib/rancher/rke2/server/tls/client-auth-proxy.key --requestheader-allowed-names=system:auth-proxy --requestheader-client-ca-file=/var/lib/rancher/rke2/server/tls/request-header-ca.crt --requestheader-extra-headers-prefix=X-Remote-Extra- --requestheader-group-headers=X-Remote-Group --requestheader-username-headers=X-Remote-User --secure-port=6443 --service-account-issuer=https://kubernetes.default.svc.cluster.local --service-account-key-file=/var/lib/rancher/rke2/server/tls/service.key --service-account-signing-key-file=/var/lib/rancher/rke2/server/tls/service.key --service-cluster-ip-range=10.43.0.0/16 --service-node-port-range=30000-32767 --storage-backend=etcd3 --tls-cert-file=/var/lib/rancher/rke2/server/tls/serving-kube-apiserver.crt --tls-private-key-file=/var/lib/rancher/rke2/server/tls/serving-kube-apiserver.key root 5522 5416 3 14:58 ?00:00:16 kube-controller-manager --flex-volume-plugin-dir=/var/lib/kubelet/volumeplugins --terminated-pod-gc-threshold=1000 --permit-port-sharing=true --address=127.0.0.1 --allocate-node-cidrs=true --bind-address=127.0.0.1 --cert-dir=/var/lib/rancher/rke2/server/tls/kube-controller-manager --cluster-cidr=10.42.0.0/16 --cluster-signing-kube-apiserver-client-cert-file=/var/lib/rancher/rke2/server/tls/client-ca.crt --cluster-signing-kube-apiserver-client-key-file=/var/lib/rancher/rke2/server/tls/client-ca.key --cluster-signing-kubelet-client-cert-file=/var/lib/rancher/rke2/server/tls/client-ca.crt --cluster-signing-kubelet-client-key-file=/var/lib/rancher/rke2/server/tls/client-ca.key --cluster-signing-kubelet-serving-cert-file=/var/lib/rancher/rke2/server/tls/server-ca.crt --cluster-signing-kubelet-serving-key-file=/var/lib/rancher/rke2/server/tls/server-ca.key --cluster-signing-legacy-unknown-cert-file=/var/lib/rancher/rke2/server/tls/client-ca.crt --cluster-signing-legacy-unknown-key-file=/var/lib/rancher/rke2/server/tls/client-ca.key --configure-cloud-routes=false --controllers=*,-service,-route,-cloud-node-lifecycle --kubeconfig=/var/lib/rancher/rke2/server/cred/controller.kubeconfig --port=10252 --profiling=false --root-ca-file=/var/lib/rancher/rke2/server/tls/server-ca.crt --secure-port=10257 --service-account-private-key-file=/var/lib/rancher/rke2/server/tls/service.key --use-service-account-credentials=true\n")),(0,n.kt)("h3",{id:"1212\u786e\u4fdd\u8bbe\u7f6e\u4e86\u51c6\u5165\u63a7\u5236\u63d2\u4ef6-alwayspullimages\u624b\u52a8"},"1.2.12\u786e\u4fdd\u8bbe\u7f6e\u4e86\u51c6\u5165\u63a7\u5236\u63d2\u4ef6 AlwaysPullImages\uff08\u624b\u52a8\uff09"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1awarn"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u5728 Master \u8282\u70b9\u4e0a\u7f16\u8f91 API Server pod \u89c4\u8303\u6587\u4ef6 /var/lib/rancher/rke2/agent/pod-manifests/kube-apiserver.yaml\uff0c\u5e76\u5c06 ",(0,n.kt)("inlineCode",{parentName:"p"},"--enable-admission-plugins")," \u53c2\u6570\u8bbe\u7f6e\u4e3a\u5305\u542b ",(0,n.kt)("inlineCode",{parentName:"p"},"AlwaysPullImages"),"\u3002\n--enable-admission-plugins=...,AlwaysPullImages,..."),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"/bin/ps -ef | grep kube-apiserver | grep -v grep\n")),(0,n.kt)("h3",{id:"1213\u5982\u679c\u6ca1\u6709\u4f7f\u7528-podsecuritypolicy\u8bf7\u786e\u4fdd\u8bbe\u7f6e\u4e86\u51c6\u5165\u63a7\u5236\u63d2\u4ef6-securitycontextdeny\u624b\u52a8"},"1.2.13\u5982\u679c\u6ca1\u6709\u4f7f\u7528 PodSecurityPolicy\uff0c\u8bf7\u786e\u4fdd\u8bbe\u7f6e\u4e86\u51c6\u5165\u63a7\u5236\u63d2\u4ef6 SecurityContextDeny\uff08\u624b\u52a8\uff09"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1awarn"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u5728 Master \u8282\u70b9\u4e0a\u7f16\u8f91 API Server pod \u89c4\u8303\u6587\u4ef6 /var/lib/rancher/rke2/agent/pod-manifests/kube-apiserver.yaml\uff0c\u5e76\u5c06 ",(0,n.kt)("inlineCode",{parentName:"p"},"--enable-admission-plugins")," \u53c2\u6570\u8bbe\u7f6e\u4e3a\u5305\u62ec ",(0,n.kt)("inlineCode",{parentName:"p"},"SecurityContextDeny"),"\uff0c\u9664\u975e\u5df2\u8bbe\u7f6e\u4e86 PodSecurityPolicy\u3002\n--enable-admission-plugins=...,SecurityContextDeny,..."),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"/bin/ps -ef | grep kube-apiserver | grep -v grep\n")),(0,n.kt)("h3",{id:"1214\u786e\u4fdd\u8bbe\u7f6e\u4e86\u51c6\u5165\u63a7\u5236\u63d2\u4ef6-serviceaccount\u81ea\u52a8"},"1.2.14\u786e\u4fdd\u8bbe\u7f6e\u4e86\u51c6\u5165\u63a7\u5236\u63d2\u4ef6 ServiceAccount\uff08\u81ea\u52a8\uff09"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1apass"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u9075\u5faa\u6587\u6863\u5e76\u6839\u636e\u4f60\u7684\u73af\u5883\u521b\u5efa ServiceAccount \u5bf9\u8c61\u3002\n\u7136\u540e\uff0c\u5728 Master \u8282\u70b9\u4e0a\u7f16\u8f91 API Server pod \u89c4\u8303\u6587\u4ef6 /var/lib/rancher/rke2/agent/pod-manifests/kube-apiserver.yaml\uff0c\u5e76\u786e\u4fdd ",(0,n.kt)("inlineCode",{parentName:"p"},"--disable-admission-plugins")," \u53c2\u6570\u8bbe\u7f6e\u4e3a\u4e0d\u5305\u542b ServiceAccount \u7684\u503c\u3002"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"/bin/ps -ef | grep kube-apiserver | grep -v grep\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u9884\u671f\u7ed3\u679c"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},"'--disable-admission-plugins' is not present OR '--disable-admission-plugins' is not present\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u8fd4\u56de\u503c"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},"root 5275 5222 15 14:58 ?00:01:26 kube-apiserver --audit-policy-file=/etc/rancher/rke2/audit-policy.yaml --audit-log-path=/var/lib/rancher/rke2/server/logs/audit.log --audit-log-maxage=30 --audit-log-maxbackup=10 --audit-log-maxsize=100 --kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname --allow-privileged=true --anonymous-auth=false --api-audiences=https://kubernetes.default.svc.cluster.local,rke2 --authorization-mode=Node,RBAC --bind-address=0.0.0.0 --cert-dir=/var/lib/rancher/rke2/server/tls/temporary-certs --client-ca-file=/var/lib/rancher/rke2/server/tls/client-ca.crt --enable-admission-plugins=NodeRestriction,PodSecurityPolicy --encryption-provider-config=/var/lib/rancher/rke2/server/cred/encryption-config.json --etcd-cafile=/var/lib/rancher/rke2/server/tls/etcd/server-ca.crt --etcd-certfile=/var/lib/rancher/rke2/server/tls/etcd/client.crt --etcd-keyfile=/var/lib/rancher/rke2/server/tls/etcd/client.key --etcd-servers=https://127.0.0.1:2379 --insecure-port=0 --kubelet-certificate-authority=/var/lib/rancher/rke2/server/tls/server-ca.crt --kubelet-client-certificate=/var/lib/rancher/rke2/server/tls/client-kube-apiserver.crt --kubelet-client-key=/var/lib/rancher/rke2/server/tls/client-kube-apiserver.key --profiling=false --proxy-client-cert-file=/var/lib/rancher/rke2/server/tls/client-auth-proxy.crt --proxy-client-key-file=/var/lib/rancher/rke2/server/tls/client-auth-proxy.key --requestheader-allowed-names=system:auth-proxy --requestheader-client-ca-file=/var/lib/rancher/rke2/server/tls/request-header-ca.crt --requestheader-extra-headers-prefix=X-Remote-Extra- --requestheader-group-headers=X-Remote-Group --requestheader-username-headers=X-Remote-User --secure-port=6443 --service-account-issuer=https://kubernetes.default.svc.cluster.local --service-account-key-file=/var/lib/rancher/rke2/server/tls/service.key --service-account-signing-key-file=/var/lib/rancher/rke2/server/tls/service.key --service-cluster-ip-range=10.43.0.0/16 --service-node-port-range=30000-32767 --storage-backend=etcd3 --tls-cert-file=/var/lib/rancher/rke2/server/tls/serving-kube-apiserver.crt --tls-private-key-file=/var/lib/rancher/rke2/server/tls/serving-kube-apiserver.key root 5522 5416 3 14:58 ?00:00:16 kube-controller-manager --flex-volume-plugin-dir=/var/lib/kubelet/volumeplugins --terminated-pod-gc-threshold=1000 --permit-port-sharing=true --address=127.0.0.1 --allocate-node-cidrs=true --bind-address=127.0.0.1 --cert-dir=/var/lib/rancher/rke2/server/tls/kube-controller-manager --cluster-cidr=10.42.0.0/16 --cluster-signing-kube-apiserver-client-cert-file=/var/lib/rancher/rke2/server/tls/client-ca.crt --cluster-signing-kube-apiserver-client-key-file=/var/lib/rancher/rke2/server/tls/client-ca.key --cluster-signing-kubelet-client-cert-file=/var/lib/rancher/rke2/server/tls/client-ca.crt --cluster-signing-kubelet-client-key-file=/var/lib/rancher/rke2/server/tls/client-ca.key --cluster-signing-kubelet-serving-cert-file=/var/lib/rancher/rke2/server/tls/server-ca.crt --cluster-signing-kubelet-serving-key-file=/var/lib/rancher/rke2/server/tls/server-ca.key --cluster-signing-legacy-unknown-cert-file=/var/lib/rancher/rke2/server/tls/client-ca.crt --cluster-signing-legacy-unknown-key-file=/var/lib/rancher/rke2/server/tls/client-ca.key --configure-cloud-routes=false --controllers=*,-service,-route,-cloud-node-lifecycle --kubeconfig=/var/lib/rancher/rke2/server/cred/controller.kubeconfig --port=10252 --profiling=false --root-ca-file=/var/lib/rancher/rke2/server/tls/server-ca.crt --secure-port=10257 --service-account-private-key-file=/var/lib/rancher/rke2/server/tls/service.key --use-service-account-credentials=true\n")),(0,n.kt)("h3",{id:"1215\u786e\u4fdd\u8bbe\u7f6e\u4e86\u51c6\u5165\u63a7\u5236\u63d2\u4ef6-namespacelifecycle\u81ea\u52a8"},"1.2.15\u786e\u4fdd\u8bbe\u7f6e\u4e86\u51c6\u5165\u63a7\u5236\u63d2\u4ef6 NamespaceLifecycle\uff08\u81ea\u52a8\uff09"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1apass"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u5728 Master \u8282\u70b9\u4e0a\u7f16\u8f91 API Server pod \u89c4\u8303\u6587\u4ef6 /var/lib/rancher/rke2/agent/pod-manifests/kube-apiserver.yaml\uff0c\u5e76\u8bbe\u7f6e ",(0,n.kt)("inlineCode",{parentName:"p"},"--disable-admission-plugins")," \u53c2\u6570\uff0c\u786e\u4fdd\u5b83\u4e0d\u5305\u542b NamespaceLifecycle\u3002"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"/bin/ps -ef | grep kube-apiserver | grep -v grep\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u9884\u671f\u7ed3\u679c"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},"'--disable-admission-plugins' is not present OR '--disable-admission-plugins' is not present\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u8fd4\u56de\u503c"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},"root 5275 5222 15 14:58 ?00:01:26 kube-apiserver --audit-policy-file=/etc/rancher/rke2/audit-policy.yaml --audit-log-path=/var/lib/rancher/rke2/server/logs/audit.log --audit-log-maxage=30 --audit-log-maxbackup=10 --audit-log-maxsize=100 --kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname --allow-privileged=true --anonymous-auth=false --api-audiences=https://kubernetes.default.svc.cluster.local,rke2 --authorization-mode=Node,RBAC --bind-address=0.0.0.0 --cert-dir=/var/lib/rancher/rke2/server/tls/temporary-certs --client-ca-file=/var/lib/rancher/rke2/server/tls/client-ca.crt --enable-admission-plugins=NodeRestriction,PodSecurityPolicy --encryption-provider-config=/var/lib/rancher/rke2/server/cred/encryption-config.json --etcd-cafile=/var/lib/rancher/rke2/server/tls/etcd/server-ca.crt --etcd-certfile=/var/lib/rancher/rke2/server/tls/etcd/client.crt --etcd-keyfile=/var/lib/rancher/rke2/server/tls/etcd/client.key --etcd-servers=https://127.0.0.1:2379 --insecure-port=0 --kubelet-certificate-authority=/var/lib/rancher/rke2/server/tls/server-ca.crt --kubelet-client-certificate=/var/lib/rancher/rke2/server/tls/client-kube-apiserver.crt --kubelet-client-key=/var/lib/rancher/rke2/server/tls/client-kube-apiserver.key --profiling=false --proxy-client-cert-file=/var/lib/rancher/rke2/server/tls/client-auth-proxy.crt --proxy-client-key-file=/var/lib/rancher/rke2/server/tls/client-auth-proxy.key --requestheader-allowed-names=system:auth-proxy --requestheader-client-ca-file=/var/lib/rancher/rke2/server/tls/request-header-ca.crt --requestheader-extra-headers-prefix=X-Remote-Extra- --requestheader-group-headers=X-Remote-Group --requestheader-username-headers=X-Remote-User --secure-port=6443 --service-account-issuer=https://kubernetes.default.svc.cluster.local --service-account-key-file=/var/lib/rancher/rke2/server/tls/service.key --service-account-signing-key-file=/var/lib/rancher/rke2/server/tls/service.key --service-cluster-ip-range=10.43.0.0/16 --service-node-port-range=30000-32767 --storage-backend=etcd3 --tls-cert-file=/var/lib/rancher/rke2/server/tls/serving-kube-apiserver.crt --tls-private-key-file=/var/lib/rancher/rke2/server/tls/serving-kube-apiserver.key root 5522 5416 3 14:58 ?00:00:16 kube-controller-manager --flex-volume-plugin-dir=/var/lib/kubelet/volumeplugins --terminated-pod-gc-threshold=1000 --permit-port-sharing=true --address=127.0.0.1 --allocate-node-cidrs=true --bind-address=127.0.0.1 --cert-dir=/var/lib/rancher/rke2/server/tls/kube-controller-manager --cluster-cidr=10.42.0.0/16 --cluster-signing-kube-apiserver-client-cert-file=/var/lib/rancher/rke2/server/tls/client-ca.crt --cluster-signing-kube-apiserver-client-key-file=/var/lib/rancher/rke2/server/tls/client-ca.key --cluster-signing-kubelet-client-cert-file=/var/lib/rancher/rke2/server/tls/client-ca.crt --cluster-signing-kubelet-client-key-file=/var/lib/rancher/rke2/server/tls/client-ca.key --cluster-signing-kubelet-serving-cert-file=/var/lib/rancher/rke2/server/tls/server-ca.crt --cluster-signing-kubelet-serving-key-file=/var/lib/rancher/rke2/server/tls/server-ca.key --cluster-signing-legacy-unknown-cert-file=/var/lib/rancher/rke2/server/tls/client-ca.crt --cluster-signing-legacy-unknown-key-file=/var/lib/rancher/rke2/server/tls/client-ca.key --configure-cloud-routes=false --controllers=*,-service,-route,-cloud-node-lifecycle --kubeconfig=/var/lib/rancher/rke2/server/cred/controller.kubeconfig --port=10252 --profiling=false --root-ca-file=/var/lib/rancher/rke2/server/tls/server-ca.crt --secure-port=10257 --service-account-private-key-file=/var/lib/rancher/rke2/server/tls/service.key --use-service-account-credentials=true\n")),(0,n.kt)("h3",{id:"1216\u786e\u4fdd\u8bbe\u7f6e\u4e86\u51c6\u5165\u63a7\u5236\u63d2\u4ef6-podsecuritypolicy\u81ea\u52a8"},"1.2.16\u786e\u4fdd\u8bbe\u7f6e\u4e86\u51c6\u5165\u63a7\u5236\u63d2\u4ef6 PodSecurityPolicy\uff08\u81ea\u52a8\uff09"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1apass"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u9075\u5faa\u6587\u6863\u5e76\u6839\u636e\u4f60\u7684\u73af\u5883\u521b\u5efa Pod \u5b89\u5168\u7b56\u7565\u5bf9\u8c61\u3002\n\u7136\u540e\uff0c\u5728 Master \u8282\u70b9\u4e0a\u7f16\u8f91 API Server pod \u89c4\u8303\u6587\u4ef6 /var/lib/rancher/rke2/agent/pod-manifests/kube-apiserver.yaml\uff0c\u5e76\u5c06 ",(0,n.kt)("inlineCode",{parentName:"p"},"--enable-admission-plugins")," \u53c2\u6570\u8bbe\u7f6e\u4e3a\u5305\u542b PodSecurityPolicy \u7684\u503c\uff1a\n--enable-admission-plugins=...,PodSecurityPolicy,...\n\u7136\u540e\u91cd\u65b0\u542f\u52a8 API Server\u3002"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"/bin/ps -ef | grep kube-apiserver | grep -v grep\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u9884\u671f\u7ed3\u679c"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},"'NodeRestriction,PodSecurityPolicy' has 'PodSecurityPolicy'\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u8fd4\u56de\u503c"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},"root 5275 5222 15 14:58 ?00:01:26 kube-apiserver --audit-policy-file=/etc/rancher/rke2/audit-policy.yaml --audit-log-path=/var/lib/rancher/rke2/server/logs/audit.log --audit-log-maxage=30 --audit-log-maxbackup=10 --audit-log-maxsize=100 --kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname --allow-privileged=true --anonymous-auth=false --api-audiences=https://kubernetes.default.svc.cluster.local,rke2 --authorization-mode=Node,RBAC --bind-address=0.0.0.0 --cert-dir=/var/lib/rancher/rke2/server/tls/temporary-certs --client-ca-file=/var/lib/rancher/rke2/server/tls/client-ca.crt --enable-admission-plugins=NodeRestriction,PodSecurityPolicy --encryption-provider-config=/var/lib/rancher/rke2/server/cred/encryption-config.json --etcd-cafile=/var/lib/rancher/rke2/server/tls/etcd/server-ca.crt --etcd-certfile=/var/lib/rancher/rke2/server/tls/etcd/client.crt --etcd-keyfile=/var/lib/rancher/rke2/server/tls/etcd/client.key --etcd-servers=https://127.0.0.1:2379 --insecure-port=0 --kubelet-certificate-authority=/var/lib/rancher/rke2/server/tls/server-ca.crt --kubelet-client-certificate=/var/lib/rancher/rke2/server/tls/client-kube-apiserver.crt --kubelet-client-key=/var/lib/rancher/rke2/server/tls/client-kube-apiserver.key --profiling=false --proxy-client-cert-file=/var/lib/rancher/rke2/server/tls/client-auth-proxy.crt --proxy-client-key-file=/var/lib/rancher/rke2/server/tls/client-auth-proxy.key --requestheader-allowed-names=system:auth-proxy --requestheader-client-ca-file=/var/lib/rancher/rke2/server/tls/request-header-ca.crt --requestheader-extra-headers-prefix=X-Remote-Extra- --requestheader-group-headers=X-Remote-Group --requestheader-username-headers=X-Remote-User --secure-port=6443 --service-account-issuer=https://kubernetes.default.svc.cluster.local --service-account-key-file=/var/lib/rancher/rke2/server/tls/service.key --service-account-signing-key-file=/var/lib/rancher/rke2/server/tls/service.key --service-cluster-ip-range=10.43.0.0/16 --service-node-port-range=30000-32767 --storage-backend=etcd3 --tls-cert-file=/var/lib/rancher/rke2/server/tls/serving-kube-apiserver.crt --tls-private-key-file=/var/lib/rancher/rke2/server/tls/serving-kube-apiserver.key root 5522 5416 3 14:58 ?00:00:16 kube-controller-manager --flex-volume-plugin-dir=/var/lib/kubelet/volumeplugins --terminated-pod-gc-threshold=1000 --permit-port-sharing=true --address=127.0.0.1 --allocate-node-cidrs=true --bind-address=127.0.0.1 --cert-dir=/var/lib/rancher/rke2/server/tls/kube-controller-manager --cluster-cidr=10.42.0.0/16 --cluster-signing-kube-apiserver-client-cert-file=/var/lib/rancher/rke2/server/tls/client-ca.crt --cluster-signing-kube-apiserver-client-key-file=/var/lib/rancher/rke2/server/tls/client-ca.key --cluster-signing-kubelet-client-cert-file=/var/lib/rancher/rke2/server/tls/client-ca.crt --cluster-signing-kubelet-client-key-file=/var/lib/rancher/rke2/server/tls/client-ca.key --cluster-signing-kubelet-serving-cert-file=/var/lib/rancher/rke2/server/tls/server-ca.crt --cluster-signing-kubelet-serving-key-file=/var/lib/rancher/rke2/server/tls/server-ca.key --cluster-signing-legacy-unknown-cert-file=/var/lib/rancher/rke2/server/tls/client-ca.crt --cluster-signing-legacy-unknown-key-file=/var/lib/rancher/rke2/server/tls/client-ca.key --configure-cloud-routes=false --controllers=*,-service,-route,-cloud-node-lifecycle --kubeconfig=/var/lib/rancher/rke2/server/cred/controller.kubeconfig --port=10252 --profiling=false --root-ca-file=/var/lib/rancher/rke2/server/tls/server-ca.crt --secure-port=10257 --service-account-private-key-file=/var/lib/rancher/rke2/server/tls/service.key --use-service-account-credentials=true\n")),(0,n.kt)("h3",{id:"1217\u786e\u4fdd\u8bbe\u7f6e\u4e86\u51c6\u5165\u63a7\u5236\u63d2\u4ef6-noderestriction\u81ea\u52a8"},"1.2.17\u786e\u4fdd\u8bbe\u7f6e\u4e86\u51c6\u5165\u63a7\u5236\u63d2\u4ef6 NodeRestriction\uff08\u81ea\u52a8\uff09"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1apass"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u6309\u7167 Kubernetes \u6587\u6863\uff0c\u5728 kubelets \u4e0a\u914d\u7f6e NodeRestriction \u63d2\u4ef6\u3002\n\u7136\u540e\uff0c\u5728 Master \u8282\u70b9\u4e0a\u7f16\u8f91 API Server pod \u89c4\u8303\u6587\u4ef6 /var/lib/rancher/rke2/agent/pod-manifests/kube-apiserver.yaml\uff0c\u5e76\u5c06 ",(0,n.kt)("inlineCode",{parentName:"p"},"--enable-admission-plugins")," \u53c2\u6570\u8bbe\u7f6e\u4e3a\u5305\u542b NodeRestriction \u7684\u503c\u3002\n--enable-admission-plugins=...,NodeRestriction,..."),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"/bin/ps -ef | grep kube-apiserver | grep -v grep\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u9884\u671f\u7ed3\u679c"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},"'NodeRestriction,PodSecurityPolicy' has 'NodeRestriction'\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u8fd4\u56de\u503c"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},"root 5275 5222 15 14:58 ?00:01:26 kube-apiserver --audit-policy-file=/etc/rancher/rke2/audit-policy.yaml --audit-log-path=/var/lib/rancher/rke2/server/logs/audit.log --audit-log-maxage=30 --audit-log-maxbackup=10 --audit-log-maxsize=100 --kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname --allow-privileged=true --anonymous-auth=false --api-audiences=https://kubernetes.default.svc.cluster.local,rke2 --authorization-mode=Node,RBAC --bind-address=0.0.0.0 --cert-dir=/var/lib/rancher/rke2/server/tls/temporary-certs --client-ca-file=/var/lib/rancher/rke2/server/tls/client-ca.crt --enable-admission-plugins=NodeRestriction,PodSecurityPolicy --encryption-provider-config=/var/lib/rancher/rke2/server/cred/encryption-config.json --etcd-cafile=/var/lib/rancher/rke2/server/tls/etcd/server-ca.crt --etcd-certfile=/var/lib/rancher/rke2/server/tls/etcd/client.crt --etcd-keyfile=/var/lib/rancher/rke2/server/tls/etcd/client.key --etcd-servers=https://127.0.0.1:2379 --insecure-port=0 --kubelet-certificate-authority=/var/lib/rancher/rke2/server/tls/server-ca.crt --kubelet-client-certificate=/var/lib/rancher/rke2/server/tls/client-kube-apiserver.crt --kubelet-client-key=/var/lib/rancher/rke2/server/tls/client-kube-apiserver.key --profiling=false --proxy-client-cert-file=/var/lib/rancher/rke2/server/tls/client-auth-proxy.crt --proxy-client-key-file=/var/lib/rancher/rke2/server/tls/client-auth-proxy.key --requestheader-allowed-names=system:auth-proxy --requestheader-client-ca-file=/var/lib/rancher/rke2/server/tls/request-header-ca.crt --requestheader-extra-headers-prefix=X-Remote-Extra- --requestheader-group-headers=X-Remote-Group --requestheader-username-headers=X-Remote-User --secure-port=6443 --service-account-issuer=https://kubernetes.default.svc.cluster.local --service-account-key-file=/var/lib/rancher/rke2/server/tls/service.key --service-account-signing-key-file=/var/lib/rancher/rke2/server/tls/service.key --service-cluster-ip-range=10.43.0.0/16 --service-node-port-range=30000-32767 --storage-backend=etcd3 --tls-cert-file=/var/lib/rancher/rke2/server/tls/serving-kube-apiserver.crt --tls-private-key-file=/var/lib/rancher/rke2/server/tls/serving-kube-apiserver.key root 5522 5416 3 14:58 ?00:00:16 kube-controller-manager --flex-volume-plugin-dir=/var/lib/kubelet/volumeplugins --terminated-pod-gc-threshold=1000 --permit-port-sharing=true --address=127.0.0.1 --allocate-node-cidrs=true --bind-address=127.0.0.1 --cert-dir=/var/lib/rancher/rke2/server/tls/kube-controller-manager --cluster-cidr=10.42.0.0/16 --cluster-signing-kube-apiserver-client-cert-file=/var/lib/rancher/rke2/server/tls/client-ca.crt --cluster-signing-kube-apiserver-client-key-file=/var/lib/rancher/rke2/server/tls/client-ca.key --cluster-signing-kubelet-client-cert-file=/var/lib/rancher/rke2/server/tls/client-ca.crt --cluster-signing-kubelet-client-key-file=/var/lib/rancher/rke2/server/tls/client-ca.key --cluster-signing-kubelet-serving-cert-file=/var/lib/rancher/rke2/server/tls/server-ca.crt --cluster-signing-kubelet-serving-key-file=/var/lib/rancher/rke2/server/tls/server-ca.key --cluster-signing-legacy-unknown-cert-file=/var/lib/rancher/rke2/server/tls/client-ca.crt --cluster-signing-legacy-unknown-key-file=/var/lib/rancher/rke2/server/tls/client-ca.key --configure-cloud-routes=false --controllers=*,-service,-route,-cloud-node-lifecycle --kubeconfig=/var/lib/rancher/rke2/server/cred/controller.kubeconfig --port=10252 --profiling=false --root-ca-file=/var/lib/rancher/rke2/server/tls/server-ca.crt --secure-port=10257 --service-account-private-key-file=/var/lib/rancher/rke2/server/tls/service.key --use-service-account-credentials=true\n")),(0,n.kt)("h3",{id:"1218\u786e\u4fdd\u672a\u8bbe\u7f6e---insecure-bind-address-\u53c2\u6570\u81ea\u52a8"},"1.2.18\u786e\u4fdd\u672a\u8bbe\u7f6e --insecure-bind-address \u53c2\u6570\uff08\u81ea\u52a8\uff09"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1apass"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u5728 Master \u8282\u70b9\u4e0a\u7f16\u8f91 API Server pod \u89c4\u8303\u6587\u4ef6 /var/lib/rancher/rke2/agent/pod-manifests/kube-apiserver.yaml \u5e76\u79fb\u9664 ",(0,n.kt)("inlineCode",{parentName:"p"},"--insecure-bind-address")," \u53c2\u6570\u3002"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"/bin/ps -ef | grep kube-apiserver | grep -v grep\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u9884\u671f\u7ed3\u679c"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},"'--insecure-bind-address' is not present\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u8fd4\u56de\u503c"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},"root 5275 5222 15 14:58 ?00:01:26 kube-apiserver --audit-policy-file=/etc/rancher/rke2/audit-policy.yaml --audit-log-path=/var/lib/rancher/rke2/server/logs/audit.log --audit-log-maxage=30 --audit-log-maxbackup=10 --audit-log-maxsize=100 --kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname --allow-privileged=true --anonymous-auth=false --api-audiences=https://kubernetes.default.svc.cluster.local,rke2 --authorization-mode=Node,RBAC --bind-address=0.0.0.0 --cert-dir=/var/lib/rancher/rke2/server/tls/temporary-certs --client-ca-file=/var/lib/rancher/rke2/server/tls/client-ca.crt --enable-admission-plugins=NodeRestriction,PodSecurityPolicy --encryption-provider-config=/var/lib/rancher/rke2/server/cred/encryption-config.json --etcd-cafile=/var/lib/rancher/rke2/server/tls/etcd/server-ca.crt --etcd-certfile=/var/lib/rancher/rke2/server/tls/etcd/client.crt --etcd-keyfile=/var/lib/rancher/rke2/server/tls/etcd/client.key --etcd-servers=https://127.0.0.1:2379 --insecure-port=0 --kubelet-certificate-authority=/var/lib/rancher/rke2/server/tls/server-ca.crt --kubelet-client-certificate=/var/lib/rancher/rke2/server/tls/client-kube-apiserver.crt --kubelet-client-key=/var/lib/rancher/rke2/server/tls/client-kube-apiserver.key --profiling=false --proxy-client-cert-file=/var/lib/rancher/rke2/server/tls/client-auth-proxy.crt --proxy-client-key-file=/var/lib/rancher/rke2/server/tls/client-auth-proxy.key --requestheader-allowed-names=system:auth-proxy --requestheader-client-ca-file=/var/lib/rancher/rke2/server/tls/request-header-ca.crt --requestheader-extra-headers-prefix=X-Remote-Extra- --requestheader-group-headers=X-Remote-Group --requestheader-username-headers=X-Remote-User --secure-port=6443 --service-account-issuer=https://kubernetes.default.svc.cluster.local --service-account-key-file=/var/lib/rancher/rke2/server/tls/service.key --service-account-signing-key-file=/var/lib/rancher/rke2/server/tls/service.key --service-cluster-ip-range=10.43.0.0/16 --service-node-port-range=30000-32767 --storage-backend=etcd3 --tls-cert-file=/var/lib/rancher/rke2/server/tls/serving-kube-apiserver.crt --tls-private-key-file=/var/lib/rancher/rke2/server/tls/serving-kube-apiserver.key root 5522 5416 3 14:58 ?00:00:16 kube-controller-manager --flex-volume-plugin-dir=/var/lib/kubelet/volumeplugins --terminated-pod-gc-threshold=1000 --permit-port-sharing=true --address=127.0.0.1 --allocate-node-cidrs=true --bind-address=127.0.0.1 --cert-dir=/var/lib/rancher/rke2/server/tls/kube-controller-manager --cluster-cidr=10.42.0.0/16 --cluster-signing-kube-apiserver-client-cert-file=/var/lib/rancher/rke2/server/tls/client-ca.crt --cluster-signing-kube-apiserver-client-key-file=/var/lib/rancher/rke2/server/tls/client-ca.key --cluster-signing-kubelet-client-cert-file=/var/lib/rancher/rke2/server/tls/client-ca.crt --cluster-signing-kubelet-client-key-file=/var/lib/rancher/rke2/server/tls/client-ca.key --cluster-signing-kubelet-serving-cert-file=/var/lib/rancher/rke2/server/tls/server-ca.crt --cluster-signing-kubelet-serving-key-file=/var/lib/rancher/rke2/server/tls/server-ca.key --cluster-signing-legacy-unknown-cert-file=/var/lib/rancher/rke2/server/tls/client-ca.crt --cluster-signing-legacy-unknown-key-file=/var/lib/rancher/rke2/server/tls/client-ca.key --configure-cloud-routes=false --controllers=*,-service,-route,-cloud-node-lifecycle --kubeconfig=/var/lib/rancher/rke2/server/cred/controller.kubeconfig --port=10252 --profiling=false --root-ca-file=/var/lib/rancher/rke2/server/tls/server-ca.crt --secure-port=10257 --service-account-private-key-file=/var/lib/rancher/rke2/server/tls/service.key --use-service-account-credentials=true\n")),(0,n.kt)("h3",{id:"1219\u786e\u4fdd---insecure-port-\u53c2\u6570\u8bbe\u7f6e\u4e3a-0\u81ea\u52a8"},"1.2.19\u786e\u4fdd --insecure-port \u53c2\u6570\u8bbe\u7f6e\u4e3a 0\uff08\u81ea\u52a8\uff09"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1apass"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u5728 Master \u8282\u70b9\u4e0a\u7f16\u8f91 API Server pod \u89c4\u8303\u6587\u4ef6 /var/lib/rancher/rke2/agent/pod-manifests/kube-apiserver.yaml \u5e76\u8bbe\u7f6e\u4ee5\u4e0b\u53c2\u6570\u3002\n--insecure-port=0"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"/bin/ps -ef | grep kube-apiserver | grep -v grep\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u9884\u671f\u7ed3\u679c"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},"'0' is equal to '0'\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u8fd4\u56de\u503c"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},"root 5275 5222 15 14:58 ?00:01:26 kube-apiserver --audit-policy-file=/etc/rancher/rke2/audit-policy.yaml --audit-log-path=/var/lib/rancher/rke2/server/logs/audit.log --audit-log-maxage=30 --audit-log-maxbackup=10 --audit-log-maxsize=100 --kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname --allow-privileged=true --anonymous-auth=false --api-audiences=https://kubernetes.default.svc.cluster.local,rke2 --authorization-mode=Node,RBAC --bind-address=0.0.0.0 --cert-dir=/var/lib/rancher/rke2/server/tls/temporary-certs --client-ca-file=/var/lib/rancher/rke2/server/tls/client-ca.crt --enable-admission-plugins=NodeRestriction,PodSecurityPolicy --encryption-provider-config=/var/lib/rancher/rke2/server/cred/encryption-config.json --etcd-cafile=/var/lib/rancher/rke2/server/tls/etcd/server-ca.crt --etcd-certfile=/var/lib/rancher/rke2/server/tls/etcd/client.crt --etcd-keyfile=/var/lib/rancher/rke2/server/tls/etcd/client.key --etcd-servers=https://127.0.0.1:2379 --insecure-port=0 --kubelet-certificate-authority=/var/lib/rancher/rke2/server/tls/server-ca.crt --kubelet-client-certificate=/var/lib/rancher/rke2/server/tls/client-kube-apiserver.crt --kubelet-client-key=/var/lib/rancher/rke2/server/tls/client-kube-apiserver.key --profiling=false --proxy-client-cert-file=/var/lib/rancher/rke2/server/tls/client-auth-proxy.crt --proxy-client-key-file=/var/lib/rancher/rke2/server/tls/client-auth-proxy.key --requestheader-allowed-names=system:auth-proxy --requestheader-client-ca-file=/var/lib/rancher/rke2/server/tls/request-header-ca.crt --requestheader-extra-headers-prefix=X-Remote-Extra- --requestheader-group-headers=X-Remote-Group --requestheader-username-headers=X-Remote-User --secure-port=6443 --service-account-issuer=https://kubernetes.default.svc.cluster.local --service-account-key-file=/var/lib/rancher/rke2/server/tls/service.key --service-account-signing-key-file=/var/lib/rancher/rke2/server/tls/service.key --service-cluster-ip-range=10.43.0.0/16 --service-node-port-range=30000-32767 --storage-backend=etcd3 --tls-cert-file=/var/lib/rancher/rke2/server/tls/serving-kube-apiserver.crt --tls-private-key-file=/var/lib/rancher/rke2/server/tls/serving-kube-apiserver.key root 5522 5416 3 14:58 ?00:00:16 kube-controller-manager --flex-volume-plugin-dir=/var/lib/kubelet/volumeplugins --terminated-pod-gc-threshold=1000 --permit-port-sharing=true --address=127.0.0.1 --allocate-node-cidrs=true --bind-address=127.0.0.1 --cert-dir=/var/lib/rancher/rke2/server/tls/kube-controller-manager --cluster-cidr=10.42.0.0/16 --cluster-signing-kube-apiserver-client-cert-file=/var/lib/rancher/rke2/server/tls/client-ca.crt --cluster-signing-kube-apiserver-client-key-file=/var/lib/rancher/rke2/server/tls/client-ca.key --cluster-signing-kubelet-client-cert-file=/var/lib/rancher/rke2/server/tls/client-ca.crt --cluster-signing-kubelet-client-key-file=/var/lib/rancher/rke2/server/tls/client-ca.key --cluster-signing-kubelet-serving-cert-file=/var/lib/rancher/rke2/server/tls/server-ca.crt --cluster-signing-kubelet-serving-key-file=/var/lib/rancher/rke2/server/tls/server-ca.key --cluster-signing-legacy-unknown-cert-file=/var/lib/rancher/rke2/server/tls/client-ca.crt --cluster-signing-legacy-unknown-key-file=/var/lib/rancher/rke2/server/tls/client-ca.key --configure-cloud-routes=false --controllers=*,-service,-route,-cloud-node-lifecycle --kubeconfig=/var/lib/rancher/rke2/server/cred/controller.kubeconfig --port=10252 --profiling=false --root-ca-file=/var/lib/rancher/rke2/server/tls/server-ca.crt --secure-port=10257 --service-account-private-key-file=/var/lib/rancher/rke2/server/tls/service.key --use-service-account-credentials=true\n")),(0,n.kt)("h3",{id:"1220\u786e\u4fdd---secure-port-\u53c2\u6570\u672a\u8bbe\u7f6e\u4e3a-0\u81ea\u52a8"},"1.2.20\u786e\u4fdd --secure-port \u53c2\u6570\u672a\u8bbe\u7f6e\u4e3a 0\uff08\u81ea\u52a8\uff09"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1apass"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u5728 Master \u8282\u70b9\u4e0a\u7f16\u8f91 API Server pod \u89c4\u8303\u6587\u4ef6 /var/lib/rancher/rke2/agent/pod-manifests/kube-apiserver.yaml\uff0c\u5e76\u5220\u9664 ",(0,n.kt)("inlineCode",{parentName:"p"},"--secure-port")," \u53c2\u6570\u6216\u5c06\u5176\u8bbe\u7f6e\u4e3a\u53e6\u4e00\u4e2a\u6240\u9700\u7aef\u53e3\uff08\u975e\u96f6\uff09\u3002"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"/bin/ps -ef | grep kube-apiserver | grep -v grep\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u9884\u671f\u7ed3\u679c"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},"6443 is greater than 0 OR '--secure-port' is not present\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u8fd4\u56de\u503c"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},"root 5275 5222 15 14:58 ?00:01:26 kube-apiserver --audit-policy-file=/etc/rancher/rke2/audit-policy.yaml --audit-log-path=/var/lib/rancher/rke2/server/logs/audit.log --audit-log-maxage=30 --audit-log-maxbackup=10 --audit-log-maxsize=100 --kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname --allow-privileged=true --anonymous-auth=false --api-audiences=https://kubernetes.default.svc.cluster.local,rke2 --authorization-mode=Node,RBAC --bind-address=0.0.0.0 --cert-dir=/var/lib/rancher/rke2/server/tls/temporary-certs --client-ca-file=/var/lib/rancher/rke2/server/tls/client-ca.crt --enable-admission-plugins=NodeRestriction,PodSecurityPolicy --encryption-provider-config=/var/lib/rancher/rke2/server/cred/encryption-config.json --etcd-cafile=/var/lib/rancher/rke2/server/tls/etcd/server-ca.crt --etcd-certfile=/var/lib/rancher/rke2/server/tls/etcd/client.crt --etcd-keyfile=/var/lib/rancher/rke2/server/tls/etcd/client.key --etcd-servers=https://127.0.0.1:2379 --insecure-port=0 --kubelet-certificate-authority=/var/lib/rancher/rke2/server/tls/server-ca.crt --kubelet-client-certificate=/var/lib/rancher/rke2/server/tls/client-kube-apiserver.crt --kubelet-client-key=/var/lib/rancher/rke2/server/tls/client-kube-apiserver.key --profiling=false --proxy-client-cert-file=/var/lib/rancher/rke2/server/tls/client-auth-proxy.crt --proxy-client-key-file=/var/lib/rancher/rke2/server/tls/client-auth-proxy.key --requestheader-allowed-names=system:auth-proxy --requestheader-client-ca-file=/var/lib/rancher/rke2/server/tls/request-header-ca.crt --requestheader-extra-headers-prefix=X-Remote-Extra- --requestheader-group-headers=X-Remote-Group --requestheader-username-headers=X-Remote-User --secure-port=6443 --service-account-issuer=https://kubernetes.default.svc.cluster.local --service-account-key-file=/var/lib/rancher/rke2/server/tls/service.key --service-account-signing-key-file=/var/lib/rancher/rke2/server/tls/service.key --service-cluster-ip-range=10.43.0.0/16 --service-node-port-range=30000-32767 --storage-backend=etcd3 --tls-cert-file=/var/lib/rancher/rke2/server/tls/serving-kube-apiserver.crt --tls-private-key-file=/var/lib/rancher/rke2/server/tls/serving-kube-apiserver.key root 5522 5416 3 14:58 ?00:00:16 kube-controller-manager --flex-volume-plugin-dir=/var/lib/kubelet/volumeplugins --terminated-pod-gc-threshold=1000 --permit-port-sharing=true --address=127.0.0.1 --allocate-node-cidrs=true --bind-address=127.0.0.1 --cert-dir=/var/lib/rancher/rke2/server/tls/kube-controller-manager --cluster-cidr=10.42.0.0/16 --cluster-signing-kube-apiserver-client-cert-file=/var/lib/rancher/rke2/server/tls/client-ca.crt --cluster-signing-kube-apiserver-client-key-file=/var/lib/rancher/rke2/server/tls/client-ca.key --cluster-signing-kubelet-client-cert-file=/var/lib/rancher/rke2/server/tls/client-ca.crt --cluster-signing-kubelet-client-key-file=/var/lib/rancher/rke2/server/tls/client-ca.key --cluster-signing-kubelet-serving-cert-file=/var/lib/rancher/rke2/server/tls/server-ca.crt --cluster-signing-kubelet-serving-key-file=/var/lib/rancher/rke2/server/tls/server-ca.key --cluster-signing-legacy-unknown-cert-file=/var/lib/rancher/rke2/server/tls/client-ca.crt --cluster-signing-legacy-unknown-key-file=/var/lib/rancher/rke2/server/tls/client-ca.key --configure-cloud-routes=false --controllers=*,-service,-route,-cloud-node-lifecycle --kubeconfig=/var/lib/rancher/rke2/server/cred/controller.kubeconfig --port=10252 --profiling=false --root-ca-file=/var/lib/rancher/rke2/server/tls/server-ca.crt --secure-port=10257 --service-account-private-key-file=/var/lib/rancher/rke2/server/tls/service.key --use-service-account-credentials=true\n")),(0,n.kt)("h3",{id:"1221\u786e\u4fdd---profiling-\u53c2\u6570\u8bbe\u7f6e\u4e3a-false\u81ea\u52a8"},"1.2.21\u786e\u4fdd --profiling \u53c2\u6570\u8bbe\u7f6e\u4e3a false\uff08\u81ea\u52a8\uff09"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1apass"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u5728 Master \u8282\u70b9\u4e0a\u7f16\u8f91 API Server pod \u89c4\u8303\u6587\u4ef6 /var/lib/rancher/rke2/agent/pod-manifests/kube-apiserver.yaml \u5e76\u8bbe\u7f6e\u4ee5\u4e0b\u53c2\u6570\u3002\n--profiling=false"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"/bin/ps -ef | grep kube-apiserver | grep -v grep\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u9884\u671f\u7ed3\u679c"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},"'false' is equal to 'false'\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u8fd4\u56de\u503c"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},"root 5275 5222 15 14:58 ?00:01:26 kube-apiserver --audit-policy-file=/etc/rancher/rke2/audit-policy.yaml --audit-log-path=/var/lib/rancher/rke2/server/logs/audit.log --audit-log-maxage=30 --audit-log-maxbackup=10 --audit-log-maxsize=100 --kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname --allow-privileged=true --anonymous-auth=false --api-audiences=https://kubernetes.default.svc.cluster.local,rke2 --authorization-mode=Node,RBAC --bind-address=0.0.0.0 --cert-dir=/var/lib/rancher/rke2/server/tls/temporary-certs --client-ca-file=/var/lib/rancher/rke2/server/tls/client-ca.crt --enable-admission-plugins=NodeRestriction,PodSecurityPolicy --encryption-provider-config=/var/lib/rancher/rke2/server/cred/encryption-config.json --etcd-cafile=/var/lib/rancher/rke2/server/tls/etcd/server-ca.crt --etcd-certfile=/var/lib/rancher/rke2/server/tls/etcd/client.crt --etcd-keyfile=/var/lib/rancher/rke2/server/tls/etcd/client.key --etcd-servers=https://127.0.0.1:2379 --insecure-port=0 --kubelet-certificate-authority=/var/lib/rancher/rke2/server/tls/server-ca.crt --kubelet-client-certificate=/var/lib/rancher/rke2/server/tls/client-kube-apiserver.crt --kubelet-client-key=/var/lib/rancher/rke2/server/tls/client-kube-apiserver.key --profiling=false --proxy-client-cert-file=/var/lib/rancher/rke2/server/tls/client-auth-proxy.crt --proxy-client-key-file=/var/lib/rancher/rke2/server/tls/client-auth-proxy.key --requestheader-allowed-names=system:auth-proxy --requestheader-client-ca-file=/var/lib/rancher/rke2/server/tls/request-header-ca.crt --requestheader-extra-headers-prefix=X-Remote-Extra- --requestheader-group-headers=X-Remote-Group --requestheader-username-headers=X-Remote-User --secure-port=6443 --service-account-issuer=https://kubernetes.default.svc.cluster.local --service-account-key-file=/var/lib/rancher/rke2/server/tls/service.key --service-account-signing-key-file=/var/lib/rancher/rke2/server/tls/service.key --service-cluster-ip-range=10.43.0.0/16 --service-node-port-range=30000-32767 --storage-backend=etcd3 --tls-cert-file=/var/lib/rancher/rke2/server/tls/serving-kube-apiserver.crt --tls-private-key-file=/var/lib/rancher/rke2/server/tls/serving-kube-apiserver.key root 5522 5416 3 14:58 ?00:00:16 kube-controller-manager --flex-volume-plugin-dir=/var/lib/kubelet/volumeplugins --terminated-pod-gc-threshold=1000 --permit-port-sharing=true --address=127.0.0.1 --allocate-node-cidrs=true --bind-address=127.0.0.1 --cert-dir=/var/lib/rancher/rke2/server/tls/kube-controller-manager --cluster-cidr=10.42.0.0/16 --cluster-signing-kube-apiserver-client-cert-file=/var/lib/rancher/rke2/server/tls/client-ca.crt --cluster-signing-kube-apiserver-client-key-file=/var/lib/rancher/rke2/server/tls/client-ca.key --cluster-signing-kubelet-client-cert-file=/var/lib/rancher/rke2/server/tls/client-ca.crt --cluster-signing-kubelet-client-key-file=/var/lib/rancher/rke2/server/tls/client-ca.key --cluster-signing-kubelet-serving-cert-file=/var/lib/rancher/rke2/server/tls/server-ca.crt --cluster-signing-kubelet-serving-key-file=/var/lib/rancher/rke2/server/tls/server-ca.key --cluster-signing-legacy-unknown-cert-file=/var/lib/rancher/rke2/server/tls/client-ca.crt --cluster-signing-legacy-unknown-key-file=/var/lib/rancher/rke2/server/tls/client-ca.key --configure-cloud-routes=false --controllers=*,-service,-route,-cloud-node-lifecycle --kubeconfig=/var/lib/rancher/rke2/server/cred/controller.kubeconfig --port=10252 --profiling=false --root-ca-file=/var/lib/rancher/rke2/server/tls/server-ca.crt --secure-port=10257 --service-account-private-key-file=/var/lib/rancher/rke2/server/tls/service.key --use-service-account-credentials=true\n")),(0,n.kt)("h3",{id:"1222\u786e\u4fdd\u8bbe\u7f6e\u4e86---audit-log-path-\u53c2\u6570\u81ea\u52a8"},"1.2.22\u786e\u4fdd\u8bbe\u7f6e\u4e86 --audit-log-path \u53c2\u6570\uff08\u81ea\u52a8\uff09"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1apass"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u5728 Master \u8282\u70b9\u4e0a\u7f16\u8f91 API Server pod \u89c4\u8303\u6587\u4ef6 /var/lib/rancher/rke2/agent/pod-manifests/kube-apiserver.yaml\uff0c\u5e76\u5c06 ",(0,n.kt)("inlineCode",{parentName:"p"},"--audit-log-path")," \u53c2\u6570\u8bbe\u7f6e\u4e3a\u6240\u9700\u7684\u8def\u5f84\u4ee5\u53ca\u8981\u5199\u5165\u5ba1\u8ba1\u65e5\u5fd7\u7684\u6587\u4ef6\u3002\n\u4f8b\u5982\uff1a--audit-log-path=/var/log/apiserver/audit.log"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"/bin/ps -ef | grep kube-apiserver | grep -v grep\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u9884\u671f\u7ed3\u679c"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},"'--audit-log-path' is present\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u8fd4\u56de\u503c"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},"root 5275 5222 15 14:58 ?00:01:26 kube-apiserver --audit-policy-file=/etc/rancher/rke2/audit-policy.yaml --audit-log-path=/var/lib/rancher/rke2/server/logs/audit.log --audit-log-maxage=30 --audit-log-maxbackup=10 --audit-log-maxsize=100 --kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname --allow-privileged=true --anonymous-auth=false --api-audiences=https://kubernetes.default.svc.cluster.local,rke2 --authorization-mode=Node,RBAC --bind-address=0.0.0.0 --cert-dir=/var/lib/rancher/rke2/server/tls/temporary-certs --client-ca-file=/var/lib/rancher/rke2/server/tls/client-ca.crt --enable-admission-plugins=NodeRestriction,PodSecurityPolicy --encryption-provider-config=/var/lib/rancher/rke2/server/cred/encryption-config.json --etcd-cafile=/var/lib/rancher/rke2/server/tls/etcd/server-ca.crt --etcd-certfile=/var/lib/rancher/rke2/server/tls/etcd/client.crt --etcd-keyfile=/var/lib/rancher/rke2/server/tls/etcd/client.key --etcd-servers=https://127.0.0.1:2379 --insecure-port=0 --kubelet-certificate-authority=/var/lib/rancher/rke2/server/tls/server-ca.crt --kubelet-client-certificate=/var/lib/rancher/rke2/server/tls/client-kube-apiserver.crt --kubelet-client-key=/var/lib/rancher/rke2/server/tls/client-kube-apiserver.key --profiling=false --proxy-client-cert-file=/var/lib/rancher/rke2/server/tls/client-auth-proxy.crt --proxy-client-key-file=/var/lib/rancher/rke2/server/tls/client-auth-proxy.key --requestheader-allowed-names=system:auth-proxy --requestheader-client-ca-file=/var/lib/rancher/rke2/server/tls/request-header-ca.crt --requestheader-extra-headers-prefix=X-Remote-Extra- --requestheader-group-headers=X-Remote-Group --requestheader-username-headers=X-Remote-User --secure-port=6443 --service-account-issuer=https://kubernetes.default.svc.cluster.local --service-account-key-file=/var/lib/rancher/rke2/server/tls/service.key --service-account-signing-key-file=/var/lib/rancher/rke2/server/tls/service.key --service-cluster-ip-range=10.43.0.0/16 --service-node-port-range=30000-32767 --storage-backend=etcd3 --tls-cert-file=/var/lib/rancher/rke2/server/tls/serving-kube-apiserver.crt --tls-private-key-file=/var/lib/rancher/rke2/server/tls/serving-kube-apiserver.key root 5522 5416 3 14:58 ?00:00:16 kube-controller-manager --flex-volume-plugin-dir=/var/lib/kubelet/volumeplugins --terminated-pod-gc-threshold=1000 --permit-port-sharing=true --address=127.0.0.1 --allocate-node-cidrs=true --bind-address=127.0.0.1 --cert-dir=/var/lib/rancher/rke2/server/tls/kube-controller-manager --cluster-cidr=10.42.0.0/16 --cluster-signing-kube-apiserver-client-cert-file=/var/lib/rancher/rke2/server/tls/client-ca.crt --cluster-signing-kube-apiserver-client-key-file=/var/lib/rancher/rke2/server/tls/client-ca.key --cluster-signing-kubelet-client-cert-file=/var/lib/rancher/rke2/server/tls/client-ca.crt --cluster-signing-kubelet-client-key-file=/var/lib/rancher/rke2/server/tls/client-ca.key --cluster-signing-kubelet-serving-cert-file=/var/lib/rancher/rke2/server/tls/server-ca.crt --cluster-signing-kubelet-serving-key-file=/var/lib/rancher/rke2/server/tls/server-ca.key --cluster-signing-legacy-unknown-cert-file=/var/lib/rancher/rke2/server/tls/client-ca.crt --cluster-signing-legacy-unknown-key-file=/var/lib/rancher/rke2/server/tls/client-ca.key --configure-cloud-routes=false --controllers=*,-service,-route,-cloud-node-lifecycle --kubeconfig=/var/lib/rancher/rke2/server/cred/controller.kubeconfig --port=10252 --profiling=false --root-ca-file=/var/lib/rancher/rke2/server/tls/server-ca.crt --secure-port=10257 --service-account-private-key-file=/var/lib/rancher/rke2/server/tls/service.key --use-service-account-credentials=true\n")),(0,n.kt)("h3",{id:"1223\u786e\u4fdd\u5c06---audit-log-maxage-\u53c2\u6570\u8bbe\u7f6e\u4e3a-30-\u6216\u9002\u5f53\u7684\u6570\u503c\u81ea\u52a8"},"1.2.23\u786e\u4fdd\u5c06 --audit-log-maxage \u53c2\u6570\u8bbe\u7f6e\u4e3a 30 \u6216\u9002\u5f53\u7684\u6570\u503c\uff08\u81ea\u52a8\uff09"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1apass"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u5728 Master \u8282\u70b9\u4e0a\u7f16\u8f91 API Server pod \u89c4\u8303\u6587\u4ef6 /var/lib/rancher/rke2/agent/pod-manifests/kube-apiserver.yaml\uff0c\u5e76\u5c06 ",(0,n.kt)("inlineCode",{parentName:"p"},"--audit-log-maxage")," \u53c2\u6570\u8bbe\u7f6e\u4e3a 30 \u6216\u9002\u5f53\u7684\u5929\u6570\uff1a\n--audit-log-maxage=30"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"/bin/ps -ef | grep kube-apiserver | grep -v grep\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u9884\u671f\u7ed3\u679c"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},"30 is greater or equal to 30\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u8fd4\u56de\u503c"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},"root 5275 5222 15 14:58 ?00:01:26 kube-apiserver --audit-policy-file=/etc/rancher/rke2/audit-policy.yaml --audit-log-path=/var/lib/rancher/rke2/server/logs/audit.log --audit-log-maxage=30 --audit-log-maxbackup=10 --audit-log-maxsize=100 --kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname --allow-privileged=true --anonymous-auth=false --api-audiences=https://kubernetes.default.svc.cluster.local,rke2 --authorization-mode=Node,RBAC --bind-address=0.0.0.0 --cert-dir=/var/lib/rancher/rke2/server/tls/temporary-certs --client-ca-file=/var/lib/rancher/rke2/server/tls/client-ca.crt --enable-admission-plugins=NodeRestriction,PodSecurityPolicy --encryption-provider-config=/var/lib/rancher/rke2/server/cred/encryption-config.json --etcd-cafile=/var/lib/rancher/rke2/server/tls/etcd/server-ca.crt --etcd-certfile=/var/lib/rancher/rke2/server/tls/etcd/client.crt --etcd-keyfile=/var/lib/rancher/rke2/server/tls/etcd/client.key --etcd-servers=https://127.0.0.1:2379 --insecure-port=0 --kubelet-certificate-authority=/var/lib/rancher/rke2/server/tls/server-ca.crt --kubelet-client-certificate=/var/lib/rancher/rke2/server/tls/client-kube-apiserver.crt --kubelet-client-key=/var/lib/rancher/rke2/server/tls/client-kube-apiserver.key --profiling=false --proxy-client-cert-file=/var/lib/rancher/rke2/server/tls/client-auth-proxy.crt --proxy-client-key-file=/var/lib/rancher/rke2/server/tls/client-auth-proxy.key --requestheader-allowed-names=system:auth-proxy --requestheader-client-ca-file=/var/lib/rancher/rke2/server/tls/request-header-ca.crt --requestheader-extra-headers-prefix=X-Remote-Extra- --requestheader-group-headers=X-Remote-Group --requestheader-username-headers=X-Remote-User --secure-port=6443 --service-account-issuer=https://kubernetes.default.svc.cluster.local --service-account-key-file=/var/lib/rancher/rke2/server/tls/service.key --service-account-signing-key-file=/var/lib/rancher/rke2/server/tls/service.key --service-cluster-ip-range=10.43.0.0/16 --service-node-port-range=30000-32767 --storage-backend=etcd3 --tls-cert-file=/var/lib/rancher/rke2/server/tls/serving-kube-apiserver.crt --tls-private-key-file=/var/lib/rancher/rke2/server/tls/serving-kube-apiserver.key root 5522 5416 3 14:58 ?00:00:16 kube-controller-manager --flex-volume-plugin-dir=/var/lib/kubelet/volumeplugins --terminated-pod-gc-threshold=1000 --permit-port-sharing=true --address=127.0.0.1 --allocate-node-cidrs=true --bind-address=127.0.0.1 --cert-dir=/var/lib/rancher/rke2/server/tls/kube-controller-manager --cluster-cidr=10.42.0.0/16 --cluster-signing-kube-apiserver-client-cert-file=/var/lib/rancher/rke2/server/tls/client-ca.crt --cluster-signing-kube-apiserver-client-key-file=/var/lib/rancher/rke2/server/tls/client-ca.key --cluster-signing-kubelet-client-cert-file=/var/lib/rancher/rke2/server/tls/client-ca.crt --cluster-signing-kubelet-client-key-file=/var/lib/rancher/rke2/server/tls/client-ca.key --cluster-signing-kubelet-serving-cert-file=/var/lib/rancher/rke2/server/tls/server-ca.crt --cluster-signing-kubelet-serving-key-file=/var/lib/rancher/rke2/server/tls/server-ca.key --cluster-signing-legacy-unknown-cert-file=/var/lib/rancher/rke2/server/tls/client-ca.crt --cluster-signing-legacy-unknown-key-file=/var/lib/rancher/rke2/server/tls/client-ca.key --configure-cloud-routes=false --controllers=*,-service,-route,-cloud-node-lifecycle --kubeconfig=/var/lib/rancher/rke2/server/cred/controller.kubeconfig --port=10252 --profiling=false --root-ca-file=/var/lib/rancher/rke2/server/tls/server-ca.crt --secure-port=10257 --service-account-private-key-file=/var/lib/rancher/rke2/server/tls/service.key --use-service-account-credentials=true\n")),(0,n.kt)("h3",{id:"1224\u786e\u4fdd---audit-log-maxbackup-\u53c2\u6570\u8bbe\u7f6e\u4e3a-10-\u6216\u9002\u5f53\u7684\u6570\u503c\u81ea\u52a8"},"1.2.24\u786e\u4fdd --audit-log-maxbackup \u53c2\u6570\u8bbe\u7f6e\u4e3a 10 \u6216\u9002\u5f53\u7684\u6570\u503c\uff08\u81ea\u52a8\uff09"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1apass"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u5728 Master \u8282\u70b9\u4e0a\u7f16\u8f91 API Server pod \u89c4\u8303\u6587\u4ef6 /var/lib/rancher/rke2/agent/pod-manifests/kube-apiserver.yaml\uff0c\u5e76\u5c06 ",(0,n.kt)("inlineCode",{parentName:"p"},"--audit-log-maxbackup")," \u53c2\u6570\u8bbe\u7f6e\u4e3a 10 \u6216\u9002\u5f53\u7684\u6570\u503c\u3002\n--audit-log-maxbackup=10"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"/bin/ps -ef | grep kube-apiserver | grep -v grep\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u9884\u671f\u7ed3\u679c"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},"10 is greater or equal to 10\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u8fd4\u56de\u503c"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},"root 5275 5222 15 14:58 ?00:01:26 kube-apiserver --audit-policy-file=/etc/rancher/rke2/audit-policy.yaml --audit-log-path=/var/lib/rancher/rke2/server/logs/audit.log --audit-log-maxage=30 --audit-log-maxbackup=10 --audit-log-maxsize=100 --kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname --allow-privileged=true --anonymous-auth=false --api-audiences=https://kubernetes.default.svc.cluster.local,rke2 --authorization-mode=Node,RBAC --bind-address=0.0.0.0 --cert-dir=/var/lib/rancher/rke2/server/tls/temporary-certs --client-ca-file=/var/lib/rancher/rke2/server/tls/client-ca.crt --enable-admission-plugins=NodeRestriction,PodSecurityPolicy --encryption-provider-config=/var/lib/rancher/rke2/server/cred/encryption-config.json --etcd-cafile=/var/lib/rancher/rke2/server/tls/etcd/server-ca.crt --etcd-certfile=/var/lib/rancher/rke2/server/tls/etcd/client.crt --etcd-keyfile=/var/lib/rancher/rke2/server/tls/etcd/client.key --etcd-servers=https://127.0.0.1:2379 --insecure-port=0 --kubelet-certificate-authority=/var/lib/rancher/rke2/server/tls/server-ca.crt --kubelet-client-certificate=/var/lib/rancher/rke2/server/tls/client-kube-apiserver.crt --kubelet-client-key=/var/lib/rancher/rke2/server/tls/client-kube-apiserver.key --profiling=false --proxy-client-cert-file=/var/lib/rancher/rke2/server/tls/client-auth-proxy.crt --proxy-client-key-file=/var/lib/rancher/rke2/server/tls/client-auth-proxy.key --requestheader-allowed-names=system:auth-proxy --requestheader-client-ca-file=/var/lib/rancher/rke2/server/tls/request-header-ca.crt --requestheader-extra-headers-prefix=X-Remote-Extra- --requestheader-group-headers=X-Remote-Group --requestheader-username-headers=X-Remote-User --secure-port=6443 --service-account-issuer=https://kubernetes.default.svc.cluster.local --service-account-key-file=/var/lib/rancher/rke2/server/tls/service.key --service-account-signing-key-file=/var/lib/rancher/rke2/server/tls/service.key --service-cluster-ip-range=10.43.0.0/16 --service-node-port-range=30000-32767 --storage-backend=etcd3 --tls-cert-file=/var/lib/rancher/rke2/server/tls/serving-kube-apiserver.crt --tls-private-key-file=/var/lib/rancher/rke2/server/tls/serving-kube-apiserver.key root 5522 5416 3 14:58 ?00:00:16 kube-controller-manager --flex-volume-plugin-dir=/var/lib/kubelet/volumeplugins --terminated-pod-gc-threshold=1000 --permit-port-sharing=true --address=127.0.0.1 --allocate-node-cidrs=true --bind-address=127.0.0.1 --cert-dir=/var/lib/rancher/rke2/server/tls/kube-controller-manager --cluster-cidr=10.42.0.0/16 --cluster-signing-kube-apiserver-client-cert-file=/var/lib/rancher/rke2/server/tls/client-ca.crt --cluster-signing-kube-apiserver-client-key-file=/var/lib/rancher/rke2/server/tls/client-ca.key --cluster-signing-kubelet-client-cert-file=/var/lib/rancher/rke2/server/tls/client-ca.crt --cluster-signing-kubelet-client-key-file=/var/lib/rancher/rke2/server/tls/client-ca.key --cluster-signing-kubelet-serving-cert-file=/var/lib/rancher/rke2/server/tls/server-ca.crt --cluster-signing-kubelet-serving-key-file=/var/lib/rancher/rke2/server/tls/server-ca.key --cluster-signing-legacy-unknown-cert-file=/var/lib/rancher/rke2/server/tls/client-ca.crt --cluster-signing-legacy-unknown-key-file=/var/lib/rancher/rke2/server/tls/client-ca.key --configure-cloud-routes=false --controllers=*,-service,-route,-cloud-node-lifecycle --kubeconfig=/var/lib/rancher/rke2/server/cred/controller.kubeconfig --port=10252 --profiling=false --root-ca-file=/var/lib/rancher/rke2/server/tls/server-ca.crt --secure-port=10257 --service-account-private-key-file=/var/lib/rancher/rke2/server/tls/service.key --use-service-account-credentials=true\n")),(0,n.kt)("h3",{id:"1225\u786e\u4fdd---audit-log-maxsize-\u53c2\u6570\u8bbe\u7f6e\u4e3a-100-\u6216\u9002\u5f53\u7684\u6570\u503c\u81ea\u52a8"},"1.2.25\u786e\u4fdd --audit-log-maxsize \u53c2\u6570\u8bbe\u7f6e\u4e3a 100 \u6216\u9002\u5f53\u7684\u6570\u503c\uff08\u81ea\u52a8\uff09"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1apass"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u5728 Master \u8282\u70b9\u4e0a\u7f16\u8f91 API Server pod \u89c4\u8303\u6587\u4ef6 /var/lib/rancher/rke2/agent/pod-manifests/kube-apiserver.yaml\uff0c\u5e76\u5c06 ",(0,n.kt)("inlineCode",{parentName:"p"},"--audit-log-maxsize")," \u53c2\u6570\u8bbe\u7f6e\u4e3a\u9002\u5f53\u7684\u5927\u5c0f\uff08\u4ee5 MB \u4e3a\u5355\u4f4d\uff09\u3002\n\u4f8b\u5982\uff0c\u8981\u5c06\u5176\u8bbe\u7f6e\u4e3a 100 MB\uff1a\n--audit-log-maxsize=100"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"/bin/ps -ef | grep kube-apiserver | grep -v grep\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u9884\u671f\u7ed3\u679c"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},"100 is greater or equal to 100\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u8fd4\u56de\u503c"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},"root 5275 5222 15 14:58 ?00:01:26 kube-apiserver --audit-policy-file=/etc/rancher/rke2/audit-policy.yaml --audit-log-path=/var/lib/rancher/rke2/server/logs/audit.log --audit-log-maxage=30 --audit-log-maxbackup=10 --audit-log-maxsize=100 --kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname --allow-privileged=true --anonymous-auth=false --api-audiences=https://kubernetes.default.svc.cluster.local,rke2 --authorization-mode=Node,RBAC --bind-address=0.0.0.0 --cert-dir=/var/lib/rancher/rke2/server/tls/temporary-certs --client-ca-file=/var/lib/rancher/rke2/server/tls/client-ca.crt --enable-admission-plugins=NodeRestriction,PodSecurityPolicy --encryption-provider-config=/var/lib/rancher/rke2/server/cred/encryption-config.json --etcd-cafile=/var/lib/rancher/rke2/server/tls/etcd/server-ca.crt --etcd-certfile=/var/lib/rancher/rke2/server/tls/etcd/client.crt --etcd-keyfile=/var/lib/rancher/rke2/server/tls/etcd/client.key --etcd-servers=https://127.0.0.1:2379 --insecure-port=0 --kubelet-certificate-authority=/var/lib/rancher/rke2/server/tls/server-ca.crt --kubelet-client-certificate=/var/lib/rancher/rke2/server/tls/client-kube-apiserver.crt --kubelet-client-key=/var/lib/rancher/rke2/server/tls/client-kube-apiserver.key --profiling=false --proxy-client-cert-file=/var/lib/rancher/rke2/server/tls/client-auth-proxy.crt --proxy-client-key-file=/var/lib/rancher/rke2/server/tls/client-auth-proxy.key --requestheader-allowed-names=system:auth-proxy --requestheader-client-ca-file=/var/lib/rancher/rke2/server/tls/request-header-ca.crt --requestheader-extra-headers-prefix=X-Remote-Extra- --requestheader-group-headers=X-Remote-Group --requestheader-username-headers=X-Remote-User --secure-port=6443 --service-account-issuer=https://kubernetes.default.svc.cluster.local --service-account-key-file=/var/lib/rancher/rke2/server/tls/service.key --service-account-signing-key-file=/var/lib/rancher/rke2/server/tls/service.key --service-cluster-ip-range=10.43.0.0/16 --service-node-port-range=30000-32767 --storage-backend=etcd3 --tls-cert-file=/var/lib/rancher/rke2/server/tls/serving-kube-apiserver.crt --tls-private-key-file=/var/lib/rancher/rke2/server/tls/serving-kube-apiserver.key root 5522 5416 3 14:58 ?00:00:16 kube-controller-manager --flex-volume-plugin-dir=/var/lib/kubelet/volumeplugins --terminated-pod-gc-threshold=1000 --permit-port-sharing=true --address=127.0.0.1 --allocate-node-cidrs=true --bind-address=127.0.0.1 --cert-dir=/var/lib/rancher/rke2/server/tls/kube-controller-manager --cluster-cidr=10.42.0.0/16 --cluster-signing-kube-apiserver-client-cert-file=/var/lib/rancher/rke2/server/tls/client-ca.crt --cluster-signing-kube-apiserver-client-key-file=/var/lib/rancher/rke2/server/tls/client-ca.key --cluster-signing-kubelet-client-cert-file=/var/lib/rancher/rke2/server/tls/client-ca.crt --cluster-signing-kubelet-client-key-file=/var/lib/rancher/rke2/server/tls/client-ca.key --cluster-signing-kubelet-serving-cert-file=/var/lib/rancher/rke2/server/tls/server-ca.crt --cluster-signing-kubelet-serving-key-file=/var/lib/rancher/rke2/server/tls/server-ca.key --cluster-signing-legacy-unknown-cert-file=/var/lib/rancher/rke2/server/tls/client-ca.crt --cluster-signing-legacy-unknown-key-file=/var/lib/rancher/rke2/server/tls/client-ca.key --configure-cloud-routes=false --controllers=*,-service,-route,-cloud-node-lifecycle --kubeconfig=/var/lib/rancher/rke2/server/cred/controller.kubeconfig --port=10252 --profiling=false --root-ca-file=/var/lib/rancher/rke2/server/tls/server-ca.crt --secure-port=10257 --service-account-private-key-file=/var/lib/rancher/rke2/server/tls/service.key --use-service-account-credentials=true\n")),(0,n.kt)("h3",{id:"1226\u786e\u4fdd\u80fd\u6839\u636e\u9700\u8981\u8bbe\u7f6e---request-timeout-\u53c2\u6570\u81ea\u52a8"},"1.2.26\u786e\u4fdd\u80fd\u6839\u636e\u9700\u8981\u8bbe\u7f6e --request-timeout \u53c2\u6570\uff08\u81ea\u52a8\uff09"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1apass"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u7f16\u8f91 API Server pod \u89c4\u8303\u6587\u4ef6 /var/lib/rancher/rke2/agent/pod-manifests/kube-apiserver.yaml\uff0c\u5e76\u6839\u636e\u9700\u8981\u8bbe\u7f6e\u4ee5\u4e0b\u53c2\u6570\u3002\n\u4f8b\u5982\uff1a--request-timeout=300s"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"/bin/ps -ef | grep kube-apiserver | grep -v grep\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u9884\u671f\u7ed3\u679c"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},"'--request-timeout' is not present OR '--request-timeout' is not present\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u8fd4\u56de\u503c"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},"root 5275 5222 15 14:58 ?00:01:26 kube-apiserver --audit-policy-file=/etc/rancher/rke2/audit-policy.yaml --audit-log-path=/var/lib/rancher/rke2/server/logs/audit.log --audit-log-maxage=30 --audit-log-maxbackup=10 --audit-log-maxsize=100 --kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname --allow-privileged=true --anonymous-auth=false --api-audiences=https://kubernetes.default.svc.cluster.local,rke2 --authorization-mode=Node,RBAC --bind-address=0.0.0.0 --cert-dir=/var/lib/rancher/rke2/server/tls/temporary-certs --client-ca-file=/var/lib/rancher/rke2/server/tls/client-ca.crt --enable-admission-plugins=NodeRestriction,PodSecurityPolicy --encryption-provider-config=/var/lib/rancher/rke2/server/cred/encryption-config.json --etcd-cafile=/var/lib/rancher/rke2/server/tls/etcd/server-ca.crt --etcd-certfile=/var/lib/rancher/rke2/server/tls/etcd/client.crt --etcd-keyfile=/var/lib/rancher/rke2/server/tls/etcd/client.key --etcd-servers=https://127.0.0.1:2379 --insecure-port=0 --kubelet-certificate-authority=/var/lib/rancher/rke2/server/tls/server-ca.crt --kubelet-client-certificate=/var/lib/rancher/rke2/server/tls/client-kube-apiserver.crt --kubelet-client-key=/var/lib/rancher/rke2/server/tls/client-kube-apiserver.key --profiling=false --proxy-client-cert-file=/var/lib/rancher/rke2/server/tls/client-auth-proxy.crt --proxy-client-key-file=/var/lib/rancher/rke2/server/tls/client-auth-proxy.key --requestheader-allowed-names=system:auth-proxy --requestheader-client-ca-file=/var/lib/rancher/rke2/server/tls/request-header-ca.crt --requestheader-extra-headers-prefix=X-Remote-Extra- --requestheader-group-headers=X-Remote-Group --requestheader-username-headers=X-Remote-User --secure-port=6443 --service-account-issuer=https://kubernetes.default.svc.cluster.local --service-account-key-file=/var/lib/rancher/rke2/server/tls/service.key --service-account-signing-key-file=/var/lib/rancher/rke2/server/tls/service.key --service-cluster-ip-range=10.43.0.0/16 --service-node-port-range=30000-32767 --storage-backend=etcd3 --tls-cert-file=/var/lib/rancher/rke2/server/tls/serving-kube-apiserver.crt --tls-private-key-file=/var/lib/rancher/rke2/server/tls/serving-kube-apiserver.key root 5522 5416 3 14:58 ?00:00:16 kube-controller-manager --flex-volume-plugin-dir=/var/lib/kubelet/volumeplugins --terminated-pod-gc-threshold=1000 --permit-port-sharing=true --address=127.0.0.1 --allocate-node-cidrs=true --bind-address=127.0.0.1 --cert-dir=/var/lib/rancher/rke2/server/tls/kube-controller-manager --cluster-cidr=10.42.0.0/16 --cluster-signing-kube-apiserver-client-cert-file=/var/lib/rancher/rke2/server/tls/client-ca.crt --cluster-signing-kube-apiserver-client-key-file=/var/lib/rancher/rke2/server/tls/client-ca.key --cluster-signing-kubelet-client-cert-file=/var/lib/rancher/rke2/server/tls/client-ca.crt --cluster-signing-kubelet-client-key-file=/var/lib/rancher/rke2/server/tls/client-ca.key --cluster-signing-kubelet-serving-cert-file=/var/lib/rancher/rke2/server/tls/server-ca.crt --cluster-signing-kubelet-serving-key-file=/var/lib/rancher/rke2/server/tls/server-ca.key --cluster-signing-legacy-unknown-cert-file=/var/lib/rancher/rke2/server/tls/client-ca.crt --cluster-signing-legacy-unknown-key-file=/var/lib/rancher/rke2/server/tls/client-ca.key --configure-cloud-routes=false --controllers=*,-service,-route,-cloud-node-lifecycle --kubeconfig=/var/lib/rancher/rke2/server/cred/controller.kubeconfig --port=10252 --profiling=false --root-ca-file=/var/lib/rancher/rke2/server/tls/server-ca.crt --secure-port=10257 --service-account-private-key-file=/var/lib/rancher/rke2/server/tls/service.key --use-service-account-credentials=true\n")),(0,n.kt)("h3",{id:"1227\u786e\u4fdd---service-account-lookup-\u53c2\u6570\u8bbe\u7f6e\u4e3a-true\u81ea\u52a8"},"1.2.27\u786e\u4fdd --service-account-lookup \u53c2\u6570\u8bbe\u7f6e\u4e3a true\uff08\u81ea\u52a8\uff09"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1apass"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u5728 Master \u8282\u70b9\u4e0a\u7f16\u8f91 API Server pod \u89c4\u8303\u6587\u4ef6 /var/lib/rancher/rke2/agent/pod-manifests/kube-apiserver.yaml \u5e76\u8bbe\u7f6e\u4ee5\u4e0b\u53c2\u6570\u3002\n--service-account-lookup=true"),(0,n.kt)("p",null,"\u4f60\u4e5f\u53ef\u4ee5\u5220\u9664\u6b64\u6587\u4ef6\u7684 --service-account-lookup \u53c2\u6570\uff0c\u4ece\u800c\u4f7f\u9ed8\u8ba4\u8bbe\u7f6e\u751f\u6548\u3002"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"/bin/ps -ef | grep kube-apiserver | grep -v grep\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u9884\u671f\u7ed3\u679c"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},"'--service-account-lookup' is not present OR '--service-account-lookup' is not present\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u8fd4\u56de\u503c"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},"root 5275 5222 15 14:58 ?00:01:26 kube-apiserver --audit-policy-file=/etc/rancher/rke2/audit-policy.yaml --audit-log-path=/var/lib/rancher/rke2/server/logs/audit.log --audit-log-maxage=30 --audit-log-maxbackup=10 --audit-log-maxsize=100 --kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname --allow-privileged=true --anonymous-auth=false --api-audiences=https://kubernetes.default.svc.cluster.local,rke2 --authorization-mode=Node,RBAC --bind-address=0.0.0.0 --cert-dir=/var/lib/rancher/rke2/server/tls/temporary-certs --client-ca-file=/var/lib/rancher/rke2/server/tls/client-ca.crt --enable-admission-plugins=NodeRestriction,PodSecurityPolicy --encryption-provider-config=/var/lib/rancher/rke2/server/cred/encryption-config.json --etcd-cafile=/var/lib/rancher/rke2/server/tls/etcd/server-ca.crt --etcd-certfile=/var/lib/rancher/rke2/server/tls/etcd/client.crt --etcd-keyfile=/var/lib/rancher/rke2/server/tls/etcd/client.key --etcd-servers=https://127.0.0.1:2379 --insecure-port=0 --kubelet-certificate-authority=/var/lib/rancher/rke2/server/tls/server-ca.crt --kubelet-client-certificate=/var/lib/rancher/rke2/server/tls/client-kube-apiserver.crt --kubelet-client-key=/var/lib/rancher/rke2/server/tls/client-kube-apiserver.key --profiling=false --proxy-client-cert-file=/var/lib/rancher/rke2/server/tls/client-auth-proxy.crt --proxy-client-key-file=/var/lib/rancher/rke2/server/tls/client-auth-proxy.key --requestheader-allowed-names=system:auth-proxy --requestheader-client-ca-file=/var/lib/rancher/rke2/server/tls/request-header-ca.crt --requestheader-extra-headers-prefix=X-Remote-Extra- --requestheader-group-headers=X-Remote-Group --requestheader-username-headers=X-Remote-User --secure-port=6443 --service-account-issuer=https://kubernetes.default.svc.cluster.local --service-account-key-file=/var/lib/rancher/rke2/server/tls/service.key --service-account-signing-key-file=/var/lib/rancher/rke2/server/tls/service.key --service-cluster-ip-range=10.43.0.0/16 --service-node-port-range=30000-32767 --storage-backend=etcd3 --tls-cert-file=/var/lib/rancher/rke2/server/tls/serving-kube-apiserver.crt --tls-private-key-file=/var/lib/rancher/rke2/server/tls/serving-kube-apiserver.key root 5522 5416 3 14:58 ?00:00:16 kube-controller-manager --flex-volume-plugin-dir=/var/lib/kubelet/volumeplugins --terminated-pod-gc-threshold=1000 --permit-port-sharing=true --address=127.0.0.1 --allocate-node-cidrs=true --bind-address=127.0.0.1 --cert-dir=/var/lib/rancher/rke2/server/tls/kube-controller-manager --cluster-cidr=10.42.0.0/16 --cluster-signing-kube-apiserver-client-cert-file=/var/lib/rancher/rke2/server/tls/client-ca.crt --cluster-signing-kube-apiserver-client-key-file=/var/lib/rancher/rke2/server/tls/client-ca.key --cluster-signing-kubelet-client-cert-file=/var/lib/rancher/rke2/server/tls/client-ca.crt --cluster-signing-kubelet-client-key-file=/var/lib/rancher/rke2/server/tls/client-ca.key --cluster-signing-kubelet-serving-cert-file=/var/lib/rancher/rke2/server/tls/server-ca.crt --cluster-signing-kubelet-serving-key-file=/var/lib/rancher/rke2/server/tls/server-ca.key --cluster-signing-legacy-unknown-cert-file=/var/lib/rancher/rke2/server/tls/client-ca.crt --cluster-signing-legacy-unknown-key-file=/var/lib/rancher/rke2/server/tls/client-ca.key --configure-cloud-routes=false --controllers=*,-service,-route,-cloud-node-lifecycle --kubeconfig=/var/lib/rancher/rke2/server/cred/controller.kubeconfig --port=10252 --profiling=false --root-ca-file=/var/lib/rancher/rke2/server/tls/server-ca.crt --secure-port=10257 --service-account-private-key-file=/var/lib/rancher/rke2/server/tls/service.key --use-service-account-credentials=true\n")),(0,n.kt)("h3",{id:"1228\u786e\u4fdd\u6839\u636e\u9700\u8981\u8bbe\u7f6e---service-account-key-file-\u53c2\u6570\u81ea\u52a8"},"1.2.28\u786e\u4fdd\u6839\u636e\u9700\u8981\u8bbe\u7f6e --service-account-key-file \u53c2\u6570\uff08\u81ea\u52a8\uff09"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1apass"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u5728 Master \u8282\u70b9\u4e0a\u7f16\u8f91 API Server pod \u89c4\u8303\u6587\u4ef6 /var/lib/rancher/rke2/agent/pod-manifests/kube-apiserver.yaml\uff0c\u5e76\u4e3a ServiceAccount \u5c06 ",(0,n.kt)("inlineCode",{parentName:"p"},"--service-account-key-file")," \u53c2\u6570\u8bbe\u7f6e\u4e3a\u516c\u94a5\u6587\u4ef6\uff1a\n",(0,n.kt)("inlineCode",{parentName:"p"},"--service-account-key-file=<filename>")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"/bin/ps -ef | grep kube-apiserver | grep -v grep\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u9884\u671f\u7ed3\u679c"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},"'--service-account-key-file' is present\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u8fd4\u56de\u503c"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},"root 5275 5222 15 14:58 ?00:01:26 kube-apiserver --audit-policy-file=/etc/rancher/rke2/audit-policy.yaml --audit-log-path=/var/lib/rancher/rke2/server/logs/audit.log --audit-log-maxage=30 --audit-log-maxbackup=10 --audit-log-maxsize=100 --kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname --allow-privileged=true --anonymous-auth=false --api-audiences=https://kubernetes.default.svc.cluster.local,rke2 --authorization-mode=Node,RBAC --bind-address=0.0.0.0 --cert-dir=/var/lib/rancher/rke2/server/tls/temporary-certs --client-ca-file=/var/lib/rancher/rke2/server/tls/client-ca.crt --enable-admission-plugins=NodeRestriction,PodSecurityPolicy --encryption-provider-config=/var/lib/rancher/rke2/server/cred/encryption-config.json --etcd-cafile=/var/lib/rancher/rke2/server/tls/etcd/server-ca.crt --etcd-certfile=/var/lib/rancher/rke2/server/tls/etcd/client.crt --etcd-keyfile=/var/lib/rancher/rke2/server/tls/etcd/client.key --etcd-servers=https://127.0.0.1:2379 --insecure-port=0 --kubelet-certificate-authority=/var/lib/rancher/rke2/server/tls/server-ca.crt --kubelet-client-certificate=/var/lib/rancher/rke2/server/tls/client-kube-apiserver.crt --kubelet-client-key=/var/lib/rancher/rke2/server/tls/client-kube-apiserver.key --profiling=false --proxy-client-cert-file=/var/lib/rancher/rke2/server/tls/client-auth-proxy.crt --proxy-client-key-file=/var/lib/rancher/rke2/server/tls/client-auth-proxy.key --requestheader-allowed-names=system:auth-proxy --requestheader-client-ca-file=/var/lib/rancher/rke2/server/tls/request-header-ca.crt --requestheader-extra-headers-prefix=X-Remote-Extra- --requestheader-group-headers=X-Remote-Group --requestheader-username-headers=X-Remote-User --secure-port=6443 --service-account-issuer=https://kubernetes.default.svc.cluster.local --service-account-key-file=/var/lib/rancher/rke2/server/tls/service.key --service-account-signing-key-file=/var/lib/rancher/rke2/server/tls/service.key --service-cluster-ip-range=10.43.0.0/16 --service-node-port-range=30000-32767 --storage-backend=etcd3 --tls-cert-file=/var/lib/rancher/rke2/server/tls/serving-kube-apiserver.crt --tls-private-key-file=/var/lib/rancher/rke2/server/tls/serving-kube-apiserver.key root 5522 5416 3 14:58 ?00:00:16 kube-controller-manager --flex-volume-plugin-dir=/var/lib/kubelet/volumeplugins --terminated-pod-gc-threshold=1000 --permit-port-sharing=true --address=127.0.0.1 --allocate-node-cidrs=true --bind-address=127.0.0.1 --cert-dir=/var/lib/rancher/rke2/server/tls/kube-controller-manager --cluster-cidr=10.42.0.0/16 --cluster-signing-kube-apiserver-client-cert-file=/var/lib/rancher/rke2/server/tls/client-ca.crt --cluster-signing-kube-apiserver-client-key-file=/var/lib/rancher/rke2/server/tls/client-ca.key --cluster-signing-kubelet-client-cert-file=/var/lib/rancher/rke2/server/tls/client-ca.crt --cluster-signing-kubelet-client-key-file=/var/lib/rancher/rke2/server/tls/client-ca.key --cluster-signing-kubelet-serving-cert-file=/var/lib/rancher/rke2/server/tls/server-ca.crt --cluster-signing-kubelet-serving-key-file=/var/lib/rancher/rke2/server/tls/server-ca.key --cluster-signing-legacy-unknown-cert-file=/var/lib/rancher/rke2/server/tls/client-ca.crt --cluster-signing-legacy-unknown-key-file=/var/lib/rancher/rke2/server/tls/client-ca.key --configure-cloud-routes=false --controllers=*,-service,-route,-cloud-node-lifecycle --kubeconfig=/var/lib/rancher/rke2/server/cred/controller.kubeconfig --port=10252 --profiling=false --root-ca-file=/var/lib/rancher/rke2/server/tls/server-ca.crt --secure-port=10257 --service-account-private-key-file=/var/lib/rancher/rke2/server/tls/service.key --use-service-account-credentials=true\n")),(0,n.kt)("h3",{id:"1229\u786e\u4fdd\u6839\u636e\u9700\u8981\u8bbe\u7f6e---etcd-certfile-\u548c---etcd-keyfile-\u53c2\u6570\u81ea\u52a8"},"1.2.29\u786e\u4fdd\u6839\u636e\u9700\u8981\u8bbe\u7f6e --etcd-certfile \u548c --etcd-keyfile \u53c2\u6570\uff08\u81ea\u52a8\uff09"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1apass"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u9075\u5faa Kubernetes \u6587\u6863\u8bbe\u7f6e apiserver \u548c etcd \u7684 TLS \u8fde\u63a5\u3002\n\u7136\u540e\uff0c\u5728 Master \u8282\u70b9\u4e0a\u7f16\u8f91 API Server pod \u89c4\u8303\u6587\u4ef6 /var/lib/rancher/rke2/agent/pod-manifests/kube-apiserver.yaml\uff0c\u5e76\u8bbe\u7f6e etcd \u8bc1\u4e66\u548c\u5bc6\u94a5\u6587\u4ef6\u53c2\u6570\u3002\n",(0,n.kt)("inlineCode",{parentName:"p"},"--etcd-certfile=<path/to/client-certificate-file>"),"\n",(0,n.kt)("inlineCode",{parentName:"p"},"--etcd-keyfile=<path/to/client-key-file>")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"/bin/ps -ef | grep kube-apiserver | grep -v grep\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u9884\u671f\u7ed3\u679c"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},"'--etcd-certfile' is present AND '--etcd-keyfile' is present\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u8fd4\u56de\u503c"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},"root 5275 5222 15 14:58 ?00:01:26 kube-apiserver --audit-policy-file=/etc/rancher/rke2/audit-policy.yaml --audit-log-path=/var/lib/rancher/rke2/server/logs/audit.log --audit-log-maxage=30 --audit-log-maxbackup=10 --audit-log-maxsize=100 --kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname --allow-privileged=true --anonymous-auth=false --api-audiences=https://kubernetes.default.svc.cluster.local,rke2 --authorization-mode=Node,RBAC --bind-address=0.0.0.0 --cert-dir=/var/lib/rancher/rke2/server/tls/temporary-certs --client-ca-file=/var/lib/rancher/rke2/server/tls/client-ca.crt --enable-admission-plugins=NodeRestriction,PodSecurityPolicy --encryption-provider-config=/var/lib/rancher/rke2/server/cred/encryption-config.json --etcd-cafile=/var/lib/rancher/rke2/server/tls/etcd/server-ca.crt --etcd-certfile=/var/lib/rancher/rke2/server/tls/etcd/client.crt --etcd-keyfile=/var/lib/rancher/rke2/server/tls/etcd/client.key --etcd-servers=https://127.0.0.1:2379 --insecure-port=0 --kubelet-certificate-authority=/var/lib/rancher/rke2/server/tls/server-ca.crt --kubelet-client-certificate=/var/lib/rancher/rke2/server/tls/client-kube-apiserver.crt --kubelet-client-key=/var/lib/rancher/rke2/server/tls/client-kube-apiserver.key --profiling=false --proxy-client-cert-file=/var/lib/rancher/rke2/server/tls/client-auth-proxy.crt --proxy-client-key-file=/var/lib/rancher/rke2/server/tls/client-auth-proxy.key --requestheader-allowed-names=system:auth-proxy --requestheader-client-ca-file=/var/lib/rancher/rke2/server/tls/request-header-ca.crt --requestheader-extra-headers-prefix=X-Remote-Extra- --requestheader-group-headers=X-Remote-Group --requestheader-username-headers=X-Remote-User --secure-port=6443 --service-account-issuer=https://kubernetes.default.svc.cluster.local --service-account-key-file=/var/lib/rancher/rke2/server/tls/service.key --service-account-signing-key-file=/var/lib/rancher/rke2/server/tls/service.key --service-cluster-ip-range=10.43.0.0/16 --service-node-port-range=30000-32767 --storage-backend=etcd3 --tls-cert-file=/var/lib/rancher/rke2/server/tls/serving-kube-apiserver.crt --tls-private-key-file=/var/lib/rancher/rke2/server/tls/serving-kube-apiserver.key root 5522 5416 3 14:58 ?00:00:16 kube-controller-manager --flex-volume-plugin-dir=/var/lib/kubelet/volumeplugins --terminated-pod-gc-threshold=1000 --permit-port-sharing=true --address=127.0.0.1 --allocate-node-cidrs=true --bind-address=127.0.0.1 --cert-dir=/var/lib/rancher/rke2/server/tls/kube-controller-manager --cluster-cidr=10.42.0.0/16 --cluster-signing-kube-apiserver-client-cert-file=/var/lib/rancher/rke2/server/tls/client-ca.crt --cluster-signing-kube-apiserver-client-key-file=/var/lib/rancher/rke2/server/tls/client-ca.key --cluster-signing-kubelet-client-cert-file=/var/lib/rancher/rke2/server/tls/client-ca.crt --cluster-signing-kubelet-client-key-file=/var/lib/rancher/rke2/server/tls/client-ca.key --cluster-signing-kubelet-serving-cert-file=/var/lib/rancher/rke2/server/tls/server-ca.crt --cluster-signing-kubelet-serving-key-file=/var/lib/rancher/rke2/server/tls/server-ca.key --cluster-signing-legacy-unknown-cert-file=/var/lib/rancher/rke2/server/tls/client-ca.crt --cluster-signing-legacy-unknown-key-file=/var/lib/rancher/rke2/server/tls/client-ca.key --configure-cloud-routes=false --controllers=*,-service,-route,-cloud-node-lifecycle --kubeconfig=/var/lib/rancher/rke2/server/cred/controller.kubeconfig --port=10252 --profiling=false --root-ca-file=/var/lib/rancher/rke2/server/tls/server-ca.crt --secure-port=10257 --service-account-private-key-file=/var/lib/rancher/rke2/server/tls/service.key --use-service-account-credentials=true\n")),(0,n.kt)("h3",{id:"1230\u786e\u4fdd\u6839\u636e\u9700\u8981\u8bbe\u7f6e---tls-cert-file-\u548c---tls-private-key-file-\u53c2\u6570\u81ea\u52a8"},"1.2.30\u786e\u4fdd\u6839\u636e\u9700\u8981\u8bbe\u7f6e --tls-cert-file \u548c --tls-private-key-file \u53c2\u6570\uff08\u81ea\u52a8\uff09"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1apass"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u9075\u5faa Kubernetes \u6587\u6863\u5e76\u5728 apiserver \u4e0a\u8bbe\u7f6e TLS \u8fde\u63a5\u3002\n\u7136\u540e\uff0c\u5728 Master \u8282\u70b9\u4e0a\u7f16\u8f91 API Server pod \u89c4\u8303\u6587\u4ef6 /var/lib/rancher/rke2/agent/pod-manifests/kube-apiserver.yaml\uff0c\u5e76\u8bbe\u7f6e TLS \u8bc1\u4e66\u548c\u79c1\u94a5\u6587\u4ef6\u53c2\u6570\u3002\n",(0,n.kt)("inlineCode",{parentName:"p"},"--tls-cert-file=<path/to/tls-certificate-file>"),"\n",(0,n.kt)("inlineCode",{parentName:"p"},"--tls-private-key-file=<path/to/tls-key-file>")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"/bin/ps -ef | grep kube-apiserver | grep -v grep\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u9884\u671f\u7ed3\u679c"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},"'--tls-cert-file' is present AND '--tls-private-key-file' is present\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u8fd4\u56de\u503c"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},"root 5275 5222 15 14:58 ?00:01:26 kube-apiserver --audit-policy-file=/etc/rancher/rke2/audit-policy.yaml --audit-log-path=/var/lib/rancher/rke2/server/logs/audit.log --audit-log-maxage=30 --audit-log-maxbackup=10 --audit-log-maxsize=100 --kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname --allow-privileged=true --anonymous-auth=false --api-audiences=https://kubernetes.default.svc.cluster.local,rke2 --authorization-mode=Node,RBAC --bind-address=0.0.0.0 --cert-dir=/var/lib/rancher/rke2/server/tls/temporary-certs --client-ca-file=/var/lib/rancher/rke2/server/tls/client-ca.crt --enable-admission-plugins=NodeRestriction,PodSecurityPolicy --encryption-provider-config=/var/lib/rancher/rke2/server/cred/encryption-config.json --etcd-cafile=/var/lib/rancher/rke2/server/tls/etcd/server-ca.crt --etcd-certfile=/var/lib/rancher/rke2/server/tls/etcd/client.crt --etcd-keyfile=/var/lib/rancher/rke2/server/tls/etcd/client.key --etcd-servers=https://127.0.0.1:2379 --insecure-port=0 --kubelet-certificate-authority=/var/lib/rancher/rke2/server/tls/server-ca.crt --kubelet-client-certificate=/var/lib/rancher/rke2/server/tls/client-kube-apiserver.crt --kubelet-client-key=/var/lib/rancher/rke2/server/tls/client-kube-apiserver.key --profiling=false --proxy-client-cert-file=/var/lib/rancher/rke2/server/tls/client-auth-proxy.crt --proxy-client-key-file=/var/lib/rancher/rke2/server/tls/client-auth-proxy.key --requestheader-allowed-names=system:auth-proxy --requestheader-client-ca-file=/var/lib/rancher/rke2/server/tls/request-header-ca.crt --requestheader-extra-headers-prefix=X-Remote-Extra- --requestheader-group-headers=X-Remote-Group --requestheader-username-headers=X-Remote-User --secure-port=6443 --service-account-issuer=https://kubernetes.default.svc.cluster.local --service-account-key-file=/var/lib/rancher/rke2/server/tls/service.key --service-account-signing-key-file=/var/lib/rancher/rke2/server/tls/service.key --service-cluster-ip-range=10.43.0.0/16 --service-node-port-range=30000-32767 --storage-backend=etcd3 --tls-cert-file=/var/lib/rancher/rke2/server/tls/serving-kube-apiserver.crt --tls-private-key-file=/var/lib/rancher/rke2/server/tls/serving-kube-apiserver.key root 5522 5416 3 14:58 ?00:00:16 kube-controller-manager --flex-volume-plugin-dir=/var/lib/kubelet/volumeplugins --terminated-pod-gc-threshold=1000 --permit-port-sharing=true --address=127.0.0.1 --allocate-node-cidrs=true --bind-address=127.0.0.1 --cert-dir=/var/lib/rancher/rke2/server/tls/kube-controller-manager --cluster-cidr=10.42.0.0/16 --cluster-signing-kube-apiserver-client-cert-file=/var/lib/rancher/rke2/server/tls/client-ca.crt --cluster-signing-kube-apiserver-client-key-file=/var/lib/rancher/rke2/server/tls/client-ca.key --cluster-signing-kubelet-client-cert-file=/var/lib/rancher/rke2/server/tls/client-ca.crt --cluster-signing-kubelet-client-key-file=/var/lib/rancher/rke2/server/tls/client-ca.key --cluster-signing-kubelet-serving-cert-file=/var/lib/rancher/rke2/server/tls/server-ca.crt --cluster-signing-kubelet-serving-key-file=/var/lib/rancher/rke2/server/tls/server-ca.key --cluster-signing-legacy-unknown-cert-file=/var/lib/rancher/rke2/server/tls/client-ca.crt --cluster-signing-legacy-unknown-key-file=/var/lib/rancher/rke2/server/tls/client-ca.key --configure-cloud-routes=false --controllers=*,-service,-route,-cloud-node-lifecycle --kubeconfig=/var/lib/rancher/rke2/server/cred/controller.kubeconfig --port=10252 --profiling=false --root-ca-file=/var/lib/rancher/rke2/server/tls/server-ca.crt --secure-port=10257 --service-account-private-key-file=/var/lib/rancher/rke2/server/tls/service.key --use-service-account-credentials=true\n")),(0,n.kt)("h3",{id:"1231\u786e\u4fdd\u6839\u636e\u9700\u8981\u8bbe\u7f6e---client-ca-file-\u53c2\u6570\u81ea\u52a8"},"1.2.31\u786e\u4fdd\u6839\u636e\u9700\u8981\u8bbe\u7f6e --client-ca-file \u53c2\u6570\uff08\u81ea\u52a8\uff09"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1apass"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u9075\u5faa Kubernetes \u6587\u6863\u5e76\u5728 apiserver \u4e0a\u8bbe\u7f6e TLS \u8fde\u63a5\u3002\n\u7136\u540e\uff0c\u5728 Master \u8282\u70b9\u4e0a\u7f16\u8f91 API Server pod \u89c4\u8303\u6587\u4ef6 /var/lib/rancher/rke2/agent/pod-manifests/kube-apiserver.yaml\uff0c\u5e76\u8bbe\u7f6e\u5ba2\u6237\u7aef CA \u6587\u4ef6\u3002\n",(0,n.kt)("inlineCode",{parentName:"p"},"--client-ca-file=<path/to/client-ca-file>")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"/bin/ps -ef | grep kube-apiserver | grep -v grep\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u9884\u671f\u7ed3\u679c"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},"'--client-ca-file' is present\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u8fd4\u56de\u503c"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},"root 5275 5222 15 14:58 ?00:01:26 kube-apiserver --audit-policy-file=/etc/rancher/rke2/audit-policy.yaml --audit-log-path=/var/lib/rancher/rke2/server/logs/audit.log --audit-log-maxage=30 --audit-log-maxbackup=10 --audit-log-maxsize=100 --kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname --allow-privileged=true --anonymous-auth=false --api-audiences=https://kubernetes.default.svc.cluster.local,rke2 --authorization-mode=Node,RBAC --bind-address=0.0.0.0 --cert-dir=/var/lib/rancher/rke2/server/tls/temporary-certs --client-ca-file=/var/lib/rancher/rke2/server/tls/client-ca.crt --enable-admission-plugins=NodeRestriction,PodSecurityPolicy --encryption-provider-config=/var/lib/rancher/rke2/server/cred/encryption-config.json --etcd-cafile=/var/lib/rancher/rke2/server/tls/etcd/server-ca.crt --etcd-certfile=/var/lib/rancher/rke2/server/tls/etcd/client.crt --etcd-keyfile=/var/lib/rancher/rke2/server/tls/etcd/client.key --etcd-servers=https://127.0.0.1:2379 --insecure-port=0 --kubelet-certificate-authority=/var/lib/rancher/rke2/server/tls/server-ca.crt --kubelet-client-certificate=/var/lib/rancher/rke2/server/tls/client-kube-apiserver.crt --kubelet-client-key=/var/lib/rancher/rke2/server/tls/client-kube-apiserver.key --profiling=false --proxy-client-cert-file=/var/lib/rancher/rke2/server/tls/client-auth-proxy.crt --proxy-client-key-file=/var/lib/rancher/rke2/server/tls/client-auth-proxy.key --requestheader-allowed-names=system:auth-proxy --requestheader-client-ca-file=/var/lib/rancher/rke2/server/tls/request-header-ca.crt --requestheader-extra-headers-prefix=X-Remote-Extra- --requestheader-group-headers=X-Remote-Group --requestheader-username-headers=X-Remote-User --secure-port=6443 --service-account-issuer=https://kubernetes.default.svc.cluster.local --service-account-key-file=/var/lib/rancher/rke2/server/tls/service.key --service-account-signing-key-file=/var/lib/rancher/rke2/server/tls/service.key --service-cluster-ip-range=10.43.0.0/16 --service-node-port-range=30000-32767 --storage-backend=etcd3 --tls-cert-file=/var/lib/rancher/rke2/server/tls/serving-kube-apiserver.crt --tls-private-key-file=/var/lib/rancher/rke2/server/tls/serving-kube-apiserver.key root 5522 5416 3 14:58 ?00:00:16 kube-controller-manager --flex-volume-plugin-dir=/var/lib/kubelet/volumeplugins --terminated-pod-gc-threshold=1000 --permit-port-sharing=true --address=127.0.0.1 --allocate-node-cidrs=true --bind-address=127.0.0.1 --cert-dir=/var/lib/rancher/rke2/server/tls/kube-controller-manager --cluster-cidr=10.42.0.0/16 --cluster-signing-kube-apiserver-client-cert-file=/var/lib/rancher/rke2/server/tls/client-ca.crt --cluster-signing-kube-apiserver-client-key-file=/var/lib/rancher/rke2/server/tls/client-ca.key --cluster-signing-kubelet-client-cert-file=/var/lib/rancher/rke2/server/tls/client-ca.crt --cluster-signing-kubelet-client-key-file=/var/lib/rancher/rke2/server/tls/client-ca.key --cluster-signing-kubelet-serving-cert-file=/var/lib/rancher/rke2/server/tls/server-ca.crt --cluster-signing-kubelet-serving-key-file=/var/lib/rancher/rke2/server/tls/server-ca.key --cluster-signing-legacy-unknown-cert-file=/var/lib/rancher/rke2/server/tls/client-ca.crt --cluster-signing-legacy-unknown-key-file=/var/lib/rancher/rke2/server/tls/client-ca.key --configure-cloud-routes=false --controllers=*,-service,-route,-cloud-node-lifecycle --kubeconfig=/var/lib/rancher/rke2/server/cred/controller.kubeconfig --port=10252 --profiling=false --root-ca-file=/var/lib/rancher/rke2/server/tls/server-ca.crt --secure-port=10257 --service-account-private-key-file=/var/lib/rancher/rke2/server/tls/service.key --use-service-account-credentials=true\n")),(0,n.kt)("h3",{id:"1232\u786e\u4fdd---etcd-cafile-\u53c2\u6570\u8bbe\u7f6e\u6b63\u786e\u81ea\u52a8"},"1.2.32\u786e\u4fdd --etcd-cafile \u53c2\u6570\u8bbe\u7f6e\u6b63\u786e\uff08\u81ea\u52a8\uff09"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1apass"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u9075\u5faa Kubernetes \u6587\u6863\u8bbe\u7f6e apiserver \u548c etcd \u7684 TLS \u8fde\u63a5\u3002\n\u7136\u540e\uff0c\u5728 Master \u8282\u70b9\u4e0a\u7f16\u8f91 API Server pod \u89c4\u8303\u6587\u4ef6 /var/lib/rancher/rke2/agent/pod-manifests/kube-apiserver.yaml\uff0c\u5e76\u8bbe\u7f6e etcd CA \u6587\u4ef6\u53c2\u6570\u3002\n",(0,n.kt)("inlineCode",{parentName:"p"},"--etcd-cafile=<path/to/ca-file>")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"/bin/ps -ef | grep kube-apiserver | grep -v grep\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u9884\u671f\u7ed3\u679c"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},"'--etcd-cafile' is present\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u8fd4\u56de\u503c"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},"root 5275 5222 15 14:58 ?00:01:26 kube-apiserver --audit-policy-file=/etc/rancher/rke2/audit-policy.yaml --audit-log-path=/var/lib/rancher/rke2/server/logs/audit.log --audit-log-maxage=30 --audit-log-maxbackup=10 --audit-log-maxsize=100 --kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname --allow-privileged=true --anonymous-auth=false --api-audiences=https://kubernetes.default.svc.cluster.local,rke2 --authorization-mode=Node,RBAC --bind-address=0.0.0.0 --cert-dir=/var/lib/rancher/rke2/server/tls/temporary-certs --client-ca-file=/var/lib/rancher/rke2/server/tls/client-ca.crt --enable-admission-plugins=NodeRestriction,PodSecurityPolicy --encryption-provider-config=/var/lib/rancher/rke2/server/cred/encryption-config.json --etcd-cafile=/var/lib/rancher/rke2/server/tls/etcd/server-ca.crt --etcd-certfile=/var/lib/rancher/rke2/server/tls/etcd/client.crt --etcd-keyfile=/var/lib/rancher/rke2/server/tls/etcd/client.key --etcd-servers=https://127.0.0.1:2379 --insecure-port=0 --kubelet-certificate-authority=/var/lib/rancher/rke2/server/tls/server-ca.crt --kubelet-client-certificate=/var/lib/rancher/rke2/server/tls/client-kube-apiserver.crt --kubelet-client-key=/var/lib/rancher/rke2/server/tls/client-kube-apiserver.key --profiling=false --proxy-client-cert-file=/var/lib/rancher/rke2/server/tls/client-auth-proxy.crt --proxy-client-key-file=/var/lib/rancher/rke2/server/tls/client-auth-proxy.key --requestheader-allowed-names=system:auth-proxy --requestheader-client-ca-file=/var/lib/rancher/rke2/server/tls/request-header-ca.crt --requestheader-extra-headers-prefix=X-Remote-Extra- --requestheader-group-headers=X-Remote-Group --requestheader-username-headers=X-Remote-User --secure-port=6443 --service-account-issuer=https://kubernetes.default.svc.cluster.local --service-account-key-file=/var/lib/rancher/rke2/server/tls/service.key --service-account-signing-key-file=/var/lib/rancher/rke2/server/tls/service.key --service-cluster-ip-range=10.43.0.0/16 --service-node-port-range=30000-32767 --storage-backend=etcd3 --tls-cert-file=/var/lib/rancher/rke2/server/tls/serving-kube-apiserver.crt --tls-private-key-file=/var/lib/rancher/rke2/server/tls/serving-kube-apiserver.key root 5522 5416 3 14:58 ?00:00:16 kube-controller-manager --flex-volume-plugin-dir=/var/lib/kubelet/volumeplugins --terminated-pod-gc-threshold=1000 --permit-port-sharing=true --address=127.0.0.1 --allocate-node-cidrs=true --bind-address=127.0.0.1 --cert-dir=/var/lib/rancher/rke2/server/tls/kube-controller-manager --cluster-cidr=10.42.0.0/16 --cluster-signing-kube-apiserver-client-cert-file=/var/lib/rancher/rke2/server/tls/client-ca.crt --cluster-signing-kube-apiserver-client-key-file=/var/lib/rancher/rke2/server/tls/client-ca.key --cluster-signing-kubelet-client-cert-file=/var/lib/rancher/rke2/server/tls/client-ca.crt --cluster-signing-kubelet-client-key-file=/var/lib/rancher/rke2/server/tls/client-ca.key --cluster-signing-kubelet-serving-cert-file=/var/lib/rancher/rke2/server/tls/server-ca.crt --cluster-signing-kubelet-serving-key-file=/var/lib/rancher/rke2/server/tls/server-ca.key --cluster-signing-legacy-unknown-cert-file=/var/lib/rancher/rke2/server/tls/client-ca.crt --cluster-signing-legacy-unknown-key-file=/var/lib/rancher/rke2/server/tls/client-ca.key --configure-cloud-routes=false --controllers=*,-service,-route,-cloud-node-lifecycle --kubeconfig=/var/lib/rancher/rke2/server/cred/controller.kubeconfig --port=10252 --profiling=false --root-ca-file=/var/lib/rancher/rke2/server/tls/server-ca.crt --secure-port=10257 --service-account-private-key-file=/var/lib/rancher/rke2/server/tls/service.key --use-service-account-credentials=true\n")),(0,n.kt)("h3",{id:"1233\u786e\u4fdd\u6839\u636e\u9700\u8981\u8bbe\u7f6e---encryption-provider-config-\u53c2\u6570\u81ea\u52a8"},"1.2.33\u786e\u4fdd\u6839\u636e\u9700\u8981\u8bbe\u7f6e --encryption-provider-config \u53c2\u6570\uff08\u81ea\u52a8\uff09"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1apass"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u6309\u7167 Kubernetes \u6587\u6863\u5e76\u914d\u7f6e EncryptionConfig \u6587\u4ef6\u3002\n\u7136\u540e\uff0c\u5728 Master \u8282\u70b9\u4e0a\u7f16\u8f91 API Server pod \u89c4\u8303\u6587\u4ef6 /var/lib/rancher/rke2/agent/pod-manifests/kube-apiserver.yaml\uff0c\u5e76\u5c06 ",(0,n.kt)("inlineCode",{parentName:"p"},"--encryption-provider-config")," \u53c2\u6570\u8bbe\u7f6e\u4e3a\u8be5\u6587\u4ef6\u7684\u8def\u5f84\uff1a\n--encryption-provider-config=</path/to/EncryptionConfig/File>"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"/bin/ps -ef | grep kube-apiserver | grep -v grep\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u9884\u671f\u7ed3\u679c"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},"'--encryption-provider-config' is present\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u8fd4\u56de\u503c"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},"root 5275 5222 15 14:58 ?00:01:26 kube-apiserver --audit-policy-file=/etc/rancher/rke2/audit-policy.yaml --audit-log-path=/var/lib/rancher/rke2/server/logs/audit.log --audit-log-maxage=30 --audit-log-maxbackup=10 --audit-log-maxsize=100 --kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname --allow-privileged=true --anonymous-auth=false --api-audiences=https://kubernetes.default.svc.cluster.local,rke2 --authorization-mode=Node,RBAC --bind-address=0.0.0.0 --cert-dir=/var/lib/rancher/rke2/server/tls/temporary-certs --client-ca-file=/var/lib/rancher/rke2/server/tls/client-ca.crt --enable-admission-plugins=NodeRestriction,PodSecurityPolicy --encryption-provider-config=/var/lib/rancher/rke2/server/cred/encryption-config.json --etcd-cafile=/var/lib/rancher/rke2/server/tls/etcd/server-ca.crt --etcd-certfile=/var/lib/rancher/rke2/server/tls/etcd/client.crt --etcd-keyfile=/var/lib/rancher/rke2/server/tls/etcd/client.key --etcd-servers=https://127.0.0.1:2379 --insecure-port=0 --kubelet-certificate-authority=/var/lib/rancher/rke2/server/tls/server-ca.crt --kubelet-client-certificate=/var/lib/rancher/rke2/server/tls/client-kube-apiserver.crt --kubelet-client-key=/var/lib/rancher/rke2/server/tls/client-kube-apiserver.key --profiling=false --proxy-client-cert-file=/var/lib/rancher/rke2/server/tls/client-auth-proxy.crt --proxy-client-key-file=/var/lib/rancher/rke2/server/tls/client-auth-proxy.key --requestheader-allowed-names=system:auth-proxy --requestheader-client-ca-file=/var/lib/rancher/rke2/server/tls/request-header-ca.crt --requestheader-extra-headers-prefix=X-Remote-Extra- --requestheader-group-headers=X-Remote-Group --requestheader-username-headers=X-Remote-User --secure-port=6443 --service-account-issuer=https://kubernetes.default.svc.cluster.local --service-account-key-file=/var/lib/rancher/rke2/server/tls/service.key --service-account-signing-key-file=/var/lib/rancher/rke2/server/tls/service.key --service-cluster-ip-range=10.43.0.0/16 --service-node-port-range=30000-32767 --storage-backend=etcd3 --tls-cert-file=/var/lib/rancher/rke2/server/tls/serving-kube-apiserver.crt --tls-private-key-file=/var/lib/rancher/rke2/server/tls/serving-kube-apiserver.key root 5522 5416 3 14:58 ?00:00:16 kube-controller-manager --flex-volume-plugin-dir=/var/lib/kubelet/volumeplugins --terminated-pod-gc-threshold=1000 --permit-port-sharing=true --address=127.0.0.1 --allocate-node-cidrs=true --bind-address=127.0.0.1 --cert-dir=/var/lib/rancher/rke2/server/tls/kube-controller-manager --cluster-cidr=10.42.0.0/16 --cluster-signing-kube-apiserver-client-cert-file=/var/lib/rancher/rke2/server/tls/client-ca.crt --cluster-signing-kube-apiserver-client-key-file=/var/lib/rancher/rke2/server/tls/client-ca.key --cluster-signing-kubelet-client-cert-file=/var/lib/rancher/rke2/server/tls/client-ca.crt --cluster-signing-kubelet-client-key-file=/var/lib/rancher/rke2/server/tls/client-ca.key --cluster-signing-kubelet-serving-cert-file=/var/lib/rancher/rke2/server/tls/server-ca.crt --cluster-signing-kubelet-serving-key-file=/var/lib/rancher/rke2/server/tls/server-ca.key --cluster-signing-legacy-unknown-cert-file=/var/lib/rancher/rke2/server/tls/client-ca.crt --cluster-signing-legacy-unknown-key-file=/var/lib/rancher/rke2/server/tls/client-ca.key --configure-cloud-routes=false --controllers=*,-service,-route,-cloud-node-lifecycle --kubeconfig=/var/lib/rancher/rke2/server/cred/controller.kubeconfig --port=10252 --profiling=false --root-ca-file=/var/lib/rancher/rke2/server/tls/server-ca.crt --secure-port=10257 --service-account-private-key-file=/var/lib/rancher/rke2/server/tls/service.key --use-service-account-credentials=true\n")),(0,n.kt)("h3",{id:"1234\u786e\u4fdd\u6b63\u786e\u914d\u7f6e\u52a0\u5bc6\u63d0\u4f9b\u7a0b\u5e8f\u81ea\u52a8"},"1.2.34\u786e\u4fdd\u6b63\u786e\u914d\u7f6e\u52a0\u5bc6\u63d0\u4f9b\u7a0b\u5e8f\uff08\u81ea\u52a8\uff09"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1apass"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u6309\u7167 Kubernetes \u6587\u6863\u5e76\u914d\u7f6e EncryptionConfig \u6587\u4ef6\u3002\n\u5728\u6b64\u6587\u4ef6\u4e2d\uff0c\u9009\u62e9 aescbc\u3001kms \u6216 secretbox \u4f5c\u4e3a\u52a0\u5bc6\u63d0\u4f9b\u7a0b\u5e8f\u3002"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"/bin/sh -c 'if grep aescbc /var/lib/rancher/rke2/server/cred/encryption-config.json; then echo 0; fi'\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u9884\u671f\u7ed3\u679c"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},"'0' is present\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u8fd4\u56de\u503c"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},'{"kind":"EncryptionConfiguration","apiVersion":"apiserver.config.k8s.io/v1","resources":[{"resources":["secrets"],"providers":[{"aescbc":{"keys":[{"name":"aescbckey","secret":"ZP3yNnlCjzcKMBXfmNBmpGbiY+oXne+WP6EM42lZIbE="}]}},{"identity":{}}]}]} 0\n')),(0,n.kt)("h3",{id:"1235\u786e\u4fdd-api-server-\u4ec5\u4f7f\u7528\u5f3a\u5bc6\u7801\u624b\u52a8"},"1.2.35\u786e\u4fdd API Server \u4ec5\u4f7f\u7528\u5f3a\u5bc6\u7801\uff08\u624b\u52a8\uff09"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1apass"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u5728 Master \u8282\u70b9\u4e0a\u7f16\u8f91 API Server pod \u89c4\u8303\u6587\u4ef6 /etc/kubernetes/manifests/kube-apiserver.yaml \u5e76\u8bbe\u7f6e\u4ee5\u4e0b\u53c2\u6570\u3002\n--tls-cipher-suites=TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_128_GCM\n_SHA256,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_AES_256_GCM\n_SHA384,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_ECDSA_WITH_AES_256_GCM\n_SHA384"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"/bin/ps -ef | grep kube-apiserver | grep -v grep\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u9884\u671f\u7ed3\u679c"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},"'--tls-cipher-suites' is not present\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u8fd4\u56de\u503c"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},"root 5275 5222 15 14:58 ?00:01:26 kube-apiserver --audit-policy-file=/etc/rancher/rke2/audit-policy.yaml --audit-log-path=/var/lib/rancher/rke2/server/logs/audit.log --audit-log-maxage=30 --audit-log-maxbackup=10 --audit-log-maxsize=100 --kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname --allow-privileged=true --anonymous-auth=false --api-audiences=https://kubernetes.default.svc.cluster.local,rke2 --authorization-mode=Node,RBAC --bind-address=0.0.0.0 --cert-dir=/var/lib/rancher/rke2/server/tls/temporary-certs --client-ca-file=/var/lib/rancher/rke2/server/tls/client-ca.crt --enable-admission-plugins=NodeRestriction,PodSecurityPolicy --encryption-provider-config=/var/lib/rancher/rke2/server/cred/encryption-config.json --etcd-cafile=/var/lib/rancher/rke2/server/tls/etcd/server-ca.crt --etcd-certfile=/var/lib/rancher/rke2/server/tls/etcd/client.crt --etcd-keyfile=/var/lib/rancher/rke2/server/tls/etcd/client.key --etcd-servers=https://127.0.0.1:2379 --insecure-port=0 --kubelet-certificate-authority=/var/lib/rancher/rke2/server/tls/server-ca.crt --kubelet-client-certificate=/var/lib/rancher/rke2/server/tls/client-kube-apiserver.crt --kubelet-client-key=/var/lib/rancher/rke2/server/tls/client-kube-apiserver.key --profiling=false --proxy-client-cert-file=/var/lib/rancher/rke2/server/tls/client-auth-proxy.crt --proxy-client-key-file=/var/lib/rancher/rke2/server/tls/client-auth-proxy.key --requestheader-allowed-names=system:auth-proxy --requestheader-client-ca-file=/var/lib/rancher/rke2/server/tls/request-header-ca.crt --requestheader-extra-headers-prefix=X-Remote-Extra- --requestheader-group-headers=X-Remote-Group --requestheader-username-headers=X-Remote-User --secure-port=6443 --service-account-issuer=https://kubernetes.default.svc.cluster.local --service-account-key-file=/var/lib/rancher/rke2/server/tls/service.key --service-account-signing-key-file=/var/lib/rancher/rke2/server/tls/service.key --service-cluster-ip-range=10.43.0.0/16 --service-node-port-range=30000-32767 --storage-backend=etcd3 --tls-cert-file=/var/lib/rancher/rke2/server/tls/serving-kube-apiserver.crt --tls-private-key-file=/var/lib/rancher/rke2/server/tls/serving-kube-apiserver.key root 5522 5416 3 14:58 ?00:00:16 kube-controller-manager --flex-volume-plugin-dir=/var/lib/kubelet/volumeplugins --terminated-pod-gc-threshold=1000 --permit-port-sharing=true --address=127.0.0.1 --allocate-node-cidrs=true --bind-address=127.0.0.1 --cert-dir=/var/lib/rancher/rke2/server/tls/kube-controller-manager --cluster-cidr=10.42.0.0/16 --cluster-signing-kube-apiserver-client-cert-file=/var/lib/rancher/rke2/server/tls/client-ca.crt --cluster-signing-kube-apiserver-client-key-file=/var/lib/rancher/rke2/server/tls/client-ca.key --cluster-signing-kubelet-client-cert-file=/var/lib/rancher/rke2/server/tls/client-ca.crt --cluster-signing-kubelet-client-key-file=/var/lib/rancher/rke2/server/tls/client-ca.key --cluster-signing-kubelet-serving-cert-file=/var/lib/rancher/rke2/server/tls/server-ca.crt --cluster-signing-kubelet-serving-key-file=/var/lib/rancher/rke2/server/tls/server-ca.key --cluster-signing-legacy-unknown-cert-file=/var/lib/rancher/rke2/server/tls/client-ca.crt --cluster-signing-legacy-unknown-key-file=/var/lib/rancher/rke2/server/tls/client-ca.key --configure-cloud-routes=false --controllers=*,-service,-route,-cloud-node-lifecycle --kubeconfig=/var/lib/rancher/rke2/server/cred/controller.kubeconfig --port=10252 --profiling=false --root-ca-file=/var/lib/rancher/rke2/server/tls/server-ca.crt --secure-port=10257 --service-account-private-key-file=/var/lib/rancher/rke2/server/tls/service.key --use-service-account-credentials=true\n")),(0,n.kt)("h2",{id:"13controller-manager"},"1.3Controller Manager"),(0,n.kt)("h3",{id:"131\u786e\u4fdd\u6b63\u786e\u8bbe\u7f6e---terminated-pod-gc-threshold-\u53c2\u6570\u81ea\u52a8"},"1.3.1\u786e\u4fdd\u6b63\u786e\u8bbe\u7f6e --terminated-pod-gc-threshold \u53c2\u6570\uff08\u81ea\u52a8\uff09"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1apass"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u5728 Master \u8282\u70b9\u4e0a\u7f16\u8f91 Controller Manager pod \u89c4\u8303\u6587\u4ef6 /var/lib/rancher/rke2/agent/pod-manifests/kube-controller-manager.yaml\uff0c\u5e76\u5c06 ",(0,n.kt)("inlineCode",{parentName:"p"},"--terminated-pod-gc-threshold")," \u8bbe\u7f6e\u4e3a\u9002\u5f53\u7684\u9608\u503c\u3002\n\u4f8b\u5982\uff1a--terminated-pod-gc-threshold=10"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"/bin/ps -ef | grep kube-controller-manager | grep -v grep\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u9884\u671f\u7ed3\u679c"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},"'--terminated-pod-gc-threshold' is present\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u8fd4\u56de\u503c"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},"root 5522 5416 3 14:58 ?00:00:16 kube-controller-manager --flex-volume-plugin-dir=/var/lib/kubelet/volumeplugins --terminated-pod-gc-threshold=1000 --permit-port-sharing=true --address=127.0.0.1 --allocate-node-cidrs=true --bind-address=127.0.0.1 --cert-dir=/var/lib/rancher/rke2/server/tls/kube-controller-manager --cluster-cidr=10.42.0.0/16 --cluster-signing-kube-apiserver-client-cert-file=/var/lib/rancher/rke2/server/tls/client-ca.crt --cluster-signing-kube-apiserver-client-key-file=/var/lib/rancher/rke2/server/tls/client-ca.key --cluster-signing-kubelet-client-cert-file=/var/lib/rancher/rke2/server/tls/client-ca.crt --cluster-signing-kubelet-client-key-file=/var/lib/rancher/rke2/server/tls/client-ca.key --cluster-signing-kubelet-serving-cert-file=/var/lib/rancher/rke2/server/tls/server-ca.crt --cluster-signing-kubelet-serving-key-file=/var/lib/rancher/rke2/server/tls/server-ca.key --cluster-signing-legacy-unknown-cert-file=/var/lib/rancher/rke2/server/tls/client-ca.crt --cluster-signing-legacy-unknown-key-file=/var/lib/rancher/rke2/server/tls/client-ca.key --configure-cloud-routes=false --controllers=*,-service,-route,-cloud-node-lifecycle --kubeconfig=/var/lib/rancher/rke2/server/cred/controller.kubeconfig --port=10252 --profiling=false --root-ca-file=/var/lib/rancher/rke2/server/tls/server-ca.crt --secure-port=10257 --service-account-private-key-file=/var/lib/rancher/rke2/server/tls/service.key --use-service-account-credentials=true\n")),(0,n.kt)("h3",{id:"132\u786e\u4fdd---profiling-\u53c2\u6570\u8bbe\u7f6e\u4e3a-false\u81ea\u52a8"},"1.3.2\u786e\u4fdd --profiling \u53c2\u6570\u8bbe\u7f6e\u4e3a false\uff08\u81ea\u52a8\uff09"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1apass"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u5728 Master \u8282\u70b9\u4e0a\u7f16\u8f91 Controller Manager pod \u89c4\u8303\u6587\u4ef6 /var/lib/rancher/rke2/agent/pod-manifests/kube-controller-manager.yaml\uff0c\u5e76\u8bbe\u7f6e\u4ee5\u4e0b\u53c2\u6570\u3002\n--profiling=false"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"/bin/ps -ef | grep kube-controller-manager | grep -v grep\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u9884\u671f\u7ed3\u679c"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},"'false' is equal to 'false'\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u8fd4\u56de\u503c"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},"root 5522 5416 3 14:58 ?00:00:16 kube-controller-manager --flex-volume-plugin-dir=/var/lib/kubelet/volumeplugins --terminated-pod-gc-threshold=1000 --permit-port-sharing=true --address=127.0.0.1 --allocate-node-cidrs=true --bind-address=127.0.0.1 --cert-dir=/var/lib/rancher/rke2/server/tls/kube-controller-manager --cluster-cidr=10.42.0.0/16 --cluster-signing-kube-apiserver-client-cert-file=/var/lib/rancher/rke2/server/tls/client-ca.crt --cluster-signing-kube-apiserver-client-key-file=/var/lib/rancher/rke2/server/tls/client-ca.key --cluster-signing-kubelet-client-cert-file=/var/lib/rancher/rke2/server/tls/client-ca.crt --cluster-signing-kubelet-client-key-file=/var/lib/rancher/rke2/server/tls/client-ca.key --cluster-signing-kubelet-serving-cert-file=/var/lib/rancher/rke2/server/tls/server-ca.crt --cluster-signing-kubelet-serving-key-file=/var/lib/rancher/rke2/server/tls/server-ca.key --cluster-signing-legacy-unknown-cert-file=/var/lib/rancher/rke2/server/tls/client-ca.crt --cluster-signing-legacy-unknown-key-file=/var/lib/rancher/rke2/server/tls/client-ca.key --configure-cloud-routes=false --controllers=*,-service,-route,-cloud-node-lifecycle --kubeconfig=/var/lib/rancher/rke2/server/cred/controller.kubeconfig --port=10252 --profiling=false --root-ca-file=/var/lib/rancher/rke2/server/tls/server-ca.crt --secure-port=10257 --service-account-private-key-file=/var/lib/rancher/rke2/server/tls/service.key --use-service-account-credentials=true\n")),(0,n.kt)("h3",{id:"133\u786e\u4fdd---use-service-account-credentials-\u53c2\u6570\u8bbe\u7f6e\u4e3a-true\u81ea\u52a8"},"1.3.3\u786e\u4fdd --use-service-account-credentials \u53c2\u6570\u8bbe\u7f6e\u4e3a true\uff08\u81ea\u52a8\uff09"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1apass"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u5728 Master \u8282\u70b9\u4e0a\u7f16\u8f91 Controller Manager pod \u89c4\u8303\u6587\u4ef6 /var/lib/rancher/rke2/agent/pod-manifests/kube-controller-manager.yaml \u4ee5\u8bbe\u7f6e\u4ee5\u4e0b\u53c2\u6570\u3002\n--use-service-account-credentials=true"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"/bin/ps -ef | grep kube-controller-manager | grep -v grep\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u9884\u671f\u7ed3\u679c"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},"'true' is not equal to 'false'\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u8fd4\u56de\u503c"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},"root 5522 5416 3 14:58 ?00:00:16 kube-controller-manager --flex-volume-plugin-dir=/var/lib/kubelet/volumeplugins --terminated-pod-gc-threshold=1000 --permit-port-sharing=true --address=127.0.0.1 --allocate-node-cidrs=true --bind-address=127.0.0.1 --cert-dir=/var/lib/rancher/rke2/server/tls/kube-controller-manager --cluster-cidr=10.42.0.0/16 --cluster-signing-kube-apiserver-client-cert-file=/var/lib/rancher/rke2/server/tls/client-ca.crt --cluster-signing-kube-apiserver-client-key-file=/var/lib/rancher/rke2/server/tls/client-ca.key --cluster-signing-kubelet-client-cert-file=/var/lib/rancher/rke2/server/tls/client-ca.crt --cluster-signing-kubelet-client-key-file=/var/lib/rancher/rke2/server/tls/client-ca.key --cluster-signing-kubelet-serving-cert-file=/var/lib/rancher/rke2/server/tls/server-ca.crt --cluster-signing-kubelet-serving-key-file=/var/lib/rancher/rke2/server/tls/server-ca.key --cluster-signing-legacy-unknown-cert-file=/var/lib/rancher/rke2/server/tls/client-ca.crt --cluster-signing-legacy-unknown-key-file=/var/lib/rancher/rke2/server/tls/client-ca.key --configure-cloud-routes=false --controllers=*,-service,-route,-cloud-node-lifecycle --kubeconfig=/var/lib/rancher/rke2/server/cred/controller.kubeconfig --port=10252 --profiling=false --root-ca-file=/var/lib/rancher/rke2/server/tls/server-ca.crt --secure-port=10257 --service-account-private-key-file=/var/lib/rancher/rke2/server/tls/service.key --use-service-account-credentials=true\n")),(0,n.kt)("h3",{id:"134\u786e\u4fdd\u6839\u636e\u9700\u8981\u8bbe\u7f6e---service-account-private-key-file-\u53c2\u6570\u81ea\u52a8"},"1.3.4\u786e\u4fdd\u6839\u636e\u9700\u8981\u8bbe\u7f6e --service-account-private-key-file \u53c2\u6570\uff08\u81ea\u52a8\uff09"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1apass"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u5728 Master \u8282\u70b9\u4e0a\u7f16\u8f91 Controller Manager pod \u89c4\u8303\u6587\u4ef6 /var/lib/rancher/rke2/agent/pod-manifests/kube-controller-manager.yaml\uff0c\u5e76\u4e3a ServiceAccount \u5c06 ",(0,n.kt)("inlineCode",{parentName:"p"},"--service-account-private-key-file")," \u53c2\u6570\u8bbe\u7f6e\u4e3a\u79c1\u94a5\u6587\u4ef6\u3002\n",(0,n.kt)("inlineCode",{parentName:"p"},"--service-account-private-key-file=<filename>")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"/bin/ps -ef | grep kube-controller-manager | grep -v grep\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u9884\u671f\u7ed3\u679c"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},"'--service-account-private-key-file' is present\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u8fd4\u56de\u503c"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},"root 5522 5416 3 14:58 ?00:00:16 kube-controller-manager --flex-volume-plugin-dir=/var/lib/kubelet/volumeplugins --terminated-pod-gc-threshold=1000 --permit-port-sharing=true --address=127.0.0.1 --allocate-node-cidrs=true --bind-address=127.0.0.1 --cert-dir=/var/lib/rancher/rke2/server/tls/kube-controller-manager --cluster-cidr=10.42.0.0/16 --cluster-signing-kube-apiserver-client-cert-file=/var/lib/rancher/rke2/server/tls/client-ca.crt --cluster-signing-kube-apiserver-client-key-file=/var/lib/rancher/rke2/server/tls/client-ca.key --cluster-signing-kubelet-client-cert-file=/var/lib/rancher/rke2/server/tls/client-ca.crt --cluster-signing-kubelet-client-key-file=/var/lib/rancher/rke2/server/tls/client-ca.key --cluster-signing-kubelet-serving-cert-file=/var/lib/rancher/rke2/server/tls/server-ca.crt --cluster-signing-kubelet-serving-key-file=/var/lib/rancher/rke2/server/tls/server-ca.key --cluster-signing-legacy-unknown-cert-file=/var/lib/rancher/rke2/server/tls/client-ca.crt --cluster-signing-legacy-unknown-key-file=/var/lib/rancher/rke2/server/tls/client-ca.key --configure-cloud-routes=false --controllers=*,-service,-route,-cloud-node-lifecycle --kubeconfig=/var/lib/rancher/rke2/server/cred/controller.kubeconfig --port=10252 --profiling=false --root-ca-file=/var/lib/rancher/rke2/server/tls/server-ca.crt --secure-port=10257 --service-account-private-key-file=/var/lib/rancher/rke2/server/tls/service.key --use-service-account-credentials=true\n")),(0,n.kt)("h3",{id:"135\u786e\u4fdd\u6839\u636e\u9700\u8981\u8bbe\u7f6e---root-ca-file-\u53c2\u6570\u81ea\u52a8"},"1.3.5\u786e\u4fdd\u6839\u636e\u9700\u8981\u8bbe\u7f6e --root-ca-file \u53c2\u6570\uff08\u81ea\u52a8\uff09"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1apass"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u5728 Master \u8282\u70b9\u4e0a\u7f16\u8f91 Controller Manager pod \u89c4\u8303\u6587\u4ef6 /var/lib/rancher/rke2/agent/pod-manifests/kube-controller-manager.yaml\uff0c\u5e76\u5c06 ",(0,n.kt)("inlineCode",{parentName:"p"},"--root-ca-file")," \u53c2\u6570\u8bbe\u7f6e\u4e3a\u8bc1\u4e66\u7ed1\u5b9a\u6587\u4ef6\u3002\n",(0,n.kt)("inlineCode",{parentName:"p"},"--root-ca-file=<path/to/file>")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"/bin/ps -ef | grep kube-controller-manager | grep -v grep\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u9884\u671f\u7ed3\u679c"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},"'--root-ca-file' is present\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u8fd4\u56de\u503c"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},"root 5522 5416 3 14:58 ?00:00:16 kube-controller-manager --flex-volume-plugin-dir=/var/lib/kubelet/volumeplugins --terminated-pod-gc-threshold=1000 --permit-port-sharing=true --address=127.0.0.1 --allocate-node-cidrs=true --bind-address=127.0.0.1 --cert-dir=/var/lib/rancher/rke2/server/tls/kube-controller-manager --cluster-cidr=10.42.0.0/16 --cluster-signing-kube-apiserver-client-cert-file=/var/lib/rancher/rke2/server/tls/client-ca.crt --cluster-signing-kube-apiserver-client-key-file=/var/lib/rancher/rke2/server/tls/client-ca.key --cluster-signing-kubelet-client-cert-file=/var/lib/rancher/rke2/server/tls/client-ca.crt --cluster-signing-kubelet-client-key-file=/var/lib/rancher/rke2/server/tls/client-ca.key --cluster-signing-kubelet-serving-cert-file=/var/lib/rancher/rke2/server/tls/server-ca.crt --cluster-signing-kubelet-serving-key-file=/var/lib/rancher/rke2/server/tls/server-ca.key --cluster-signing-legacy-unknown-cert-file=/var/lib/rancher/rke2/server/tls/client-ca.crt --cluster-signing-legacy-unknown-key-file=/var/lib/rancher/rke2/server/tls/client-ca.key --configure-cloud-routes=false --controllers=*,-service,-route,-cloud-node-lifecycle --kubeconfig=/var/lib/rancher/rke2/server/cred/controller.kubeconfig --port=10252 --profiling=false --root-ca-file=/var/lib/rancher/rke2/server/tls/server-ca.crt --secure-port=10257 --service-account-private-key-file=/var/lib/rancher/rke2/server/tls/service.key --use-service-account-credentials=true\n")),(0,n.kt)("h3",{id:"136\u786e\u4fdd-rotatekubeletservercertificate-\u53c2\u6570\u8bbe\u7f6e\u4e3a-true\u81ea\u52a8"},"1.3.6\u786e\u4fdd RotateKubeletServerCertificate \u53c2\u6570\u8bbe\u7f6e\u4e3a true\uff08\u81ea\u52a8\uff09"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1aNot Applicable"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u5728 Master \u8282\u70b9\u4e0a\u7f16\u8f91 Controller Manager pod \u89c4\u8303\u6587\u4ef6 /var/lib/rancher/rke2/agent/pod-manifests/kube-controller-manager.yaml\uff0c\u5e76\u5c06 ",(0,n.kt)("inlineCode",{parentName:"p"},"--feature-gates")," \u53c2\u6570\u8bbe\u7f6e\u4e3a\u5305\u542b ",(0,n.kt)("inlineCode",{parentName:"p"},"RotateKubeletServerCertificate=true"),"\u3002\n--feature-gates=RotateKubeletServerCertificate=true"),(0,n.kt)("h3",{id:"137\u786e\u4fdd---bind-address-\u53c2\u6570\u8bbe\u7f6e\u4e3a-127001\u81ea\u52a8"},"1.3.7\u786e\u4fdd --bind-address \u53c2\u6570\u8bbe\u7f6e\u4e3a 127.0.0.1\uff08\u81ea\u52a8\uff09"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1apass"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u5728 Master \u8282\u70b9\u4e0a\u7f16\u8f91 Controller Manager pod \u89c4\u8303\u6587\u4ef6 /var/lib/rancher/rke2/agent/pod-manifests/kube-controller-manager.yaml\uff0c\u5e76\u786e\u4fdd ",(0,n.kt)("inlineCode",{parentName:"p"},"--bind-address")," \u53c2\u6570\u7684\u503c\u6b63\u786e\u3002"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"/bin/ps -ef | grep kube-controller-manager | grep -v grep\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u9884\u671f\u7ed3\u679c"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},"'127.0.0.1' is equal to '127.0.0.1' OR '--bind-address' is not present\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u8fd4\u56de\u503c"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},"root 5522 5416 3 14:58 ?00:00:16 kube-controller-manager --flex-volume-plugin-dir=/var/lib/kubelet/volumeplugins --terminated-pod-gc-threshold=1000 --permit-port-sharing=true --address=127.0.0.1 --allocate-node-cidrs=true --bind-address=127.0.0.1 --cert-dir=/var/lib/rancher/rke2/server/tls/kube-controller-manager --cluster-cidr=10.42.0.0/16 --cluster-signing-kube-apiserver-client-cert-file=/var/lib/rancher/rke2/server/tls/client-ca.crt --cluster-signing-kube-apiserver-client-key-file=/var/lib/rancher/rke2/server/tls/client-ca.key --cluster-signing-kubelet-client-cert-file=/var/lib/rancher/rke2/server/tls/client-ca.crt --cluster-signing-kubelet-client-key-file=/var/lib/rancher/rke2/server/tls/client-ca.key --cluster-signing-kubelet-serving-cert-file=/var/lib/rancher/rke2/server/tls/server-ca.crt --cluster-signing-kubelet-serving-key-file=/var/lib/rancher/rke2/server/tls/server-ca.key --cluster-signing-legacy-unknown-cert-file=/var/lib/rancher/rke2/server/tls/client-ca.crt --cluster-signing-legacy-unknown-key-file=/var/lib/rancher/rke2/server/tls/client-ca.key --configure-cloud-routes=false --controllers=*,-service,-route,-cloud-node-lifecycle --kubeconfig=/var/lib/rancher/rke2/server/cred/controller.kubeconfig --port=10252 --profiling=false --root-ca-file=/var/lib/rancher/rke2/server/tls/server-ca.crt --secure-port=10257 --service-account-private-key-file=/var/lib/rancher/rke2/server/tls/service.key --use-service-account-credentials=true\n")),(0,n.kt)("h2",{id:"14scheduler"},"1.4Scheduler"),(0,n.kt)("h3",{id:"141\u786e\u4fdd---profiling-\u53c2\u6570\u8bbe\u7f6e\u4e3a-false\u81ea\u52a8"},"1.4.1\u786e\u4fdd --profiling \u53c2\u6570\u8bbe\u7f6e\u4e3a false\uff08\u81ea\u52a8\uff09"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1apass"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u5728 Master \u8282\u70b9\u4e0a\u7f16\u8f91 Scheduler pod \u89c4\u8303\u6587\u4ef6 /var/lib/rancher/rke2/agent/pod-manifests/kube-scheduler.yaml \u6587\u4ef6\uff0c\u5e76\u8bbe\u7f6e\u4ee5\u4e0b\u53c2\u6570\u3002\n--profiling=false"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"/bin/ps -ef | grep kube-scheduler | grep -v grep\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u9884\u671f\u7ed3\u679c"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},"'false' is equal to 'false'\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u8fd4\u56de\u503c"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},"root 5533 5414 0 14:58 ?00:00:02 kube-scheduler --permit-port-sharing=true --address=127.0.0.1 --bind-address=127.0.0.1 --cert-dir=/var/lib/rancher/rke2/server/tls/kube-scheduler --kubeconfig=/var/lib/rancher/rke2/server/cred/scheduler.kubeconfig --port=10251 --profiling=false --secure-port=10259\n")),(0,n.kt)("h3",{id:"142\u786e\u4fdd---bind-address-\u53c2\u6570\u8bbe\u7f6e\u4e3a-127001\u81ea\u52a8"},"1.4.2\u786e\u4fdd --bind-address \u53c2\u6570\u8bbe\u7f6e\u4e3a 127.0.0.1\uff08\u81ea\u52a8\uff09"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1apass"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u5728 Master \u8282\u70b9\u4e0a\u7f16\u8f91 Scheduler pod \u89c4\u8303\u6587\u4ef6 /var/lib/rancher/rke2/agent/pod-manifests/kube-scheduler.yaml\uff0c\u5e76\u786e\u4fdd ",(0,n.kt)("inlineCode",{parentName:"p"},"--bind-address")," \u53c2\u6570\u7684\u503c\u6b63\u786e\u3002"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"/bin/ps -ef | grep kube-scheduler | grep -v grep\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u9884\u671f\u7ed3\u679c"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},"'127.0.0.1' is equal to '127.0.0.1' OR '--bind-address' is not present\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u8fd4\u56de\u503c"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},"root 5533 5414 0 14:58 ?00:00:02 kube-scheduler --permit-port-sharing=true --address=127.0.0.1 --bind-address=127.0.0.1 --cert-dir=/var/lib/rancher/rke2/server/tls/kube-scheduler --kubeconfig=/var/lib/rancher/rke2/server/cred/scheduler.kubeconfig --port=10251 --profiling=false --secure-port=10259\n")),(0,n.kt)("h2",{id:"2-etcd-node-configuration-files"},"2 Etcd Node Configuration Files"),(0,n.kt)("h3",{id:"21\u786e\u4fdd\u6839\u636e\u9700\u8981\u8bbe\u7f6e---cert-file-\u548c---key-file-\u53c2\u6570\u81ea\u52a8"},"2.1\u786e\u4fdd\u6839\u636e\u9700\u8981\u8bbe\u7f6e --cert-file \u548c --key-file \u53c2\u6570\uff08\u81ea\u52a8\uff09"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1aNot Applicable"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u6309\u7167 etcd \u670d\u52a1\u6587\u6863\u914d\u7f6e TLS \u52a0\u5bc6\u3002\n\u7136\u540e\uff0c\u5728 Master \u8282\u70b9\u4e0a\u7f16\u8f91 etcd pod \u89c4\u8303\u6587\u4ef6 /etc/kubernetes/manifests/etcd.yaml\uff0c\u5e76\u8bbe\u7f6e\u4ee5\u4e0b\u53c2\u6570\u3002\n",(0,n.kt)("inlineCode",{parentName:"p"},"--cert-file=</path/to/ca-file>"),"\n",(0,n.kt)("inlineCode",{parentName:"p"},"--key-file=</path/to/key-file>")),(0,n.kt)("h3",{id:"22\u786e\u4fdd---client-cert-auth-\u53c2\u6570\u8bbe\u7f6e\u4e3a-true\u81ea\u52a8"},"2.2\u786e\u4fdd --client-cert-auth \u53c2\u6570\u8bbe\u7f6e\u4e3a true\uff08\u81ea\u52a8\uff09"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1aNot Applicable"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),'\uff1a\n\u5728 Master \u8282\u70b9\u4e0a\u7f16\u8f91 etcd pod \u89c4\u8303\u6587\u4ef6 /var/lib/rancher/rke2/agent/pod-manifests/etcd.yaml\uff0c\u5e76\u8bbe\u7f6e\u4ee5\u4e0b\u53c2\u6570\u3002\n--client-cert-auth="true"'),(0,n.kt)("h3",{id:"23\u786e\u4fdd---auto-tls-\u53c2\u6570\u672a\u8bbe\u7f6e\u4e3a-true\u81ea\u52a8"},"2.3\u786e\u4fdd --auto-tls \u53c2\u6570\u672a\u8bbe\u7f6e\u4e3a true\uff08\u81ea\u52a8\uff09"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1apass"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u5728 Master \u8282\u70b9\u4e0a\u7f16\u8f91 etcd pod \u89c4\u8303\u6587\u4ef6 /var/lib/rancher/rke2/agent/pod-manifests/etcd.yaml\uff0c\u5e76\u5220\u9664 ",(0,n.kt)("inlineCode",{parentName:"p"},"--auto-tls")," \u53c2\u6570\u6216\u5c06\u5176\u8bbe\u7f6e\u4e3a false\u3002\n--auto-tls=false"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"/bin/ps -ef | /bin/grep etcd | /bin/grep -v grep\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u9884\u671f\u7ed3\u679c"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},"'--auto-tls' is not present OR '--auto-tls' is not present\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u8fd4\u56de\u503c"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},"etcd 5059 5033 0 14:58 ?00:00:00 /pause etcd 5121 5033 3 14:58 ?00:00:18 etcd --config-file=/var/lib/rancher/rke2/server/db/etcd/config root 5275 5222 15 14:58 ?00:01:26 kube-apiserver --audit-policy-file=/etc/rancher/rke2/audit-policy.yaml --audit-log-path=/var/lib/rancher/rke2/server/logs/audit.log --audit-log-maxage=30 --audit-log-maxbackup=10 --audit-log-maxsize=100 --kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname --allow-privileged=true --anonymous-auth=false --api-audiences=https://kubernetes.default.svc.cluster.local,rke2 --authorization-mode=Node,RBAC --bind-address=0.0.0.0 --cert-dir=/var/lib/rancher/rke2/server/tls/temporary-certs --client-ca-file=/var/lib/rancher/rke2/server/tls/client-ca.crt --enable-admission-plugins=NodeRestriction,PodSecurityPolicy --encryption-provider-config=/var/lib/rancher/rke2/server/cred/encryption-config.json --etcd-cafile=/var/lib/rancher/rke2/server/tls/etcd/server-ca.crt --etcd-certfile=/var/lib/rancher/rke2/server/tls/etcd/client.crt --etcd-keyfile=/var/lib/rancher/rke2/server/tls/etcd/client.key --etcd-servers=https://127.0.0.1:2379 --insecure-port=0 --kubelet-certificate-authority=/var/lib/rancher/rke2/server/tls/server-ca.crt --kubelet-client-certificate=/var/lib/rancher/rke2/server/tls/client-kube-apiserver.crt --kubelet-client-key=/var/lib/rancher/rke2/server/tls/client-kube-apiserver.key --profiling=false --proxy-client-cert-file=/var/lib/rancher/rke2/server/tls/client-auth-proxy.crt --proxy-client-key-file=/var/lib/rancher/rke2/server/tls/client-auth-proxy.key --requestheader-allowed-names=system:auth-proxy --requestheader-client-ca-file=/var/lib/rancher/rke2/server/tls/request-header-ca.crt --requestheader-extra-headers-prefix=X-Remote-Extra- --requestheader-group-headers=X-Remote-Group --requestheader-username-headers=X-Remote-User --secure-port=6443 --service-account-issuer=https://kubernetes.default.svc.cluster.local --service-account-key-file=/var/lib/rancher/rke2/server/tls/service.key --service-account-signing-key-file=/var/lib/rancher/rke2/server/tls/service.key --service-cluster-ip-range=10.43.0.0/16 --service-node-port-range=30000-32767 --storage-backend=etcd3 --tls-cert-file=/var/lib/rancher/rke2/server/tls/serving-kube-apiserver.crt --tls-private-key-file=/var/lib/rancher/rke2/server/tls/serving-kube-apiserver.key root 16473 16413 0 15:07 ?00:00:00 kube-bench run --targets etcd --scored --nosummary --noremediations --v=5 --config-dir=/etc/kube-bench/cfg --benchmark rke2-cis-1.6-hardened --json --log_dir /tmp/results/logs --outputfile /tmp/results/etcd.json\n")),(0,n.kt)("h3",{id:"24\u786e\u4fdd\u6839\u636e\u9700\u8981\u8bbe\u7f6e---peer-cert-file-\u548c---peer-key-file-\u53c2\u6570\u81ea\u52a8"},"2.4\u786e\u4fdd\u6839\u636e\u9700\u8981\u8bbe\u7f6e --peer-cert-file \u548c --peer-key-file \u53c2\u6570\uff08\u81ea\u52a8\uff09"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1aNot Applicable"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u9075\u5faa etcd \u670d\u52a1\u6587\u6863\uff0c\u6839\u636e\u9700\u8981\u4e3a\u4f60\u7684 etcd \u96c6\u7fa4\u914d\u7f6e\u5bf9\u7b49 TLS \u52a0\u5bc6\u3002\n\u7136\u540e\uff0c\u5728 Master \u8282\u70b9\u4e0a\u7f16\u8f91 etcd pod \u89c4\u8303\u6587\u4ef6 /var/lib/rancher/rke2/agent/pod-manifests/etcd.yaml\uff0c\u5e76\u8bbe\u7f6e\u4ee5\u4e0b\u53c2\u6570\u3002\n",(0,n.kt)("inlineCode",{parentName:"p"},"--peer-client-file=</path/to/peer-cert-file>"),"\n",(0,n.kt)("inlineCode",{parentName:"p"},"--peer-key-file=</path/to/peer-key-file>")),(0,n.kt)("h3",{id:"25\u786e\u4fdd---peer-client-cert-auth-\u53c2\u6570\u8bbe\u7f6e\u4e3a-true\u81ea\u52a8"},"2.5\u786e\u4fdd --peer-client-cert-auth \u53c2\u6570\u8bbe\u7f6e\u4e3a true\uff08\u81ea\u52a8\uff09"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1aNot Applicable"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u5728 Master \u8282\u70b9\u4e0a\u7f16\u8f91 etcd pod \u89c4\u8303\u6587\u4ef6 /var/lib/rancher/rke2/agent/pod-manifests/etcd.yaml\uff0c\u5e76\u8bbe\u7f6e\u4ee5\u4e0b\u53c2\u6570\u3002\n--peer-client-cert-auth=true"),(0,n.kt)("h3",{id:"26\u786e\u4fdd---peer-auto-tls-\u53c2\u6570\u672a\u8bbe\u7f6e\u4e3a-true\u81ea\u52a8"},"2.6\u786e\u4fdd --peer-auto-tls \u53c2\u6570\u672a\u8bbe\u7f6e\u4e3a true\uff08\u81ea\u52a8\uff09"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1apass"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u5728 Master \u8282\u70b9\u4e0a\u7f16\u8f91 etcd pod \u89c4\u8303\u6587\u4ef6 /var/lib/rancher/rke2/agent/pod-manifests/etcd.yaml\uff0c\u5e76\u5220\u9664 ",(0,n.kt)("inlineCode",{parentName:"p"},"--peer-auto-tls")," \u53c2\u6570\u6216\u5c06\u5176\u8bbe\u7f6e\u4e3a false\u3002\n--peer-auto-tls=false"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"/bin/ps -ef | /bin/grep etcd | /bin/grep -v grep\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u9884\u671f\u7ed3\u679c"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},"'--peer-auto-tls' is not present OR '--peer-auto-tls' is not present\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u8fd4\u56de\u503c"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},"etcd 5059 5033 0 14:58 ?00:00:00 /pause etcd 5121 5033 3 14:58 ?00:00:18 etcd --config-file=/var/lib/rancher/rke2/server/db/etcd/config root 5275 5222 15 14:58 ?00:01:26 kube-apiserver --audit-policy-file=/etc/rancher/rke2/audit-policy.yaml --audit-log-path=/var/lib/rancher/rke2/server/logs/audit.log --audit-log-maxage=30 --audit-log-maxbackup=10 --audit-log-maxsize=100 --kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname --allow-privileged=true --anonymous-auth=false --api-audiences=https://kubernetes.default.svc.cluster.local,rke2 --authorization-mode=Node,RBAC --bind-address=0.0.0.0 --cert-dir=/var/lib/rancher/rke2/server/tls/temporary-certs --client-ca-file=/var/lib/rancher/rke2/server/tls/client-ca.crt --enable-admission-plugins=NodeRestriction,PodSecurityPolicy --encryption-provider-config=/var/lib/rancher/rke2/server/cred/encryption-config.json --etcd-cafile=/var/lib/rancher/rke2/server/tls/etcd/server-ca.crt --etcd-certfile=/var/lib/rancher/rke2/server/tls/etcd/client.crt --etcd-keyfile=/var/lib/rancher/rke2/server/tls/etcd/client.key --etcd-servers=https://127.0.0.1:2379 --insecure-port=0 --kubelet-certificate-authority=/var/lib/rancher/rke2/server/tls/server-ca.crt --kubelet-client-certificate=/var/lib/rancher/rke2/server/tls/client-kube-apiserver.crt --kubelet-client-key=/var/lib/rancher/rke2/server/tls/client-kube-apiserver.key --profiling=false --proxy-client-cert-file=/var/lib/rancher/rke2/server/tls/client-auth-proxy.crt --proxy-client-key-file=/var/lib/rancher/rke2/server/tls/client-auth-proxy.key --requestheader-allowed-names=system:auth-proxy --requestheader-client-ca-file=/var/lib/rancher/rke2/server/tls/request-header-ca.crt --requestheader-extra-headers-prefix=X-Remote-Extra- --requestheader-group-headers=X-Remote-Group --requestheader-username-headers=X-Remote-User --secure-port=6443 --service-account-issuer=https://kubernetes.default.svc.cluster.local --service-account-key-file=/var/lib/rancher/rke2/server/tls/service.key --service-account-signing-key-file=/var/lib/rancher/rke2/server/tls/service.key --service-cluster-ip-range=10.43.0.0/16 --service-node-port-range=30000-32767 --storage-backend=etcd3 --tls-cert-file=/var/lib/rancher/rke2/server/tls/serving-kube-apiserver.crt --tls-private-key-file=/var/lib/rancher/rke2/server/tls/serving-kube-apiserver.key root 16473 16413 6 15:07 ?00:00:00 kube-bench run --targets etcd --scored --nosummary --noremediations --v=5 --config-dir=/etc/kube-bench/cfg --benchmark rke2-cis-1.6-hardened --json --log_dir /tmp/results/logs --outputfile /tmp/results/etcd.json\n")),(0,n.kt)("h3",{id:"27\u786e\u4fdd-etcd-\u4f7f\u7528\u552f\u4e00\u7684-ca\u624b\u52a8"},"2.7\u786e\u4fdd etcd \u4f7f\u7528\u552f\u4e00\u7684 CA\uff08\u624b\u52a8\uff09"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1apass"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n","[\u624b\u52a8\u6d4b\u8bd5]","\n\u9075\u5faa etcd \u6587\u6863\uff0c\u4e3a etcd \u670d\u52a1\u521b\u5efa\u4e13\u7528\u7684 CA \u8bbe\u7f6e\u3002\n\u7136\u540e\uff0c\u5728 Master \u8282\u70b9\u4e0a\u7f16\u8f91 etcd pod \u89c4\u8303\u6587\u4ef6 /var/lib/rancher/rke2/agent/pod-manifests/etcd.yaml\uff0c\u5e76\u8bbe\u7f6e\u4ee5\u4e0b\u53c2\u6570\u3002\n",(0,n.kt)("inlineCode",{parentName:"p"},"--trusted-ca-file=</path/to/ca-file>")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"/bin/ps -ef | /bin/grep etcd | /bin/grep -v grep\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u9884\u671f\u7ed3\u679c"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},"'--trusted-ca-file' is not present\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u8fd4\u56de\u503c"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},"etcd 5059 5033 0 14:58 ?00:00:00 /pause etcd 5121 5033 3 14:58 ?00:00:18 etcd --config-file=/var/lib/rancher/rke2/server/db/etcd/config root 5275 5222 15 14:58 ?00:01:26 kube-apiserver --audit-policy-file=/etc/rancher/rke2/audit-policy.yaml --audit-log-path=/var/lib/rancher/rke2/server/logs/audit.log --audit-log-maxage=30 --audit-log-maxbackup=10 --audit-log-maxsize=100 --kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname --allow-privileged=true --anonymous-auth=false --api-audiences=https://kubernetes.default.svc.cluster.local,rke2 --authorization-mode=Node,RBAC --bind-address=0.0.0.0 --cert-dir=/var/lib/rancher/rke2/server/tls/temporary-certs --client-ca-file=/var/lib/rancher/rke2/server/tls/client-ca.crt --enable-admission-plugins=NodeRestriction,PodSecurityPolicy --encryption-provider-config=/var/lib/rancher/rke2/server/cred/encryption-config.json --etcd-cafile=/var/lib/rancher/rke2/server/tls/etcd/server-ca.crt --etcd-certfile=/var/lib/rancher/rke2/server/tls/etcd/client.crt --etcd-keyfile=/var/lib/rancher/rke2/server/tls/etcd/client.key --etcd-servers=https://127.0.0.1:2379 --insecure-port=0 --kubelet-certificate-authority=/var/lib/rancher/rke2/server/tls/server-ca.crt --kubelet-client-certificate=/var/lib/rancher/rke2/server/tls/client-kube-apiserver.crt --kubelet-client-key=/var/lib/rancher/rke2/server/tls/client-kube-apiserver.key --profiling=false --proxy-client-cert-file=/var/lib/rancher/rke2/server/tls/client-auth-proxy.crt --proxy-client-key-file=/var/lib/rancher/rke2/server/tls/client-auth-proxy.key --requestheader-allowed-names=system:auth-proxy --requestheader-client-ca-file=/var/lib/rancher/rke2/server/tls/request-header-ca.crt --requestheader-extra-headers-prefix=X-Remote-Extra- --requestheader-group-headers=X-Remote-Group --requestheader-username-headers=X-Remote-User --secure-port=6443 --service-account-issuer=https://kubernetes.default.svc.cluster.local --service-account-key-file=/var/lib/rancher/rke2/server/tls/service.key --service-account-signing-key-file=/var/lib/rancher/rke2/server/tls/service.key --service-cluster-ip-range=10.43.0.0/16 --service-node-port-range=30000-32767 --storage-backend=etcd3 --tls-cert-file=/var/lib/rancher/rke2/server/tls/serving-kube-apiserver.crt --tls-private-key-file=/var/lib/rancher/rke2/server/tls/serving-kube-apiserver.key root 16473 16413 3 15:07 ?00:00:00 kube-bench run --targets etcd --scored --nosummary --noremediations --v=5 --config-dir=/etc/kube-bench/cfg --benchmark rke2-cis-1.6-hardened --json --log_dir /tmp/results/logs --outputfile /tmp/results/etcd.json\n")),(0,n.kt)("h2",{id:"31\u8ba4\u8bc1\u548c\u6388\u6743"},"3.1\u8ba4\u8bc1\u548c\u6388\u6743"),(0,n.kt)("h3",{id:"311\u4e0d\u80fd\u5c06\u5ba2\u6237\u7aef\u8bc1\u4e66\u8eab\u4efd\u9a8c\u8bc1\u5e94\u7528\u4e8e\u7528\u6237\u624b\u52a8"},"3.1.1\u4e0d\u80fd\u5c06\u5ba2\u6237\u7aef\u8bc1\u4e66\u8eab\u4efd\u9a8c\u8bc1\u5e94\u7528\u4e8e\u7528\u6237\uff08\u624b\u52a8\uff09"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1awarn"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\nKubernetes \u63d0\u4f9b\u7684\u66ff\u4ee3\u673a\u5236\uff08\u4f8b\u5982 OIDC\uff09\u5e94\u8be5\u4ee3\u66ff\u5ba2\u6237\u7aef\u8bc1\u4e66\u7684\u5b9e\u73b0\u3002"),(0,n.kt)("h2",{id:"32logging"},"3.2Logging"),(0,n.kt)("h3",{id:"321\u786e\u4fdd\u521b\u5efa\u6700\u5c0f\u5ba1\u8ba1\u7b56\u7565\u81ea\u52a8"},"3.2.1\u786e\u4fdd\u521b\u5efa\u6700\u5c0f\u5ba1\u8ba1\u7b56\u7565\uff08\u81ea\u52a8\uff09"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1apass"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u4e3a\u4f60\u7684\u96c6\u7fa4\u521b\u5efa\u4e00\u4e2a\u5ba1\u8ba1\u7b56\u7565\u6587\u4ef6\u3002"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"/bin/ps -ef | grep kube-apiserver | grep -v grep | grep -o audit-policy-file\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u9884\u671f\u7ed3\u679c"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},"'audit-policy-file' is equal to 'audit-policy-file'\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u8fd4\u56de\u503c"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},"audit-policy-file\n")),(0,n.kt)("h3",{id:"322\u786e\u4fdd\u5ba1\u8ba1\u7b56\u7565\u6db5\u76d6\u5173\u952e\u5b89\u5168\u95ee\u9898\u624b\u52a8"},"3.2.2\u786e\u4fdd\u5ba1\u8ba1\u7b56\u7565\u6db5\u76d6\u5173\u952e\u5b89\u5168\u95ee\u9898\uff08\u624b\u52a8\uff09"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1awarn"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u8003\u8651\u4fee\u6539\u96c6\u7fa4\u4e0a\u4f7f\u7528\u7684\u5ba1\u8ba1\u7b56\u7565\uff0c\u81f3\u5c11\u8981\u5305\u62ec\u8fd9\u4e9b\u9879\u76ee\u3002"),(0,n.kt)("h2",{id:"41worker-\u8282\u70b9\u914d\u7f6e\u6587\u4ef6"},"4.1Worker \u8282\u70b9\u914d\u7f6e\u6587\u4ef6"),(0,n.kt)("h3",{id:"411\u786e\u4fdd-kubelet-\u670d\u52a1\u6587\u4ef6\u6743\u9650\u5177\u6709-644-\u6216\u66f4\u4e25\u683c\u7684\u8bbe\u7f6e\u81ea\u52a8"},"4.1.1\u786e\u4fdd kubelet \u670d\u52a1\u6587\u4ef6\u6743\u9650\u5177\u6709 644 \u6216\u66f4\u4e25\u683c\u7684\u8bbe\u7f6e\uff08\u81ea\u52a8\uff09"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1apass"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u5728\u6bcf\u4e2a Worker \u8282\u70b9\u4e0a\u8fd0\u884c\u4ee5\u4e0b\u547d\u4ee4\uff08\u57fa\u4e8e\u7cfb\u7edf\u4e0a\u7684\u6587\u4ef6\u4f4d\u7f6e\uff09\u3002\n\u4f8b\u5982\uff1achmod 644 /etc/systemd/system/kubelet.service.d/10-kubeadm.conf"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"/bin/sh -c 'if test -e /etc/systemd/system/kubelet.service.d/10-kubeadm.conf; then stat -c permissions=%a /etc/systemd/system/kubelet.service.d/10-kubeadm.conf; fi'\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u9884\u671f\u7ed3\u679c"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},"'permissions' is not present\n")),(0,n.kt)("h3",{id:"412\u786e\u4fdd-kubelet-\u670d\u52a1\u6587\u4ef6\u6240\u6709\u6743\u8bbe\u7f6e\u4e3a-rootroot\u81ea\u52a8"},"4.1.2\u786e\u4fdd kubelet \u670d\u52a1\u6587\u4ef6\u6240\u6709\u6743\u8bbe\u7f6e\u4e3a root:root\uff08\u81ea\u52a8\uff09"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1aNot Applicable"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u5728\u6bcf\u4e2a Worker \u8282\u70b9\u4e0a\u8fd0\u884c\u4ee5\u4e0b\u547d\u4ee4\uff08\u57fa\u4e8e\u7cfb\u7edf\u4e0a\u7684\u6587\u4ef6\u4f4d\u7f6e\uff09\u3002\n\u4f8b\u5982\uff1achown root:root /etc/systemd/system/kubelet.service.d/10-kubeadm.conf"),(0,n.kt)("h3",{id:"413\u5982\u679c\u4ee3\u7406-kubeconfig-\u6587\u4ef6\u5b58\u5728\u8bf7\u786e\u4fdd\u6743\u9650\u5177\u6709-644-\u6216\u66f4\u4e25\u683c\u7684\u8bbe\u7f6e\u624b\u52a8"},"4.1.3\u5982\u679c\u4ee3\u7406 kubeconfig \u6587\u4ef6\u5b58\u5728\uff0c\u8bf7\u786e\u4fdd\u6743\u9650\u5177\u6709 644 \u6216\u66f4\u4e25\u683c\u7684\u8bbe\u7f6e\uff08\u624b\u52a8\uff09"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1apass"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u5728\u6bcf\u4e2a Worker \u8282\u70b9\u4e0a\u8fd0\u884c\u4ee5\u4e0b\u547d\u4ee4\uff08\u57fa\u4e8e\u7cfb\u7edf\u4e0a\u7684\u6587\u4ef6\u4f4d\u7f6e\uff09\u3002\n\u4f8b\u5982\uff1achmod 644 /var/lib/rancher/rke2/agent/kubeproxy.kubeconfig"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"/bin/sh -c 'if test -e /node/var/lib/rancher/rke2/agent/kubeproxy.kubeconfig; then stat -c %a /node/var/lib/rancher/rke2/agent/kubeproxy.kubeconfig; fi'\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u9884\u671f\u7ed3\u679c"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},"'permissions' is present OR '/var/lib/rancher/rke2/agent/kubeproxy.kubeconfig' is not present\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u8fd4\u56de\u503c"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},"644\n")),(0,n.kt)("h3",{id:"414\u786e\u4fdd\u4ee3\u7406-kubeconfig-\u6587\u4ef6\u6240\u6709\u6743\u8bbe\u7f6e\u4e3a-rootroot\u624b\u52a8"},"4.1.4\u786e\u4fdd\u4ee3\u7406 kubeconfig \u6587\u4ef6\u6240\u6709\u6743\u8bbe\u7f6e\u4e3a root:root\uff08\u624b\u52a8\uff09"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1apass"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u5728\u6bcf\u4e2a Worker \u8282\u70b9\u4e0a\u8fd0\u884c\u4ee5\u4e0b\u547d\u4ee4\uff08\u57fa\u4e8e\u7cfb\u7edf\u4e0a\u7684\u6587\u4ef6\u4f4d\u7f6e\uff09\u3002\n\u4f8b\u5982\uff1achown root:root /var/lib/rancher/rke2/agent/kubeproxy.kubeconfig"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"/bin/sh -c 'if test -e /var/lib/rancher/rke2/agent/kubeproxy.kubeconfig; then stat -c %U:%G /var/lib/rancher/rke2/agent/kubeproxy.kubeconfig; fi'\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u9884\u671f\u7ed3\u679c"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},"'root:root' is not present OR '/var/lib/rancher/rke2/agent/kubeproxy.kubeconfig' is not present\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u8fd4\u56de\u503c"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},"root:root\n")),(0,n.kt)("h3",{id:"415\u786e\u4fdd---kubeconfig-kubeletconf-\u6587\u4ef6\u6743\u9650\u5177\u6709-644-\u6216\u66f4\u4e25\u683c\u7684\u8bbe\u7f6e\u81ea\u52a8"},"4.1.5\u786e\u4fdd --kubeconfig kubelet.conf \u6587\u4ef6\u6743\u9650\u5177\u6709 644 \u6216\u66f4\u4e25\u683c\u7684\u8bbe\u7f6e\uff08\u81ea\u52a8\uff09"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1apass"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u5728\u6bcf\u4e2a Worker \u8282\u70b9\u4e0a\u8fd0\u884c\u4ee5\u4e0b\u547d\u4ee4\uff08\u57fa\u4e8e\u7cfb\u7edf\u4e0a\u7684\u6587\u4ef6\u4f4d\u7f6e\uff09\u3002\n\u4f8b\u5982\uff1achmod 644 /var/lib/rancher/rke2/agent/kubelet.kubeconfig"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"/bin/sh -c 'if test -e /var/lib/rancher/rke2/agent/kubelet.kubeconfig; then stat -c permissions=%a /var/lib/rancher/rke2/agent/kubelet.kubeconfig; fi'\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u9884\u671f\u7ed3\u679c"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},"'644' is equal to '644'\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u8fd4\u56de\u503c"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},"permissions=644\n")),(0,n.kt)("h3",{id:"416\u786e\u4fdd---kubeconfig-kubeletconf-\u6587\u4ef6\u6240\u6709\u6743\u8bbe\u7f6e\u4e3a-rootroot\u81ea\u52a8"},"4.1.6\u786e\u4fdd --kubeconfig kubelet.conf \u6587\u4ef6\u6240\u6709\u6743\u8bbe\u7f6e\u4e3a root:root\uff08\u81ea\u52a8\uff09"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1apass"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u5728\u6bcf\u4e2a Worker \u8282\u70b9\u4e0a\u8fd0\u884c\u4ee5\u4e0b\u547d\u4ee4\uff08\u57fa\u4e8e\u7cfb\u7edf\u4e0a\u7684\u6587\u4ef6\u4f4d\u7f6e\uff09\u3002\n\u4f8b\u5982\uff1achown root:root /var/lib/rancher/rke2/agent/kubelet.kubeconfig"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"/bin/sh -c 'if test -e /var/lib/rancher/rke2/agent/kubelet.kubeconfig; then stat -c %U:%G /var/lib/rancher/rke2/agent/kubelet.kubeconfig; fi'\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u9884\u671f\u7ed3\u679c"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},"'root:root' is equal to 'root:root'\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u8fd4\u56de\u503c"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},"root:root\n")),(0,n.kt)("h3",{id:"417\u786e\u4fdd-ca-\u6587\u4ef6\u6743\u9650\u5177\u6709-644-\u6216\u66f4\u4e25\u683c\u7684\u8bbe\u7f6e\u624b\u52a8"},"4.1.7\u786e\u4fdd CA \u6587\u4ef6\u6743\u9650\u5177\u6709 644 \u6216\u66f4\u4e25\u683c\u7684\u8bbe\u7f6e\uff08\u624b\u52a8\uff09"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1awarn"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u8fd0\u884c\u4ee5\u4e0b\u547d\u4ee4\u4fee\u6539 ",(0,n.kt)("inlineCode",{parentName:"p"},"--client-ca-file chmod 644 <filename>")," \u7684\u6587\u4ef6\u6743\u9650\u3002"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"stat -c %a /var/lib/rancher/rke2/server/tls/server-ca.crt\n")),(0,n.kt)("h3",{id:"418\u786e\u4fdd\u5ba2\u6237\u7aef-ca-\u6587\u4ef6\u6240\u6709\u6743\u8bbe\u7f6e\u4e3a-rootroot\u81ea\u52a8"},"4.1.8\u786e\u4fdd\u5ba2\u6237\u7aef CA \u6587\u4ef6\u6240\u6709\u6743\u8bbe\u7f6e\u4e3a root:root\uff08\u81ea\u52a8\uff09"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1apass"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u8fd0\u884c\u4ee5\u4e0b\u547d\u4ee4\u6765\u4fee\u6539 ",(0,n.kt)("inlineCode",{parentName:"p"},"--client-ca-file")," \u7684\u6240\u6709\u6743\u3002\n",(0,n.kt)("inlineCode",{parentName:"p"},"chown root:roset: trueot <filename>")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"/bin/sh -c 'if test -e /var/lib/rancher/rke2/agent/client-ca.crt; then stat -c %U:%G /var/lib/rancher/rke2/agent/client-ca.crt; fi'\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u9884\u671f\u7ed3\u679c"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},"'root:root' is equal to 'root:root'\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u8fd4\u56de\u503c"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},"root:root\n")),(0,n.kt)("h3",{id:"419\u786e\u4fdd-kubelet---config-\u914d\u7f6e\u6587\u4ef6\u6743\u9650\u5177\u6709-644-\u6216\u66f4\u4e25\u683c\u7684\u8bbe\u7f6e\u81ea\u52a8"},"4.1.9\u786e\u4fdd kubelet --config \u914d\u7f6e\u6587\u4ef6\u6743\u9650\u5177\u6709 644 \u6216\u66f4\u4e25\u683c\u7684\u8bbe\u7f6e\uff08\u81ea\u52a8\uff09"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1apass"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u8fd0\u884c\u4ee5\u4e0b\u547d\u4ee4\uff08\u4f7f\u7528\u5ba1\u8ba1\u6b65\u9aa4\u4e2d\u786e\u5b9a\u7684\u914d\u7f6e\u6587\u4ef6\u4f4d\u7f6e\uff09\uff1a\nchmod 644 /var/lib/rancher/rke2/agent/kubelet.kubeconfig"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"/bin/sh -c 'if test -e /var/lib/rancher/rke2/agent/kubelet.kubeconfig; then stat -c permissions=%a /var/lib/rancher/rke2/agent/kubelet.kubeconfig; fi'\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u9884\u671f\u7ed3\u679c"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},"'644' is equal to '644'\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u8fd4\u56de\u503c"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},"permissions=644\n")),(0,n.kt)("h3",{id:"4110\u786e\u4fdd-kubelet---config-\u914d\u7f6e\u6587\u4ef6\u6240\u6709\u6743\u8bbe\u7f6e\u4e3a-rootroot\u81ea\u52a8"},"4.1.10\u786e\u4fdd kubelet --config \u914d\u7f6e\u6587\u4ef6\u6240\u6709\u6743\u8bbe\u7f6e\u4e3a root:root\uff08\u81ea\u52a8\uff09"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1apass"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u8fd0\u884c\u4ee5\u4e0b\u547d\u4ee4\uff08\u4f7f\u7528\u5ba1\u8ba1\u6b65\u9aa4\u4e2d\u786e\u5b9a\u7684\u914d\u7f6e\u6587\u4ef6\u4f4d\u7f6e\uff09\uff1a\nchown root:root /var/lib/rancher/rke2/agent/kubelet.kubeconfig"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"/bin/sh -c 'if test -e /var/lib/rancher/rke2/agent/kubelet.kubeconfig; then stat -c %U:%G /var/lib/rancher/rke2/agent/kubelet.kubeconfig; fi'\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u9884\u671f\u7ed3\u679c"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},"'root:root' is present\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u8fd4\u56de\u503c"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},"root:root\n")),(0,n.kt)("h2",{id:"42kubelet"},"4.2Kubelet"),(0,n.kt)("h3",{id:"421\u786e\u4fdd\u5c06-anonymous-auth-\u53c2\u6570\u8bbe\u7f6e\u4e3a-false\u81ea\u52a8"},"4.2.1\u786e\u4fdd\u5c06 anonymous-auth \u53c2\u6570\u8bbe\u7f6e\u4e3a false\uff08\u81ea\u52a8\uff09"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1apass"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u5982\u679c\u4f7f\u7528 Kubelet \u914d\u7f6e\u6587\u4ef6\uff0c\u8bf7\u7f16\u8f91\u8be5\u6587\u4ef6\uff0c\u5c06 authentication: anonymous \u8bbe\u7f6e\u4e3a ",(0,n.kt)("inlineCode",{parentName:"p"},"false"),"\u3002\n\u5982\u679c\u4f7f\u7528\u53ef\u6267\u884c\u53c2\u6570\uff0c\u8bf7\u5728\u6bcf\u4e2a Worker \u8282\u70b9\u4e2d\u7f16\u8f91 kubelet \u670d\u52a1\u6587\u4ef6 /etc/systemd/system/kubelet.service.d/10-kubeadm.conf\uff0c\u5e76\u5728 ",(0,n.kt)("inlineCode",{parentName:"p"},"KUBELET_SYSTEM_PODS_ARGS")," \u53d8\u91cf\u4e2d\u8bbe\u7f6e\u4ee5\u4e0b\u53c2\u6570\u3002\n--anonymous-auth=false\n\u6839\u636e\u4f60\u7684\u7cfb\u7edf\uff0c\u91cd\u65b0\u542f\u52a8 kubelet \u670d\u52a1\u3002\u4f8b\u5982\uff1a\nsystemctl daemon-reload\nsystemctl restart kubelet.service"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"/bin/ps -fC kubelet\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1\u914d\u7f6e"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"/bin/cat /var/lib/rancher/rke2/agent/kubelet.kubeconfig\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u9884\u671f\u7ed3\u679c"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},"'false' is equal to 'false'\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u8fd4\u56de\u503c"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},"UID PID PPID C STIME TTY TIME CMD root 4785 4751 3 14:58 ?00:00:21 kubelet --volume-plugin-dir=/var/lib/kubelet/volumeplugins --file-check-frequency=5s --sync-frequency=30s --address=0.0.0.0 --alsologtostderr=false --anonymous-auth=false --authentication-token-webhook=true --authorization-mode=Webhook --cgroup-driver=cgroupfs --client-ca-file=/var/lib/rancher/rke2/agent/client-ca.crt --cloud-provider=external --cluster-dns=10.43.0.10 --cluster-domain=cluster.local --container-runtime-endpoint=unix:///run/k3s/containerd/containerd.sock --container-runtime=remote --containerd=/run/k3s/containerd/containerd.sock --eviction-hard=imagefs.available<5%,nodefs.available<5% --eviction-minimum-reclaim=imagefs.available=10%,nodefs.available=10% --fail-swap-on=false --healthz-bind-address=127.0.0.1 --hostname-override=<node_ip> --kubeconfig=/var/lib/rancher/rke2/agent/kubelet.kubeconfig --log-file-max-size=50 --log-file=/var/lib/rancher/rke2/agent/logs/kubelet.log --logtostderr=false --node-labels=cattle.io/os=linux,rke.cattle.io/machine=7c32844c-359f-45f7-88c5-a7173d27690a --pod-manifest-path=/var/lib/rancher/rke2/agent/pod-manifests --protect-kernel-defaults=true --read-only-port=0 --resolv-conf=/run/systemd/resolve/resolv.conf --serialize-image-pulls=false --stderrthreshold=FATAL --tls-cert-file=/var/lib/rancher/rke2/agent/serving-kubelet.crt --tls-private-key-file=/var/lib/rancher/rke2/agent/serving-kubelet.key\n")),(0,n.kt)("h3",{id:"422\u786e\u4fdd---authorization-mode-\u53c2\u6570\u672a\u8bbe\u7f6e\u4e3a-alwaysallow\u81ea\u52a8"},"4.2.2\u786e\u4fdd --authorization-mode \u53c2\u6570\u672a\u8bbe\u7f6e\u4e3a AlwaysAllow\uff08\u81ea\u52a8\uff09"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1apass"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u5982\u679c\u4f7f\u7528 Kubelet \u914d\u7f6e\u6587\u4ef6\uff0c\u8bf7\u7f16\u8f91\u8be5\u6587\u4ef6\uff0c\u5c06 authorization: mode \u8bbe\u7f6e\u4e3a ",(0,n.kt)("inlineCode",{parentName:"p"},"Webhook"),"\u3002\u5982\u679c\u4f7f\u7528\u53ef\u6267\u884c\u53c2\u6570\uff0c\u8bf7\u5728\u6bcf\u4e2a Worker \u8282\u70b9\u4e2d\u7f16\u8f91 kubelet \u670d\u52a1\u6587\u4ef6 /etc/systemd/system/kubelet.service.d/10-kubeadm.conf\uff0c\u5e76\u5728 ",(0,n.kt)("inlineCode",{parentName:"p"},"KUBELET_AUTHZ_ARGS")," \u53d8\u91cf\u4e2d\u8bbe\u7f6e\u4ee5\u4e0b\u53c2\u6570\u3002\n--authorization-mode=Webhook\n\u6839\u636e\u4f60\u7684\u7cfb\u7edf\uff0c\u91cd\u65b0\u542f\u52a8 kubelet \u670d\u52a1\u3002\u4f8b\u5982\uff1a\nsystemctl daemon-reload\nsystemctl restart kubelet.service"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"/bin/ps -fC kubelet\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1\u914d\u7f6e"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"/bin/cat /var/lib/rancher/rke2/agent/kubelet.kubeconfig\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u9884\u671f\u7ed3\u679c"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},"'' is not present\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u8fd4\u56de\u503c"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},"apiVersion: v1 clusters: - cluster: server: https://127.0.0.1:6443 certificate-authority: /var/lib/rancher/rke2/agent/server-ca.crt name: local contexts: - context: cluster: local namespace: default user: user name: Default current-context: Default kind: Config preferences: {} users: - name: user user: client-certificate: /var/lib/rancher/rke2/agent/client-kubelet.crt client-key: /var/lib/rancher/rke2/agent/client-kubelet.key\n")),(0,n.kt)("h3",{id:"423\u786e\u4fdd\u6839\u636e\u9700\u8981\u8bbe\u7f6e---client-ca-file-\u53c2\u6570\u81ea\u52a8"},"4.2.3\u786e\u4fdd\u6839\u636e\u9700\u8981\u8bbe\u7f6e --client-ca-file \u53c2\u6570\uff08\u81ea\u52a8\uff09"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1apass"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u5982\u679c\u4f7f\u7528 Kubelet \u914d\u7f6e\u6587\u4ef6\uff0c\u8bf7\u7f16\u8f91\u6587\u4ef6\uff0c\u5c06 authentication: x509: clientCAFile \u8bbe\u7f6e\u4e3a\u5ba2\u6237\u7aef CA \u6587\u4ef6\u7684\u4f4d\u7f6e\u3002\n\u5982\u679c\u4f7f\u7528\u547d\u4ee4\u884c\u53c2\u6570\uff0c\u8bf7\u5728\u6bcf\u4e2a Worker \u8282\u70b9\u4e2d\u7f16\u8f91 kubelet \u670d\u52a1\u6587\u4ef6 /etc/systemd/system/kubelet.service.d/10-kubeadm.conf\uff0c\u5e76\u5728 ",(0,n.kt)("inlineCode",{parentName:"p"},"KUBELET_AUTHZ_ARGS")," \u53d8\u91cf\u4e2d\u8bbe\u7f6e\u4ee5\u4e0b\u53c2\u6570\u3002\n",(0,n.kt)("inlineCode",{parentName:"p"},"--client-ca-file=<path/to/client-ca-file>"),"\n\u6839\u636e\u4f60\u7684\u7cfb\u7edf\uff0c\u91cd\u65b0\u542f\u52a8 kubelet \u670d\u52a1\u3002\u4f8b\u5982\uff1a\nsystemctl daemon-reload\nsystemctl restart kubelet.service"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"/bin/ps -fC kubelet\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1\u914d\u7f6e"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"/bin/cat /var/lib/rancher/rke2/agent/kubelet.kubeconfig\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u9884\u671f\u7ed3\u679c"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},"'' is not present\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u8fd4\u56de\u503c"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},"apiVersion: v1 clusters: - cluster: server: https://127.0.0.1:6443 certificate-authority: /var/lib/rancher/rke2/agent/server-ca.crt name: local contexts: - context: cluster: local namespace: default user: user name: Default current-context: Default kind: Config preferences: {} users: - name: user user: client-certificate: /var/lib/rancher/rke2/agent/client-kubelet.crt client-key: /var/lib/rancher/rke2/agent/client-kubelet.key\n")),(0,n.kt)("h3",{id:"424\u786e\u4fdd---read-only-port-\u53c2\u6570\u8bbe\u7f6e\u4e3a-0\u81ea\u52a8"},"4.2.4\u786e\u4fdd --read-only-port \u53c2\u6570\u8bbe\u7f6e\u4e3a 0\uff08\u81ea\u52a8\uff09"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1apass"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u5982\u679c\u4f7f\u7528 Kubelet \u914d\u7f6e\u6587\u4ef6\uff0c\u8bf7\u7f16\u8f91\u8be5\u6587\u4ef6\uff0c\u5c06 ",(0,n.kt)("inlineCode",{parentName:"p"},"readOnlyPort")," \u8bbe\u7f6e\u4e3a 0\u3002\n\u5982\u679c\u4f7f\u7528\u547d\u4ee4\u884c\u53c2\u6570\uff0c\u8bf7\u5728\u6bcf\u4e2a Worker \u8282\u70b9\u4e2d\u7f16\u8f91 kubelet \u670d\u52a1\u6587\u4ef6 /etc/systemd/system/kubelet.service.d/10-kubeadm.conf\uff0c\u5e76\u5728 ",(0,n.kt)("inlineCode",{parentName:"p"},"KUBELET_SYSTEM_PODS_ARGS")," \u53d8\u91cf\u4e2d\u8bbe\u7f6e\u4ee5\u4e0b\u53c2\u6570\u3002\n--read-only-port=0\n\u6839\u636e\u4f60\u7684\u7cfb\u7edf\uff0c\u91cd\u65b0\u542f\u52a8 kubelet \u670d\u52a1\u3002\u4f8b\u5982\uff1a\nsystemctl daemon-reload\nsystemctl restart kubelet.service"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"/bin/ps -fC kubelet\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1\u914d\u7f6e"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"/bin/cat /var/lib/rancher/rke2/agent/kubelet.kubeconfig\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u9884\u671f\u7ed3\u679c"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},"'0' is equal to '0' AND '--read-only-port' is present\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u8fd4\u56de\u503c"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},"UID PID PPID C STIME TTY TIME CMD root 4785 4751 3 14:58 ?00:00:21 kubelet --volume-plugin-dir=/var/lib/kubelet/volumeplugins --file-check-frequency=5s --sync-frequency=30s --address=0.0.0.0 --alsologtostderr=false --anonymous-auth=false --authentication-token-webhook=true --authorization-mode=Webhook --cgroup-driver=cgroupfs --client-ca-file=/var/lib/rancher/rke2/agent/client-ca.crt --cloud-provider=external --cluster-dns=10.43.0.10 --cluster-domain=cluster.local --container-runtime-endpoint=unix:///run/k3s/containerd/containerd.sock --container-runtime=remote --containerd=/run/k3s/containerd/containerd.sock --eviction-hard=imagefs.available<5%,nodefs.available<5% --eviction-minimum-reclaim=imagefs.available=10%,nodefs.available=10% --fail-swap-on=false --healthz-bind-address=127.0.0.1 --hostname-override=<node_ip> --kubeconfig=/var/lib/rancher/rke2/agent/kubelet.kubeconfig --log-file-max-size=50 --log-file=/var/lib/rancher/rke2/agent/logs/kubelet.log --logtostderr=false --node-labels=cattle.io/os=linux,rke.cattle.io/machine=7c32844c-359f-45f7-88c5-a7173d27690a --pod-manifest-path=/var/lib/rancher/rke2/agent/pod-manifests --protect-kernel-defaults=true --read-only-port=0 --resolv-conf=/run/systemd/resolve/resolv.conf --serialize-image-pulls=false --stderrthreshold=FATAL --tls-cert-file=/var/lib/rancher/rke2/agent/serving-kubelet.crt --tls-private-key-file=/var/lib/rancher/rke2/agent/serving-kubelet.key\n")),(0,n.kt)("h3",{id:"425\u786e\u4fdd---streaming-connection-idle-timeout-\u53c2\u6570\u672a\u8bbe\u7f6e\u4e3a-0\u81ea\u52a8"},"4.2.5\u786e\u4fdd --streaming-connection-idle-timeout \u53c2\u6570\u672a\u8bbe\u7f6e\u4e3a 0\uff08\u81ea\u52a8\uff09"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1apass"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u5982\u679c\u4f7f\u7528 Kubelet \u914d\u7f6e\u6587\u4ef6\uff0c\u8bf7\u7f16\u8f91\u8be5\u6587\u4ef6\uff0c\u5c06 ",(0,n.kt)("inlineCode",{parentName:"p"},"streamingConnectionIdleTimeout")," \u8bbe\u7f6e\u4e3a 0 \u4ee5\u5916\u7684\u503c\u3002\n\u5982\u679c\u4f7f\u7528\u547d\u4ee4\u884c\u53c2\u6570\uff0c\u8bf7\u5728\u6bcf\u4e2a Worker \u8282\u70b9\u4e2d\u7f16\u8f91 kubelet \u670d\u52a1\u6587\u4ef6 /etc/systemd/system/kubelet.service.d/10-kubeadm.conf\uff0c\u5e76\u5728 ",(0,n.kt)("inlineCode",{parentName:"p"},"KUBELET_SYSTEM_PODS_ARGS")," \u53d8\u91cf\u4e2d\u8bbe\u7f6e\u4ee5\u4e0b\u53c2\u6570\u3002\n--streaming-connection-idle-timeout=5m\n\u6839\u636e\u4f60\u7684\u7cfb\u7edf\uff0c\u91cd\u65b0\u542f\u52a8 kubelet \u670d\u52a1\u3002\u4f8b\u5982\uff1a\nsystemctl daemon-reload\nsystemctl restart kubelet.service"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"/bin/ps -fC kubelet\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1\u914d\u7f6e"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"/bin/cat /var/lib/rancher/rke2/agent/kubelet.kubeconfig\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u9884\u671f\u7ed3\u679c"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},"'--streaming-connection-idle-timeout' is not present OR '--streaming-connection-idle-timeout' is present\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u8fd4\u56de\u503c"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},"UID PID PPID C STIME TTY TIME CMD root 4785 4751 3 14:58 ?00:00:21 kubelet --volume-plugin-dir=/var/lib/kubelet/volumeplugins --file-check-frequency=5s --sync-frequency=30s --address=0.0.0.0 --alsologtostderr=false --anonymous-auth=false --authentication-token-webhook=true --authorization-mode=Webhook --cgroup-driver=cgroupfs --client-ca-file=/var/lib/rancher/rke2/agent/client-ca.crt --cloud-provider=external --cluster-dns=10.43.0.10 --cluster-domain=cluster.local --container-runtime-endpoint=unix:///run/k3s/containerd/containerd.sock --container-runtime=remote --containerd=/run/k3s/containerd/containerd.sock --eviction-hard=imagefs.available<5%,nodefs.available<5% --eviction-minimum-reclaim=imagefs.available=10%,nodefs.available=10% --fail-swap-on=false --healthz-bind-address=127.0.0.1 --hostname-override=<node_ip> --kubeconfig=/var/lib/rancher/rke2/agent/kubelet.kubeconfig --log-file-max-size=50 --log-file=/var/lib/rancher/rke2/agent/logs/kubelet.log --logtostderr=false --node-labels=cattle.io/os=linux,rke.cattle.io/machine=7c32844c-359f-45f7-88c5-a7173d27690a --pod-manifest-path=/var/lib/rancher/rke2/agent/pod-manifests --protect-kernel-defaults=true --read-only-port=0 --resolv-conf=/run/systemd/resolve/resolv.conf --serialize-image-pulls=false --stderrthreshold=FATAL --tls-cert-file=/var/lib/rancher/rke2/agent/serving-kubelet.crt --tls-private-key-file=/var/lib/rancher/rke2/agent/serving-kubelet.key\n")),(0,n.kt)("h3",{id:"426\u786e\u4fdd---protect-kernel-defaults-\u53c2\u6570\u8bbe\u7f6e\u4e3a-true\u81ea\u52a8"},"4.2.6\u786e\u4fdd --protect-kernel-defaults \u53c2\u6570\u8bbe\u7f6e\u4e3a true\uff08\u81ea\u52a8\uff09"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1apass"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u5982\u679c\u4f7f\u7528 Kubelet \u914d\u7f6e\u6587\u4ef6\uff0c\u8bf7\u7f16\u8f91\u8be5\u6587\u4ef6\u4ee5\u8bbe\u7f6e ",(0,n.kt)("inlineCode",{parentName:"p"},"protectKernelDefaults: true"),"\u3002\n\u5982\u679c\u4f7f\u7528\u547d\u4ee4\u884c\u53c2\u6570\uff0c\u8bf7\u5728\u6bcf\u4e2a Worker \u8282\u70b9\u4e2d\u7f16\u8f91 kubelet \u670d\u52a1\u6587\u4ef6 /etc/systemd/system/kubelet.service.d/10-kubeadm.conf\uff0c\u5e76\u5728 ",(0,n.kt)("inlineCode",{parentName:"p"},"KUBELET_SYSTEM_PODS_ARGS")," \u53d8\u91cf\u4e2d\u8bbe\u7f6e\u4ee5\u4e0b\u53c2\u6570\u3002\n--protect-kernel-defaults=true\n\u6839\u636e\u4f60\u7684\u7cfb\u7edf\uff0c\u91cd\u65b0\u542f\u52a8 kubelet \u670d\u52a1\u3002\u4f8b\u5982\uff1a\nsystemctl daemon-reload\nsystemctl restart kubelet.service"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"/bin/ps -fC kubelet\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1\u914d\u7f6e"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"/bin/cat /var/lib/rancher/rke2/agent/kubelet.kubeconfig\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u9884\u671f\u7ed3\u679c"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},"'' is not present\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u8fd4\u56de\u503c"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},"apiVersion: v1 clusters: - cluster: server: https://127.0.0.1:6443 certificate-authority: /var/lib/rancher/rke2/agent/server-ca.crt name: local contexts: - context: cluster: local namespace: default user: user name: Default current-context: Default kind: Config preferences: {} users: - name: user user: client-certificate: /var/lib/rancher/rke2/agent/client-kubelet.crt client-key: /var/lib/rancher/rke2/agent/client-kubelet.key\n")),(0,n.kt)("h3",{id:"427\u786e\u4fdd---make-iptables-util-chains-\u53c2\u6570\u8bbe\u7f6e\u4e3a-true\u81ea\u52a8"},"4.2.7\u786e\u4fdd --make-iptables-util-chains \u53c2\u6570\u8bbe\u7f6e\u4e3a true\uff08\u81ea\u52a8\uff09"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1apass"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u5982\u679c\u4f7f\u7528 Kubelet \u914d\u7f6e\u6587\u4ef6\uff0c\u8bf7\u7f16\u8f91\u8be5\u6587\u4ef6\u4ee5\u8bbe\u7f6e ",(0,n.kt)("inlineCode",{parentName:"p"},"makeIPTablesUtilChains: true"),"\u3002\n\u5982\u679c\u4f7f\u7528\u547d\u4ee4\u884c\u53c2\u6570\uff0c\u8bf7\u5728\u6bcf\u4e2a Worker \u8282\u70b9\u4e0a\u7f16\u8f91 kubelet \u670d\u52a1\u6587\u4ef6 /etc/systemd/system/kubelet.service.d/10-kubeadm.conf\uff0c\u5e76\u5220\u9664 ",(0,n.kt)("inlineCode",{parentName:"p"},"KUBELET_SYSTEM_PODS_ARGS")," \u53d8\u91cf\u4e2d\u7684 ",(0,n.kt)("inlineCode",{parentName:"p"},"--make-iptables-util-chains")," \u53c2\u6570\u3002\n\u6839\u636e\u4f60\u7684\u7cfb\u7edf\uff0c\u91cd\u65b0\u542f\u52a8 kubelet \u670d\u52a1\u3002\u4f8b\u5982\uff1a\nsystemctl daemon-reload\nsystemctl restart kubelet.service"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"/bin/ps -fC kubelet\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1\u914d\u7f6e"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"/bin/cat /var/lib/rancher/rke2/agent/kubelet.kubeconfig\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u9884\u671f\u7ed3\u679c"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},"'--make-iptables-util-chains' is not present OR '--make-iptables-util-chains' is not present\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u8fd4\u56de\u503c"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},"UID PID PPID C STIME TTY TIME CMD root 4785 4751 3 14:58 ?00:00:21 kubelet --volume-plugin-dir=/var/lib/kubelet/volumeplugins --file-check-frequency=5s --sync-frequency=30s --address=0.0.0.0 --alsologtostderr=false --anonymous-auth=false --authentication-token-webhook=true --authorization-mode=Webhook --cgroup-driver=cgroupfs --client-ca-file=/var/lib/rancher/rke2/agent/client-ca.crt --cloud-provider=external --cluster-dns=10.43.0.10 --cluster-domain=cluster.local --container-runtime-endpoint=unix:///run/k3s/containerd/containerd.sock --container-runtime=remote --containerd=/run/k3s/containerd/containerd.sock --eviction-hard=imagefs.available<5%,nodefs.available<5% --eviction-minimum-reclaim=imagefs.available=10%,nodefs.available=10% --fail-swap-on=false --healthz-bind-address=127.0.0.1 --hostname-override=<node_ip> --kubeconfig=/var/lib/rancher/rke2/agent/kubelet.kubeconfig --log-file-max-size=50 --log-file=/var/lib/rancher/rke2/agent/logs/kubelet.log --logtostderr=false --node-labels=cattle.io/os=linux,rke.cattle.io/machine=7c32844c-359f-45f7-88c5-a7173d27690a --pod-manifest-path=/var/lib/rancher/rke2/agent/pod-manifests --protect-kernel-defaults=true --read-only-port=0 --resolv-conf=/run/systemd/resolve/resolv.conf --serialize-image-pulls=false --stderrthreshold=FATAL --tls-cert-file=/var/lib/rancher/rke2/agent/serving-kubelet.crt --tls-private-key-file=/var/lib/rancher/rke2/agent/serving-kubelet.key\n")),(0,n.kt)("h3",{id:"428\u786e\u4fdd\u672a\u8bbe\u7f6e---hostname-override-\u53c2\u6570\u624b\u52a8"},"4.2.8\u786e\u4fdd\u672a\u8bbe\u7f6e --hostname-override \u53c2\u6570\uff08\u624b\u52a8\uff09"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1awarn"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u5728\u6bcf\u4e2a Worker \u8282\u70b9\u4e0a\u7f16\u8f91 kubelet \u670d\u52a1\u6587\u4ef6 /etc/systemd/system/kubelet.service.d/10-kubeadm.conf\uff0c\u5e76\u5220\u9664 ",(0,n.kt)("inlineCode",{parentName:"p"},"KUBELET_SYSTEM_PODS_ARGS")," \u53d8\u91cf\u4e2d\u7684 ",(0,n.kt)("inlineCode",{parentName:"p"},"--hostname-override")," \u53c2\u6570\u3002\n\u6839\u636e\u4f60\u7684\u7cfb\u7edf\uff0c\u91cd\u65b0\u542f\u52a8 kubelet \u670d\u52a1\u3002\u4f8b\u5982\uff1a\nsystemctl daemon-reload\nsystemctl restart kubelet.service"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"/bin/ps -fC kubelet\n")),(0,n.kt)("h3",{id:"429\u786e\u4fdd---event-qps-\u53c2\u6570\u8bbe\u7f6e\u4e3a-0-\u6216\u80fd\u9002\u5f53\u6293\u53d6\u4e8b\u4ef6\u7684\u7ea7\u522b\u624b\u52a8"},"4.2.9\u786e\u4fdd --event-qps \u53c2\u6570\u8bbe\u7f6e\u4e3a 0 \u6216\u80fd\u9002\u5f53\u6293\u53d6\u4e8b\u4ef6\u7684\u7ea7\u522b\uff08\u624b\u52a8\uff09"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1apass"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u5982\u679c\u4f7f\u7528 Kubelet \u914d\u7f6e\u6587\u4ef6\uff0c\u8bf7\u7f16\u8f91\u8be5\u6587\u4ef6\u4ee5\u5c06 ",(0,n.kt)("inlineCode",{parentName:"p"},"eventRecordQPS")," \u8bbe\u7f6e\u4e3a\u9002\u5f53\u7684\u7ea7\u522b\u3002\n\u5982\u679c\u4f7f\u7528\u547d\u4ee4\u884c\u53c2\u6570\uff0c\u8bf7\u5728\u6bcf\u4e2a Worker \u8282\u70b9\u4e2d\u7f16\u8f91 kubelet \u670d\u52a1\u6587\u4ef6 /etc/systemd/system/kubelet.service.d/10-kubeadm.conf\uff0c\u5e76\u5728 ",(0,n.kt)("inlineCode",{parentName:"p"},"KUBELET_SYSTEM_PODS_ARGS")," \u53d8\u91cf\u4e2d\u8bbe\u7f6e\u4ee5\u4e0b\u53c2\u6570\u3002\n\u6839\u636e\u4f60\u7684\u7cfb\u7edf\uff0c\u91cd\u65b0\u542f\u52a8 kubelet \u670d\u52a1\u3002\u4f8b\u5982\uff1a\nsystemctl daemon-reload\nsystemctl restart kubelet.service"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"/bin/ps -fC kubelet\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1\u914d\u7f6e"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"/bin/cat /var/lib/rancher/rke2/agent/kubelet.kubeconfig\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u9884\u671f\u7ed3\u679c"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},"'--event-qps' is not present\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u8fd4\u56de\u503c"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},"UID PID PPID C STIME TTY TIME CMD root 4785 4751 3 14:58 ?00:00:21 kubelet --volume-plugin-dir=/var/lib/kubelet/volumeplugins --file-check-frequency=5s --sync-frequency=30s --address=0.0.0.0 --alsologtostderr=false --anonymous-auth=false --authentication-token-webhook=true --authorization-mode=Webhook --cgroup-driver=cgroupfs --client-ca-file=/var/lib/rancher/rke2/agent/client-ca.crt --cloud-provider=external --cluster-dns=10.43.0.10 --cluster-domain=cluster.local --container-runtime-endpoint=unix:///run/k3s/containerd/containerd.sock --container-runtime=remote --containerd=/run/k3s/containerd/containerd.sock --eviction-hard=imagefs.available<5%,nodefs.available<5% --eviction-minimum-reclaim=imagefs.available=10%,nodefs.available=10% --fail-swap-on=false --healthz-bind-address=127.0.0.1 --hostname-override=<node_ip> --kubeconfig=/var/lib/rancher/rke2/agent/kubelet.kubeconfig --log-file-max-size=50 --log-file=/var/lib/rancher/rke2/agent/logs/kubelet.log --logtostderr=false --node-labels=cattle.io/os=linux,rke.cattle.io/machine=7c32844c-359f-45f7-88c5-a7173d27690a --pod-manifest-path=/var/lib/rancher/rke2/agent/pod-manifests --protect-kernel-defaults=true --read-only-port=0 --resolv-conf=/run/systemd/resolve/resolv.conf --serialize-image-pulls=false --stderrthreshold=FATAL --tls-cert-file=/var/lib/rancher/rke2/agent/serving-kubelet.crt --tls-private-key-file=/var/lib/rancher/rke2/agent/serving-kubelet.key\n")),(0,n.kt)("h3",{id:"4210\u786e\u4fdd\u6839\u636e\u9700\u8981\u8bbe\u7f6e---tls-cert-file-\u548c---tls-private-key-file-\u53c2\u6570\u81ea\u52a8"},"4.2.10\u786e\u4fdd\u6839\u636e\u9700\u8981\u8bbe\u7f6e --tls-cert-file \u548c --tls-private-key-file \u53c2\u6570\uff08\u81ea\u52a8\uff09"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1apass"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u5982\u679c\u4f7f\u7528 Kubelet \u914d\u7f6e\u6587\u4ef6\uff0c\u8bf7\u7f16\u8f91\u8be5\u6587\u4ef6\u4ee5\u5c06 ",(0,n.kt)("inlineCode",{parentName:"p"},"tlsCertFile")," \u8bbe\u7f6e\u4e3a\u8bc1\u4e66\u6587\u4ef6\u7684\u4f4d\u7f6e\u6765\u4f7f\u7528 Kubelet \u7684\u6807\u8bc6\u7b26\uff0c\u5e76\u5c06 ",(0,n.kt)("inlineCode",{parentName:"p"},"tlsPrivateKeyFile")," \u8bbe\u7f6e\u4e3a\u5bf9\u5e94\u7684\u79c1\u94a5\u6587\u4ef6\u7684\u4f4d\u7f6e\u3002\n\u5982\u679c\u4f7f\u7528\u547d\u4ee4\u884c\u53c2\u6570\uff0c\u8bf7\u5728\u6bcf\u4e2a Worker \u8282\u70b9\u4e2d\u7f16\u8f91 kubelet \u670d\u52a1\u6587\u4ef6 /etc/systemd/system/kubelet.service.d/10-kubeadm.conf\uff0c\u5e76\u5728 ",(0,n.kt)("inlineCode",{parentName:"p"},"KUBELET_CERTIFICATE_ARGS")," \u53d8\u91cf\u4e2d\u8bbe\u7f6e\u4ee5\u4e0b\u53c2\u6570\u3002\n",(0,n.kt)("inlineCode",{parentName:"p"},"--tls-cert-file=<path/to/tls-certificate-file>"),"\n",(0,n.kt)("inlineCode",{parentName:"p"},"--tls-private-key-file=<path/to/tls-key-file>"),"\n\u6839\u636e\u4f60\u7684\u7cfb\u7edf\uff0c\u91cd\u65b0\u542f\u52a8 kubelet \u670d\u52a1\u3002\u4f8b\u5982\uff1a\nsystemctl daemon-reload\nsystemctl restart kubelet.service"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"/bin/ps -fC kubelet\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1\u914d\u7f6e"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"/bin/cat /var/lib/rancher/rke2/agent/kubelet.kubeconfig\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u9884\u671f\u7ed3\u679c"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},"'--tls-cert-file' is present AND '--tls-private-key-file' is present\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u8fd4\u56de\u503c"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},"UID PID PPID C STIME TTY TIME CMD root 4785 4751 3 14:58 ?00:00:21 kubelet --volume-plugin-dir=/var/lib/kubelet/volumeplugins --file-check-frequency=5s --sync-frequency=30s --address=0.0.0.0 --alsologtostderr=false --anonymous-auth=false --authentication-token-webhook=true --authorization-mode=Webhook --cgroup-driver=cgroupfs --client-ca-file=/var/lib/rancher/rke2/agent/client-ca.crt --cloud-provider=external --cluster-dns=10.43.0.10 --cluster-domain=cluster.local --container-runtime-endpoint=unix:///run/k3s/containerd/containerd.sock --container-runtime=remote --containerd=/run/k3s/containerd/containerd.sock --eviction-hard=imagefs.available<5%,nodefs.available<5% --eviction-minimum-reclaim=imagefs.available=10%,nodefs.available=10% --fail-swap-on=false --healthz-bind-address=127.0.0.1 --hostname-override=<node_ip> --kubeconfig=/var/lib/rancher/rke2/agent/kubelet.kubeconfig --log-file-max-size=50 --log-file=/var/lib/rancher/rke2/agent/logs/kubelet.log --logtostderr=false --node-labels=cattle.io/os=linux,rke.cattle.io/machine=7c32844c-359f-45f7-88c5-a7173d27690a --pod-manifest-path=/var/lib/rancher/rke2/agent/pod-manifests --protect-kernel-defaults=true --read-only-port=0 --resolv-conf=/run/systemd/resolve/resolv.conf --serialize-image-pulls=false --stderrthreshold=FATAL --tls-cert-file=/var/lib/rancher/rke2/agent/serving-kubelet.crt --tls-private-key-file=/var/lib/rancher/rke2/agent/serving-kubelet.key\n")),(0,n.kt)("h3",{id:"4211\u786e\u4fdd---rotate-certificates-\u53c2\u6570\u672a\u8bbe\u7f6e\u4e3a-false\u624b\u52a8"},"4.2.11\u786e\u4fdd --rotate-certificates \u53c2\u6570\u672a\u8bbe\u7f6e\u4e3a false\uff08\u624b\u52a8\uff09"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1apass"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u5982\u679c\u4f7f\u7528 Kubelet \u914d\u7f6e\u6587\u4ef6\uff0c\u8bf7\u7f16\u8f91\u6587\u4ef6\u4ee5\u6dfb\u52a0\u884c ",(0,n.kt)("inlineCode",{parentName:"p"},"rotateCertificates: true"),"\uff0c\u6216\u5b8c\u5168\u5220\u9664\u5b83\u4ee5\u4f7f\u7528\u9ed8\u8ba4\u503c\u3002\n\u5982\u679c\u4f7f\u7528\u547d\u4ee4\u884c\u53c2\u6570\uff0c\u8bf7\u5728\u6bcf\u4e2a Worker \u8282\u70b9\u4e0a\u7f16\u8f91 kubelet \u670d\u52a1\u6587\u4ef6 /etc/systemd/system/kubelet.service.d/10-kubeadm.conf\uff0c\u5e76\u5220\u9664 ",(0,n.kt)("inlineCode",{parentName:"p"},"KUBELET_CERTIFICATE_ARGS")," \u53d8\u91cf\u4e2d\u7684 ",(0,n.kt)("inlineCode",{parentName:"p"},"--rotate-certificates=false")," \u53c2\u6570\u3002\n\u6839\u636e\u4f60\u7684\u7cfb\u7edf\uff0c\u91cd\u65b0\u542f\u52a8 kubelet \u670d\u52a1\u3002\u4f8b\u5982\uff1a\nsystemctl daemon-reload\nsystemctl restart kubelet.service"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"/bin/ps -fC kubelet\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1\u914d\u7f6e"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"/bin/cat /var/lib/rancher/rke2/agent/kubelet.kubeconfig\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u9884\u671f\u7ed3\u679c"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},"'--rotate-certificates' is not present OR '--rotate-certificates' is not present\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u8fd4\u56de\u503c"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},"UID PID PPID C STIME TTY TIME CMD root 4785 4751 3 14:58 ?00:00:21 kubelet --volume-plugin-dir=/var/lib/kubelet/volumeplugins --file-check-frequency=5s --sync-frequency=30s --address=0.0.0.0 --alsologtostderr=false --anonymous-auth=false --authentication-token-webhook=true --authorization-mode=Webhook --cgroup-driver=cgroupfs --client-ca-file=/var/lib/rancher/rke2/agent/client-ca.crt --cloud-provider=external --cluster-dns=10.43.0.10 --cluster-domain=cluster.local --container-runtime-endpoint=unix:///run/k3s/containerd/containerd.sock --container-runtime=remote --containerd=/run/k3s/containerd/containerd.sock --eviction-hard=imagefs.available<5%,nodefs.available<5% --eviction-minimum-reclaim=imagefs.available=10%,nodefs.available=10% --fail-swap-on=false --healthz-bind-address=127.0.0.1 --hostname-override=<node_ip> --kubeconfig=/var/lib/rancher/rke2/agent/kubelet.kubeconfig --log-file-max-size=50 --log-file=/var/lib/rancher/rke2/agent/logs/kubelet.log --logtostderr=false --node-labels=cattle.io/os=linux,rke.cattle.io/machine=7c32844c-359f-45f7-88c5-a7173d27690a --pod-manifest-path=/var/lib/rancher/rke2/agent/pod-manifests --protect-kernel-defaults=true --read-only-port=0 --resolv-conf=/run/systemd/resolve/resolv.conf --serialize-image-pulls=false --stderrthreshold=FATAL --tls-cert-file=/var/lib/rancher/rke2/agent/serving-kubelet.crt --tls-private-key-file=/var/lib/rancher/rke2/agent/serving-kubelet.key\n")),(0,n.kt)("h3",{id:"4212\u9a8c\u8bc1-rotatekubeletservercertificate-\u53c2\u6570\u662f\u5426\u8bbe\u7f6e\u4e3a-true\u624b\u52a8"},"4.2.12\u9a8c\u8bc1 RotateKubeletServerCertificate \u53c2\u6570\u662f\u5426\u8bbe\u7f6e\u4e3a true\uff08\u624b\u52a8\uff09"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1apass"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u5728\u6bcf\u4e2a Worker \u8282\u70b9\u4e0a\u7f16\u8f91 kubelet \u670d\u52a1\u6587\u4ef6 /etc/systemd/system/kubelet.service.d/10-kubeadm.conf\uff0c\u5e76\u5728 ",(0,n.kt)("inlineCode",{parentName:"p"},"KUBELET_CERTIFICATE_ARGS")," \u53d8\u91cf\u4e2d\u8bbe\u7f6e\u4ee5\u4e0b\u53c2\u6570\u3002\n--feature-gates=RotateKubeletServerCertificate=true\n\u6839\u636e\u4f60\u7684\u7cfb\u7edf\uff0c\u91cd\u65b0\u542f\u52a8 kubelet \u670d\u52a1\u3002\u4f8b\u5982\uff1a\nsystemctl daemon-reload\nsystemctl restart kubelet.service"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"/bin/ps -fC kubelet\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1\u914d\u7f6e"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"/bin/cat /var/lib/rancher/rke2/agent/kubelet.kubeconfig\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u9884\u671f\u7ed3\u679c"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},"'RotateKubeletServerCertificate' is not present\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u8fd4\u56de\u503c"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},"UID PID PPID C STIME TTY TIME CMD root 4785 4751 3 14:58 ?00:00:21 kubelet --volume-plugin-dir=/var/lib/kubelet/volumeplugins --file-check-frequency=5s --sync-frequency=30s --address=0.0.0.0 --alsologtostderr=false --anonymous-auth=false --authentication-token-webhook=true --authorization-mode=Webhook --cgroup-driver=cgroupfs --client-ca-file=/var/lib/rancher/rke2/agent/client-ca.crt --cloud-provider=external --cluster-dns=10.43.0.10 --cluster-domain=cluster.local --container-runtime-endpoint=unix:///run/k3s/containerd/containerd.sock --container-runtime=remote --containerd=/run/k3s/containerd/containerd.sock --eviction-hard=imagefs.available<5%,nodefs.available<5% --eviction-minimum-reclaim=imagefs.available=10%,nodefs.available=10% --fail-swap-on=false --healthz-bind-address=127.0.0.1 --hostname-override=<node_ip> --kubeconfig=/var/lib/rancher/rke2/agent/kubelet.kubeconfig --log-file-max-size=50 --log-file=/var/lib/rancher/rke2/agent/logs/kubelet.log --logtostderr=false --node-labels=cattle.io/os=linux,rke.cattle.io/machine=7c32844c-359f-45f7-88c5-a7173d27690a --pod-manifest-path=/var/lib/rancher/rke2/agent/pod-manifests --protect-kernel-defaults=true --read-only-port=0 --resolv-conf=/run/systemd/resolve/resolv.conf --serialize-image-pulls=false --stderrthreshold=FATAL --tls-cert-file=/var/lib/rancher/rke2/agent/serving-kubelet.crt --tls-private-key-file=/var/lib/rancher/rke2/agent/serving-kubelet.key\n")),(0,n.kt)("h3",{id:"4213\u786e\u4fdd-kubelet-\u4ec5\u4f7f\u7528\u5f3a\u5bc6\u7801\u624b\u52a8"},"4.2.13\u786e\u4fdd Kubelet \u4ec5\u4f7f\u7528\u5f3a\u5bc6\u7801\uff08\u624b\u52a8\uff09"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1apass"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u5982\u679c\u4f7f\u7528 Kubelet \u914d\u7f6e\u6587\u4ef6\uff0c\u8bf7\u7f16\u8f91\u8be5\u6587\u4ef6\u4ee5\u5c06 ",(0,n.kt)("inlineCode",{parentName:"p"},"TLSCipherSuites")," \u8bbe\u7f6e\u4e3a\nTLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_AES_128_GCM_SHA256 \u6216\u8fd9\u4e9b\u503c\u7684\u5b50\u96c6\u3002\n\u5982\u679c\u4f7f\u7528\u53ef\u6267\u884c\u53c2\u6570\uff0c\u8bf7\u5728\u6bcf\u4e2a Worker \u8282\u70b9\u4e0a\u7f16\u8f91 kubelet \u670d\u52a1\u6587\u4ef6 /etc/systemd/system/kubelet.service.d/10-kubeadm.conf\uff0c\u5e76\u5c06 ",(0,n.kt)("inlineCode",{parentName:"p"},"--tls-cipher-suites")," \u53c2\u6570\u8bbe\u7f6e\u5982\u4e0b\u503c\uff0c\u6216\u8fd9\u4e9b\u503c\u7684\u5b50\u96c6\u3002\n--tls-cipher-suites=TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_AES_128_GCM_SHA256\n\u6839\u636e\u4f60\u7684\u7cfb\u7edf\uff0c\u91cd\u65b0\u542f\u52a8 kubelet \u670d\u52a1\u3002\u4f8b\u5982\uff1a\nsystemctl daemon-reload\nsystemctl restart kubelet.service"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"/bin/ps -fC kubelet\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1\u914d\u7f6e"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"/bin/cat /var/lib/rancher/rke2/agent/kubelet.kubeconfig\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u9884\u671f\u7ed3\u679c"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},"'--tls-cipher-suites' is not present\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u8fd4\u56de\u503c"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},"UID PID PPID C STIME TTY TIME CMD root 4785 4751 3 14:58 ?00:00:21 kubelet --volume-plugin-dir=/var/lib/kubelet/volumeplugins --file-check-frequency=5s --sync-frequency=30s --address=0.0.0.0 --alsologtostderr=false --anonymous-auth=false --authentication-token-webhook=true --authorization-mode=Webhook --cgroup-driver=cgroupfs --client-ca-file=/var/lib/rancher/rke2/agent/client-ca.crt --cloud-provider=external --cluster-dns=10.43.0.10 --cluster-domain=cluster.local --container-runtime-endpoint=unix:///run/k3s/containerd/containerd.sock --container-runtime=remote --containerd=/run/k3s/containerd/containerd.sock --eviction-hard=imagefs.available<5%,nodefs.available<5% --eviction-minimum-reclaim=imagefs.available=10%,nodefs.available=10% --fail-swap-on=false --healthz-bind-address=127.0.0.1 --hostname-override=<node_ip> --kubeconfig=/var/lib/rancher/rke2/agent/kubelet.kubeconfig --log-file-max-size=50 --log-file=/var/lib/rancher/rke2/agent/logs/kubelet.log --logtostderr=false --node-labels=cattle.io/os=linux,rke.cattle.io/machine=7c32844c-359f-45f7-88c5-a7173d27690a --pod-manifest-path=/var/lib/rancher/rke2/agent/pod-manifests --protect-kernel-defaults=true --read-only-port=0 --resolv-conf=/run/systemd/resolve/resolv.conf --serialize-image-pulls=false --stderrthreshold=FATAL --tls-cert-file=/var/lib/rancher/rke2/agent/serving-kubelet.crt --tls-private-key-file=/var/lib/rancher/rke2/agent/serving-kubelet.key\n")),(0,n.kt)("h2",{id:"51rbac-\u548c-serviceaccount"},"5.1RBAC \u548c ServiceAccount"),(0,n.kt)("h3",{id:"511\u786e\u4fdd\u4ec5\u5728\u9700\u8981\u65f6\u4f7f\u7528-cluster-admin-\u89d2\u8272\u624b\u52a8"},"5.1.1\u786e\u4fdd\u4ec5\u5728\u9700\u8981\u65f6\u4f7f\u7528 cluster-admin \u89d2\u8272\uff08\u624b\u52a8\uff09"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1awarn"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u8bc6\u522b cluster-admin \u89d2\u8272\u7684\u6240\u6709 clusterrolebindings\u3002\u68c0\u67e5\u5b83\u4eec\u662f\u5426\u88ab\u4f7f\u7528\uff0c\u5b83\u4eec\u662f\u5426\u9700\u8981\u8fd9\u4e2a\u89d2\u8272\uff0c\u6216\u8005\u662f\u5426\u53ef\u4ee5\u4f7f\u7528\u8f83\u4f4e\u6743\u9650\u7684\u89d2\u8272\u3002\n\u5728\u53ef\u80fd\u7684\u60c5\u51b5\u4e0b\uff0c\u5148\u5c06\u7528\u6237\u7ed1\u5b9a\u5230\u8f83\u4f4e\u6743\u9650\u7684\u89d2\u8272\uff0c\u7136\u540e\u5220\u9664\u7ed1\u5b9a\u5230 cluster-admin \u89d2\u8272\u7684 clusterrolebinding\uff1a\nkubectl delete clusterrolebinding ","[name]"),(0,n.kt)("h3",{id:"512\u5c3d\u91cf\u51cf\u5c11\u5bf9\u5bc6\u6587\u7684\u8bbf\u95ee\u624b\u52a8"},"5.1.2\u5c3d\u91cf\u51cf\u5c11\u5bf9\u5bc6\u6587\u7684\u8bbf\u95ee\uff08\u624b\u52a8\uff09"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1awarn"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u5728\u53ef\u80fd\u7684\u60c5\u51b5\u4e0b\uff0c\u5220\u9664\u5bf9\u96c6\u7fa4\u4e2d\u5bc6\u6587\u5bf9\u8c61\u7684 get\u3001list \u548c watch \u8bbf\u95ee\u3002"),(0,n.kt)("h3",{id:"513\u5c3d\u91cf\u51cf\u5c11\u89d2\u8272\u548c-clusterroles-\u4e2d\u901a\u914d\u7b26\u7684\u4f7f\u7528\u624b\u52a8"},"5.1.3\u5c3d\u91cf\u51cf\u5c11\u89d2\u8272\u548c ClusterRoles \u4e2d\u901a\u914d\u7b26\u7684\u4f7f\u7528\uff08\u624b\u52a8\uff09"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1awarn"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u5728\u53ef\u80fd\u7684\u60c5\u51b5\u4e0b\uff0c\u5c06\u96c6\u7fa4\u89d2\u8272\u548c\u89d2\u8272\u4e2d\u7684\u901a\u914d\u7b26\u66ff\u6362\u4e3a\u7279\u5b9a\u7684\u5bf9\u8c61\u6216\u52a8\u4f5c\u3002"),(0,n.kt)("h3",{id:"514\u5c3d\u91cf\u51cf\u5c11\u521b\u5efa-pod-\u7684\u8bbf\u95ee\u624b\u52a8"},"5.1.4\u5c3d\u91cf\u51cf\u5c11\u521b\u5efa pod \u7684\u8bbf\u95ee\uff08\u624b\u52a8\uff09"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1awarn"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u5728\u53ef\u80fd\u7684\u60c5\u51b5\u4e0b\uff0c\u5220\u9664\u5bf9\u96c6\u7fa4\u4e2d pod \u5bf9\u8c61\u7684\u521b\u5efa\u8bbf\u95ee\u6743\u9650\u3002"),(0,n.kt)("h3",{id:"515\u786e\u4fdd\u672a\u4e3b\u52a8\u4f7f\u7528\u9ed8\u8ba4-serviceaccount\u81ea\u52a8"},"5.1.5\u786e\u4fdd\u672a\u4e3b\u52a8\u4f7f\u7528\u9ed8\u8ba4 ServiceAccount\u3002\uff08\u81ea\u52a8\uff09"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1apass"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u5728 Kubernetes \u5de5\u4f5c\u8d1f\u8f7d\u9700\u8981\u5bf9 Kubernetes API Server \u8fdb\u884c\u7279\u5b9a\u8bbf\u95ee\u65f6\uff0c\u521b\u5efa\u663e\u5f0f\u7684 ServiceAccount\u3002\n\u4fee\u6539\u6bcf\u4e2a\u9ed8\u8ba4 ServiceAccount \u7684\u914d\u7f6e\u4ee5\u5305\u542b\u6b64\u503c\nautomountServiceAccountToken: false"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1\u811a\u672c"),"\uff1a",(0,n.kt)("inlineCode",{parentName:"p"},"check_for_default_sa.sh")),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},'#!/bin/bash\n\nset -eE\n\nhandle_error() {\n    echo "false"\n}\n\ntrap \'handle_error\' ERR\n\ncount_sa=$(kubectl get serviceaccounts --all-namespaces -o json | jq -r \'.items[] | select(.metadata.name=="default") | select((.automountServiceAccountToken == null) or (.automountServiceAccountToken == true))\' | jq .metadata.namespace | wc -l)\nif [[ ${count_sa} -gt 0 ]]; then\n    echo "false"\n    exit\nfi\n\nfor ns in $(kubectl get ns --no-headers -o custom-columns=":metadata.name")\ndo\n    for result in $(kubectl get clusterrolebinding,rolebinding -n $ns -o json | jq -r \'.items[] | select((.subjects[].kind=="ServiceAccount" and .subjects[].name=="default") or (.subjects[].kind=="Group" and .subjects[].name=="system:serviceaccounts"))\' | jq -r \'"\\(.roleRef.kind),\\(.roleRef.name)"\')\n    do\n        read kind name <<<$(IFS=","; echo $result)\n        resource_count=$(kubectl get $kind $name -n $ns -o json | jq -r \'.rules[] | select(.resources[] != "podsecuritypolicies")\' | wc -l)\n        if [[ ${resource_count} -gt 0 ]]; then\n            echo "false"\n            exit\n        fi\n    done\ndone\n\n\necho "true"\n')),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1\u6267\u884c"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"./check_for_default_sa.sh\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u9884\u671f\u7ed3\u679c"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},"'true' is equal to 'true'\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u8fd4\u56de\u503c"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},"true\n")),(0,n.kt)("h3",{id:"516\u786e\u4fdd\u4ec5\u5728\u5fc5\u8981\u65f6\u6302\u8f7d-serviceaccount-\u4ee4\u724c\u624b\u52a8"},"5.1.6\u786e\u4fdd\u4ec5\u5728\u5fc5\u8981\u65f6\u6302\u8f7d ServiceAccount \u4ee4\u724c\uff08\u624b\u52a8\uff09"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1awarn"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u4fee\u6539\u4e0d\u9700\u8981\u6302\u8f7d ServiceAccount \u4ee4\u724c\u7684 pod \u548c ServiceAccount \u7684\u5b9a\u4e49\uff0c\u4f7f\u5176\u7981\u7528\u3002"),(0,n.kt)("h2",{id:"52pod-\u5b89\u5168\u7b56\u7565"},"5.2Pod \u5b89\u5168\u7b56\u7565"),(0,n.kt)("h3",{id:"521\u6700\u5c0f\u5316\u7279\u6743\u5bb9\u5668\u7684\u51c6\u5165\u81ea\u52a8"},"5.2.1\u6700\u5c0f\u5316\u7279\u6743\u5bb9\u5668\u7684\u51c6\u5165\uff08\u81ea\u52a8\uff09"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1apass"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u6309\u7167 Kubernetes \u6587\u6863\u4e2d\u7684\u8bf4\u660e\u521b\u5efa PSP\uff0c\u786e\u4fdd ",(0,n.kt)("inlineCode",{parentName:"p"},".spec.privileged")," \u5b57\u6bb5\u88ab\u7701\u7565\u6216\u8bbe\u7f6e\u4e3a false\u3002"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"kubectl get psp global-restricted-psp -o json | jq -r '.spec.runAsUser.rule'\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u9884\u671f\u7ed3\u679c"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},"'MustRunAsNonRoot' is equal to 'MustRunAsNonRoot'\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u8fd4\u56de\u503c"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},"MustRunAsNonRoot\n")),(0,n.kt)("h3",{id:"522\u6700\u5c0f\u5316\u9700\u8981\u5171\u4eab\u4e3b\u673a\u8fdb\u7a0b-id-\u547d\u540d\u7a7a\u95f4\u7684\u5bb9\u5668\u51c6\u5165\u81ea\u52a8"},"5.2.2\u6700\u5c0f\u5316\u9700\u8981\u5171\u4eab\u4e3b\u673a\u8fdb\u7a0b ID \u547d\u540d\u7a7a\u95f4\u7684\u5bb9\u5668\u51c6\u5165\uff08\u81ea\u52a8\uff09"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1apass"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u6309\u7167 Kubernetes \u6587\u6863\u4e2d\u7684\u8bf4\u660e\u521b\u5efa PSP\uff0c\u786e\u4fdd ",(0,n.kt)("inlineCode",{parentName:"p"},".spec.hostPID")," \u5b57\u6bb5\u88ab\u7701\u7565\u6216\u8bbe\u7f6e\u4e3a false\u3002"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"kubectl get psp -o json | jq .items[] | jq -r 'select((.spec.hostPID == null) or (.spec.hostPID == false))' | jq .metadata.name | wc -l | xargs -I {} echo '--count={}'\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u9884\u671f\u7ed3\u679c"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},"1 is greater than 0\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u8fd4\u56de\u503c"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},"--count=1\n")),(0,n.kt)("h3",{id:"523\u6700\u5c0f\u5316\u9700\u8981\u5171\u4eab\u4e3b\u673a-ipc-\u547d\u540d\u7a7a\u95f4\u7684\u5bb9\u5668\u51c6\u5165\u81ea\u52a8"},"5.2.3\u6700\u5c0f\u5316\u9700\u8981\u5171\u4eab\u4e3b\u673a IPC \u547d\u540d\u7a7a\u95f4\u7684\u5bb9\u5668\u51c6\u5165\uff08\u81ea\u52a8\uff09"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1apass"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u6309\u7167 Kubernetes \u6587\u6863\u4e2d\u7684\u8bf4\u660e\u521b\u5efa PSP\uff0c\u786e\u4fdd ",(0,n.kt)("inlineCode",{parentName:"p"},".spec.hostIPC")," \u5b57\u6bb5\u88ab\u7701\u7565\u6216\u8bbe\u7f6e\u4e3a false\u3002"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"kubectl get psp -o json | jq .items[] | jq -r 'select((.spec.hostIPC == null) or (.spec.hostIPC == false))' | jq .metadata.name | wc -l | xargs -I {} echo '--count={}'\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u9884\u671f\u7ed3\u679c"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},"1 is greater than 0\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u8fd4\u56de\u503c"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},"--count=1\n")),(0,n.kt)("h3",{id:"524\u6700\u5c0f\u5316\u9700\u8981\u5171\u4eab\u4e3b\u673a\u7f51\u7edc\u547d\u540d\u7a7a\u95f4\u7684\u5bb9\u5668\u51c6\u5165\u81ea\u52a8"},"5.2.4\u6700\u5c0f\u5316\u9700\u8981\u5171\u4eab\u4e3b\u673a\u7f51\u7edc\u547d\u540d\u7a7a\u95f4\u7684\u5bb9\u5668\u51c6\u5165\uff08\u81ea\u52a8\uff09"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1apass"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u6309\u7167 Kubernetes \u6587\u6863\u4e2d\u7684\u8bf4\u660e\u521b\u5efa PSP\uff0c\u786e\u4fdd ",(0,n.kt)("inlineCode",{parentName:"p"},".spec.hostNetwork")," \u5b57\u6bb5\u88ab\u7701\u7565\u6216\u8bbe\u7f6e\u4e3a false\u3002"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"kubectl get psp -o json | jq .items[] | jq -r 'select((.spec.hostNetwork == null) or (.spec.hostNetwork == false))' | jq .metadata.name | wc -l | xargs -I {} echo '--count={}'\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u9884\u671f\u7ed3\u679c"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},"1 is greater than 0\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u8fd4\u56de\u503c"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},"--count=1\n")),(0,n.kt)("h3",{id:"525\u4f7f\u7528-allowprivilegeescalation\u81ea\u52a8\u6700\u5c0f\u5316\u5bb9\u5668\u7684\u51c6\u5165"},"5.2.5\u4f7f\u7528 allowPrivilegeEscalation\uff08\u81ea\u52a8\uff09\u6700\u5c0f\u5316\u5bb9\u5668\u7684\u51c6\u5165"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1apass"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u6309\u7167 Kubernetes \u6587\u6863\u4e2d\u7684\u8bf4\u660e\u521b\u5efa PSP\uff0c\u786e\u4fdd ",(0,n.kt)("inlineCode",{parentName:"p"},".spec.allowPrivilegeEscalation")," \u5b57\u6bb5\u88ab\u7701\u7565\u6216\u8bbe\u7f6e\u4e3a false\u3002"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"kubectl get psp -o json | jq .items[] | jq -r 'select((.spec.allowPrivilegeEscalation == null) or (.spec.allowPrivilegeEscalation == false))' | jq .metadata.name | wc -l | xargs -I {} echo '--count={}'\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u9884\u671f\u7ed3\u679c"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},"1 is greater than 0\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u8fd4\u56de\u503c"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},"--count=1\n")),(0,n.kt)("h3",{id:"526\u6700\u5c0f\u5316\u6839\u5bb9\u5668\u7684\u51c6\u5165\u81ea\u52a8"},"5.2.6\u6700\u5c0f\u5316\u6839\u5bb9\u5668\u7684\u51c6\u5165\uff08\u81ea\u52a8\uff09"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1apass"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u6309\u7167 Kubernetes \u6587\u6863\u4e2d\u7684\u8bf4\u660e\u521b\u5efa PSP\uff0c\u786e\u4fdd ",(0,n.kt)("inlineCode",{parentName:"p"},".spec.runAsUser.rule")," \u8bbe\u7f6e\u4e3a ",(0,n.kt)("inlineCode",{parentName:"p"},"MustRunAsNonRoot")," \u6216 ",(0,n.kt)("inlineCode",{parentName:"p"},"MustRunAs"),"\uff0c\u8303\u56f4\u4e3a\u4e0d\u5305\u62ec 0 \u7684 UID\u3002"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"kubectl get psp -o json | jq .items[] | jq -r 'select((.spec.allowPrivilegeEscalation == null) or (.spec.allowPrivilegeEscalation == false))' | jq .metadata.name | wc -l | xargs -I {} echo '--count={}'\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u9884\u671f\u7ed3\u679c"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},"1 is greater than 0\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u8fd4\u56de\u503c"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},"--count=1\n")),(0,n.kt)("h3",{id:"527\u4f7f\u7528-net_raw-\u529f\u80fd\u6700\u5927\u9650\u5ea6\u5730\u51cf\u5c11\u5bb9\u5668\u7684\u51c6\u5165\u624b\u52a8"},"5.2.7\u4f7f\u7528 NET_RAW \u529f\u80fd\u6700\u5927\u9650\u5ea6\u5730\u51cf\u5c11\u5bb9\u5668\u7684\u51c6\u5165\uff08\u624b\u52a8\uff09"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1apass"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u6309\u7167 Kubernetes \u6587\u6863\u4e2d\u7684\u8bf4\u660e\u521b\u5efa PSP\uff0c\u786e\u4fdd ",(0,n.kt)("inlineCode",{parentName:"p"},".spec.requiredDropCapabilities")," \u5305\u62ec ",(0,n.kt)("inlineCode",{parentName:"p"},"NET_RAW")," \u6216 ",(0,n.kt)("inlineCode",{parentName:"p"},"ALL"),"\u3002"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"kubectl get psp global-restricted-psp -o json | jq -r .spec.requiredDropCapabilities[]\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u9884\u671f\u7ed3\u679c"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},"'ALL' is equal to 'ALL'\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u8fd4\u56de\u503c"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},"ALL\n")),(0,n.kt)("h3",{id:"528\u4f7f\u7528\u6dfb\u52a0\u7684\u529f\u80fd\u6700\u5927\u9650\u5ea6\u5730\u51cf\u5c11\u5bb9\u5668\u7684\u51c6\u5165\u624b\u52a8"},"5.2.8\u4f7f\u7528\u6dfb\u52a0\u7684\u529f\u80fd\u6700\u5927\u9650\u5ea6\u5730\u51cf\u5c11\u5bb9\u5668\u7684\u51c6\u5165\uff08\u624b\u52a8\uff09"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1awarn"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u786e\u4fdd\u96c6\u7fa4\u7684 PSP \u4e2d\u4e0d\u5b58\u5728 ",(0,n.kt)("inlineCode",{parentName:"p"},"allowedCapabilities"),"\uff0c\u9664\u975e\u5b83\u88ab\u8bbe\u7f6e\u4e3a\u4e00\u4e2a\u7a7a\u6570\u7ec4\u3002"),(0,n.kt)("h3",{id:"529\u4f7f\u7528\u5206\u914d\u7684\u529f\u80fd\u6700\u5927\u9650\u5ea6\u5730\u51cf\u5c11\u5bb9\u5668\u7684\u51c6\u5165\u624b\u52a8"},"5.2.9\u4f7f\u7528\u5206\u914d\u7684\u529f\u80fd\u6700\u5927\u9650\u5ea6\u5730\u51cf\u5c11\u5bb9\u5668\u7684\u51c6\u5165\uff08\u624b\u52a8\uff09"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1awarn"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u67e5\u770b\u96c6\u7fa4\u4e0a\u8fd0\u884c\u7684\u5e94\u7528\u7a0b\u5e8f\u4e2d\u529f\u80fd\u7684\u4f7f\u7528\u60c5\u51b5\u3002\u5982\u679c\u4e00\u4e2a\u547d\u540d\u7a7a\u95f4\u5305\u542b\u4e0d\u9700\u8981\u4efb\u4f55 Linux \u529f\u80fd\u7684\u5e94\u7528\uff0c\u4f60\u53ef\u4ee5\u8003\u8651\u6dfb\u52a0\u4e00\u4e2a PSP\uff0c\u7981\u6b62\u4e0d\u4e22\u5f03\u6240\u6709\u529f\u80fd\u7684\u5bb9\u5668\u7684\u51c6\u5165\u3002"),(0,n.kt)("h2",{id:"53\u7f51\u7edc\u7b56\u7565\u548c-cni"},"5.3\u7f51\u7edc\u7b56\u7565\u548c \u200b\u200bCNI"),(0,n.kt)("h3",{id:"531\u786e\u4fdd\u4f7f\u7528\u7684-cni-\u652f\u6301\u7f51\u7edc\u7b56\u7565\u81ea\u52a8"},"5.3.1\u786e\u4fdd\u4f7f\u7528\u7684 CNI \u652f\u6301\u7f51\u7edc\u7b56\u7565\uff08\u81ea\u52a8\uff09"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1apass"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u5982\u679c\u4f7f\u7528\u7684 CNI \u63d2\u4ef6\u4e0d\u652f\u6301\u7f51\u7edc\u7b56\u7565\uff0c\u5219\u5e94\u8003\u8651\u4f7f\u7528\u4e0d\u540c\u7684\u63d2\u4ef6\uff0c\u6216\u5728 Kubernetes \u96c6\u7fa4\u4e2d\u5bfb\u627e\u66ff\u4ee3\u673a\u5236\u6765\u9650\u5236\u6d41\u91cf\u3002"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"kubectl get pods -n kube-system -l k8s-app=canal -o json | jq .items[] | jq .metadata.name | wc -l | xargs -I {} echo '--count={}'\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u9884\u671f\u7ed3\u679c"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},"1 is greater than 0\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u8fd4\u56de\u503c"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},"--count=1\n")),(0,n.kt)("h3",{id:"532\u786e\u4fdd\u6240\u6709\u547d\u540d\u7a7a\u95f4\u90fd\u5b9a\u4e49\u4e86\u7f51\u7edc\u7b56\u7565\u81ea\u52a8"},"5.3.2\u786e\u4fdd\u6240\u6709\u547d\u540d\u7a7a\u95f4\u90fd\u5b9a\u4e49\u4e86\u7f51\u7edc\u7b56\u7565\uff08\u81ea\u52a8\uff09"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1apass"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u9075\u5faa\u6587\u6863\u5e76\u6839\u636e\u9700\u8981\u521b\u5efa NetworkPolicy \u5bf9\u8c61\u3002"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"Audit Script:")," ",(0,n.kt)("inlineCode",{parentName:"p"},"check_for_rke2_network_policies.sh")),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},'#!/bin/bash\n\nset -eE\n\nhandle_error() {\n    echo "false"\n}\n\ntrap \'handle_error\' ERR\n\nfor namespace in kube-system kube-public default; do\n  policy_count=$(/var/lib/rancher/rke2/bin/kubectl get networkpolicy -n ${namespace} -o json | jq -r \'.items | length\')\n  if [ ${policy_count} -eq 0 ]; then\n    echo "false"\n    exit\n  fi\ndone\n\necho "true"\n\n')),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u5ba1\u8ba1\u6267\u884c"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"./check_for_rke2_network_policies.sh\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u9884\u671f\u7ed3\u679c"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},"'true' is equal to 'true'\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u8fd4\u56de\u503c"),"\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-console"},"true\n")),(0,n.kt)("h2",{id:"54\u5bc6\u6587\u7ba1\u7406"},"5.4\u5bc6\u6587\u7ba1\u7406"),(0,n.kt)("h3",{id:"541\u4f18\u5148\u4f7f\u7528\u5bc6\u6587\u6587\u4ef6\u800c\u4e0d\u662f\u5bc6\u6587\u73af\u5883\u53d8\u91cf\u624b\u52a8"},"5.4.1\u4f18\u5148\u4f7f\u7528\u5bc6\u6587\u6587\u4ef6\u800c\u4e0d\u662f\u5bc6\u6587\u73af\u5883\u53d8\u91cf\uff08\u624b\u52a8\uff09"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1awarn"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u5982\u679c\u53ef\u80fd\uff0c\u91cd\u5199\u5e94\u7528\u7a0b\u5e8f\u4ee3\u7801\uff0c\u4ece\u6302\u8f7d\u7684\u5bc6\u6587\u6587\u4ef6\u800c\u4e0d\u662f\u73af\u5883\u53d8\u91cf\u4e2d\u8bfb\u53d6\u5bc6\u6587\u3002"),(0,n.kt)("h3",{id:"542\u8003\u8651\u5916\u90e8\u5bc6\u6587\u5b58\u50a8\u624b\u52a8"},"5.4.2\u8003\u8651\u5916\u90e8\u5bc6\u6587\u5b58\u50a8\uff08\u624b\u52a8\uff09"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1awarn"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u8bf7\u53c2\u9605\u4f60\u7684\u4e91\u63d0\u4f9b\u5546\u6216\u7b2c\u4e09\u65b9\u5bc6\u6587\u7ba1\u7406\u89e3\u51b3\u65b9\u6848\u7684\u5bc6\u6587\u7ba1\u7406\u9009\u9879\u3002"),(0,n.kt)("h2",{id:"55\u53ef\u6269\u5c55\u51c6\u5165\u63a7\u5236"},"5.5\u53ef\u6269\u5c55\u51c6\u5165\u63a7\u5236"),(0,n.kt)("h3",{id:"551\u4f7f\u7528-imagepolicywebhook-\u51c6\u5165\u63a7\u5236\u5668\u914d\u7f6e\u955c\u50cf\u6765\u6e90\u624b\u52a8"},"5.5.1\u4f7f\u7528 ImagePolicyWebhook \u51c6\u5165\u63a7\u5236\u5668\u914d\u7f6e\u955c\u50cf\u6765\u6e90\uff08\u624b\u52a8\uff09"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1awarn"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u9075\u5faa Kubernetes \u6587\u6863\u5e76\u8bbe\u7f6e\u955c\u50cf\u6765\u6e90\u3002"),(0,n.kt)("h2",{id:"56v151-\u6307\u5357\u8df3\u8fc7-56-\u5e76\u4ece-55-\u8f6c\u5230-57\u6211\u4eec\u5c06\u5b83\u5305\u542b\u5728\u8fd9\u91cc\u53ea\u662f\u4e3a\u4e86\u8fdb\u884c\u89e3\u91ca"},"5.6v1.5.1 \u6307\u5357\u8df3\u8fc7 5.6 \u5e76\u4ece 5.5 \u8f6c\u5230 5.7\u3002\u6211\u4eec\u5c06\u5b83\u5305\u542b\u5728\u8fd9\u91cc\u53ea\u662f\u4e3a\u4e86\u8fdb\u884c\u89e3\u91ca\u3002"),(0,n.kt)("h2",{id:"57\u901a\u7528\u7b56\u7565"},"5.7\u901a\u7528\u7b56\u7565"),(0,n.kt)("h3",{id:"571\u4f7f\u7528\u547d\u540d\u7a7a\u95f4\u5728\u8d44\u6e90\u4e4b\u95f4\u521b\u5efa\u7ba1\u7406\u8fb9\u754c\u624b\u52a8"},"5.7.1\u4f7f\u7528\u547d\u540d\u7a7a\u95f4\u5728\u8d44\u6e90\u4e4b\u95f4\u521b\u5efa\u7ba1\u7406\u8fb9\u754c\uff08\u624b\u52a8\uff09"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1awarn"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u9075\u5faa\u6587\u6863\u5e76\u6839\u636e\u9700\u8981\u4e3a Deployment \u4e2d\u7684\u5bf9\u8c61\u521b\u5efa\u547d\u540d\u7a7a\u95f4\u3002"),(0,n.kt)("h3",{id:"572\u786e\u4fdd-seccomp-\u914d\u7f6e\u6587\u4ef6\u5728\u4f60\u7684-pod-\u5b9a\u4e49\u4e2d\u8bbe\u7f6e\u4e3a-dockerdefault\u624b\u52a8"},"5.7.2\u786e\u4fdd seccomp \u914d\u7f6e\u6587\u4ef6\u5728\u4f60\u7684 pod \u5b9a\u4e49\u4e2d\u8bbe\u7f6e\u4e3a docker/default\uff08\u624b\u52a8\uff09"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1awarn"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\nSeccomp \u76ee\u524d\u662f\u4e00\u4e2a alpha \u529f\u80fd\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u6240\u6709 alpha \u529f\u80fd\u90fd\u662f\u7981\u7528\u7684\u3002\u56e0\u6b64\uff0c\u4f60\u9700\u8981\u901a\u8fc7\u4f20\u5165 ",(0,n.kt)("inlineCode",{parentName:"p"},"--feature-\ngates=AllAlpha=true")," \u53c2\u6570\u6765\u542f\u7528 apiserver \u4e2d\u7684 alpha \u529f\u80fd\u3002\n\u7f16\u8f91 Master \u8282\u70b9\u4e0a\u7684 /etc/kubernetes/apiserver \u6587\u4ef6\uff0c\u5e76\u5c06 ",(0,n.kt)("inlineCode",{parentName:"p"},"KUBE_API_ARGS")," \u53c2\u6570\u8bbe\u7f6e\u4e3a ",(0,n.kt)("inlineCode",{parentName:"p"},"--feature-gates=AllAlpha=true"),'\nKUBE_API_ARGS="--feature-gates=AllAlpha=true"\n\u6839\u636e\u4f60\u7684\u7cfb\u7edf\uff0c\u91cd\u65b0\u542f\u52a8 kube-apiserver \u670d\u52a1\u3002\u4f8b\u5982\uff1asystemctl restart kube-apiserver.service\n\u4f7f\u7528\u6ce8\u91ca\u5728\u4f60\u7684 pod \u5b9a\u4e49\u4e2d\u542f\u7528 docker/default seccomp \u914d\u7f6e\u6587\u4ef6\u3002\u4ee5\u4e0b\u662f\u4e00\u4e2a\u793a\u4f8b\uff1a\napiVersion: v1\nkind: Pod\nmetadata:\nname: trustworthy-pod\nannotations:\nseccomp.security.alpha.kubernetes.io/pod: docker/default\nspec:\ncontainers:'),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"name: trustworthy-container\nimage: sotrustworthy:latest")),(0,n.kt)("h3",{id:"573\u5c06\u5b89\u5168\u4e0a\u4e0b\u6587\u5e94\u7528\u5230\u4f60\u7684-pod-\u548c\u5bb9\u5668\u81ea\u52a8"},"5.7.3\u5c06\u5b89\u5168\u4e0a\u4e0b\u6587\u5e94\u7528\u5230\u4f60\u7684 Pod \u548c\u5bb9\u5668\uff08\u81ea\u52a8\uff09"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1awarn"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u9075\u5faa Kubernetes \u6587\u6863\uff0c\u5c06\u5b89\u5168\u4e0a\u4e0b\u6587\u5e94\u7528\u5230\u4f60\u7684 pod\u3002\u5173\u4e8e\u5b89\u5168\u4e0a\u4e0b\u6587\u7684\u5efa\u8bae\u6e05\u5355\uff0c\u4f60\u53ef\u4ee5\u53c2\u8003 CIS \u7684 Docker \u5bb9\u5668\u5b89\u5168 Benchmark\u3002"),(0,n.kt)("h3",{id:"574\u786e\u4fdd\u4e0d\u4f7f\u7528-default-\u547d\u540d\u7a7a\u95f4\u624b\u52a8"},"5.7.4\u786e\u4fdd\u4e0d\u4f7f\u7528 Default \u547d\u540d\u7a7a\u95f4\uff08\u624b\u52a8\uff09"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u7ed3\u679c"),"\uff1awarn"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"\u4fee\u6b63\u63aa\u65bd"),"\uff1a\n\u786e\u4fdd\u521b\u5efa\u547d\u540d\u7a7a\u95f4\u4ee5\u5141\u8bb8\u5bf9 Kubernetes \u8fdb\u884c\u9002\u5f53\u7684\u9694\u79bb\u8d44\u6e90\uff0c\u5e76\u4e14\u6240\u6709\u65b0\u8d44\u6e90\u90fd\u521b\u5efa\u5728\u7279\u5b9a\u7684\u547d\u540d\u7a7a\u95f4\u4e2d\u3002"))}v.isMDXComponent=!0}}]);