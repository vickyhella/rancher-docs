<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-2.0-2.4 plugin-docs plugin-id-default docs-doc-id-pages-for-subheaders/helm2-rke-add-on-layer-7-lb">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.21">
<link rel="search" type="application/opensearchdescription+xml" title="Rancher Manager" href="/opensearch.xml"><title data-rh="true">Kubernetes Install with External Load Balancer (HTTPS/Layer 7) | Rancher Manager</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="http://docs.ranchermanager.rancher.io//v2.0-v2.4/pages-for-subheaders/helm2-rke-add-on-layer-7-lb"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="2.0-2.4"><meta data-rh="true" name="docusaurus_tag" content="docs-default-2.0-2.4"><meta data-rh="true" name="docsearch:version" content="2.0-2.4"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-2.0-2.4"><meta data-rh="true" property="og:title" content="Kubernetes Install with External Load Balancer (HTTPS/Layer 7) | Rancher Manager"><meta data-rh="true" name="description" content="#### Important: RKE add-on install is only supported up to Rancher v2.0.8"><meta data-rh="true" property="og:description" content="#### Important: RKE add-on install is only supported up to Rancher v2.0.8"><link data-rh="true" rel="icon" href="/img/favicon.png"><link data-rh="true" rel="canonical" href="http://docs.ranchermanager.rancher.io//v2.0-v2.4/pages-for-subheaders/helm2-rke-add-on-layer-7-lb"><link data-rh="true" rel="alternate" href="http://docs.ranchermanager.rancher.io//v2.0-v2.4/pages-for-subheaders/helm2-rke-add-on-layer-7-lb" hreflang="en"><link data-rh="true" rel="alternate" href="http://docs.ranchermanager.rancher.io//v2.0-v2.4/pages-for-subheaders/helm2-rke-add-on-layer-7-lb" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://30NEY6C9UY-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.31d3122a.css">
<link rel="preload" href="/assets/js/runtime~main.d2604d48.js" as="script">
<link rel="preload" href="/assets/js/main.aa78001f.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_fXgn">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/rancher-logo-horiz-color.svg" alt="logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/rancher-logo-horiz-color.svg" alt="logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate"></b></a><div class="navbar__item dropdown dropdown--hoverable"><a aria-current="page" class="navbar__link active" aria-haspopup="true" aria-expanded="false" role="button" href="/v2.0-v2.4">v2.0-v2.4</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/">v2.6</a></li><li><a class="dropdown__link" href="/v2.5">v2.5</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/v2.0-v2.4/pages-for-subheaders/helm2-rke-add-on-layer-7-lb">v2.0-v2.4</a></li><li><a class="dropdown__link" href="/versions">All versions</a></li></ul></div></div><div class="navbar__items navbar__items--right"><a aria-current="page" class="navbar__item navbar__link navbar__docs navbar__link--active" href="/v2.0-v2.4">Docs</a><a href="https://github.com/rancher/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link navbar__github btn btn-secondary icon-github">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_lCJq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd"><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/v2.0-v2.4">Rancher 2.0-2.4</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/v2.0-v2.4/getting-started">Getting Started</a><button aria-label="Toggle the collapsible sidebar category &#x27;Getting Started&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/v2.0-v2.4/pages-for-subheaders/introduction">Introduction</a><button aria-label="Toggle the collapsible sidebar category &#x27;Introduction&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/v2.0-v2.4/pages-for-subheaders/quick-start-guides">Quick Start Guides</a><button aria-label="Toggle the collapsible sidebar category &#x27;Quick Start Guides&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" tabindex="0" href="/v2.0-v2.4/pages-for-subheaders/installation-and-upgrade">Installation and Upgrade</a><button aria-label="Toggle the collapsible sidebar category &#x27;Installation and Upgrade&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/v2.0-v2.4/pages-for-subheaders/installation-requirements">Installation Requirements</a><button aria-label="Toggle the collapsible sidebar category &#x27;Installation Requirements&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/v2.0-v2.4/pages-for-subheaders/install-upgrade-on-a-kubernetes-cluster">Install/Upgrade on a Kubernetes Cluster</a><button aria-label="Toggle the collapsible sidebar category &#x27;Install/Upgrade on a Kubernetes Cluster&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/v2.0-v2.4/pages-for-subheaders/other-installation-methods">Other Installation Methods</a><button aria-label="Toggle the collapsible sidebar category &#x27;Other Installation Methods&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/v2.0-v2.4/pages-for-subheaders/resources">Resources</a><button aria-label="Toggle the collapsible sidebar category &#x27;Resources&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/v2.0-v2.4/getting-started/installation-and-upgrade/upgrade-and-roll-back-kubernetes">Upgrading and Rolling Back Kubernetes</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/v2.0-v2.4/getting-started/installation-and-upgrade/upgrade-kubernetes-without-upgrading-rancher">Upgrading Kubernetes without Upgrading Rancher</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" tabindex="0" href="/v2.0-v2.4/pages-for-subheaders/advanced-options">Advanced Options</a><button aria-label="Toggle the collapsible sidebar category &#x27;Advanced Options&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-4 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/v2.0-v2.4/pages-for-subheaders/enable-experimental-features">Enable Experimental Features</a><button aria-label="Toggle the collapsible sidebar category &#x27;Enable Experimental Features&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-4 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" tabindex="0" href="/v2.0-v2.4/pages-for-subheaders/helm2">Advanced Use Cases</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-5 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" tabindex="0" href="/v2.0-v2.4/pages-for-subheaders/helm2">Kubernetes Installation Using Helm 2</a><button aria-label="Toggle the collapsible sidebar category &#x27;Kubernetes Installation Using Helm 2&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-6 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/v2.0-v2.4/pages-for-subheaders/helm2-create-nodes-lb">Create Nodes and Load Balancer</a><button aria-label="Toggle the collapsible sidebar category &#x27;Create Nodes and Load Balancer&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-6 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/v2.0-v2.4/pages-for-subheaders/helm2-kubernetes-rke">Install Kubernetes with RKE</a><button aria-label="Toggle the collapsible sidebar category &#x27;Install Kubernetes with RKE&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-6 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/v2.0-v2.4/pages-for-subheaders/helm2-helm-init">Initialize Helm: Install the Tiller Service</a><button aria-label="Toggle the collapsible sidebar category &#x27;Initialize Helm: Install the Tiller Service&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-6 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/v2.0-v2.4/pages-for-subheaders/helm-rancher">Install Rancher</a><button aria-label="Toggle the collapsible sidebar category &#x27;Install Rancher&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-6 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" tabindex="0" href="/v2.0-v2.4/pages-for-subheaders/helm2-rke-add-on">RKE Add-On Install</a><button aria-label="Toggle the collapsible sidebar category &#x27;RKE Add-On Install&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-7 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/v2.0-v2.4/pages-for-subheaders/helm2-rke-add-on-layer-4-lb">Kubernetes Install with External Load Balancer (TCP/Layer 4)</a><button aria-label="Toggle the collapsible sidebar category &#x27;Kubernetes Install with External Load Balancer (TCP/Layer 4)&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-7 menu__list-item"><div class="menu__list-item-collapsible menu__list-item-collapsible--active"><a class="menu__link menu__link--sublist menu__link--active" aria-current="page" aria-expanded="true" tabindex="0" href="/v2.0-v2.4/pages-for-subheaders/helm2-rke-add-on-layer-7-lb">Kubernetes Install with External Load Balancer (HTTPS/Layer 7)</a><button aria-label="Toggle the collapsible sidebar category &#x27;Kubernetes Install with External Load Balancer (HTTPS/Layer 7)&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-8 menu__list-item"><a class="menu__link" tabindex="0" href="/v2.0-v2.4/getting-started/installation-and-upgrade/advanced-options/advanced-use-cases/helm2/rke-add-on/layer-7-lb/alb">Amazon ALB Configuration</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-8 menu__list-item"><a class="menu__link" tabindex="0" href="/v2.0-v2.4/getting-started/installation-and-upgrade/advanced-options/advanced-use-cases/helm2/rke-add-on/layer-7-lb/nginx">NGINX Configuration</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-7 menu__list-item"><a class="menu__link" tabindex="0" href="/v2.0-v2.4/getting-started/installation-and-upgrade/advanced-options/advanced-use-cases/helm2/rke-add-on/proxy">HTTP Proxy Configuration</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-7 menu__list-item"><a class="menu__link" tabindex="0" href="/v2.0-v2.4/getting-started/installation-and-upgrade/advanced-options/advanced-use-cases/helm2/rke-add-on/api-auditing">Enable API Auditing</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-7 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/v2.0-v2.4/pages-for-subheaders/helm2-rke-add-on-troubleshooting">Troubleshooting HA RKE Add-On Install</a><button aria-label="Toggle the collapsible sidebar category &#x27;Troubleshooting HA RKE Add-On Install&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-5 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/v2.0-v2.4/pages-for-subheaders/air-gap-helm2">Installing Rancher in an Air Gapped Environment with Helm 2</a><button aria-label="Toggle the collapsible sidebar category &#x27;Installing Rancher in an Air Gapped Environment with Helm 2&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class="menu__link" tabindex="0" href="/v2.0-v2.4/getting-started/installation-and-upgrade/advanced-options/advanced-use-cases/open-ports-with-firewalld">Opening Ports with firewalld</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class="menu__link" tabindex="0" href="/v2.0-v2.4/getting-started/installation-and-upgrade/advanced-options/advanced-use-cases/tune-etcd-for-large-installs">Tuning etcd for Large Installations</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class="menu__link" tabindex="0" href="/v2.0-v2.4/getting-started/installation-and-upgrade/advanced-options/advanced-use-cases/enable-api-audit-log">Enabling the API Audit Log to Record System Events</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-5 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/v2.0-v2.4/pages-for-subheaders/cluster-yml">cluster.yml Templates for RKE add-on installs</a><button aria-label="Toggle the collapsible sidebar category &#x27;cluster.yml Templates for RKE add-on installs&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class="menu__link" tabindex="0" href="/v2.0-v2.4/getting-started/installation-and-upgrade/advanced-options/advanced-use-cases/configure-layer-7-nginx-load-balancer">Docker Install with TLS Termination at Layer-7 NGINX Load Balancer</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-5 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/v2.0-v2.4/pages-for-subheaders/rke-add-on">RKE Add-On</a><button aria-label="Toggle the collapsible sidebar category &#x27;RKE Add-On&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></li></ul></li></ul></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/v2.0-v2.4/how-to-guides">How-to Guides</a><button aria-label="Toggle the collapsible sidebar category &#x27;How-to Guides&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/v2.0-v2.4/reference-guides">Reference Guides</a><button aria-label="Toggle the collapsible sidebar category &#x27;Reference Guides&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/v2.0-v2.4/explanations">Explanations</a><button aria-label="Toggle the collapsible sidebar category &#x27;Explanations&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/v2.0-v2.4/faq">FAQ</a><button aria-label="Toggle the collapsible sidebar category &#x27;FAQ&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/v2.0-v2.4/troubleshooting">Troubleshooting</a><button aria-label="Toggle the collapsible sidebar category &#x27;Troubleshooting&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/v2.0-v2.4/contribute-to-rancher">Contributing to Rancher</a></li></ul></nav></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_GujU"><div class="theme-doc-version-banner alert alert--warning margin-bottom--md" role="alert"><div>This is documentation for <!-- -->Rancher Manager<!-- --> <b>v2.0-v2.4</b>, which is no longer actively maintained.</div><div class="margin-top--md">For up-to-date documentation, see the <b><a href="/">latest version</a></b> (<!-- -->v2.6<!-- -->).</div></div><div class="docItemContainer_Adtb"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_OVgt"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/v2.0-v2.4/getting-started"><span itemprop="name">Getting Started</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/v2.0-v2.4/pages-for-subheaders/installation-and-upgrade"><span itemprop="name">Installation and Upgrade</span></a><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/v2.0-v2.4/pages-for-subheaders/advanced-options"><span itemprop="name">Advanced Options</span></a><meta itemprop="position" content="3"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Advanced Use Cases</span><meta itemprop="position" content="4"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/v2.0-v2.4/pages-for-subheaders/helm2"><span itemprop="name">Kubernetes Installation Using Helm 2</span></a><meta itemprop="position" content="5"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/v2.0-v2.4/pages-for-subheaders/helm2-rke-add-on"><span itemprop="name">RKE Add-On Install</span></a><meta itemprop="position" content="6"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Kubernetes Install with External Load Balancer (HTTPS/Layer 7)</span><meta itemprop="position" content="7"></li></ul></nav><span class="theme-doc-version-badge badge badge--secondary">Version: v2.0-v2.4</span><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_aoJ5"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Kubernetes Install with External Load Balancer (HTTPS/Layer 7)</h1></header><blockquote><h4 class="anchor anchorWithStickyNavbar_LWe7" id="important-rke-add-on-install-is-only-supported-up-to-rancher-v208"><strong>Important: RKE add-on install is only supported up to Rancher v2.0.8</strong><a class="hash-link" href="#important-rke-add-on-install-is-only-supported-up-to-rancher-v208" title="Direct link to heading">​</a></h4><p>Please use the Rancher Helm chart to install Rancher on a Kubernetes cluster. For details, see the <a href="/v2.0-v2.4/getting-started/installation-and-upgrade/resources/helm-version-requirements">Kubernetes Install </a>.</p><p>If you are currently using the RKE add-on install method, see <a href="/v2.0-v2.4/getting-started/installation-and-upgrade/install-upgrade-on-a-kubernetes-cluster/upgrades/migrating-from-rke-add-on">Migrating from a Kubernetes Install with an RKE Add-on</a> for details on how to move to using the helm chart.</p></blockquote><p>This procedure walks you through setting up a 3-node cluster using the Rancher Kubernetes Engine (RKE). The cluster&#x27;s sole purpose is running pods for Rancher. The setup is based on:</p><ul><li>Layer 7 Loadbalancer with SSL termination (HTTPS)</li><li><a href="https://kubernetes.github.io/ingress-nginx/" target="_blank" rel="noopener noreferrer">NGINX Ingress controller (HTTP)</a></li></ul><p>In an Kubernetes setup that uses a layer 7 load balancer, the load balancer accepts Rancher client connections over the HTTP protocol (i.e., the application level). This application-level access allows the load balancer to read client requests and then redirect to them to cluster nodes using logic that optimally distributes load.</p><sup>Kubernetes Rancher install with layer 7 load balancer, depicting SSL termination at load balancer</sup>![Rancher HA](/img/ha/rancher2ha-l7.svg)<h2 class="anchor anchorWithStickyNavbar_LWe7" id="1-provision-linux-hosts">1. Provision Linux Hosts<a class="hash-link" href="#1-provision-linux-hosts" title="Direct link to heading">​</a></h2><p>Provision three Linux hosts according to our <a href="/v2.0-v2.4/pages-for-subheaders/installation-requirements">Requirements</a>.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="2-configure-load-balancer">2. Configure Load Balancer<a class="hash-link" href="#2-configure-load-balancer" title="Direct link to heading">​</a></h2><p>When using a load balancer in front of Rancher, there&#x27;s no need for the container to redirect port communication from port 80 or port 443. By passing the header <code>X-Forwarded-Proto: https</code>, this redirect is disabled. This is the expected configuration when terminating SSL externally.</p><p>The load balancer has to be configured to support the following:</p><ul><li><strong>WebSocket</strong> connections</li><li><strong>SPDY</strong> / <strong>HTTP/2</strong> protocols</li><li>Passing / setting the following headers:</li></ul><table><thead><tr><th>Header</th><th>Value</th><th align="left">Description</th></tr></thead><tbody><tr><td><code>Host</code></td><td>FQDN used to reach Rancher.</td><td align="left">To identify the server requested by the client.</td></tr><tr><td><code>X-Forwarded-Proto</code></td><td><code>https</code></td><td align="left">To identify the protocol that a client used to connect to the load balancer.<br><br><strong>Note:</strong> If this header is present, <code>rancher/rancher</code> does not redirect HTTP to HTTPS.</td></tr><tr><td><code>X-Forwarded-Port</code></td><td>Port used to reach Rancher.</td><td align="left">To identify the protocol that client used to connect to the load balancer.</td></tr><tr><td><code>X-Forwarded-For</code></td><td>IP of the client connection.</td><td align="left">To identify the originating IP address of a client.</td></tr></tbody></table><p>Health checks can be executed on the <code>/healthz</code> endpoint of the node, this will return HTTP 200.</p><p>We have example configurations for the following load balancers:</p><ul><li><a href="/v2.0-v2.4/getting-started/installation-and-upgrade/advanced-options/advanced-use-cases/helm2/rke-add-on/layer-7-lb/alb">Amazon ALB configuration</a></li><li><a href="/v2.0-v2.4/getting-started/installation-and-upgrade/advanced-options/advanced-use-cases/helm2/rke-add-on/layer-7-lb/nginx">NGINX configuration</a></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="3-configure-dns">3. Configure DNS<a class="hash-link" href="#3-configure-dns" title="Direct link to heading">​</a></h2><p>Choose a fully qualified domain name (FQDN) that you want to use to access Rancher (e.g., <code>rancher.yourdomain.com</code>).<br><br></p><ol><li><p>Log into your DNS server a create a <code>DNS A</code> record that points to the IP address of your <a href="#2-configure-load-balancer">load balancer</a>.</p></li><li><p>Validate that the <code>DNS A</code> is working correctly. Run the following command from any terminal, replacing <code>HOSTNAME.DOMAIN.COM</code> with your chosen FQDN:</p><p><code>nslookup HOSTNAME.DOMAIN.COM</code></p><p><strong>Step Result:</strong> Terminal displays output similar to the following:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ nslookup rancher.yourdomain.com</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Server:         YOUR_HOSTNAME_IP_ADDRESS</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Address:        YOUR_HOSTNAME_IP_ADDRESS#53</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Non-authoritative answer:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Name:   rancher.yourdomain.com</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Address: HOSTNAME.DOMAIN.COM</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li></ol><br><h2 class="anchor anchorWithStickyNavbar_LWe7" id="4-install-rke">4. Install RKE<a class="hash-link" href="#4-install-rke" title="Direct link to heading">​</a></h2><p>RKE (Rancher Kubernetes Engine) is a fast, versatile Kubernetes installer that you can use to install Kubernetes on your Linux hosts. We will use RKE to setup our cluster and run Rancher.</p><ol><li><p>Follow the <a href="https://rancher.com/docs/rke/latest/en/installation" target="_blank" rel="noopener noreferrer">RKE Install</a> instructions.</p></li><li><p>Confirm that RKE is now executable by running the following command:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">rke --version</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li></ol><h2 class="anchor anchorWithStickyNavbar_LWe7" id="5-download-rke-config-file-template">5. Download RKE Config File Template<a class="hash-link" href="#5-download-rke-config-file-template" title="Direct link to heading">​</a></h2><p>RKE uses a YAML config file to install and configure your Kubernetes cluster. There are 2 templates to choose from, depending on the SSL certificate you want to use.</p><ol><li><p>Download one of following templates, depending on the SSL certificate you&#x27;re using.</p><ul><li><a href="https://raw.githubusercontent.com/rancher/rancher/master/rke-templates/3-node-externalssl-certificate.yml" target="_blank" rel="noopener noreferrer">Template for self-signed certificate<br> <code>3-node-externalssl-certificate.yml</code></a></li><li><a href="https://raw.githubusercontent.com/rancher/rancher/master/rke-templates/3-node-externalssl-recognizedca.yml" target="_blank" rel="noopener noreferrer">Template for certificate signed by recognized CA<br> <code>3-node-externalssl-recognizedca.yml</code></a></li></ul><blockquote><p><strong>Advanced Config Options:</strong></p><ul><li>Want records of all transactions with the Rancher API? Enable the <a href="/v2.0-v2.4/getting-started/installation-and-upgrade/advanced-options/advanced-use-cases/enable-api-audit-log">API Auditing</a> feature by editing your RKE config file. For more information, see how to enable it in <a href="/v2.0-v2.4/getting-started/installation-and-upgrade/advanced-options/advanced-use-cases/helm2/rke-add-on/api-auditing">your RKE config file</a>.</li><li>Want to know the other config options available for your RKE template? See the <a href="https://rancher.com/docs/rke/latest/en/config-options/" target="_blank" rel="noopener noreferrer">RKE Documentation: Config Options</a>.</li></ul></blockquote></li></ol><ol start="2"><li>Rename the file to <code>rancher-cluster.yml</code>.</li></ol><h2 class="anchor anchorWithStickyNavbar_LWe7" id="6-configure-nodes">6. Configure Nodes<a class="hash-link" href="#6-configure-nodes" title="Direct link to heading">​</a></h2><p>Once you have the <code>rancher-cluster.yml</code> config file template, edit the nodes section to point toward your Linux hosts.</p><ol><li><p>Open <code>rancher-cluster.yml</code> in your favorite text editor.</p></li><li><p>Update the <code>nodes</code> section with the information of your <a href="#1-provision-linux-hosts">Linux hosts</a>.</p><p>For each node in your cluster, update the following placeholders: <code>IP_ADDRESS_X</code> and <code>USER</code>. The specified user should be able to access the Docker socket, you can test this by logging in with the specified user and run <code>docker ps</code>.</p><blockquote><p><strong>Note:</strong></p><p>When using RHEL/CentOS, the SSH user can&#x27;t be root due to <a href="https://bugzilla.redhat.com/show_bug.cgi?id=1527565" target="_blank" rel="noopener noreferrer">https://bugzilla.redhat.com/show_bug.cgi?id=1527565</a>. See <a href="https://rancher.com/docs/rke/latest/en/installation/os#redhat-enterprise-linux-rhel-centos" target="_blank" rel="noopener noreferrer">Operating System Requirements</a> for RHEL/CentOS specific requirements.</p></blockquote><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">nodes:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    # The IP address or hostname of the node</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">- address: IP_ADDRESS_1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    # User that can login to the node and has access to the Docker socket (i.e. can execute `docker ps` on the node)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    # When using RHEL/CentOS, this can&#x27;t be root due to https://bugzilla.redhat.com/show_bug.cgi?id=1527565</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    user: USER</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    role: [controlplane,etcd,worker]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    # Path the SSH key that can be used to access to node with the specified user</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    ssh_key_path: ~/.ssh/id_rsa</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">- address: IP_ADDRESS_2</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    user: USER</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    role: [controlplane,etcd,worker]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    ssh_key_path: ~/.ssh/id_rsa</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">- address: IP_ADDRESS_3</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    user: USER</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    role: [controlplane,etcd,worker]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    ssh_key_path: ~/.ssh/id_rsa</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p><strong>Optional:</strong> By default, <code>rancher-cluster.yml</code> is configured to take backup snapshots of your data. To disable these snapshots, change the <code>backup</code> directive setting to <code>false</code>, as depicted below.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">services:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  etcd:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    backup: false</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li></ol><h2 class="anchor anchorWithStickyNavbar_LWe7" id="7-configure-certificates">7. Configure Certificates<a class="hash-link" href="#7-configure-certificates" title="Direct link to heading">​</a></h2><p>For security purposes, SSL (Secure Sockets Layer) is required when using Rancher. SSL secures all Rancher network communication, like when you login or interact with a cluster.</p><p>Choose from the following options:</p><details id="option-a" class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Option A—Bring Your Own Certificate: Self-Signed</summary><div><div class="collapsibleContent_i85q"><blockquote><p><strong>Prerequisites:</strong>
Create a self-signed certificate.</p><ul><li>The certificate files must be in PEM format.</li><li>The certificate files must be encoded in <a href="#base64">base64</a>.</li><li>In your certificate file, include all intermediate certificates in the chain. Order your certificates with your certificate first, followed by the intermediates. For an example, see <a href="/v2.0-v2.4/getting-started/installation-and-upgrade/other-installation-methods/rancher-on-a-single-node-with-docker/certificate-troubleshooting">Certificate Troubleshooting.</a></li></ul></blockquote><p>In <code>kind: Secret</code> with <code>name: cattle-keys-ingress</code>, replace <code>&lt;BASE64_CA&gt;</code> with the base64 encoded string of the CA Certificate file (usually called <code>ca.pem</code> or <code>ca.crt</code>)</p><blockquote><p><strong>Note:</strong> The base64 encoded string should be on the same line as <code>cacerts.pem</code>, without any newline at the beginning, in between or at the end.</p></blockquote><p>After replacing the values, the file should look like the example below (the base64 encoded strings should be different):</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">    ---</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    apiVersion: v1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    kind: Secret</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    metadata:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        name: cattle-keys-server</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        namespace: cattle-system</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    type: Opaque</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    data:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        cacerts.pem: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUNvRENDQVlnQ0NRRHVVWjZuMEZWeU16QU5CZ2txaGtpRzl3MEJBUXNGQURBU01SQXdEZ1lEVlFRRERBZDAKWlhOMExXTmhNQjRYRFRFNE1EVXdOakl4TURRd09Wb1hEVEU0TURjd05USXhNRFF3T1Zvd0VqRVFNQTRHQTFVRQpBd3dIZEdWemRDMWpZVENDQVNJd0RRWUpLb1pJaHZjTkFRRUJCUUFEZ2dFUEFEQ0NBUW9DZ2dFQkFNQmpBS3dQCndhRUhwQTdaRW1iWWczaTNYNlppVmtGZFJGckJlTmFYTHFPL2R0RUdmWktqYUF0Wm45R1VsckQxZUlUS3UzVHgKOWlGVlV4Mmo1Z0tyWmpwWitCUnFiZ1BNbk5hS1hocmRTdDRtUUN0VFFZdGRYMVFZS0pUbWF5NU45N3FoNTZtWQprMllKRkpOWVhHWlJabkdMUXJQNk04VHZramF0ZnZOdmJ0WmtkY2orYlY3aWhXanp2d2theHRUVjZlUGxuM2p5CnJUeXBBTDliYnlVcHlad3E2MWQvb0Q4VUtwZ2lZM1dOWmN1YnNvSjhxWlRsTnN6UjVadEFJV0tjSE5ZbE93d2oKaG41RE1tSFpwZ0ZGNW14TU52akxPRUc0S0ZRU3laYlV2QzlZRUhLZTUxbGVxa1lmQmtBZWpPY002TnlWQUh1dApuay9DMHpXcGdENkIwbkVDQXdFQUFUQU5CZ2txaGtpRzl3MEJBUXNGQUFPQ0FRRUFHTCtaNkRzK2R4WTZsU2VBClZHSkMvdzE1bHJ2ZXdia1YxN3hvcmlyNEMxVURJSXB6YXdCdFJRSGdSWXVtblVqOGo4T0hFWUFDUEthR3BTVUsKRDVuVWdzV0pMUUV0TDA2eTh6M3A0MDBrSlZFZW9xZlVnYjQrK1JLRVJrWmowWXR3NEN0WHhwOVMzVkd4NmNOQQozZVlqRnRQd2hoYWVEQmdma1hXQWtISXFDcEsrN3RYem9pRGpXbi8walI2VDcrSGlaNEZjZ1AzYnd3K3NjUDIyCjlDQVZ1ZFg4TWpEQ1hTcll0Y0ZINllBanlCSTJjbDhoSkJqa2E3aERpVC9DaFlEZlFFVFZDM3crQjBDYjF1NWcKdE03Z2NGcUw4OVdhMnp5UzdNdXk5bEthUDBvTXl1Ty82Tm1wNjNsVnRHeEZKSFh4WTN6M0lycGxlbTNZQThpTwpmbmlYZXc9PQotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tCg==</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></details><details id="option-b" class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Option B—Bring Your Own Certificate: Signed by Recognized CA</summary><div><div class="collapsibleContent_i85q"><p>If you are using a Certificate Signed By A Recognized Certificate Authority, you don&#x27;t need to perform any step in this part.</p></div></div></details><h2 class="anchor anchorWithStickyNavbar_LWe7" id="8-configure-fqdn">8. Configure FQDN<a class="hash-link" href="#8-configure-fqdn" title="Direct link to heading">​</a></h2><p>There is one reference to <code>&lt;FQDN&gt;</code> in the RKE config file. Replace this reference with the FQDN you chose in <a href="#3-configure-dns">3. Configure DNS</a>.</p><ol><li><p>Open <code>rancher-cluster.yml</code>.</p></li><li><p>In the <code>kind: Ingress</code> with <code>name: cattle-ingress-http:</code></p><p>Replace <code>&lt;FQDN&gt;</code> with the FQDN chosen in <a href="#3-configure-dns">3. Configure DNS</a>.</p><p><strong>Step Result:</strong> After replacing the values, the file should look like the example below (the base64 encoded strings should be different):</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">apiVersion: extensions/v1beta1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  kind: Ingress</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  metadata:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    namespace: cattle-system</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    name: cattle-ingress-http</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    annotations:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      nginx.ingress.kubernetes.io/proxy-connect-timeout: &quot;30&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      nginx.ingress.kubernetes.io/proxy-read-timeout: &quot;1800&quot;   # Max time in seconds for ws to remain shell window open</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      nginx.ingress.kubernetes.io/proxy-send-timeout: &quot;1800&quot;   # Max time in seconds for ws to remain shell window open</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  spec:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    rules:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    - host: rancher.yourdomain.com</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      http:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        paths:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        - backend:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            serviceName: cattle-service</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            servicePort: 80</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li></ol><ol start="3"><li>Save the file and close it.</li></ol><h2 class="anchor anchorWithStickyNavbar_LWe7" id="9-configure-rancher-version">9. Configure Rancher version<a class="hash-link" href="#9-configure-rancher-version" title="Direct link to heading">​</a></h2><p>The last reference that needs to be replaced is <code>&lt;RANCHER_VERSION&gt;</code>. This needs to be replaced with a Rancher version which is marked as stable. The latest stable release of Rancher can be found in the <a href="https://github.com/rancher/rancher/blob/master/README.md" target="_blank" rel="noopener noreferrer">GitHub README</a>. Make sure the version is an actual version number, and not a named tag like <code>stable</code> or <code>latest</code>. The example below shows the version configured to <code>v2.0.6</code>.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">      spec:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        serviceAccountName: cattle-admin</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        containers:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        - image: rancher/rancher:v2.0.6</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          imagePullPolicy: Always</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="10-back-up-your-rke-config-file">10. Back Up Your RKE Config File<a class="hash-link" href="#10-back-up-your-rke-config-file" title="Direct link to heading">​</a></h2><p>After you close your RKE config file, <code>rancher-cluster.yml</code>, back it up to a secure location. You can use this file again when it&#x27;s time to upgrade Rancher.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="11-run-rke">11. Run RKE<a class="hash-link" href="#11-run-rke" title="Direct link to heading">​</a></h2><p>With all configuration in place, use RKE to launch Rancher. You can complete this action by running the <code>rke up</code> command and using the <code>--config</code> parameter to point toward your config file.</p><ol><li><p>From your workstation, make sure <code>rancher-cluster.yml</code> and the downloaded <code>rke</code> binary are in the same directory.</p></li><li><p>Open a Terminal instance. Change to the directory that contains your config file and <code>rke</code>.</p></li><li><p>Enter one of the <code>rke up</code> commands listen below.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">rke up --config rancher-cluster.yml</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>Step Result:</strong> The output should be similar to the snippet below:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">INFO[0000] Building Kubernetes cluster</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">INFO[0000] [dialer] Setup tunnel for host [1.1.1.1]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">INFO[0000] [network] Deploying port listener containers</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">INFO[0000] [network] Pulling image [alpine:latest] on host [1.1.1.1]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">INFO[0101] Finished building Kubernetes cluster successfully</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li></ol><h2 class="anchor anchorWithStickyNavbar_LWe7" id="12-back-up-auto-generated-config-file">12. Back Up Auto-Generated Config File<a class="hash-link" href="#12-back-up-auto-generated-config-file" title="Direct link to heading">​</a></h2><p>During installation, RKE automatically generates a config file named <code>kube_config_rancher-cluster.yml</code> in the same directory as the <code>rancher-cluster.yml</code> file. Copy this file and back it up to a safe location. You&#x27;ll use this file later when upgrading Rancher Server.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="whats-next">What&#x27;s Next?<a class="hash-link" href="#whats-next" title="Direct link to heading">​</a></h2><ul><li><strong>Recommended:</strong> Review <a href="/v2.0-v2.4/how-to-guides/new-user-guides/backup-restore-and-disaster-recovery/back-up-rancher-launched-kubernetes-clusters">Creating Backups—High Availability Back Up and Restore</a> to learn how to backup your Rancher Server in case of a disaster scenario.</li><li>Create a Kubernetes cluster: <a href="/v2.0-v2.4/pages-for-subheaders/kubernetes-clusters-in-rancher-setup">Creating a Cluster</a>.</li></ul><br><h2 class="anchor anchorWithStickyNavbar_LWe7" id="faq-and-troubleshooting">FAQ and Troubleshooting<a class="hash-link" href="#faq-and-troubleshooting" title="Direct link to heading">​</a></h2><div><h3 id="pem">How Do I Know if My Certificates are in PEM Format?</h3><p>You can recognize the PEM format by the following traits:</p><ul><li>The file begins with the following header:<br> <code>-----BEGIN CERTIFICATE-----</code></li><li>The header is followed by a long string of characters. Like, really long.</li><li>The file ends with a footer:<br> <code>-----END CERTIFICATE-----</code></li></ul><p><strong>PEM Certificate Example:</strong></p><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4px;-o-tab-size:4px;tab-size:4px">----BEGIN CERTIFICATE----- MIIGVDCCBDygAwIBAgIJAMiIrEm29kRLMA0GCSqGSIb3DQEBCwUAMHkxCzAJBgNV ... more lines VWQqljhfacYPgp8KJUJENQ9h5hZ2nSCrI+W00Jcw4QcEdCI8HL5wmg== -----END CERTIFICATE-----</pre><h3 id="base64">How Can I Encode My PEM Files in base64?</h3><p>To encode your certificates in base64:</p><ol><li>Change directory to where the PEM file resides.</li><li>Run one of the following commands. Replace <code>FILENAME</code> with the name of your certificate.<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4px;-o-tab-size:4px;tab-size:4px"># MacOS cat FILENAME | base64 # Linux cat FILENAME | base64 -w0 # Windows certutil -encode FILENAME FILENAME.base64</pre></li></ol><h3 id="base64">How Can I Verify My Generated base64 String For The Certificates?</h3><p>To decode your certificates in base64:</p><ol><li>Copy the generated base64 string.</li><li>Run one of the following commands. Replace <code>YOUR_BASE64_STRING</code> with the previously copied base64 string.<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4px;-o-tab-size:4px;tab-size:4px"># MacOS echo YOUR_BASE64_STRING | base64 -D # Linux echo YOUR_BASE64_STRING | base64 -d # Windows certutil -decode FILENAME.base64 FILENAME.verify</pre></li></ol><h3 id="cert-order">What is the Order of Certificates if I Want to Add My Intermediate(s)?</h3><p>The order of adding certificates is as follows:</p><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4px;-o-tab-size:4px;tab-size:4px">-----BEGIN CERTIFICATE----- %YOUR_CERTIFICATE% -----END CERTIFICATE----- -----BEGIN CERTIFICATE----- %YOUR_INTERMEDIATE_CERTIFICATE% -----END CERTIFICATE-----</pre><h3 id="validate-cert-chain">How Do I Validate My Certificate Chain?</h3><p>You can validate the certificate chain by using the <code>openssl</code> binary. If the output of the command (see the command example below) ends with <code>Verify return code: 0 (ok)</code>, your certificate chain is valid. The<code>ca.pem</code> file must be the same as you added to the <code>rancher/rancher</code> container. When using a certificate signed by a recognized Certificate Authority, you can omit the <code>-CAfile</code> parameter.</p><p>Command:</p><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4px;-o-tab-size:4px;tab-size:4px">openssl s_client -CAfile ca.pem -connect rancher.yourdomain.com:443 -servername rancher.yourdomain.com ... Verify return code: 0 (ok)</pre></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/rancher/rancher-docs/edit/main/versioned_docs/version-2.0-2.4/pages-for-subheaders/helm2-rke-add-on-layer-7-lb.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_eYIM" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vbeJ"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2022-09-10T07:31:45.000Z">9/10/2022</time></b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/v2.0-v2.4/getting-started/installation-and-upgrade/advanced-options/advanced-use-cases/helm2/rke-add-on/layer-4-lb/nlb"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Amazon NLB Configuration</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/v2.0-v2.4/getting-started/installation-and-upgrade/advanced-options/advanced-use-cases/helm2/rke-add-on/layer-7-lb/alb"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Amazon ALB Configuration</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#1-provision-linux-hosts" class="table-of-contents__link toc-highlight">1. Provision Linux Hosts</a></li><li><a href="#2-configure-load-balancer" class="table-of-contents__link toc-highlight">2. Configure Load Balancer</a></li><li><a href="#3-configure-dns" class="table-of-contents__link toc-highlight">3. Configure DNS</a></li><li><a href="#4-install-rke" class="table-of-contents__link toc-highlight">4. Install RKE</a></li><li><a href="#5-download-rke-config-file-template" class="table-of-contents__link toc-highlight">5. Download RKE Config File Template</a></li><li><a href="#6-configure-nodes" class="table-of-contents__link toc-highlight">6. Configure Nodes</a></li><li><a href="#7-configure-certificates" class="table-of-contents__link toc-highlight">7. Configure Certificates</a></li><li><a href="#8-configure-fqdn" class="table-of-contents__link toc-highlight">8. Configure FQDN</a></li><li><a href="#9-configure-rancher-version" class="table-of-contents__link toc-highlight">9. Configure Rancher version</a></li><li><a href="#10-back-up-your-rke-config-file" class="table-of-contents__link toc-highlight">10. Back Up Your RKE Config File</a></li><li><a href="#11-run-rke" class="table-of-contents__link toc-highlight">11. Run RKE</a></li><li><a href="#12-back-up-auto-generated-config-file" class="table-of-contents__link toc-highlight">12. Back Up Auto-Generated Config File</a></li><li><a href="#whats-next" class="table-of-contents__link toc-highlight">What&#39;s Next?</a></li><li><a href="#faq-and-troubleshooting" class="table-of-contents__link toc-highlight">FAQ and Troubleshooting</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2022 SUSE Rancher. All Rights Reserved.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.d2604d48.js"></script>
<script src="/assets/js/main.aa78001f.js"></script>
</body>
</html>