<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-2.5 plugin-docs plugin-id-default docs-doc-id-getting-started/installation-and-upgrade/other-installation-methods/air-gapped-helm-cli-install/publish-images">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.21">
<link rel="search" type="application/opensearchdescription+xml" title="Rancher Manager" href="/opensearch.xml"><title data-rh="true">2. Collect and Publish Images to your Private Registry | Rancher Manager</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="http://docs.ranchermanager.rancher.io//v2.5/getting-started/installation-and-upgrade/other-installation-methods/air-gapped-helm-cli-install/publish-images"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="2.5"><meta data-rh="true" name="docusaurus_tag" content="docs-default-2.5"><meta data-rh="true" name="docsearch:version" content="2.5"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-2.5"><meta data-rh="true" property="og:title" content="2. Collect and Publish Images to your Private Registry | Rancher Manager"><meta data-rh="true" name="description" content="This section describes how to set up your private registry so that when you install Rancher, Rancher will pull all the required images from this registry."><meta data-rh="true" property="og:description" content="This section describes how to set up your private registry so that when you install Rancher, Rancher will pull all the required images from this registry."><link data-rh="true" rel="icon" href="/img/favicon.png"><link data-rh="true" rel="canonical" href="http://docs.ranchermanager.rancher.io//v2.5/getting-started/installation-and-upgrade/other-installation-methods/air-gapped-helm-cli-install/publish-images"><link data-rh="true" rel="alternate" href="http://docs.ranchermanager.rancher.io//v2.5/getting-started/installation-and-upgrade/other-installation-methods/air-gapped-helm-cli-install/publish-images" hreflang="en"><link data-rh="true" rel="alternate" href="http://docs.ranchermanager.rancher.io//v2.5/getting-started/installation-and-upgrade/other-installation-methods/air-gapped-helm-cli-install/publish-images" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://30NEY6C9UY-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.9543bcfd.css">
<link rel="preload" href="/assets/js/runtime~main.217a7f9f.js" as="script">
<link rel="preload" href="/assets/js/main.00d8b9dc.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_fXgn">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/rancher-logo-horiz-color.svg" alt="logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/rancher-logo-horiz-color.svg" alt="logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate"></b></a><div class="navbar__item dropdown dropdown--hoverable"><a aria-current="page" class="navbar__link active" aria-haspopup="true" aria-expanded="false" role="button" href="/v2.5">v2.5</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/getting-started/installation-and-upgrade/other-installation-methods/air-gapped-helm-cli-install/publish-images">v2.6</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/v2.5/getting-started/installation-and-upgrade/other-installation-methods/air-gapped-helm-cli-install/publish-images">v2.5</a></li><li><a class="dropdown__link" href="/v2.0-v2.4/getting-started/installation-and-upgrade/other-installation-methods/air-gapped-helm-cli-install/publish-images">v2.0-v2.4</a></li><li><a class="dropdown__link" href="/versions">All versions</a></li></ul></div></div><div class="navbar__items navbar__items--right"><a aria-current="page" class="navbar__item navbar__link navbar__docs navbar__link--active" href="/v2.5">Docs</a><a href="https://github.com/rancher/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link navbar__github btn btn-secondary icon-github">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_lCJq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd"><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/v2.5">Rancher 2.5</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/v2.5/getting-started">Getting Started</a><button aria-label="Toggle the collapsible sidebar category &#x27;Getting Started&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/v2.5/pages-for-subheaders/introduction">Introduction</a><button aria-label="Toggle the collapsible sidebar category &#x27;Introduction&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/v2.5/pages-for-subheaders/quick-start-guides">Quick Start Guides</a><button aria-label="Toggle the collapsible sidebar category &#x27;Quick Start Guides&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" tabindex="0" href="/v2.5/pages-for-subheaders/installation-and-upgrade">Installation and Upgrade</a><button aria-label="Toggle the collapsible sidebar category &#x27;Installation and Upgrade&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/v2.5/pages-for-subheaders/installation-requirements">Installation Requirements</a><button aria-label="Toggle the collapsible sidebar category &#x27;Installation Requirements&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/v2.5/pages-for-subheaders/install-upgrade-on-a-kubernetes-cluster">Install/Upgrade on a Kubernetes Cluster</a><button aria-label="Toggle the collapsible sidebar category &#x27;Install/Upgrade on a Kubernetes Cluster&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" tabindex="0" href="/v2.5/pages-for-subheaders/other-installation-methods">Other Installation Methods</a><button aria-label="Toggle the collapsible sidebar category &#x27;Other Installation Methods&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-4 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" tabindex="0" href="/v2.5/pages-for-subheaders/air-gapped-helm-cli-install">Air-Gapped Helm CLI Install</a><button aria-label="Toggle the collapsible sidebar category &#x27;Air-Gapped Helm CLI Install&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class="menu__link" tabindex="0" href="/v2.5/getting-started/installation-and-upgrade/other-installation-methods/air-gapped-helm-cli-install/infrastructure-private-registry">1. Set up Infrastructure and Private Registry</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/v2.5/getting-started/installation-and-upgrade/other-installation-methods/air-gapped-helm-cli-install/publish-images">2. Collect and Publish Images to your Private Registry</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class="menu__link" tabindex="0" href="/v2.5/getting-started/installation-and-upgrade/other-installation-methods/air-gapped-helm-cli-install/install-kubernetes">3. Install Kubernetes (Skip for Docker Installs)</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class="menu__link" tabindex="0" href="/v2.5/getting-started/installation-and-upgrade/other-installation-methods/air-gapped-helm-cli-install/install-rancher-ha">4. Install Rancher</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class="menu__link" tabindex="0" href="/v2.5/getting-started/installation-and-upgrade/other-installation-methods/air-gapped-helm-cli-install/docker-install-commands">Docker Install Commands</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-4 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/v2.5/pages-for-subheaders/rancher-on-a-single-node-with-docker">Rancher on a Single Node with Docker</a><button aria-label="Toggle the collapsible sidebar category &#x27;Rancher on a Single Node with Docker&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-4 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/v2.5/pages-for-subheaders/rancher-behind-an-http-proxy">Rancher Behind an HTTP Proxy</a><button aria-label="Toggle the collapsible sidebar category &#x27;Rancher Behind an HTTP Proxy&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-4 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/v2.5/pages-for-subheaders/install-rancher-on-linux">Install/Upgrade Rancher with RancherD</a><button aria-label="Toggle the collapsible sidebar category &#x27;Install/Upgrade Rancher with RancherD&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/v2.5/pages-for-subheaders/resources">Resources</a><button aria-label="Toggle the collapsible sidebar category &#x27;Resources&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/v2.5/getting-started/installation-and-upgrade/upgrade-and-roll-back-kubernetes">Upgrading and Rolling Back Kubernetes</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/v2.5/getting-started/installation-and-upgrade/upgrade-kubernetes-without-upgrading-rancher">Upgrading Kubernetes without Upgrading Rancher</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/v2.5/pages-for-subheaders/advanced-options">Advanced Options</a><button aria-label="Toggle the collapsible sidebar category &#x27;Advanced Options&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/v2.5/how-to-guides">How-to Guides</a><button aria-label="Toggle the collapsible sidebar category &#x27;How-to Guides&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/v2.5/reference-guides">Reference Guides</a><button aria-label="Toggle the collapsible sidebar category &#x27;Reference Guides&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/v2.5/explanations">Explanations</a><button aria-label="Toggle the collapsible sidebar category &#x27;Explanations&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/v2.5/faq">FAQ</a><button aria-label="Toggle the collapsible sidebar category &#x27;FAQ&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/v2.5/troubleshooting">Troubleshooting</a><button aria-label="Toggle the collapsible sidebar category &#x27;Troubleshooting&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/v2.5/contribute-to-rancher">Contributing to Rancher</a></li></ul></nav></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_GujU"><div class="theme-doc-version-banner alert alert--warning margin-bottom--md" role="alert"><div>This is documentation for <!-- -->Rancher Manager<!-- --> <b>v2.5</b>, which is no longer actively maintained.</div><div class="margin-top--md">For up-to-date documentation, see the <b><a href="/getting-started/installation-and-upgrade/other-installation-methods/air-gapped-helm-cli-install/publish-images">latest version</a></b> (<!-- -->v2.6<!-- -->).</div></div><div class="docItemContainer_Adtb"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_OVgt"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/v2.5/getting-started"><span itemprop="name">Getting Started</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/v2.5/pages-for-subheaders/installation-and-upgrade"><span itemprop="name">Installation and Upgrade</span></a><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/v2.5/pages-for-subheaders/other-installation-methods"><span itemprop="name">Other Installation Methods</span></a><meta itemprop="position" content="3"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/v2.5/pages-for-subheaders/air-gapped-helm-cli-install"><span itemprop="name">Air-Gapped Helm CLI Install</span></a><meta itemprop="position" content="4"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">2. Collect and Publish Images to your Private Registry</span><meta itemprop="position" content="5"></li></ul></nav><span class="theme-doc-version-badge badge badge--secondary">Version: v2.5</span><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_aoJ5"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>2. Collect and Publish Images to your Private Registry</h1></header><p>This section describes how to set up your private registry so that when you install Rancher, Rancher will pull all the required images from this registry.</p><p>By default, all images used to <a href="/v2.5/pages-for-subheaders/kubernetes-clusters-in-rancher-setup">provision Kubernetes clusters</a> or launch any tools in Rancher, e.g. monitoring and logging, are pulled from Docker Hub. In an air gapped installation of Rancher, you will need a private registry that is located somewhere accessible by your Rancher server. Then, you will load the registry with all the images.</p><p>Populating the private registry with images is the same process for installing Rancher with Docker and for installing Rancher on a Kubernetes cluster.</p><p>The steps in this section differ depending on whether or not you are planning to use Rancher to provision a downstream cluster with Windows nodes or not. By default, we provide the steps of how to populate your private registry assuming that Rancher will provision downstream Kubernetes clusters with only Linux nodes. But if you plan on provisioning any <a href="/v2.5/pages-for-subheaders/use-windows-clusters">downstream Kubernetes clusters using Windows nodes</a>, there are separate instructions to support the images needed.</p><blockquote><p><strong>Prerequisites:</strong></p><p>You must have a <a href="https://docs.docker.com/registry/deploying/#run-an-externally-accessible-registry" target="_blank" rel="noopener noreferrer">private registry</a> available to use.</p><p>If the registry has certs, follow <a href="https://rancher.com/docs/k3s/latest/en/installation/private-registry/" target="_blank" rel="noopener noreferrer">this K3s documentation</a> about adding a private registry. The certs and registry configuration files need to be mounted into the Rancher container.</p></blockquote><div class="tabs-container tabList__CuJ"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LNqP tabs__item--active">Linux Only Clusters</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">Linux and Windows Clusters</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_Ymn6"><p>For Rancher servers that will only provision Linux clusters, these are the steps to populate your private registry.</p><ol><li><a href="#1-find-the-required-assets-for-your-rancher-version">Find the required assets for your Rancher version</a></li><li><a href="#2-collect-the-cert-manager-image">Collect the cert-manager image</a> (unless you are bringing your own certificates or terminating TLS on a load balancer)</li><li><a href="#3-save-the-images-to-your-workstation">Save the images to your workstation</a></li><li><a href="#4-populate-the-private-registry">Populate the private registry</a></li></ol><h3 class="anchor anchorWithStickyNavbar_LWe7" id="prerequisites">Prerequisites<a class="hash-link" href="#prerequisites" title="Direct link to heading">​</a></h3><p>These steps expect you to use a Linux workstation that has internet access, access to your private registry, and at least 20 GB of disk space.</p><p>If you will use ARM64 hosts, the registry must support manifests. As of April 2020, Amazon Elastic Container Registry does not support manifests.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="1-find-the-required-assets-for-your-rancher-version">1. Find the required assets for your Rancher version<a class="hash-link" href="#1-find-the-required-assets-for-your-rancher-version" title="Direct link to heading">​</a></h3><ol><li><p>Go to our <a href="https://github.com/rancher/rancher/releases" target="_blank" rel="noopener noreferrer">releases page,</a> find the Rancher v2.x.x release that you want to install, and click <strong>Assets.</strong> Note: Don&#x27;t use releases marked <code>rc</code> or <code>Pre-release</code>, as they are not stable for production environments.</p></li><li><p>From the release&#x27;s <strong>Assets</strong> section, download the following files, which are required to install Rancher in an air gap environment:</p></li></ol><table><thead><tr><th>Release File</th><th>Description</th></tr></thead><tbody><tr><td><code>rancher-images.txt</code></td><td>This file contains a list of images needed to install Rancher, provision clusters and user Rancher tools.</td></tr><tr><td><code>rancher-save-images.sh</code></td><td>This script pulls all the images in the <code>rancher-images.txt</code> from Docker Hub and saves all of the images as <code>rancher-images.tar.gz</code>.</td></tr><tr><td><code>rancher-load-images.sh</code></td><td>This script loads images from the <code>rancher-images.tar.gz</code> file and pushes them to your private registry.</td></tr></tbody></table><h3 class="anchor anchorWithStickyNavbar_LWe7" id="2-collect-the-cert-manager-image">2. Collect the cert-manager image<a class="hash-link" href="#2-collect-the-cert-manager-image" title="Direct link to heading">​</a></h3><blockquote><p>Skip this step if you are using your own certificates, or if you are terminating TLS on an external load balancer.</p></blockquote><p>In a Kubernetes Install, if you elect to use the Rancher default self-signed TLS certificates, you must add the <a href="https://hub.helm.sh/charts/jetstack/cert-manager" target="_blank" rel="noopener noreferrer"><code>cert-manager</code></a> image to <code>rancher-images.txt</code> as well.</p><ol><li><p>Fetch the latest <code>cert-manager</code> Helm chart and parse the template for image details:</p><blockquote><p><strong>Note:</strong> Recent changes to cert-manager require an upgrade. If you are upgrading Rancher and using a version of cert-manager older than v0.12.0, please see our <a href="/v2.5/getting-started/installation-and-upgrade/resources/upgrade-cert-manager">upgrade documentation</a>.</p></blockquote><div class="language-plain codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-plain codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">helm repo add jetstack https://charts.jetstack.io</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">helm repo update</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">helm fetch jetstack/cert-manager --version v1.5.1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">helm template ./cert-manager-&lt;version&gt;.tgz | awk &#x27;$1 ~ /image:/ {print $2}&#x27; | sed s/\&quot;//g &gt;&gt; ./rancher-images.txt</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>Sort and unique the images list to remove any overlap between the sources:</p><div class="language-plain codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-plain codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">sort -u rancher-images.txt -o rancher-images.txt</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li></ol><h3 class="anchor anchorWithStickyNavbar_LWe7" id="3-save-the-images-to-your-workstation">3. Save the images to your workstation<a class="hash-link" href="#3-save-the-images-to-your-workstation" title="Direct link to heading">​</a></h3><ol><li><p>Make <code>rancher-save-images.sh</code> an executable:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">chmod +x rancher-save-images.sh</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>Run <code>rancher-save-images.sh</code> with the <code>rancher-images.txt</code> image list to create a tarball of all the required images:</p><div class="language-plain codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-plain codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">./rancher-save-images.sh --image-list ./rancher-images.txt</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>Result:</strong> Docker begins pulling the images used for an air gap install. Be patient. This process takes a few minutes. When the process completes, your current directory will output a tarball named <code>rancher-images.tar.gz</code>. Check that the output is in the directory.</p></li></ol><h3 class="anchor anchorWithStickyNavbar_LWe7" id="4-populate-the-private-registry">4. Populate the private registry<a class="hash-link" href="#4-populate-the-private-registry" title="Direct link to heading">​</a></h3><p>Next, you will move the images in the <code>rancher-images.tar.gz</code> to your private registry using the scripts to load the images.</p><p>Move the images in the <code>rancher-images.tar.gz</code> to your private registry using the scripts to load the images.</p><p>The <code>rancher-images.txt</code> is expected to be on the workstation in the same directory that you are running the <code>rancher-load-images.sh</code> script. The <code>rancher-images.tar.gz</code> should also be in the same directory.</p><ol><li><p>Log into your private registry if required:</p><div class="language-plain codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-plain codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">docker login &lt;REGISTRY.YOURDOMAIN.COM:PORT&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>Make <code>rancher-load-images.sh</code> an executable:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">chmod +x rancher-load-images.sh</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>Use <code>rancher-load-images.sh</code> to extract, tag and push <code>rancher-images.txt</code> and <code>rancher-images.tar.gz</code> to your private registry:</p><div class="language-plain codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-plain codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">./rancher-load-images.sh --image-list ./rancher-images.txt --registry &lt;REGISTRY.YOURDOMAIN.COM:PORT&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li></ol></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><p>For Rancher servers that will provision Linux and Windows clusters, there are distinctive steps to populate your private registry for the Windows images and the Linux images. Since a Windows cluster is a mix of Linux and Windows nodes, the Linux images pushed into the private registry are manifests.</p><h1>Windows Steps</h1><p>The Windows images need to be collected and pushed from a Windows server workstation.</p><ol><li><a href="#windows-1">Find the required assets for your Rancher version</a></li><li><a href="#windows-2">Save the images to your Windows Server workstation</a></li><li><a href="#windows-3">Prepare the Docker daemon</a></li><li><a href="#windows-4">Populate the private registry</a></li></ol><h3 class="anchor anchorWithStickyNavbar_LWe7" id="prerequisites-1">Prerequisites<a class="hash-link" href="#prerequisites-1" title="Direct link to heading">​</a></h3><p>These steps expect you to use a Windows Server 1809 workstation that has internet access, access to your private registry, and at least 50 GB of disk space.</p><p>The workstation must have Docker 18.02+ in order to support manifests, which are required when provisioning Windows clusters.</p><p>Your registry must support manifests. As of April 2020, Amazon Elastic Container Registry does not support manifests.</p><a name="windows-1"></a><h3 class="anchor anchorWithStickyNavbar_LWe7" id="1-find-the-required-assets-for-your-rancher-version-1">1. Find the required assets for your Rancher version<a class="hash-link" href="#1-find-the-required-assets-for-your-rancher-version-1" title="Direct link to heading">​</a></h3><ol><li><p>Browse to our <a href="https://github.com/rancher/rancher/releases" target="_blank" rel="noopener noreferrer">releases page</a> and find the Rancher v2.x.x release that you want to install. Don&#x27;t download releases marked <code>rc</code> or <code>Pre-release</code>, as they are not stable for production environments.</p></li><li><p>From the release&#x27;s &quot;Assets&quot; section, download the following files:</p></li></ol><table><thead><tr><th>Release File</th><th>Description</th></tr></thead><tbody><tr><td><code>rancher-windows-images.txt</code></td><td>This file contains a list of Windows images needed to provision Windows clusters.</td></tr><tr><td><code>rancher-save-images.ps1</code></td><td>This script pulls all the images in the <code>rancher-windows-images.txt</code> from Docker Hub and saves all of the images as <code>rancher-windows-images.tar.gz</code>.</td></tr><tr><td><code>rancher-load-images.ps1</code></td><td>This script loads the images from the <code>rancher-windows-images.tar.gz</code> file and pushes them to your private registry.</td></tr></tbody></table><a name="windows-2"></a><h3 class="anchor anchorWithStickyNavbar_LWe7" id="2-save-the-images-to-your-windows-server-workstation">2. Save the images to your Windows Server workstation<a class="hash-link" href="#2-save-the-images-to-your-windows-server-workstation" title="Direct link to heading">​</a></h3><ol><li><p>Using <code>powershell</code>, go to the directory that has the files that were downloaded in the previous step.</p></li><li><p>Run <code>rancher-save-images.ps1</code> to create a tarball of all the required images:</p><div class="language-plain codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-plain codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">./rancher-save-images.ps1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>Result:</strong> Docker begins pulling the images used for an air gap install. Be patient. This process takes a few minutes. When the process completes, your current directory will output a tarball named <code>rancher-windows-images.tar.gz</code>. Check that the output is in the directory.</p></li></ol><a name="windows-3"></a><h3 class="anchor anchorWithStickyNavbar_LWe7" id="3-prepare-the-docker-daemon">3. Prepare the Docker daemon<a class="hash-link" href="#3-prepare-the-docker-daemon" title="Direct link to heading">​</a></h3><p>Append your private registry address to the <code>allow-nondistributable-artifacts</code> config field in the Docker daemon (<code>C:\ProgramData\Docker\config\daemon.json</code>). Since the base image of Windows images are maintained by the <code>mcr.microsoft.com</code> registry, this step is required as the layers in the Microsoft registry are missing from Docker Hub and need to be pulled into the private registry.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">{</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;allow-nondistributable-artifacts&quot;: [</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;&lt;REGISTRY.YOURDOMAIN.COM:PORT&gt;&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><a name="windows-4"></a><h3 class="anchor anchorWithStickyNavbar_LWe7" id="4-populate-the-private-registry-1">4. Populate the private registry<a class="hash-link" href="#4-populate-the-private-registry-1" title="Direct link to heading">​</a></h3><p>Move the images in the <code>rancher-windows-images.tar.gz</code> to your private registry using the scripts to load the images.</p><p>The <code>rancher-windows-images.txt</code> is expected to be on the workstation in the same directory that you are running the <code>rancher-load-images.ps1</code> script. The <code>rancher-windows-images.tar.gz</code> should also be in the same directory.</p><ol><li><p>Using <code>powershell</code>, log into your private registry if required:</p><div class="language-plain codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-plain codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">docker login &lt;REGISTRY.YOURDOMAIN.COM:PORT&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>Using <code>powershell</code>, use <code>rancher-load-images.ps1</code> to extract, tag and push the images from <code>rancher-images.tar.gz</code> to your private registry:</p><div class="language-plain codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-plain codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">./rancher-load-images.ps1 --registry &lt;REGISTRY.YOURDOMAIN.COM:PORT&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li></ol><h1>Linux Steps</h1><p>The Linux images need to be collected and pushed from a Linux host, but <em>must be done after</em> populating the Windows images into the private registry. These step are different from the Linux only steps as the Linux images that are pushed will actually manifests that support Windows and Linux images.</p><ol><li><a href="#linux-1">Find the required assets for your Rancher version</a></li><li><a href="#linux-2">Collect all the required images</a></li><li><a href="#linux-3">Save the images to your Linux workstation</a></li><li><a href="#linux-4">Populate the private registry</a></li></ol><h3 class="anchor anchorWithStickyNavbar_LWe7" id="prerequisites-2">Prerequisites<a class="hash-link" href="#prerequisites-2" title="Direct link to heading">​</a></h3><p>You must populate the private registry with the Windows images before populating the private registry with Linux images. If you have already populated the registry with Linux images, you will need to follow these instructions again as they will publish manifests that support Windows and Linux images.</p><p>These steps expect you to use a Linux workstation that has internet access, access to your private registry, and at least 20 GB of disk space.</p><p>The workstation must have Docker 18.02+ in order to support manifests, which are required when provisioning Windows clusters.</p><a name="linux-1"></a><h3 class="anchor anchorWithStickyNavbar_LWe7" id="1-find-the-required-assets-for-your-rancher-version-2">1. Find the required assets for your Rancher version<a class="hash-link" href="#1-find-the-required-assets-for-your-rancher-version-2" title="Direct link to heading">​</a></h3><ol><li><p>Browse to our <a href="https://github.com/rancher/rancher/releases" target="_blank" rel="noopener noreferrer">releases page</a> and find the Rancher v2.x.x release that you want to install. Don&#x27;t download releases marked <code>rc</code> or <code>Pre-release</code>, as they are not stable for production environments. Click <strong>Assets.</strong></p></li><li><p>From the release&#x27;s <strong>Assets</strong> section, download the following files:</p></li></ol><table><thead><tr><th>Release File</th><th>Description</th></tr></thead><tbody><tr><td><code>rancher-images.txt</code></td><td>This file contains a list of images needed to install Rancher, provision clusters and user Rancher tools.</td></tr><tr><td><code>rancher-windows-images.txt</code></td><td>This file contains a list of images needed to provision Windows clusters.</td></tr><tr><td><code>rancher-save-images.sh</code></td><td>This script pulls all the images in the <code>rancher-images.txt</code> from Docker Hub and saves all of the images as <code>rancher-images.tar.gz</code>.</td></tr><tr><td><code>rancher-load-images.sh</code></td><td>This script loads images from the <code>rancher-images.tar.gz</code> file and pushes them to your private registry.</td></tr></tbody></table><a name="linux-2"></a><h3 class="anchor anchorWithStickyNavbar_LWe7" id="2-collect-all-the-required-images">2. Collect all the required images<a class="hash-link" href="#2-collect-all-the-required-images" title="Direct link to heading">​</a></h3><p><strong>For Kubernetes Installs using Rancher Generated Self-Signed Certificate:</strong> In a Kubernetes Install, if you elect to use the Rancher default self-signed TLS certificates, you must add the <a href="https://hub.helm.sh/charts/jetstack/cert-manager" target="_blank" rel="noopener noreferrer"><code>cert-manager</code></a> image to <code>rancher-images.txt</code> as well. You skip this step if you are using you using your own certificates.</p><ol><li><p>Fetch the latest <code>cert-manager</code> Helm chart and parse the template for image details:</p><blockquote><p><strong>Note:</strong> Recent changes to cert-manager require an upgrade. If you are upgrading Rancher and using a version of cert-manager older than v0.12.0, please see our <a href="/v2.5/getting-started/installation-and-upgrade/resources/upgrade-cert-manager">upgrade documentation</a>.</p><div class="language-plain codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-plain codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">helm repo add jetstack https://charts.jetstack.io</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">helm repo update</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">helm fetch jetstack/cert-manager --version v0.12.0</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">helm template ./cert-manager-&lt;version&gt;.tgz | | awk &#x27;$1 ~ /image:/ {print $2}&#x27; | sed s/\&quot;//g &gt;&gt; ./rancher-images.txt</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></blockquote></li><li><p>Sort and unique the images list to remove any overlap between the sources:</p><div class="language-plain codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-plain codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">sort -u rancher-images.txt -o rancher-images.txt</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li></ol><a name="linux-3"></a><h3 class="anchor anchorWithStickyNavbar_LWe7" id="3-save-the-images-to-your-workstation-1">3. Save the images to your workstation<a class="hash-link" href="#3-save-the-images-to-your-workstation-1" title="Direct link to heading">​</a></h3><ol><li><p>Make <code>rancher-save-images.sh</code> an executable:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">chmod +x rancher-save-images.sh</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>Run <code>rancher-save-images.sh</code> with the <code>rancher-images.txt</code> image list to create a tarball of all the required images:</p><div class="language-plain codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-plain codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">./rancher-save-images.sh --image-list ./rancher-images.txt</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li></ol><p><strong>Result:</strong> Docker begins pulling the images used for an air gap install. Be patient. This process takes a few minutes. When the process completes, your current directory will output a tarball named <code>rancher-images.tar.gz</code>. Check that the output is in the directory.</p><a name="linux-4"></a><h3 class="anchor anchorWithStickyNavbar_LWe7" id="4-populate-the-private-registry-2">4. Populate the private registry<a class="hash-link" href="#4-populate-the-private-registry-2" title="Direct link to heading">​</a></h3><p>Move the images in the <code>rancher-images.tar.gz</code> to your private registry using the <code>rancher-load-images.sh script</code> to load the images.</p><p>The image list, <code>rancher-images.txt</code> or <code>rancher-windows-images.txt</code>, is expected to be on the workstation in the same directory that you are running the <code>rancher-load-images.sh</code> script. The <code>rancher-images.tar.gz</code> should also be in the same directory.</p><ol><li><p>Log into your private registry if required:</p><div class="language-plain codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-plain codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">docker login &lt;REGISTRY.YOURDOMAIN.COM:PORT&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>Make <code>rancher-load-images.sh</code> an executable:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">chmod +x rancher-load-images.sh</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>Use <code>rancher-load-images.sh</code> to extract, tag and push the images from <code>rancher-images.tar.gz</code> to your private registry:</p></li></ol><div class="language-plain codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-plain codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">./rancher-load-images.sh --image-list ./rancher-images.txt \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   --windows-image-list ./rancher-windows-images.txt \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   --registry &lt;REGISTRY.YOURDOMAIN.COM:PORT&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="next-step-for-kubernetes-installs---launch-a-kubernetes-cluster"><a href="/v2.5/getting-started/installation-and-upgrade/other-installation-methods/air-gapped-helm-cli-install/install-kubernetes">Next step for Kubernetes Installs - Launch a Kubernetes Cluster</a><a class="hash-link" href="#next-step-for-kubernetes-installs---launch-a-kubernetes-cluster" title="Direct link to heading">​</a></h3><h3 class="anchor anchorWithStickyNavbar_LWe7" id="next-step-for-docker-installs---install-rancher"><a href="/v2.5/getting-started/installation-and-upgrade/other-installation-methods/air-gapped-helm-cli-install/install-rancher-ha">Next step for Docker Installs - Install Rancher</a><a class="hash-link" href="#next-step-for-docker-installs---install-rancher" title="Direct link to heading">​</a></h3></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/rancher/rancher-docs/edit/main/versioned_docs/version-2.5/getting-started/installation-and-upgrade/other-installation-methods/air-gapped-helm-cli-install/publish-images.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_eYIM" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vbeJ"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2022-09-08T22:35:34.000Z">9/8/2022</time></b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/v2.5/getting-started/installation-and-upgrade/other-installation-methods/air-gapped-helm-cli-install/infrastructure-private-registry"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">1. Set up Infrastructure and Private Registry</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/v2.5/getting-started/installation-and-upgrade/other-installation-methods/air-gapped-helm-cli-install/install-kubernetes"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">3. Install Kubernetes (Skip for Docker Installs)</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#prerequisites" class="table-of-contents__link toc-highlight">Prerequisites</a></li><li><a href="#1-find-the-required-assets-for-your-rancher-version" class="table-of-contents__link toc-highlight">1. Find the required assets for your Rancher version</a></li><li><a href="#2-collect-the-cert-manager-image" class="table-of-contents__link toc-highlight">2. Collect the cert-manager image</a></li><li><a href="#3-save-the-images-to-your-workstation" class="table-of-contents__link toc-highlight">3. Save the images to your workstation</a></li><li><a href="#4-populate-the-private-registry" class="table-of-contents__link toc-highlight">4. Populate the private registry</a></li><li><a href="#prerequisites-1" class="table-of-contents__link toc-highlight">Prerequisites</a></li><li><a href="#1-find-the-required-assets-for-your-rancher-version-1" class="table-of-contents__link toc-highlight">1. Find the required assets for your Rancher version</a></li><li><a href="#2-save-the-images-to-your-windows-server-workstation" class="table-of-contents__link toc-highlight">2. Save the images to your Windows Server workstation</a></li><li><a href="#3-prepare-the-docker-daemon" class="table-of-contents__link toc-highlight">3. Prepare the Docker daemon</a></li><li><a href="#4-populate-the-private-registry-1" class="table-of-contents__link toc-highlight">4. Populate the private registry</a></li><li><a href="#prerequisites-2" class="table-of-contents__link toc-highlight">Prerequisites</a></li><li><a href="#1-find-the-required-assets-for-your-rancher-version-2" class="table-of-contents__link toc-highlight">1. Find the required assets for your Rancher version</a></li><li><a href="#2-collect-all-the-required-images" class="table-of-contents__link toc-highlight">2. Collect all the required images</a></li><li><a href="#3-save-the-images-to-your-workstation-1" class="table-of-contents__link toc-highlight">3. Save the images to your workstation</a></li><li><a href="#4-populate-the-private-registry-2" class="table-of-contents__link toc-highlight">4. Populate the private registry</a></li><li><a href="#next-step-for-kubernetes-installs---launch-a-kubernetes-cluster" class="table-of-contents__link toc-highlight">Next step for Kubernetes Installs - Launch a Kubernetes Cluster</a></li><li><a href="#next-step-for-docker-installs---install-rancher" class="table-of-contents__link toc-highlight">Next step for Docker Installs - Install Rancher</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2022 SUSE Rancher. All Rights Reserved.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.217a7f9f.js"></script>
<script src="/assets/js/main.00d8b9dc.js"></script>
</body>
</html>